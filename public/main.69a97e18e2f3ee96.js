(self.webpackChunkPuntos_de_CyL=self.webpackChunkPuntos_de_CyL||[]).push([[179],{2340:(Yn,ct,we)=>{"use strict";we.d(ct,{N:()=>W});const W={mapboxToken:"pk.eyJ1IjoianVuY2EyMzUiLCJhIjoiY2xmdjBpa2VnMDJrYzNrbzMwMmEyOXlmZiJ9.GJ8cigJUn2cUWxd_Wx_5VQ",mongoUrl:"http://localhost:4000/api",jcylUrl:"https://analisis.datosabiertos.jcyl.es/api/records/1.0/search/?dataset=puntos-de-recarga-del-vehiculo-electrico&rows=123"}},4066:(Yn,ct,we)=>{"use strict";var W=we(1481),ee=we(1571),Ve=we(7340);function Ie(Q){return new ee.vHH(3e3,!1)}function yn(){return typeof window<"u"&&typeof window.document<"u"}function Qt(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function wr(Q){switch(Q.length){case 0:return new Ve.ZN;case 1:return Q[0];default:return new Ve.ZE(Q)}}function ir(Q,M,A,j,ne=new Map,ge=new Map){const Oe=[],ze=[];let Qe=-1,Et=null;if(j.forEach(mn=>{const gn=mn.get("offset"),ur=gn==Qe,hr=ur&&Et||new Map;mn.forEach((Vn,Xn)=>{let pr=Xn,Br=Vn;if("offset"!==Xn)switch(pr=M.normalizePropertyName(pr,Oe),Br){case Ve.k1:Br=ne.get(Xn);break;case Ve.l3:Br=ge.get(Xn);break;default:Br=M.normalizeStyleValue(Xn,pr,Br,Oe)}hr.set(pr,Br)}),ur||ze.push(hr),Et=hr,Qe=gn}),Oe.length)throw function un(Q){return new ee.vHH(3502,!1)}();return ze}function Xr(Q,M,A,j){switch(M){case"start":Q.onStart(()=>j(A&&Tn(A,"start",Q)));break;case"done":Q.onDone(()=>j(A&&Tn(A,"done",Q)));break;case"destroy":Q.onDestroy(()=>j(A&&Tn(A,"destroy",Q)))}}function Tn(Q,M,A){const ge=ni(Q.element,Q.triggerName,Q.fromState,Q.toState,M||Q.phaseName,A.totalTime??Q.totalTime,!!A.disabled),Oe=Q._data;return null!=Oe&&(ge._data=Oe),ge}function ni(Q,M,A,j,ne="",ge=0,Oe){return{element:Q,triggerName:M,fromState:A,toState:j,phaseName:ne,totalTime:ge,disabled:!!Oe}}function Dn(Q,M,A){let j=Q.get(M);return j||Q.set(M,j=A),j}function ei(Q){const M=Q.indexOf(":");return[Q.substring(1,M),Q.slice(M+1)]}let ri=(Q,M)=>!1,qi=(Q,M,A)=>[],vn=null;function sr(Q){const M=Q.parentNode||Q.host;return M===vn?null:M}(Qt()||typeof Element<"u")&&(yn()?(vn=(()=>document.documentElement)(),ri=(Q,M)=>{for(;M;){if(M===Q)return!0;M=sr(M)}return!1}):ri=(Q,M)=>Q.contains(M),qi=(Q,M,A)=>{if(A)return Array.from(Q.querySelectorAll(M));const j=Q.querySelector(M);return j?[j]:[]});let Fr=null,Bo=!1;const zr=ri,xn=qi;let xi=(()=>{class Q{validateStyleProperty(A){return function Ii(Q){Fr||(Fr=function to(){return typeof document<"u"?document.body:null}()||{},Bo=!!Fr.style&&"WebkitAppearance"in Fr.style);let M=!0;return Fr.style&&!function Kr(Q){return"ebkit"==Q.substring(1,6)}(Q)&&(M=Q in Fr.style,!M&&Bo&&(M="Webkit"+Q.charAt(0).toUpperCase()+Q.slice(1)in Fr.style)),M}(A)}matchesElement(A,j){return!1}containsElement(A,j){return zr(A,j)}getParentElement(A){return sr(A)}query(A,j,ne){return xn(A,j,ne)}computeStyle(A,j,ne){return ne||""}animate(A,j,ne,ge,Oe,ze=[],Qe){return new Ve.ZN(ne,ge)}}return Q.\u0275fac=function(A){return new(A||Q)},Q.\u0275prov=ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})(),yr=(()=>{class Q{}return Q.NOOP=new xi,Q})();const Ai=1e3,Pi="ng-enter",Ar="ng-leave",ho="ng-trigger",vr=".ng-trigger",ro="ng-animating",Vi=".ng-animating";function ii(Q){if("number"==typeof Q)return Q;const M=Q.match(/^(-?[\.\d]+)(m?s)/);return!M||M.length<2?0:Hn(parseFloat(M[1]),M[2])}function Hn(Q,M){return"s"===M?Q*Ai:Q}function _t(Q,M,A){return Q.hasOwnProperty("duration")?Q:function Fe(Q,M,A){let ne,ge=0,Oe="";if("string"==typeof Q){const ze=Q.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===ze)return M.push(Ie()),{duration:0,delay:0,easing:""};ne=Hn(parseFloat(ze[1]),ze[2]);const Qe=ze[3];null!=Qe&&(ge=Hn(parseFloat(Qe),ze[4]));const Et=ze[5];Et&&(Oe=Et)}else ne=Q;if(!A){let ze=!1,Qe=M.length;ne<0&&(M.push(function Xt(){return new ee.vHH(3100,!1)}()),ze=!0),ge<0&&(M.push(function St(){return new ee.vHH(3101,!1)}()),ze=!0),ze&&M.splice(Qe,0,Ie())}return{duration:ne,delay:ge,easing:Oe}}(Q,M,A)}function Le(Q,M={}){return Object.keys(Q).forEach(A=>{M[A]=Q[A]}),M}function $t(Q){const M=new Map;return Object.keys(Q).forEach(A=>{M.set(A,Q[A])}),M}function he(Q,M=new Map,A){if(A)for(let[j,ne]of A)M.set(j,ne);for(let[j,ne]of Q)M.set(j,ne);return M}function H(Q,M,A){return A?M+":"+A+";":""}function K(Q){let M="";for(let A=0;A<Q.style.length;A++){const j=Q.style.item(A);M+=H(0,j,Q.style.getPropertyValue(j))}for(const A in Q.style)Q.style.hasOwnProperty(A)&&!A.startsWith("_")&&(M+=H(0,en(A),Q.style[A]));Q.setAttribute("style",M)}function fe(Q,M,A){Q.style&&(M.forEach((j,ne)=>{const ge=dt(ne);A&&!A.has(ne)&&A.set(ne,Q.style[ge]),Q.style[ge]=j}),Qt()&&K(Q))}function Ee(Q,M){Q.style&&(M.forEach((A,j)=>{const ne=dt(j);Q.style[ne]=""}),Qt()&&K(Q))}function se(Q){return Array.isArray(Q)?1==Q.length?Q[0]:(0,Ve.vP)(Q):Q}const q=new RegExp("{{\\s*(.+?)\\s*}}","g");function re(Q){let M=[];if("string"==typeof Q){let A;for(;A=q.exec(Q);)M.push(A[1]);q.lastIndex=0}return M}function pe(Q,M,A){const j=Q.toString(),ne=j.replace(q,(ge,Oe)=>{let ze=M[Oe];return null==ze&&(A.push(function xt(Q){return new ee.vHH(3003,!1)}()),ze=""),ze.toString()});return ne==j?Q:ne}function Ue(Q){const M=[];let A=Q.next();for(;!A.done;)M.push(A.value),A=Q.next();return M}const ft=/-+([a-z0-9])/g;function dt(Q){return Q.replace(ft,(...M)=>M[1].toUpperCase())}function en(Q){return Q.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function an(Q,M,A){switch(M.type){case 7:return Q.visitTrigger(M,A);case 0:return Q.visitState(M,A);case 1:return Q.visitTransition(M,A);case 2:return Q.visitSequence(M,A);case 3:return Q.visitGroup(M,A);case 4:return Q.visitAnimate(M,A);case 5:return Q.visitKeyframes(M,A);case 6:return Q.visitStyle(M,A);case 8:return Q.visitReference(M,A);case 9:return Q.visitAnimateChild(M,A);case 10:return Q.visitAnimateRef(M,A);case 11:return Q.visitQuery(M,A);case 12:return Q.visitStagger(M,A);default:throw function nt(Q){return new ee.vHH(3004,!1)}()}}function or(Q,M){return window.getComputedStyle(Q)[M]}const io="*";function Wn(Q,M){const A=[];return"string"==typeof Q?Q.split(/\s*,\s*/).forEach(j=>function _i(Q,M,A){if(":"==Q[0]){const Qe=function zi(Q,M){switch(Q){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(A,j)=>parseFloat(j)>parseFloat(A);case":decrement":return(A,j)=>parseFloat(j)<parseFloat(A);default:return M.push(function _n(Q){return new ee.vHH(3016,!1)}()),"* => *"}}(Q,A);if("function"==typeof Qe)return void M.push(Qe);Q=Qe}const j=Q.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==j||j.length<4)return A.push(function sn(Q){return new ee.vHH(3015,!1)}()),M;const ne=j[1],ge=j[2],Oe=j[3];M.push(Ks(ne,Oe));"<"==ge[0]&&!(ne==io&&Oe==io)&&M.push(Ks(Oe,ne))}(j,A,M)):A.push(Q),A}const oi=new Set(["true","1"]),Gr=new Set(["false","0"]);function Ks(Q,M){const A=oi.has(Q)||Gr.has(Q),j=oi.has(M)||Gr.has(M);return(ne,ge)=>{let Oe=Q==io||Q==ne,ze=M==io||M==ge;return!Oe&&A&&"boolean"==typeof ne&&(Oe=ne?oi.has(Q):Gr.has(Q)),!ze&&j&&"boolean"==typeof ge&&(ze=ge?oi.has(M):Gr.has(M)),Oe&&ze}}const Zt=new RegExp("s*:selfs*,?","g");function Fn(Q,M,A,j){return new Zn(Q).build(M,A,j)}class Zn{constructor(M){this._driver=M}build(M,A,j){const ne=new oo(A);return this._resetContextStyleTimingState(ne),an(this,se(M),ne)}_resetContextStyleTimingState(M){M.currentQuerySelector="",M.collectedStyles=new Map,M.collectedStyles.set("",new Map),M.currentTime=0}visitTrigger(M,A){let j=A.queryCount=0,ne=A.depCount=0;const ge=[],Oe=[];return"@"==M.name.charAt(0)&&A.errors.push(function Ct(){return new ee.vHH(3006,!1)}()),M.definitions.forEach(ze=>{if(this._resetContextStyleTimingState(A),0==ze.type){const Qe=ze,Et=Qe.name;Et.toString().split(/\s*,\s*/).forEach(mn=>{Qe.name=mn,ge.push(this.visitState(Qe,A))}),Qe.name=Et}else if(1==ze.type){const Qe=this.visitTransition(ze,A);j+=Qe.queryCount,ne+=Qe.depCount,Oe.push(Qe)}else A.errors.push(function jn(){return new ee.vHH(3007,!1)}())}),{type:7,name:M.name,states:ge,transitions:Oe,queryCount:j,depCount:ne,options:null}}visitState(M,A){const j=this.visitStyle(M.styles,A),ne=M.options&&M.options.params||null;if(j.containsDynamicStyles){const ge=new Set,Oe=ne||{};j.styles.forEach(ze=>{ze instanceof Map&&ze.forEach(Qe=>{re(Qe).forEach(Et=>{Oe.hasOwnProperty(Et)||ge.add(Et)})})}),ge.size&&(Ue(ge.values()),A.errors.push(function Kt(Q,M){return new ee.vHH(3008,!1)}()))}return{type:0,name:M.name,style:j,options:ne?{params:ne}:null}}visitTransition(M,A){A.queryCount=0,A.depCount=0;const j=an(this,se(M.animation),A);return{type:1,matchers:Wn(M.expr,A.errors),animation:j,queryCount:A.queryCount,depCount:A.depCount,options:Jn(M.options)}}visitSequence(M,A){return{type:2,steps:M.steps.map(j=>an(this,j,A)),options:Jn(M.options)}}visitGroup(M,A){const j=A.currentTime;let ne=0;const ge=M.steps.map(Oe=>{A.currentTime=j;const ze=an(this,Oe,A);return ne=Math.max(ne,A.currentTime),ze});return A.currentTime=ne,{type:3,steps:ge,options:Jn(M.options)}}visitAnimate(M,A){const j=function Co(Q,M){if(Q.hasOwnProperty("duration"))return Q;if("number"==typeof Q)return br(_t(Q,M).duration,0,"");const A=Q;if(A.split(/\s+/).some(ge=>"{"==ge.charAt(0)&&"{"==ge.charAt(1))){const ge=br(0,0,"");return ge.dynamic=!0,ge.strValue=A,ge}const ne=_t(A,M);return br(ne.duration,ne.delay,ne.easing)}(M.timings,A.errors);A.currentAnimateTimings=j;let ne,ge=M.styles?M.styles:(0,Ve.oB)({});if(5==ge.type)ne=this.visitKeyframes(ge,A);else{let Oe=M.styles,ze=!1;if(!Oe){ze=!0;const Et={};j.easing&&(Et.easing=j.easing),Oe=(0,Ve.oB)(Et)}A.currentTime+=j.duration+j.delay;const Qe=this.visitStyle(Oe,A);Qe.isEmptyStep=ze,ne=Qe}return A.currentAnimateTimings=null,{type:4,timings:j,style:ne,options:null}}visitStyle(M,A){const j=this._makeStyleAst(M,A);return this._validateStyleAst(j,A),j}_makeStyleAst(M,A){const j=[],ne=Array.isArray(M.styles)?M.styles:[M.styles];for(let ze of ne)"string"==typeof ze?ze===Ve.l3?j.push(ze):A.errors.push(new ee.vHH(3002,!1)):j.push($t(ze));let ge=!1,Oe=null;return j.forEach(ze=>{if(ze instanceof Map&&(ze.has("easing")&&(Oe=ze.get("easing"),ze.delete("easing")),!ge))for(let Qe of ze.values())if(Qe.toString().indexOf("{{")>=0){ge=!0;break}}),{type:6,styles:j,easing:Oe,offset:M.offset,containsDynamicStyles:ge,options:null}}_validateStyleAst(M,A){const j=A.currentAnimateTimings;let ne=A.currentTime,ge=A.currentTime;j&&ge>0&&(ge-=j.duration+j.delay),M.styles.forEach(Oe=>{"string"!=typeof Oe&&Oe.forEach((ze,Qe)=>{const Et=A.collectedStyles.get(A.currentQuerySelector),mn=Et.get(Qe);let gn=!0;mn&&(ge!=ne&&ge>=mn.startTime&&ne<=mn.endTime&&(A.errors.push(function Gn(Q,M,A,j,ne){return new ee.vHH(3010,!1)}()),gn=!1),ge=mn.startTime),gn&&Et.set(Qe,{startTime:ge,endTime:ne}),A.options&&function ie(Q,M,A){const j=M.params||{},ne=re(Q);ne.length&&ne.forEach(ge=>{j.hasOwnProperty(ge)||A.push(function wt(Q){return new ee.vHH(3001,!1)}())})}(ze,A.options,A.errors)})})}visitKeyframes(M,A){const j={type:5,styles:[],options:null};if(!A.currentAnimateTimings)return A.errors.push(function st(){return new ee.vHH(3011,!1)}()),j;let ge=0;const Oe=[];let ze=!1,Qe=!1,Et=0;const mn=M.steps.map(Br=>{const Jr=this._makeStyleAst(Br,A);let Pr=null!=Jr.offset?Jr.offset:function Yr(Q){if("string"==typeof Q)return null;let M=null;if(Array.isArray(Q))Q.forEach(A=>{if(A instanceof Map&&A.has("offset")){const j=A;M=parseFloat(j.get("offset")),j.delete("offset")}});else if(Q instanceof Map&&Q.has("offset")){const A=Q;M=parseFloat(A.get("offset")),A.delete("offset")}return M}(Jr.styles),qr=0;return null!=Pr&&(ge++,qr=Jr.offset=Pr),Qe=Qe||qr<0||qr>1,ze=ze||qr<Et,Et=qr,Oe.push(qr),Jr});Qe&&A.errors.push(function Pn(){return new ee.vHH(3012,!1)}()),ze&&A.errors.push(function Or(){return new ee.vHH(3200,!1)}());const gn=M.steps.length;let ur=0;ge>0&&ge<gn?A.errors.push(function Ye(){return new ee.vHH(3202,!1)}()):0==ge&&(ur=1/(gn-1));const hr=gn-1,Vn=A.currentTime,Xn=A.currentAnimateTimings,pr=Xn.duration;return mn.forEach((Br,Jr)=>{const Pr=ur>0?Jr==hr?1:ur*Jr:Oe[Jr],qr=Pr*pr;A.currentTime=Vn+Xn.delay+qr,Xn.duration=qr,this._validateStyleAst(Br,A),Br.offset=Pr,j.styles.push(Br)}),j}visitReference(M,A){return{type:8,animation:an(this,se(M.animation),A),options:Jn(M.options)}}visitAnimateChild(M,A){return A.depCount++,{type:9,options:Jn(M.options)}}visitAnimateRef(M,A){return{type:10,animation:this.visitReference(M.animation,A),options:Jn(M.options)}}visitQuery(M,A){const j=A.currentQuerySelector,ne=M.options||{};A.queryCount++,A.currentQuery=M;const[ge,Oe]=function Nr(Q){const M=!!Q.split(/\s*,\s*/).find(A=>":self"==A);return M&&(Q=Q.replace(Zt,"")),Q=Q.replace(/@\*/g,vr).replace(/@\w+/g,A=>vr+"-"+A.slice(1)).replace(/:animating/g,Vi),[Q,M]}(M.selector);A.currentQuerySelector=j.length?j+" "+ge:ge,Dn(A.collectedStyles,A.currentQuerySelector,new Map);const ze=an(this,se(M.animation),A);return A.currentQuery=null,A.currentQuerySelector=j,{type:11,selector:ge,limit:ne.limit||0,optional:!!ne.optional,includeSelf:Oe,animation:ze,originalSelector:M.selector,options:Jn(M.options)}}visitStagger(M,A){A.currentQuery||A.errors.push(function Ne(){return new ee.vHH(3013,!1)}());const j="full"===M.timings?{duration:0,delay:0,easing:"full"}:_t(M.timings,A.errors,!0);return{type:12,animation:an(this,se(M.animation),A),timings:j,options:null}}}class oo{constructor(M){this.errors=M,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Jn(Q){return Q?(Q=Le(Q)).params&&(Q.params=function $n(Q){return Q?Le(Q):null}(Q.params)):Q={},Q}function br(Q,M,A){return{duration:Q,delay:M,easing:A}}function Es(Q,M,A,j,ne,ge,Oe=null,ze=!1){return{type:1,element:Q,keyframes:M,preStyleProps:A,postStyleProps:j,duration:ne,delay:ge,totalTime:ne+ge,easing:Oe,subTimeline:ze}}class Ln{constructor(){this._map=new Map}get(M){return this._map.get(M)||[]}append(M,A){let j=this._map.get(M);j||this._map.set(M,j=[]),j.push(...A)}has(M){return this._map.has(M)}clear(){this._map.clear()}}const Ys=new RegExp(":enter","g"),si=new RegExp(":leave","g");function so(Q,M,A,j,ne,ge=new Map,Oe=new Map,ze,Qe,Et=[]){return(new ui).buildKeyframes(Q,M,A,j,ne,ge,Oe,ze,Qe,Et)}class ui{buildKeyframes(M,A,j,ne,ge,Oe,ze,Qe,Et,mn=[]){Et=Et||new Ln;const gn=new Ri(M,A,Et,ne,ge,mn,[]);gn.options=Qe;const ur=Qe.delay?ii(Qe.delay):0;gn.currentTimeline.delayNextStep(ur),gn.currentTimeline.setStyles([Oe],null,gn.errors,Qe),an(this,j,gn);const hr=gn.timelines.filter(Vn=>Vn.containsAnimation());if(hr.length&&ze.size){let Vn;for(let Xn=hr.length-1;Xn>=0;Xn--){const pr=hr[Xn];if(pr.element===A){Vn=pr;break}}Vn&&!Vn.allowOnlyTimelineStyles()&&Vn.setStyles([ze],null,gn.errors,Qe)}return hr.length?hr.map(Vn=>Vn.buildKeyframes()):[Es(A,[],[],[],0,ur,"",!1)]}visitTrigger(M,A){}visitState(M,A){}visitTransition(M,A){}visitAnimateChild(M,A){const j=A.subInstructions.get(A.element);if(j){const ne=A.createSubContext(M.options),ge=A.currentTimeline.currentTime,Oe=this._visitSubInstructions(j,ne,ne.options);ge!=Oe&&A.transformIntoNewTimeline(Oe)}A.previousNode=M}visitAnimateRef(M,A){const j=A.createSubContext(M.options);j.transformIntoNewTimeline(),this._applyAnimationRefDelays([M.options,M.animation.options],A,j),this.visitReference(M.animation,j),A.transformIntoNewTimeline(j.currentTimeline.currentTime),A.previousNode=M}_applyAnimationRefDelays(M,A,j){for(const ne of M){const ge=ne?.delay;if(ge){const Oe="number"==typeof ge?ge:ii(pe(ge,ne?.params??{},A.errors));j.delayNextStep(Oe)}}}_visitSubInstructions(M,A,j){let ge=A.currentTimeline.currentTime;const Oe=null!=j.duration?ii(j.duration):null,ze=null!=j.delay?ii(j.delay):null;return 0!==Oe&&M.forEach(Qe=>{const Et=A.appendInstructionToTimeline(Qe,Oe,ze);ge=Math.max(ge,Et.duration+Et.delay)}),ge}visitReference(M,A){A.updateOptions(M.options,!0),an(this,M.animation,A),A.previousNode=M}visitSequence(M,A){const j=A.subContextCount;let ne=A;const ge=M.options;if(ge&&(ge.params||ge.delay)&&(ne=A.createSubContext(ge),ne.transformIntoNewTimeline(),null!=ge.delay)){6==ne.previousNode.type&&(ne.currentTimeline.snapshotCurrentStyles(),ne.previousNode=Bi);const Oe=ii(ge.delay);ne.delayNextStep(Oe)}M.steps.length&&(M.steps.forEach(Oe=>an(this,Oe,ne)),ne.currentTimeline.applyStylesToKeyframe(),ne.subContextCount>j&&ne.transformIntoNewTimeline()),A.previousNode=M}visitGroup(M,A){const j=[];let ne=A.currentTimeline.currentTime;const ge=M.options&&M.options.delay?ii(M.options.delay):0;M.steps.forEach(Oe=>{const ze=A.createSubContext(M.options);ge&&ze.delayNextStep(ge),an(this,Oe,ze),ne=Math.max(ne,ze.currentTimeline.currentTime),j.push(ze.currentTimeline)}),j.forEach(Oe=>A.currentTimeline.mergeTimelineCollectedStyles(Oe)),A.transformIntoNewTimeline(ne),A.previousNode=M}_visitTiming(M,A){if(M.dynamic){const j=M.strValue;return _t(A.params?pe(j,A.params,A.errors):j,A.errors)}return{duration:M.duration,delay:M.delay,easing:M.easing}}visitAnimate(M,A){const j=A.currentAnimateTimings=this._visitTiming(M.timings,A),ne=A.currentTimeline;j.delay&&(A.incrementTime(j.delay),ne.snapshotCurrentStyles());const ge=M.style;5==ge.type?this.visitKeyframes(ge,A):(A.incrementTime(j.duration),this.visitStyle(ge,A),ne.applyStylesToKeyframe()),A.currentAnimateTimings=null,A.previousNode=M}visitStyle(M,A){const j=A.currentTimeline,ne=A.currentAnimateTimings;!ne&&j.hasCurrentStyleProperties()&&j.forwardFrame();const ge=ne&&ne.easing||M.easing;M.isEmptyStep?j.applyEmptyStep(ge):j.setStyles(M.styles,ge,A.errors,A.options),A.previousNode=M}visitKeyframes(M,A){const j=A.currentAnimateTimings,ne=A.currentTimeline.duration,ge=j.duration,ze=A.createSubContext().currentTimeline;ze.easing=j.easing,M.styles.forEach(Qe=>{ze.forwardTime((Qe.offset||0)*ge),ze.setStyles(Qe.styles,Qe.easing,A.errors,A.options),ze.applyStylesToKeyframe()}),A.currentTimeline.mergeTimelineCollectedStyles(ze),A.transformIntoNewTimeline(ne+ge),A.previousNode=M}visitQuery(M,A){const j=A.currentTimeline.currentTime,ne=M.options||{},ge=ne.delay?ii(ne.delay):0;ge&&(6===A.previousNode.type||0==j&&A.currentTimeline.hasCurrentStyleProperties())&&(A.currentTimeline.snapshotCurrentStyles(),A.previousNode=Bi);let Oe=j;const ze=A.invokeQuery(M.selector,M.originalSelector,M.limit,M.includeSelf,!!ne.optional,A.errors);A.currentQueryTotal=ze.length;let Qe=null;ze.forEach((Et,mn)=>{A.currentQueryIndex=mn;const gn=A.createSubContext(M.options,Et);ge&&gn.delayNextStep(ge),Et===A.element&&(Qe=gn.currentTimeline),an(this,M.animation,gn),gn.currentTimeline.applyStylesToKeyframe(),Oe=Math.max(Oe,gn.currentTimeline.currentTime)}),A.currentQueryIndex=0,A.currentQueryTotal=0,A.transformIntoNewTimeline(Oe),Qe&&(A.currentTimeline.mergeTimelineCollectedStyles(Qe),A.currentTimeline.snapshotCurrentStyles()),A.previousNode=M}visitStagger(M,A){const j=A.parentContext,ne=A.currentTimeline,ge=M.timings,Oe=Math.abs(ge.duration),ze=Oe*(A.currentQueryTotal-1);let Qe=Oe*A.currentQueryIndex;switch(ge.duration<0?"reverse":ge.easing){case"reverse":Qe=ze-Qe;break;case"full":Qe=j.currentStaggerTime}const mn=A.currentTimeline;Qe&&mn.delayNextStep(Qe);const gn=mn.currentTime;an(this,M.animation,A),A.previousNode=M,j.currentStaggerTime=ne.currentTime-gn+(ne.startTime-j.currentTimeline.startTime)}}const Bi={};class Ri{constructor(M,A,j,ne,ge,Oe,ze,Qe){this._driver=M,this.element=A,this.subInstructions=j,this._enterClassName=ne,this._leaveClassName=ge,this.errors=Oe,this.timelines=ze,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Bi,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=Qe||new Hr(this._driver,A,0),ze.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(M,A){if(!M)return;const j=M;let ne=this.options;null!=j.duration&&(ne.duration=ii(j.duration)),null!=j.delay&&(ne.delay=ii(j.delay));const ge=j.params;if(ge){let Oe=ne.params;Oe||(Oe=this.options.params={}),Object.keys(ge).forEach(ze=>{(!A||!Oe.hasOwnProperty(ze))&&(Oe[ze]=pe(ge[ze],Oe,this.errors))})}}_copyOptions(){const M={};if(this.options){const A=this.options.params;if(A){const j=M.params={};Object.keys(A).forEach(ne=>{j[ne]=A[ne]})}}return M}createSubContext(M=null,A,j){const ne=A||this.element,ge=new Ri(this._driver,ne,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(ne,j||0));return ge.previousNode=this.previousNode,ge.currentAnimateTimings=this.currentAnimateTimings,ge.options=this._copyOptions(),ge.updateOptions(M),ge.currentQueryIndex=this.currentQueryIndex,ge.currentQueryTotal=this.currentQueryTotal,ge.parentContext=this,this.subContextCount++,ge}transformIntoNewTimeline(M){return this.previousNode=Bi,this.currentTimeline=this.currentTimeline.fork(this.element,M),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(M,A,j){const ne={duration:A??M.duration,delay:this.currentTimeline.currentTime+(j??0)+M.delay,easing:""},ge=new jr(this._driver,M.element,M.keyframes,M.preStyleProps,M.postStyleProps,ne,M.stretchStartingKeyframe);return this.timelines.push(ge),ne}incrementTime(M){this.currentTimeline.forwardTime(this.currentTimeline.duration+M)}delayNextStep(M){M>0&&this.currentTimeline.delayNextStep(M)}invokeQuery(M,A,j,ne,ge,Oe){let ze=[];if(ne&&ze.push(this.element),M.length>0){M=(M=M.replace(Ys,"."+this._enterClassName)).replace(si,"."+this._leaveClassName);let Et=this._driver.query(this.element,M,1!=j);0!==j&&(Et=j<0?Et.slice(Et.length+j,Et.length):Et.slice(0,j)),ze.push(...Et)}return!ge&&0==ze.length&&Oe.push(function pt(Q){return new ee.vHH(3014,!1)}()),ze}}class Hr{constructor(M,A,j,ne){this._driver=M,this.element=A,this.startTime=j,this._elementTimelineStylesLookup=ne,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(A),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(A,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(M){const A=1===this._keyframes.size&&this._pendingStyles.size;this.duration||A?(this.forwardTime(this.currentTime+M),A&&this.snapshotCurrentStyles()):this.startTime+=M}fork(M,A){return this.applyStylesToKeyframe(),new Hr(this._driver,M,A||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(M){this.applyStylesToKeyframe(),this.duration=M,this._loadKeyframe()}_updateStyle(M,A){this._localTimelineStyles.set(M,A),this._globalTimelineStyles.set(M,A),this._styleSummary.set(M,{time:this.currentTime,value:A})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(M){M&&this._previousKeyframe.set("easing",M);for(let[A,j]of this._globalTimelineStyles)this._backFill.set(A,j||Ve.l3),this._currentKeyframe.set(A,Ve.l3);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(M,A,j,ne){A&&this._previousKeyframe.set("easing",A);const ge=ne&&ne.params||{},Oe=function Yi(Q,M){const A=new Map;let j;return Q.forEach(ne=>{if("*"===ne){j=j||M.keys();for(let ge of j)A.set(ge,Ve.l3)}else he(ne,A)}),A}(M,this._globalTimelineStyles);for(let[ze,Qe]of Oe){const Et=pe(Qe,ge,j);this._pendingStyles.set(ze,Et),this._localTimelineStyles.has(ze)||this._backFill.set(ze,this._globalTimelineStyles.get(ze)??Ve.l3),this._updateStyle(ze,Et)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((M,A)=>{this._currentKeyframe.set(A,M)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((M,A)=>{this._currentKeyframe.has(A)||this._currentKeyframe.set(A,M)}))}snapshotCurrentStyles(){for(let[M,A]of this._localTimelineStyles)this._pendingStyles.set(M,A),this._updateStyle(M,A)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const M=[];for(let A in this._currentKeyframe)M.push(A);return M}mergeTimelineCollectedStyles(M){M._styleSummary.forEach((A,j)=>{const ne=this._styleSummary.get(j);(!ne||A.time>ne.time)&&this._updateStyle(j,A.value)})}buildKeyframes(){this.applyStylesToKeyframe();const M=new Set,A=new Set,j=1===this._keyframes.size&&0===this.duration;let ne=[];this._keyframes.forEach((ze,Qe)=>{const Et=he(ze,new Map,this._backFill);Et.forEach((mn,gn)=>{mn===Ve.k1?M.add(gn):mn===Ve.l3&&A.add(gn)}),j||Et.set("offset",Qe/this.duration),ne.push(Et)});const ge=M.size?Ue(M.values()):[],Oe=A.size?Ue(A.values()):[];if(j){const ze=ne[0],Qe=new Map(ze);ze.set("offset",0),Qe.set("offset",1),ne=[ze,Qe]}return Es(this.element,ne,ge,Oe,this.duration,this.startTime,this.easing,!1)}}class jr extends Hr{constructor(M,A,j,ne,ge,Oe,ze=!1){super(M,A,Oe.delay),this.keyframes=j,this.preStyleProps=ne,this.postStyleProps=ge,this._stretchStartingKeyframe=ze,this.timings={duration:Oe.duration,delay:Oe.delay,easing:Oe.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let M=this.keyframes,{delay:A,duration:j,easing:ne}=this.timings;if(this._stretchStartingKeyframe&&A){const ge=[],Oe=j+A,ze=A/Oe,Qe=he(M[0]);Qe.set("offset",0),ge.push(Qe);const Et=he(M[0]);Et.set("offset",ia(ze)),ge.push(Et);const mn=M.length-1;for(let gn=1;gn<=mn;gn++){let ur=he(M[gn]);const hr=ur.get("offset");ur.set("offset",ia((A+hr*j)/Oe)),ge.push(ur)}j=Oe,A=0,ne="",M=ge}return Es(this.element,M,this.preStyleProps,this.postStyleProps,j,A,ne,!0)}}function ia(Q,M=3){const A=Math.pow(10,M-1);return Math.round(Q*A)/A}class Ns{}const ti=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Ni extends Ns{normalizePropertyName(M,A){return dt(M)}normalizeStyleValue(M,A,j,ne){let ge="";const Oe=j.toString().trim();if(ti.has(A)&&0!==j&&"0"!==j)if("number"==typeof j)ge="px";else{const ze=j.match(/^[+-]?[\d\.]+([a-z]*)$/);ze&&0==ze[1].length&&ne.push(function yt(Q,M){return new ee.vHH(3005,!1)}())}return Oe+ge}}function xa(Q,M,A,j,ne,ge,Oe,ze,Qe,Et,mn,gn,ur){return{type:0,element:Q,triggerName:M,isRemovalTransition:ne,fromState:A,fromStyles:ge,toState:j,toStyles:Oe,timelines:ze,queriedElements:Qe,preStyleProps:Et,postStyleProps:mn,totalTime:gn,errors:ur}}const ki={};class Vr{constructor(M,A,j){this._triggerName=M,this.ast=A,this._stateStyles=j}match(M,A,j,ne){return function Ko(Q,M,A,j,ne){return Q.some(ge=>ge(M,A,j,ne))}(this.ast.matchers,M,A,j,ne)}buildStyles(M,A,j){let ne=this._stateStyles.get("*");return void 0!==M&&(ne=this._stateStyles.get(M?.toString())||ne),ne?ne.buildStyles(A,j):new Map}build(M,A,j,ne,ge,Oe,ze,Qe,Et,mn){const gn=[],ur=this.ast.options&&this.ast.options.params||ki,Vn=this.buildStyles(j,ze&&ze.params||ki,gn),Xn=Qe&&Qe.params||ki,pr=this.buildStyles(ne,Xn,gn),Br=new Set,Jr=new Map,Pr=new Map,qr="void"===ne,Sr={params:So(Xn,ur),delay:this.ast.options?.delay},Ei=mn?[]:so(M,A,this.ast.animation,ge,Oe,Vn,pr,Sr,Et,gn);let Bn=0;if(Ei.forEach(fs=>{Bn=Math.max(fs.duration+fs.delay,Bn)}),gn.length)return xa(A,this._triggerName,j,ne,qr,Vn,pr,[],[],Jr,Pr,Bn,gn);Ei.forEach(fs=>{const F=fs.element,X=Dn(Jr,F,new Set);fs.preStyleProps.forEach(ae=>X.add(ae));const N=Dn(Pr,F,new Set);fs.postStyleProps.forEach(ae=>N.add(ae)),F!==A&&Br.add(F)});const Ho=Ue(Br.values());return xa(A,this._triggerName,j,ne,qr,Vn,pr,Ei,Ho,Jr,Pr,Bn)}}function So(Q,M){const A=Le(M);for(const j in Q)Q.hasOwnProperty(j)&&null!=Q[j]&&(A[j]=Q[j]);return A}class Ji{constructor(M,A,j){this.styles=M,this.defaultParams=A,this.normalizer=j}buildStyles(M,A){const j=new Map,ne=Le(this.defaultParams);return Object.keys(M).forEach(ge=>{const Oe=M[ge];null!==Oe&&(ne[ge]=Oe)}),this.styles.styles.forEach(ge=>{"string"!=typeof ge&&ge.forEach((Oe,ze)=>{Oe&&(Oe=pe(Oe,ne,A));const Qe=this.normalizer.normalizePropertyName(ze,A);Oe=this.normalizer.normalizeStyleValue(ze,Qe,Oe,A),j.set(ze,Oe)})}),j}}class Fa{constructor(M,A,j){this.name=M,this.ast=A,this._normalizer=j,this.transitionFactories=[],this.states=new Map,A.states.forEach(ne=>{this.states.set(ne.name,new Ji(ne.style,ne.options&&ne.options.params||{},j))}),Mo(this.states,"true","1"),Mo(this.states,"false","0"),A.transitions.forEach(ne=>{this.transitionFactories.push(new Vr(M,ne,this.states))}),this.fallbackTransition=function No(Q,M,A){return new Vr(Q,{type:1,animation:{type:2,steps:[],options:null},matchers:[(Oe,ze)=>!0],options:null,queryCount:0,depCount:0},M)}(M,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(M,A,j,ne){return this.transitionFactories.find(Oe=>Oe.match(M,A,j,ne))||null}matchStyles(M,A,j){return this.fallbackTransition.buildStyles(M,A,j)}}function Mo(Q,M,A){Q.has(M)?Q.has(A)||Q.set(A,Q.get(M)):Q.has(A)&&Q.set(M,Q.get(A))}const za=new Ln;class Ds{constructor(M,A,j){this.bodyNode=M,this._driver=A,this._normalizer=j,this._animations=new Map,this._playersById=new Map,this.players=[]}register(M,A){const j=[],ne=[],ge=Fn(this._driver,A,j,ne);if(j.length)throw function rr(Q){return new ee.vHH(3503,!1)}();this._animations.set(M,ge)}_buildPlayer(M,A,j){const ne=M.element,ge=ir(0,this._normalizer,0,M.keyframes,A,j);return this._driver.animate(ne,ge,M.duration,M.delay,M.easing,[],!0)}create(M,A,j={}){const ne=[],ge=this._animations.get(M);let Oe;const ze=new Map;if(ge?(Oe=so(this._driver,A,ge,Pi,Ar,new Map,new Map,j,za,ne),Oe.forEach(mn=>{const gn=Dn(ze,mn.element,new Map);mn.postStyleProps.forEach(ur=>gn.set(ur,null))})):(ne.push(function Vt(){return new ee.vHH(3300,!1)}()),Oe=[]),ne.length)throw function at(Q){return new ee.vHH(3504,!1)}();ze.forEach((mn,gn)=>{mn.forEach((ur,hr)=>{mn.set(hr,this._driver.computeStyle(gn,hr,Ve.l3))})});const Et=wr(Oe.map(mn=>{const gn=ze.get(mn.element);return this._buildPlayer(mn,new Map,gn)}));return this._playersById.set(M,Et),Et.onDestroy(()=>this.destroy(M)),this.players.push(Et),Et}destroy(M){const A=this._getPlayer(M);A.destroy(),this._playersById.delete(M);const j=this.players.indexOf(A);j>=0&&this.players.splice(j,1)}_getPlayer(M){const A=this._playersById.get(M);if(!A)throw function rt(Q){return new ee.vHH(3301,!1)}();return A}listen(M,A,j,ne){const ge=ni(A,"","","");return Xr(this._getPlayer(M),j,ge,ne),()=>{}}command(M,A,j,ne){if("register"==j)return void this.register(M,ne[0]);if("create"==j)return void this.create(M,A,ne[0]||{});const ge=this._getPlayer(M);switch(j){case"play":ge.play();break;case"pause":ge.pause();break;case"reset":ge.reset();break;case"restart":ge.restart();break;case"finish":ge.finish();break;case"init":ge.init();break;case"setPosition":ge.setPosition(parseFloat(ne[0]));break;case"destroy":this.destroy(M)}}}const cs="ng-animate-queued",oa="ng-animate-disabled",Ba=[],Cs={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},aa={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},vo="__ng_removed";class la{get params(){return this.options.params}constructor(M,A=""){this.namespaceId=A;const j=M&&M.hasOwnProperty("value");if(this.value=function us(Q){return Q??null}(j?M.value:M),j){const ge=Le(M);delete ge.value,this.options=ge}else this.options={};this.options.params||(this.options.params={})}absorbOptions(M){const A=M.params;if(A){const j=this.options.params;Object.keys(A).forEach(ne=>{null==j[ne]&&(j[ne]=A[ne])})}}}const Io="void",js=new la(Io);class Na{constructor(M,A,j){this.id=M,this.hostElement=A,this._engine=j,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+M,Zi(A,this._hostClassName)}listen(M,A,j,ne){if(!this._triggers.has(A))throw function Mt(Q,M){return new ee.vHH(3302,!1)}();if(null==j||0==j.length)throw function At(Q){return new ee.vHH(3303,!1)}();if(!function ba(Q){return"start"==Q||"done"==Q}(j))throw function Wt(Q,M){return new ee.vHH(3400,!1)}();const ge=Dn(this._elementListeners,M,[]),Oe={name:A,phase:j,callback:ne};ge.push(Oe);const ze=Dn(this._engine.statesByElement,M,new Map);return ze.has(A)||(Zi(M,ho),Zi(M,ho+"-"+A),ze.set(A,js)),()=>{this._engine.afterFlush(()=>{const Qe=ge.indexOf(Oe);Qe>=0&&ge.splice(Qe,1),this._triggers.has(A)||ze.delete(A)})}}register(M,A){return!this._triggers.has(M)&&(this._triggers.set(M,A),!0)}_getTrigger(M){const A=this._triggers.get(M);if(!A)throw function qt(Q){return new ee.vHH(3401,!1)}();return A}trigger(M,A,j,ne=!0){const ge=this._getTrigger(A),Oe=new po(this.id,A,M);let ze=this._engine.statesByElement.get(M);ze||(Zi(M,ho),Zi(M,ho+"-"+A),this._engine.statesByElement.set(M,ze=new Map));let Qe=ze.get(A);const Et=new la(j,this.id);if(!(j&&j.hasOwnProperty("value"))&&Qe&&Et.absorbOptions(Qe.options),ze.set(A,Et),Qe||(Qe=js),Et.value!==Io&&Qe.value===Et.value){if(!function Ss(Q,M){const A=Object.keys(Q),j=Object.keys(M);if(A.length!=j.length)return!1;for(let ne=0;ne<A.length;ne++){const ge=A[ne];if(!M.hasOwnProperty(ge)||Q[ge]!==M[ge])return!1}return!0}(Qe.params,Et.params)){const Xn=[],pr=ge.matchStyles(Qe.value,Qe.params,Xn),Br=ge.matchStyles(Et.value,Et.params,Xn);Xn.length?this._engine.reportError(Xn):this._engine.afterFlush(()=>{Ee(M,pr),fe(M,Br)})}return}const ur=Dn(this._engine.playersByElement,M,[]);ur.forEach(Xn=>{Xn.namespaceId==this.id&&Xn.triggerName==A&&Xn.queued&&Xn.destroy()});let hr=ge.matchTransition(Qe.value,Et.value,M,Et.params),Vn=!1;if(!hr){if(!ne)return;hr=ge.fallbackTransition,Vn=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:M,triggerName:A,transition:hr,fromState:Qe,toState:Et,player:Oe,isFallbackTransition:Vn}),Vn||(Zi(M,cs),Oe.onStart(()=>{Ao(M,cs)})),Oe.onDone(()=>{let Xn=this.players.indexOf(Oe);Xn>=0&&this.players.splice(Xn,1);const pr=this._engine.playersByElement.get(M);if(pr){let Br=pr.indexOf(Oe);Br>=0&&pr.splice(Br,1)}}),this.players.push(Oe),ur.push(Oe),Oe}deregister(M){this._triggers.delete(M),this._engine.statesByElement.forEach(A=>A.delete(M)),this._elementListeners.forEach((A,j)=>{this._elementListeners.set(j,A.filter(ne=>ne.name!=M))})}clearElementCache(M){this._engine.statesByElement.delete(M),this._elementListeners.delete(M);const A=this._engine.playersByElement.get(M);A&&(A.forEach(j=>j.destroy()),this._engine.playersByElement.delete(M))}_signalRemovalForInnerTriggers(M,A){const j=this._engine.driver.query(M,vr,!0);j.forEach(ne=>{if(ne[vo])return;const ge=this._engine.fetchNamespacesByElement(ne);ge.size?ge.forEach(Oe=>Oe.triggerLeaveAnimation(ne,A,!1,!0)):this.clearElementCache(ne)}),this._engine.afterFlushAnimationsDone(()=>j.forEach(ne=>this.clearElementCache(ne)))}triggerLeaveAnimation(M,A,j,ne){const ge=this._engine.statesByElement.get(M),Oe=new Map;if(ge){const ze=[];if(ge.forEach((Qe,Et)=>{if(Oe.set(Et,Qe.value),this._triggers.has(Et)){const mn=this.trigger(M,Et,Io,ne);mn&&ze.push(mn)}}),ze.length)return this._engine.markElementAsRemoved(this.id,M,!0,A,Oe),j&&wr(ze).onDone(()=>this._engine.processLeaveNode(M)),!0}return!1}prepareLeaveAnimationListeners(M){const A=this._elementListeners.get(M),j=this._engine.statesByElement.get(M);if(A&&j){const ne=new Set;A.forEach(ge=>{const Oe=ge.name;if(ne.has(Oe))return;ne.add(Oe);const Qe=this._triggers.get(Oe).fallbackTransition,Et=j.get(Oe)||js,mn=new la(Io),gn=new po(this.id,Oe,M);this._engine.totalQueuedPlayers++,this._queue.push({element:M,triggerName:Oe,transition:Qe,fromState:Et,toState:mn,player:gn,isFallbackTransition:!0})})}}removeNode(M,A){const j=this._engine;if(M.childElementCount&&this._signalRemovalForInnerTriggers(M,A),this.triggerLeaveAnimation(M,A,!0))return;let ne=!1;if(j.totalAnimations){const ge=j.players.length?j.playersByQueriedElement.get(M):[];if(ge&&ge.length)ne=!0;else{let Oe=M;for(;Oe=Oe.parentNode;)if(j.statesByElement.get(Oe)){ne=!0;break}}}if(this.prepareLeaveAnimationListeners(M),ne)j.markElementAsRemoved(this.id,M,!1,A);else{const ge=M[vo];(!ge||ge===Cs)&&(j.afterFlush(()=>this.clearElementCache(M)),j.destroyInnerAnimations(M),j._onRemovalComplete(M,A))}}insertNode(M,A){Zi(M,this._hostClassName)}drainQueuedTransitions(M){const A=[];return this._queue.forEach(j=>{const ne=j.player;if(ne.destroyed)return;const ge=j.element,Oe=this._elementListeners.get(ge);Oe&&Oe.forEach(ze=>{if(ze.name==j.triggerName){const Qe=ni(ge,j.triggerName,j.fromState.value,j.toState.value);Qe._data=M,Xr(j.player,ze.phase,Qe,ze.callback)}}),ne.markedForDestroy?this._engine.afterFlush(()=>{ne.destroy()}):A.push(j)}),this._queue=[],A.sort((j,ne)=>{const ge=j.transition.ast.depCount,Oe=ne.transition.ast.depCount;return 0==ge||0==Oe?ge-Oe:this._engine.driver.containsElement(j.element,ne.element)?1:-1})}destroy(M){this.players.forEach(A=>A.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,M)}elementContainsData(M){let A=!1;return this._elementListeners.has(M)&&(A=!0),A=!!this._queue.find(j=>j.element===M)||A,A}}class ca{_onRemovalComplete(M,A){this.onRemovalComplete(M,A)}constructor(M,A,j){this.bodyNode=M,this.driver=A,this._normalizer=j,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(ne,ge)=>{}}get queuedPlayers(){const M=[];return this._namespaceList.forEach(A=>{A.players.forEach(j=>{j.queued&&M.push(j)})}),M}createNamespace(M,A){const j=new Na(M,A,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,A)?this._balanceNamespaceList(j,A):(this.newHostElements.set(A,j),this.collectEnterElement(A)),this._namespaceLookup[M]=j}_balanceNamespaceList(M,A){const j=this._namespaceList,ne=this.namespacesByHostElement;if(j.length-1>=0){let Oe=!1,ze=this.driver.getParentElement(A);for(;ze;){const Qe=ne.get(ze);if(Qe){const Et=j.indexOf(Qe);j.splice(Et+1,0,M),Oe=!0;break}ze=this.driver.getParentElement(ze)}Oe||j.unshift(M)}else j.push(M);return ne.set(A,M),M}register(M,A){let j=this._namespaceLookup[M];return j||(j=this.createNamespace(M,A)),j}registerTrigger(M,A,j){let ne=this._namespaceLookup[M];ne&&ne.register(A,j)&&this.totalAnimations++}destroy(M,A){if(!M)return;const j=this._fetchNamespace(M);this.afterFlush(()=>{this.namespacesByHostElement.delete(j.hostElement),delete this._namespaceLookup[M];const ne=this._namespaceList.indexOf(j);ne>=0&&this._namespaceList.splice(ne,1)}),this.afterFlushAnimationsDone(()=>j.destroy(A))}_fetchNamespace(M){return this._namespaceLookup[M]}fetchNamespacesByElement(M){const A=new Set,j=this.statesByElement.get(M);if(j)for(let ne of j.values())if(ne.namespaceId){const ge=this._fetchNamespace(ne.namespaceId);ge&&A.add(ge)}return A}trigger(M,A,j,ne){if(gr(A)){const ge=this._fetchNamespace(M);if(ge)return ge.trigger(A,j,ne),!0}return!1}insertNode(M,A,j,ne){if(!gr(A))return;const ge=A[vo];if(ge&&ge.setForRemoval){ge.setForRemoval=!1,ge.setForMove=!0;const Oe=this.collectedLeaveElements.indexOf(A);Oe>=0&&this.collectedLeaveElements.splice(Oe,1)}if(M){const Oe=this._fetchNamespace(M);Oe&&Oe.insertNode(A,j)}ne&&this.collectEnterElement(A)}collectEnterElement(M){this.collectedEnterElements.push(M)}markElementAsDisabled(M,A){A?this.disabledNodes.has(M)||(this.disabledNodes.add(M),Zi(M,oa)):this.disabledNodes.has(M)&&(this.disabledNodes.delete(M),Ao(M,oa))}removeNode(M,A,j,ne){if(gr(A)){const ge=M?this._fetchNamespace(M):null;if(ge?ge.removeNode(A,ne):this.markElementAsRemoved(M,A,!1,ne),j){const Oe=this.namespacesByHostElement.get(A);Oe&&Oe.id!==M&&Oe.removeNode(A,ne)}}else this._onRemovalComplete(A,ne)}markElementAsRemoved(M,A,j,ne,ge){this.collectedLeaveElements.push(A),A[vo]={namespaceId:M,setForRemoval:ne,hasAnimation:j,removedBeforeQueried:!1,previousTriggersValues:ge}}listen(M,A,j,ne,ge){return gr(A)?this._fetchNamespace(M).listen(A,j,ne,ge):()=>{}}_buildInstruction(M,A,j,ne,ge){return M.transition.build(this.driver,M.element,M.fromState.value,M.toState.value,j,ne,M.fromState.options,M.toState.options,A,ge)}destroyInnerAnimations(M){let A=this.driver.query(M,vr,!0);A.forEach(j=>this.destroyActiveAnimationsForElement(j)),0!=this.playersByQueriedElement.size&&(A=this.driver.query(M,Vi,!0),A.forEach(j=>this.finishActiveQueriedAnimationOnElement(j)))}destroyActiveAnimationsForElement(M){const A=this.playersByElement.get(M);A&&A.forEach(j=>{j.queued?j.markedForDestroy=!0:j.destroy()})}finishActiveQueriedAnimationOnElement(M){const A=this.playersByQueriedElement.get(M);A&&A.forEach(j=>j.finish())}whenRenderingDone(){return new Promise(M=>{if(this.players.length)return wr(this.players).onDone(()=>M());M()})}processLeaveNode(M){const A=M[vo];if(A&&A.setForRemoval){if(M[vo]=Cs,A.namespaceId){this.destroyInnerAnimations(M);const j=this._fetchNamespace(A.namespaceId);j&&j.clearElementCache(M)}this._onRemovalComplete(M,A.setForRemoval)}M.classList?.contains(oa)&&this.markElementAsDisabled(M,!1),this.driver.query(M,".ng-animate-disabled",!0).forEach(j=>{this.markElementAsDisabled(j,!1)})}flush(M=-1){let A=[];if(this.newHostElements.size&&(this.newHostElements.forEach((j,ne)=>this._balanceNamespaceList(j,ne)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let j=0;j<this.collectedEnterElements.length;j++)Zi(this.collectedEnterElements[j],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const j=[];try{A=this._flushAnimations(j,M)}finally{for(let ne=0;ne<j.length;ne++)j[ne]()}}else for(let j=0;j<this.collectedLeaveElements.length;j++)this.processLeaveNode(this.collectedLeaveElements[j]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(j=>j()),this._flushFns=[],this._whenQuietFns.length){const j=this._whenQuietFns;this._whenQuietFns=[],A.length?wr(A).onDone(()=>{j.forEach(ne=>ne())}):j.forEach(ne=>ne())}}reportError(M){throw function Rn(Q){return new ee.vHH(3402,!1)}()}_flushAnimations(M,A){const j=new Ln,ne=[],ge=new Map,Oe=[],ze=new Map,Qe=new Map,Et=new Map,mn=new Set;this.disabledNodes.forEach(I=>{mn.add(I);const k=this.driver.query(I,".ng-animate-queued",!0);for(let G=0;G<k.length;G++)mn.add(k[G])});const gn=this.bodyNode,ur=Array.from(this.statesByElement.keys()),hr=Qo(ur,this.collectedEnterElements),Vn=new Map;let Xn=0;hr.forEach((I,k)=>{const G=Pi+Xn++;Vn.set(k,G),I.forEach(_e=>Zi(_e,G))});const pr=[],Br=new Set,Jr=new Set;for(let I=0;I<this.collectedLeaveElements.length;I++){const k=this.collectedLeaveElements[I],G=k[vo];G&&G.setForRemoval&&(pr.push(k),Br.add(k),G.hasAnimation?this.driver.query(k,".ng-star-inserted",!0).forEach(_e=>Br.add(_e)):Jr.add(k))}const Pr=new Map,qr=Qo(ur,Array.from(Br));qr.forEach((I,k)=>{const G=Ar+Xn++;Pr.set(k,G),I.forEach(_e=>Zi(_e,G))}),M.push(()=>{hr.forEach((I,k)=>{const G=Vn.get(k);I.forEach(_e=>Ao(_e,G))}),qr.forEach((I,k)=>{const G=Pr.get(k);I.forEach(_e=>Ao(_e,G))}),pr.forEach(I=>{this.processLeaveNode(I)})});const Sr=[],Ei=[];for(let I=this._namespaceList.length-1;I>=0;I--)this._namespaceList[I].drainQueuedTransitions(A).forEach(G=>{const _e=G.player,$e=G.element;if(Sr.push(_e),this.collectedEnterElements.length){const Ti=$e[vo];if(Ti&&Ti.setForMove){if(Ti.previousTriggersValues&&Ti.previousTriggersValues.has(G.triggerName)){const Hi=Ti.previousTriggersValues.get(G.triggerName),Ui=this.statesByElement.get(G.element);if(Ui&&Ui.has(G.triggerName)){const Hs=Ui.get(G.triggerName);Hs.value=Hi,Ui.set(G.triggerName,Hs)}}return void _e.destroy()}}const Gt=!gn||!this.driver.containsElement(gn,$e),An=Pr.get($e),nr=Vn.get($e),mt=this._buildInstruction(G,j,nr,An,Gt);if(mt.errors&&mt.errors.length)return void Ei.push(mt);if(Gt)return _e.onStart(()=>Ee($e,mt.fromStyles)),_e.onDestroy(()=>fe($e,mt.toStyles)),void ne.push(_e);if(G.isFallbackTransition)return _e.onStart(()=>Ee($e,mt.fromStyles)),_e.onDestroy(()=>fe($e,mt.toStyles)),void ne.push(_e);const ai=[];mt.timelines.forEach(Ti=>{Ti.stretchStartingKeyframe=!0,this.disabledNodes.has(Ti.element)||ai.push(Ti)}),mt.timelines=ai,j.append($e,mt.timelines),Oe.push({instruction:mt,player:_e,element:$e}),mt.queriedElements.forEach(Ti=>Dn(ze,Ti,[]).push(_e)),mt.preStyleProps.forEach((Ti,Hi)=>{if(Ti.size){let Ui=Qe.get(Hi);Ui||Qe.set(Hi,Ui=new Set),Ti.forEach((Hs,Wo)=>Ui.add(Wo))}}),mt.postStyleProps.forEach((Ti,Hi)=>{let Ui=Et.get(Hi);Ui||Et.set(Hi,Ui=new Set),Ti.forEach((Hs,Wo)=>Ui.add(Wo))})});if(Ei.length){const I=[];Ei.forEach(k=>{I.push(function mr(Q,M){return new ee.vHH(3505,!1)}())}),Sr.forEach(k=>k.destroy()),this.reportError(I)}const Bn=new Map,Ho=new Map;Oe.forEach(I=>{const k=I.element;j.has(k)&&(Ho.set(k,k),this._beforeAnimationBuild(I.player.namespaceId,I.instruction,Bn))}),ne.forEach(I=>{const k=I.element;this._getPreviousPlayers(k,!1,I.namespaceId,I.triggerName,null).forEach(_e=>{Dn(Bn,k,[]).push(_e),_e.destroy()})});const fs=pr.filter(I=>hi(I,Qe,Et)),F=new Map;hs(F,this.driver,Jr,Et,Ve.l3).forEach(I=>{hi(I,Qe,Et)&&fs.push(I)});const N=new Map;hr.forEach((I,k)=>{hs(N,this.driver,new Set(I),Qe,Ve.k1)}),fs.forEach(I=>{const k=F.get(I),G=N.get(I);F.set(I,new Map([...Array.from(k?.entries()??[]),...Array.from(G?.entries()??[])]))});const ae=[],Se=[],ot={};Oe.forEach(I=>{const{element:k,player:G,instruction:_e}=I;if(j.has(k)){if(mn.has(k))return G.onDestroy(()=>fe(k,_e.toStyles)),G.disabled=!0,G.overrideTotalTime(_e.totalTime),void ne.push(G);let $e=ot;if(Ho.size>1){let An=k;const nr=[];for(;An=An.parentNode;){const mt=Ho.get(An);if(mt){$e=mt;break}nr.push(An)}nr.forEach(mt=>Ho.set(mt,$e))}const Gt=this._buildAnimation(G.namespaceId,_e,Bn,ge,N,F);if(G.setRealPlayer(Gt),$e===ot)ae.push(G);else{const An=this.playersByElement.get($e);An&&An.length&&(G.parentPlayer=wr(An)),ne.push(G)}}else Ee(k,_e.fromStyles),G.onDestroy(()=>fe(k,_e.toStyles)),Se.push(G),mn.has(k)&&ne.push(G)}),Se.forEach(I=>{const k=ge.get(I.element);if(k&&k.length){const G=wr(k);I.setRealPlayer(G)}}),ne.forEach(I=>{I.parentPlayer?I.syncPlayerEvents(I.parentPlayer):I.destroy()});for(let I=0;I<pr.length;I++){const k=pr[I],G=k[vo];if(Ao(k,Ar),G&&G.hasAnimation)continue;let _e=[];if(ze.size){let Gt=ze.get(k);Gt&&Gt.length&&_e.push(...Gt);let An=this.driver.query(k,Vi,!0);for(let nr=0;nr<An.length;nr++){let mt=ze.get(An[nr]);mt&&mt.length&&_e.push(...mt)}}const $e=_e.filter(Gt=>!Gt.destroyed);$e.length?xo(this,k,$e):this.processLeaveNode(k)}return pr.length=0,ae.forEach(I=>{this.players.push(I),I.onDone(()=>{I.destroy();const k=this.players.indexOf(I);this.players.splice(k,1)}),I.play()}),ae}elementContainsData(M,A){let j=!1;const ne=A[vo];return ne&&ne.setForRemoval&&(j=!0),this.playersByElement.has(A)&&(j=!0),this.playersByQueriedElement.has(A)&&(j=!0),this.statesByElement.has(A)&&(j=!0),this._fetchNamespace(M).elementContainsData(A)||j}afterFlush(M){this._flushFns.push(M)}afterFlushAnimationsDone(M){this._whenQuietFns.push(M)}_getPreviousPlayers(M,A,j,ne,ge){let Oe=[];if(A){const ze=this.playersByQueriedElement.get(M);ze&&(Oe=ze)}else{const ze=this.playersByElement.get(M);if(ze){const Qe=!ge||ge==Io;ze.forEach(Et=>{Et.queued||!Qe&&Et.triggerName!=ne||Oe.push(Et)})}}return(j||ne)&&(Oe=Oe.filter(ze=>!(j&&j!=ze.namespaceId||ne&&ne!=ze.triggerName))),Oe}_beforeAnimationBuild(M,A,j){const ge=A.element,Oe=A.isRemovalTransition?void 0:M,ze=A.isRemovalTransition?void 0:A.triggerName;for(const Qe of A.timelines){const Et=Qe.element,mn=Et!==ge,gn=Dn(j,Et,[]);this._getPreviousPlayers(Et,mn,Oe,ze,A.toState).forEach(hr=>{const Vn=hr.getRealPlayer();Vn.beforeDestroy&&Vn.beforeDestroy(),hr.destroy(),gn.push(hr)})}Ee(ge,A.fromStyles)}_buildAnimation(M,A,j,ne,ge,Oe){const ze=A.triggerName,Qe=A.element,Et=[],mn=new Set,gn=new Set,ur=A.timelines.map(Vn=>{const Xn=Vn.element;mn.add(Xn);const pr=Xn[vo];if(pr&&pr.removedBeforeQueried)return new Ve.ZN(Vn.duration,Vn.delay);const Br=Xn!==Qe,Jr=function Qi(Q){const M=[];return Vs(Q,M),M}((j.get(Xn)||Ba).map(Bn=>Bn.getRealPlayer())).filter(Bn=>!!Bn.element&&Bn.element===Xn),Pr=ge.get(Xn),qr=Oe.get(Xn),Sr=ir(0,this._normalizer,0,Vn.keyframes,Pr,qr),Ei=this._buildPlayer(Vn,Sr,Jr);if(Vn.subTimeline&&ne&&gn.add(Xn),Br){const Bn=new po(M,ze,Xn);Bn.setRealPlayer(Ei),Et.push(Bn)}return Ei});Et.forEach(Vn=>{Dn(this.playersByQueriedElement,Vn.element,[]).push(Vn),Vn.onDone(()=>function wa(Q,M,A){let j=Q.get(M);if(j){if(j.length){const ne=j.indexOf(A);j.splice(ne,1)}0==j.length&&Q.delete(M)}return j}(this.playersByQueriedElement,Vn.element,Vn))}),mn.forEach(Vn=>Zi(Vn,ro));const hr=wr(ur);return hr.onDestroy(()=>{mn.forEach(Vn=>Ao(Vn,ro)),fe(Qe,A.toStyles)}),gn.forEach(Vn=>{Dn(ne,Vn,[]).push(hr)}),hr}_buildPlayer(M,A,j){return A.length>0?this.driver.animate(M.element,A,M.duration,M.delay,M.easing,j):new Ve.ZN(M.duration,M.delay)}}class po{constructor(M,A,j){this.namespaceId=M,this.triggerName=A,this.element=j,this._player=new Ve.ZN,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(M){this._containsRealPlayer||(this._player=M,this._queuedCallbacks.forEach((A,j)=>{A.forEach(ne=>Xr(M,j,void 0,ne))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(M.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(M){this.totalTime=M}syncPlayerEvents(M){const A=this._player;A.triggerCallback&&M.onStart(()=>A.triggerCallback("start")),M.onDone(()=>this.finish()),M.onDestroy(()=>this.destroy())}_queueEvent(M,A){Dn(this._queuedCallbacks,M,[]).push(A)}onDone(M){this.queued&&this._queueEvent("done",M),this._player.onDone(M)}onStart(M){this.queued&&this._queueEvent("start",M),this._player.onStart(M)}onDestroy(M){this.queued&&this._queueEvent("destroy",M),this._player.onDestroy(M)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(M){this.queued||this._player.setPosition(M)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(M){const A=this._player;A.triggerCallback&&A.triggerCallback(M)}}function gr(Q){return Q&&1===Q.nodeType}function Jo(Q,M){const A=Q.style.display;return Q.style.display=M??"none",A}function hs(Q,M,A,j,ne){const ge=[];A.forEach(Qe=>ge.push(Jo(Qe)));const Oe=[];j.forEach((Qe,Et)=>{const mn=new Map;Qe.forEach(gn=>{const ur=M.computeStyle(Et,gn,ne);mn.set(gn,ur),(!ur||0==ur.length)&&(Et[vo]=aa,Oe.push(Et))}),Q.set(Et,mn)});let ze=0;return A.forEach(Qe=>Jo(Qe,ge[ze++])),Oe}function Qo(Q,M){const A=new Map;if(Q.forEach(ze=>A.set(ze,[])),0==M.length)return A;const j=1,ne=new Set(M),ge=new Map;function Oe(ze){if(!ze)return j;let Qe=ge.get(ze);if(Qe)return Qe;const Et=ze.parentNode;return Qe=A.has(Et)?Et:ne.has(Et)?j:Oe(Et),ge.set(ze,Qe),Qe}return M.forEach(ze=>{const Qe=Oe(ze);Qe!==j&&A.get(Qe).push(ze)}),A}function Zi(Q,M){Q.classList?.add(M)}function Ao(Q,M){Q.classList?.remove(M)}function xo(Q,M,A){wr(A).onDone(()=>Q.processLeaveNode(M))}function Vs(Q,M){for(let A=0;A<Q.length;A++){const j=Q[A];j instanceof Ve.ZE?Vs(j.players,M):M.push(j)}}function hi(Q,M,A){const j=A.get(Q);if(!j)return!1;let ne=M.get(Q);return ne?j.forEach(ge=>ne.add(ge)):M.set(Q,j),A.delete(Q),!0}class ua{constructor(M,A,j){this.bodyNode=M,this._driver=A,this._normalizer=j,this._triggerCache={},this.onRemovalComplete=(ne,ge)=>{},this._transitionEngine=new ca(M,A,j),this._timelineEngine=new Ds(M,A,j),this._transitionEngine.onRemovalComplete=(ne,ge)=>this.onRemovalComplete(ne,ge)}registerTrigger(M,A,j,ne,ge){const Oe=M+"-"+ne;let ze=this._triggerCache[Oe];if(!ze){const Qe=[],Et=[],mn=Fn(this._driver,ge,Qe,Et);if(Qe.length)throw function Bt(Q,M){return new ee.vHH(3404,!1)}();ze=function Yo(Q,M,A){return new Fa(Q,M,A)}(ne,mn,this._normalizer),this._triggerCache[Oe]=ze}this._transitionEngine.registerTrigger(A,ne,ze)}register(M,A){this._transitionEngine.register(M,A)}destroy(M,A){this._transitionEngine.destroy(M,A)}onInsert(M,A,j,ne){this._transitionEngine.insertNode(M,A,j,ne)}onRemove(M,A,j,ne){this._transitionEngine.removeNode(M,A,ne||!1,j)}disableAnimations(M,A){this._transitionEngine.markElementAsDisabled(M,A)}process(M,A,j,ne){if("@"==j.charAt(0)){const[ge,Oe]=ei(j);this._timelineEngine.command(ge,A,Oe,ne)}else this._transitionEngine.trigger(M,A,j,ne)}listen(M,A,j,ne,ge){if("@"==j.charAt(0)){const[Oe,ze]=ei(j);return this._timelineEngine.listen(Oe,A,ze,ge)}return this._transitionEngine.listen(M,A,j,ne,ge)}flush(M=-1){this._transitionEngine.flush(M)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let Qn=(()=>{class Q{constructor(A,j,ne){this._element=A,this._startStyles=j,this._endStyles=ne,this._state=0;let ge=Q.initialStylesByElement.get(A);ge||Q.initialStylesByElement.set(A,ge=new Map),this._initialStyles=ge}start(){this._state<1&&(this._startStyles&&fe(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(fe(this._element,this._initialStyles),this._endStyles&&(fe(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Q.initialStylesByElement.delete(this._element),this._startStyles&&(Ee(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ee(this._element,this._endStyles),this._endStyles=null),fe(this._element,this._initialStyles),this._state=3)}}return Q.initialStylesByElement=new WeakMap,Q})();function $s(Q){let M=null;return Q.forEach((A,j)=>{(function Ua(Q){return"display"===Q||"position"===Q})(j)&&(M=M||new Map,M.set(j,A))}),M}class jo{constructor(M,A,j,ne){this.element=M,this.keyframes=A,this.options=j,this._specialStyles=ne,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=j.duration,this._delay=j.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(M=>M()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const M=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,M,this.options),this._finalKeyframe=M.length?M[M.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(M){const A=[];return M.forEach(j=>{A.push(Object.fromEntries(j))}),A}_triggerWebAnimation(M,A,j){return M.animate(this._convertKeyframesToObject(A),j)}onStart(M){this._originalOnStartFns.push(M),this._onStartFns.push(M)}onDone(M){this._originalOnDoneFns.push(M),this._onDoneFns.push(M)}onDestroy(M){this._onDestroyFns.push(M)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(M=>M()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(M=>M()),this._onDestroyFns=[])}setPosition(M){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=M*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const M=new Map;this.hasStarted()&&this._finalKeyframe.forEach((j,ne)=>{"offset"!==ne&&M.set(ne,this._finished?j:or(this.element,ne))}),this.currentSnapshot=M}triggerCallback(M){const A="start"===M?this._onStartFns:this._onDoneFns;A.forEach(j=>j()),A.length=0}}class Wr{validateStyleProperty(M){return!0}validateAnimatableStyleProperty(M){return!0}matchesElement(M,A){return!1}containsElement(M,A){return zr(M,A)}getParentElement(M){return sr(M)}query(M,A,j){return xn(M,A,j)}computeStyle(M,A,j){return window.getComputedStyle(M)[A]}animate(M,A,j,ne,ge,Oe=[]){const Qe={duration:j,delay:ne,fill:0==ne?"both":"forwards"};ge&&(Qe.easing=ge);const Et=new Map,mn=Oe.filter(hr=>hr instanceof jo);(function hn(Q,M){return 0===Q||0===M})(j,ne)&&mn.forEach(hr=>{hr.currentSnapshot.forEach((Vn,Xn)=>Et.set(Xn,Vn))});let gn=function Rt(Q){return Q.length?Q[0]instanceof Map?Q:Q.map(M=>$t(M)):[]}(A).map(hr=>he(hr));gn=function dn(Q,M,A){if(A.size&&M.length){let j=M[0],ne=[];if(A.forEach((ge,Oe)=>{j.has(Oe)||ne.push(Oe),j.set(Oe,ge)}),ne.length)for(let ge=1;ge<M.length;ge++){let Oe=M[ge];ne.forEach(ze=>Oe.set(ze,or(Q,ze)))}}return M}(M,gn,Et);const ur=function Ms(Q,M){let A=null,j=null;return Array.isArray(M)&&M.length?(A=$s(M[0]),M.length>1&&(j=$s(M[M.length-1]))):M instanceof Map&&(A=$s(M)),A||j?new Qn(Q,A,j):null}(M,gn);return new jo(M,gn,Qe,ur)}}var ha=we(6895);let es=(()=>{class Q extends Ve._j{constructor(A,j){super(),this._nextAnimationId=0,this._renderer=A.createRenderer(j.body,{id:"0",encapsulation:ee.ifc.None,styles:[],data:{animation:[]}})}build(A){const j=this._nextAnimationId.toString();this._nextAnimationId++;const ne=Array.isArray(A)?(0,Ve.vP)(A):A;return Gs(this._renderer,null,j,"register",[ne]),new Qa(j,this._renderer)}}return Q.\u0275fac=function(A){return new(A||Q)(ee.LFG(ee.FYo),ee.LFG(ha.K0))},Q.\u0275prov=ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class Qa extends Ve.LC{constructor(M,A){super(),this._id=M,this._renderer=A}create(M,A){return new Is(this._id,M,A||{},this._renderer)}}class Is{constructor(M,A,j,ne){this.id=M,this.element=A,this._renderer=ne,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",j)}_listen(M,A){return this._renderer.listen(this.element,`@@${this.id}:${M}`,A)}_command(M,...A){return Gs(this._renderer,this.element,this.id,M,A)}onDone(M){this._listen("done",M)}onStart(M){this._listen("start",M)}onDestroy(M){this._listen("destroy",M)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(M){this._command("setPosition",M)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function Gs(Q,M,A,j,ne){return Q.setProperty(M,`@@${A}:${j}`,ne)}const tr="@.disabled";let Qs=(()=>{class Q{constructor(A,j,ne){this.delegate=A,this.engine=j,this._zone=ne,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),j.onRemovalComplete=(ge,Oe)=>{const ze=Oe?.parentNode(ge);ze&&Oe.removeChild(ze,ge)}}createRenderer(A,j){const ge=this.delegate.createRenderer(A,j);if(!(A&&j&&j.data&&j.data.animation)){let mn=this._rendererCache.get(ge);return mn||(mn=new As("",ge,this.engine,()=>this._rendererCache.delete(ge)),this._rendererCache.set(ge,mn)),mn}const Oe=j.id,ze=j.id+"-"+this._currentId;this._currentId++,this.engine.register(ze,A);const Qe=mn=>{Array.isArray(mn)?mn.forEach(Qe):this.engine.registerTrigger(Oe,ze,A,mn.name,mn)};return j.data.animation.forEach(Qe),new ea(this,ze,ge,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(A,j,ne){A>=0&&A<this._microtaskId?this._zone.run(()=>j(ne)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(ge=>{const[Oe,ze]=ge;Oe(ze)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([j,ne]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return Q.\u0275fac=function(A){return new(A||Q)(ee.LFG(ee.FYo),ee.LFG(ua),ee.LFG(ee.R0b))},Q.\u0275prov=ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class As{constructor(M,A,j,ne){this.namespaceId=M,this.delegate=A,this.engine=j,this._onDestroy=ne,this.destroyNode=this.delegate.destroyNode?ge=>A.destroyNode(ge):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(M,A){return this.delegate.createElement(M,A)}createComment(M){return this.delegate.createComment(M)}createText(M){return this.delegate.createText(M)}appendChild(M,A){this.delegate.appendChild(M,A),this.engine.onInsert(this.namespaceId,A,M,!1)}insertBefore(M,A,j,ne=!0){this.delegate.insertBefore(M,A,j),this.engine.onInsert(this.namespaceId,A,M,ne)}removeChild(M,A,j){this.engine.onRemove(this.namespaceId,A,this.delegate,j)}selectRootElement(M,A){return this.delegate.selectRootElement(M,A)}parentNode(M){return this.delegate.parentNode(M)}nextSibling(M){return this.delegate.nextSibling(M)}setAttribute(M,A,j,ne){this.delegate.setAttribute(M,A,j,ne)}removeAttribute(M,A,j){this.delegate.removeAttribute(M,A,j)}addClass(M,A){this.delegate.addClass(M,A)}removeClass(M,A){this.delegate.removeClass(M,A)}setStyle(M,A,j,ne){this.delegate.setStyle(M,A,j,ne)}removeStyle(M,A,j){this.delegate.removeStyle(M,A,j)}setProperty(M,A,j){"@"==A.charAt(0)&&A==tr?this.disableAnimations(M,!!j):this.delegate.setProperty(M,A,j)}setValue(M,A){this.delegate.setValue(M,A)}listen(M,A,j){return this.delegate.listen(M,A,j)}disableAnimations(M,A){this.engine.disableAnimations(M,A)}}class ea extends As{constructor(M,A,j,ne,ge){super(A,j,ne,ge),this.factory=M,this.namespaceId=A}setProperty(M,A,j){"@"==A.charAt(0)?"."==A.charAt(1)&&A==tr?this.disableAnimations(M,j=void 0===j||!!j):this.engine.process(this.namespaceId,M,A.slice(1),j):this.delegate.setProperty(M,A,j)}listen(M,A,j){if("@"==A.charAt(0)){const ne=function bi(Q){switch(Q){case"body":return document.body;case"document":return document;case"window":return window;default:return Q}}(M);let ge=A.slice(1),Oe="";return"@"!=ge.charAt(0)&&([ge,Oe]=function Ea(Q){const M=Q.indexOf(".");return[Q.substring(0,M),Q.slice(M+1)]}(ge)),this.engine.listen(this.namespaceId,ne,ge,Oe,ze=>{this.factory.scheduleListenerCallback(ze._data||-1,j,ze)})}return this.delegate.listen(M,A,j)}}const Ft=[{provide:Ve._j,useClass:es},{provide:Ns,useFactory:function da(){return new Ni}},{provide:ua,useClass:(()=>{class Q extends ua{constructor(A,j,ne,ge){super(A.body,j,ne)}ngOnDestroy(){this.flush()}}return Q.\u0275fac=function(A){return new(A||Q)(ee.LFG(ha.K0),ee.LFG(yr),ee.LFG(Ns),ee.LFG(ee.z2F))},Q.\u0275prov=ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})()},{provide:ee.FYo,useFactory:function Ta(Q,M,A){return new Qs(Q,M,A)},deps:[W.se,ua,ee.R0b]}],ar=[{provide:yr,useFactory:()=>new Wr},{provide:ee.QbO,useValue:"BrowserAnimations"},...Ft],ta=[{provide:yr,useClass:xi},{provide:ee.QbO,useValue:"NoopAnimations"},...Ft];let el=(()=>{class Q{static withConfig(A){return{ngModule:Q,providers:A.disableAnimations?ta:ar}}}return Q.\u0275fac=function(A){return new(A||Q)},Q.\u0275mod=ee.oAB({type:Q}),Q.\u0275inj=ee.cJS({providers:ar,imports:[W.b2]}),Q})();var bo=we(529),Vo=we(8750);const $o=[{path:"mapas",loadChildren:()=>Promise.all([we.e(592),we.e(420)]).then(we.bind(we,5420)).then(Q=>Q.MapasModule)},{path:"auth",loadChildren:()=>Promise.all([we.e(592),we.e(152)]).then(we.bind(we,7152)).then(Q=>Q.AuthModule)},{path:"**",redirectTo:"mapas"}];let ds=(()=>{class Q{}return Q.\u0275fac=function(A){return new(A||Q)},Q.\u0275mod=ee.oAB({type:Q}),Q.\u0275inj=ee.cJS({imports:[Vo.Bz.forRoot($o,{useHash:!1}),Vo.Bz]}),Q})();var kl=we(9898),Da=we(2340);let Gi=(()=>{class Q{constructor(){this.title="Puntos_de_CyL"}ngOnInit(){kl.accessToken=Da.N.mapboxToken}}return Q.\u0275fac=function(A){return new(A||Q)},Q.\u0275cmp=ee.Xpm({type:Q,selectors:[["app-root"]],decls:1,vars:0,template:function(A,j){1&A&&ee._UZ(0,"router-outlet")},dependencies:[Vo.lC]}),Q})(),Ro=(()=>{class Q{}return Q.\u0275fac=function(A){return new(A||Q)},Q.\u0275mod=ee.oAB({type:Q,bootstrap:[Gi]}),Q.\u0275inj=ee.cJS({imports:[W.b2,ds,el,bo.JF]}),Q})();var fl=we(5226);if(!navigator.geolocation)throw we.n(fl)().fire("Error","El navegador no soporta la Geolocalizaci\xf3n","error"),new Error("El navegador no soporta la Geolocalizaci\xf3n");W.q6().bootstrapModule(Ro).catch(Q=>console.error(Q))},9898:function(Yn){Yn.exports=function(){"use strict";var ct,we,W;function ee(u,Ie){if(ct)if(we){var Xt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+ct+")(sharedChunk); ("+we+")(sharedChunk); self.onerror = null;",St={};ct(St),W=Ie(St),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(W.workerUrl=window.URL.createObjectURL(new Blob([Xt],{type:"text/javascript"})))}else we=Ie;else ct=Ie}return ee(0,function(u){var Ie=typeof self<"u"?self:{},Xt="2.13.0";let St;const wt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==St){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{St=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{St=t}}return St},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},xt={supported:!1,testSupport:function(t){!Ct&&yt&&(jn?Kt(t):nt=t)}};let nt,yt,Ct=!1,jn=!1;function Kt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,yt),t.isContextLost())return;xt.supported=!0}catch{}t.deleteTexture(e),Ct=!0}Ie.document&&(yt=Ie.document.createElement("img"),yt.onload=function(){nt&&Kt(nt),nt=null,jn=!0},yt.onerror=function(){Ct=!0,nt=null},yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ln="01";var jt=Gn;function Gn(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}Gn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var h=this.sampleCurveX(n)-t;if(Math.abs(h)<e)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var _=0,w=1;for(n=t,s=0;s<20&&(h=this.sampleCurveX(n),!(Math.abs(h-t)<e));s++)t>h?_=n:w=n,n=.5*(w-_)+_;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var st=Pn;function Pn(t,e){this.x=t,this.y=e}Pn.prototype={clone:function(){return new Pn(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),h=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pn.convert=function(t){return t instanceof Pn?t:Array.isArray(t)?new Pn(t[0],t[1]):t};const Or=Math.PI/180,Ye=180/Math.PI;function Ne(t){return t*Or}function pt(t){return t*Ye}const sn=[[0,0],[1,0],[1,1],[0,1]];function _n(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function nn(t,e,n,s){const h=new jt(t,e,n,s);return function(g){return h.solve(g)}}const Yt=nn(.25,.1,.25,1);function Bt(t,e,n){return Math.min(n,Math.max(e,t))}function un(t,e,n){return(n=Bt((n-t)/(e-t),0,1))*n*(3-2*n)}function rr(t,e,n){const s=n-e,h=((t-e)%s+s)%s+e;return h===e?n:h}function Vt(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const h=new Array(t.length);let g=null;t.forEach((_,w)=>{e(_,(T,D)=>{T&&(g=T),h[w]=D,0==--s&&n(g,h)})})}function at(t){const e=[];for(const n in t)e.push(t[n]);return e}function rt(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let Mt=1;function At(){return Mt++}function Wt(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function qt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Rn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function fr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function mr(t,e){return-1!==t.indexOf(e,t.length-e.length)}function bn(t,e,n){const s={};for(const h in t)s[h]=e.call(n||this,t[h],h,t);return s}function yn(t,e,n){const s={};for(const h in t)e.call(n||this,t[h],h,t)&&(s[h]=t[h]);return s}function Qt(t){return Array.isArray(t)?t.map(Qt):"object"==typeof t&&t?bn(t,Qt):t}const wr={};function ir(t){wr[t]||(typeof console<"u"&&console.warn(t),wr[t]=!0)}function Xr(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Tn(t){let e=0;for(let n,s,h=0,g=t.length,_=g-1;h<g;_=h++)n=t[h],s=t[_],e+=(s.x-n.x)*(n.y+s.y);return e}function ni(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Dn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,h,g)=>{const _=h||g;return e[s]=!_||_.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let ei=null;function ri(t){if(null==ei){const e=t.navigator?t.navigator.userAgent:null;ei=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ei}function qi(t){try{const e=Ie[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function vn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const sr="mapbox-tiles";let vi,Kr,Fr=500,Bo=50;function Ii(){try{return Ie.caches}catch{}}function In(){Ii()&&!vi&&(vi=Ie.caches.open(sr))}function to(t){const e=t.indexOf("?");if(e<0)return t;const s=function(h){const g=h.indexOf("?");return g>0?h.slice(g+1).split("&"):[]}(t).filter(h=>{const g=h.split("=");return"language"===g[0]||"worldview"===g[0]});return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let zr=1/0;const xn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(xn);class gt extends Error{constructor(e,n,s){401===n&&Vi(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xi=ni()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ie.location.protocol?Ie.parent:Ie).location.href,yr=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(xi())&&!/^\w+:/.test(n))){if(Ie.fetch&&Ie.Request&&Ie.AbortController&&Ie.Request.prototype.hasOwnProperty("signal"))return function(s,h){const g=new Ie.AbortController,_=new Ie.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:xi(),signal:g.signal});let w=!1,T=!1;const D=(P=_.url).indexOf("sku=")>0&&Vi(P);var P;"json"===s.type&&_.headers.set("Accept","application/json");const O=(V,$,J)=>{if(T)return;if(V&&"SecurityError"!==V.message&&ir(V),$&&J)return B($);const ue=Date.now();Ie.fetch(_).then(xe=>{if(xe.ok){const Me=D?xe.clone():null;return B(xe,Me,ue)}return h(new gt(xe.statusText,xe.status,s.url))}).catch(xe=>{"AbortError"!==xe.name&&h(new Error(`${xe.message} ${s.url}`))})},B=(V,$,J)=>{("arrayBuffer"===s.type?V.arrayBuffer():"json"===s.type?V.json():V.text()).then(ue=>{T||($&&J&&function(xe,Me,ve){if(In(),!vi)return;const Ce={status:Me.status,statusText:Me.statusText,headers:new Ie.Headers};Me.headers.forEach((Xe,qe)=>Ce.headers.set(qe,Xe));const ke=Dn(Me.headers.get("Cache-Control")||"");if(ke["no-store"])return;ke["max-age"]&&Ce.headers.set("Expires",new Date(ve+1e3*ke["max-age"]).toUTCString());const Pe=Ce.headers.get("Expires");Pe&&(new Date(Pe).getTime()-ve<42e4||function(Xe,qe){if(void 0===Kr)try{new Response(new ReadableStream),Kr=!0}catch{Kr=!1}Kr?qe(Xe.body):Xe.blob().then(qe)}(Me,Xe=>{const qe=new Ie.Response(Xe,Ce);In(),vi&&vi.then(vt=>vt.put(to(xe.url),qe)).catch(vt=>ir(vt.message))}))}(_,$,J),w=!0,h(null,ue,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(ue=>{T||h(new Error(ue.message))})};return D?function(V,$){if(In(),!vi)return $(null);const J=to(V.url);vi.then(ue=>{ue.match(J).then(xe=>{const Me=function(ve){if(!ve)return!1;const Ce=new Date(ve.headers.get("Expires")||0),ke=Dn(ve.headers.get("Cache-Control")||"");return Ce>Date.now()&&!ke["no-cache"]}(xe);ue.delete(J),Me&&ue.put(J,xe.clone()),$(null,xe,Me)}).catch($)}).catch($)}(_,O):O(null,null),{cancel:()=>{T=!0,w||g.abort()}}}(t,e);if(ni()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,h){const g=new Ie.XMLHttpRequest;g.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(g.responseType="arraybuffer");for(const _ in s.headers)g.setRequestHeader(_,s.headers[_]);return"json"===s.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===s.credentials,g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let _=g.response;if("json"===s.type)try{_=JSON.parse(g.response)}catch(w){return h(w)}h(null,_,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else h(new gt(g.statusText,g.status,s.url))},g.send(s.body),{cancel:()=>g.abort()}}(t,e)},Ai=function(t,e){return yr(rt(t,{type:"arrayBuffer"}),e)};function no(t){const e=Ie.document.createElement("a");return e.href=t,e.protocol===Ie.document.location.protocol&&e.host===Ie.document.location.host}const Fi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pi,Ar;Pi=[],Ar=0;const ho=function(t,e){if(xt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ar>=wt.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Pi.push(g),g}Ar++;let n=!1;const s=()=>{if(!n)for(n=!0,Ar--;Pi.length&&Ar<wt.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Pi.shift(),{requestParameters:_,callback:w,cancelled:T}=g;T||(g.cancel=ho(_,w).cancel)}},h=Ai(t,(g,_,w,T)=>{s(),g?e(g):_&&(Ie.createImageBitmap?function(D,P){const O=new Ie.Blob([new Uint8Array(D)],{type:"image/png"});Ie.createImageBitmap(O).then(B=>{P(null,B)}).catch(B=>{P(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(D,P)=>e(D,P,w,T)):function(D,P){const O=new Ie.Image,B=Ie.URL;O.onload=()=>{P(null,O),B.revokeObjectURL(O.src),O.onload=null,Ie.requestAnimationFrame(()=>{O.src=Fi})},O.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Ie.Blob([new Uint8Array(D)],{type:"image/png"});O.src=D.byteLength?B.createObjectURL(V):Fi}(_,(D,P)=>e(D,P,w,T)))});return{cancel:()=>{h.cancel(),s()}}},vr="NO_ACCESS_TOKEN";function ro(t){return 0===t.indexOf("mapbox:")}function Vi(t){return wt.API_URL_REGEX.test(t)}function ii(t){return wt.API_CDN_URL_REGEX.test(t)}function Hn(t){return wt.API_STYLE_REGEX.test(t)&&!_t(t)}function _t(t){return wt.API_SPRITE_REGEX.test(t)}const Fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Le(t){const e=t.match(Fe);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function $t(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Rt(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Ie.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class On{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Rt(wt.ACCESS_TOKEN);let s="";return s=n&&n.u?Ie.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(h,g)=>String.fromCharCode(Number("0x"+g)))):wt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=qi("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const h=Ie.localStorage.getItem(n);h&&(this.eventData=JSON.parse(h));const g=Ie.localStorage.getItem(s);g&&(this.anonId=g)}catch{ir("Unable to read from LocalStorage")}}saveEventData(){const e=qi("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Ie.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Ie.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{ir("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,h){if(!wt.EVENTS_URL)return;const g=Le(wt.EVENTS_URL);g.params.push(`access_token=${h||wt.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString()},w=n?rt(_,n):_,T={url:$t(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var P;this.pendingRequest=(P=D=>{this.pendingRequest=null,s(D),this.saveEventData(),this.processRequests(h)},yr(rt(T,{method:"POST"}),P))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const he=new class extends On{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){wt.EVENTS_URL&&wt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>ro(n)||Vi(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Rt(wt.ACCESS_TOKEN),n=e?e.u:wt.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;Rn(this.anonId)||(this.anonId=Wt(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),_=new Date(h),w=(h-this.eventData.lastSuccess)/864e5;s=s||w>=1||w<-1||g.getDate()!==_.getDate()}else s=!0;s?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xt,skuId:ln,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=h,this.eventData.tokenU=n)},t):this.processRequests()}},H=he.postTurnstileEvent.bind(he),K=new class extends On{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,wt.EVENTS_URL&&(n||wt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(vr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Rn(this.anonId)||(this.anonId=Wt()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xt,skuId:ln,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},fe=K.postMapLoadEvent.bind(K),Ee=new class extends On{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){wt.EVENTS_URL&&(t||wt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(h){const g=Ie.performance.getEntriesByType("resource"),_=Ie.performance.getEntriesByType("mark"),w=function(B){const V={};if(B)for(const $ in B)if("other"!==$)for(const J of B[$]){const ue=`${$}ResolveRangeMin`,xe=`${$}ResolveRangeMax`,Me=`${$}RequestCount`,ve=`${$}RequestCachedCount`;V[ue]=Math.min(V[ue]||1/0,J.startTime),V[xe]=Math.max(V[xe]||-1/0,J.responseEnd);const Ce=ke=>{void 0===V[ke]&&(V[ke]=0),++V[ke]};void 0!==J.transferSize&&0===J.transferSize&&Ce(ve),Ce(Me)}return V}(function(B,V){const $={};if(B)for(const J of B){const ue=V(J);void 0===$[ue]&&($[ue]=[]),$[ue].push(J)}return $}(g,ft)),T=Ie.devicePixelRatio,D=Ie.navigator.connection||Ie.navigator.mozConnection||Ie.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},O=(B,V,$)=>{null!=$&&B.push({name:V,value:$.toString()})};for(const B in w)O(P.counters,B,w[B]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(O(P.counters,"interactionRangeMin",h.interactionRange[0]),O(P.counters,"interactionRangeMax",h.interactionRange[1])),_)for(const B of Object.keys(pe)){const V=pe[B],$=_.find(J=>J.name===V);$&&O(P.counters,V,$.startTime)}return O(P.counters,"visibilityHidden",h.visibilityHidden),O(P.attributes,"style",function(B){if(B)for(const V of B){const $=V.name.split("?")[0];if(Hn($)){const J=$.split("/").slice(-2);if(2===J.length)return`mapbox://styles/${J[0]}/${J[1]}`}}}(g)),O(P.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),O(P.attributes,"fogEnabled",h.fogEnabled?"true":"false"),O(P.attributes,"projection",h.projection),O(P.attributes,"zoom",h.zoom),O(P.metadata,"devicePixelRatio",T),O(P.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),O(P.metadata,"navigatorUserAgent",Ie.navigator.userAgent),O(P.metadata,"screenWidth",Ie.screen.width),O(P.metadata,"screenHeight",Ie.screen.height),O(P.metadata,"windowWidth",Ie.innerWidth),O(P.metadata,"windowHeight",Ie.innerHeight),O(P.metadata,"mapWidth",h.width/T),O(P.metadata,"mapHeight",h.height/T),O(P.metadata,"webglRenderer",h.renderer),O(P.metadata,"webglVendor",h.vendor),O(P.metadata,"sdkVersion",Xt),O(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(n);for(const h of s.metadata);for(const h of s.counters);for(const h of s.attributes);this.postEvent(e,s,()=>{},t)}},se=Ee.postPerformanceEvent.bind(Ee),ie=new class extends On{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!wt.API_URL||!wt.SESSION_PATH)return;const h=Le(wt.API_URL+wt.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${s||wt.ACCESS_TOKEN||""}`);const g={url:$t(h),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=_=>{this.pendingRequest=null,n(_),this.saveEventData(),this.processRequests(s)},yr(rt(g,{method:"GET"}),w))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,wt.SESSION_PATH&&wt.API_URL&&(n||wt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(vr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},q=ie.getSessionAPI.bind(ie),re=new Set,pe={create:"create",load:"load",fullLoad:"fullLoad"},Ue={mark(t){Ie.performance.mark(t)},measure(t,e,n){Ie.performance.measure(t,e,n)}};function ft(t){const e=t.name.split("?")[0];return ii(e)&&e.includes("mapbox-gl.js")?"javascript":ii(e)&&e.includes("mapbox-gl.css")?"css":wt.API_FONTS_REGEX.test(e)?"fontRange":_t(e)?"sprite":Hn(e)?"style":wt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const dt=Ie.performance;function en(t){const e=t?t.url.toString():void 0;return dt.getEntriesByName(e)}let hn,dn,an,or;const xr={now:()=>void 0!==an?an:Ie.performance.now(),setNow(t){an=t},restoreNow(){an=void 0},frame(t){const e=Ie.requestAnimationFrame(t);return{cancel:()=>Ie.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;or||(or=Ie.document.createElement("canvas"));const h=or.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(n>or.width||s>or.height)&&(or.width=n,or.height=s),h.clearRect(-e,-e,n+2*e,s+2*e),h.drawImage(t,0,0,n,s),h.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(hn||(hn=Ie.document.createElement("a")),hn.href=t,hn.href),get devicePixelRatio(){return Ie.devicePixelRatio},get prefersReducedMotion(){return!!Ie.matchMedia&&(null==dn&&(dn=Ie.matchMedia("(prefers-reduced-motion: reduce)")),dn.matches)}};function Sn(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Cr(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class kr{constructor(e,n={}){rt(this,n),this.type=e}}class fo extends kr{constructor(e,n={}){super("error",rt({error:e},n))}}class yo{on(e,n){return this._listeners=this._listeners||{},Sn(e,n,this._listeners),this}off(e,n){return Cr(e,n,this._listeners),Cr(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Sn(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){"string"==typeof e&&(e=new kr(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const w of h)w.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const w of g)Cr(s,w,this._oneTimeListeners),w.call(this,e);const _=this._eventedParent;_&&(rt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof fo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ht=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function io(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function Wn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function _i(t){if(Array.isArray(t))return t.map(_i);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=_i(t[n]);return e}return Wn(t)}class zi extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var oi=zi;class Gr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,h]of n)this.bindings[s]=h}concat(e){return new Gr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ks=Gr;const as={kind:"null"},Zt={kind:"number"},Fn={kind:"string"},Lt={kind:"boolean"},Zn={kind:"color"},Nr={kind:"object"},$n={kind:"value"},oo={kind:"collator"},Yr={kind:"formatted"},Co={kind:"resolvedImage"};function Jn(t,e){return{kind:"array",itemType:t,N:e}}function br(t){if("array"===t.kind){const e=br(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Es=[as,Zt,Fn,Lt,Zn,Yr,Nr,Jn($n),Co];function Ln(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ln(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of Es)if(!Ln(n,e))return null}return`Expected ${br(t)} but found ${br(e)} instead.`}function ls(t,e){return e.some(n=>n.kind===t.kind)}function wi(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var Ys,Ki={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function si(t){return(t=Math.round(t))<0?0:t>255?255:t}function so(t){return si("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function ui(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Bi(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Ys={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Ki)return Ki[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),h=n.indexOf(")");if(-1!==s&&h+1===n.length){var g=n.substr(0,s),_=n.substr(s+1,h-(s+1)).split(","),w=1;switch(g){case"rgba":if(4!==_.length)return null;w=ui(_.pop());case"rgb":return 3!==_.length?null:[so(_[0]),so(_[1]),so(_[2]),w];case"hsla":if(4!==_.length)return null;w=ui(_.pop());case"hsl":if(3!==_.length)return null;var T=(parseFloat(_[0])%360+360)%360/360,D=ui(_[1]),P=ui(_[2]),O=P<=.5?P*(D+1):P+D-P*D,B=2*P-O;return[si(255*Bi(B,O,T+1/3)),si(255*Bi(B,O,T)),si(255*Bi(B,O,T-1/3)),w];default:return null}}return null}}catch{}class Ri{constructor(e,n,s,h=1){this.r=e,this.g=n,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof Ri)return e;if("string"!=typeof e)return;const n=Ys(e);return n?new Ri(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${h})`}toArray(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*n/h,255*s/h,h]}toArray01(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[e/h,n/h,s/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:h}=this;return[e,n,s,h]}}Ri.black=new Ri(0,0,0,1),Ri.white=new Ri(1,1,1,1),Ri.transparent=new Ri(0,0,0,0),Ri.red=new Ri(1,0,0,1),Ri.blue=new Ri(0,0,1,1);var Hr=Ri;class jr{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ia{constructor(e,n,s,h,g){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=h,this.textColor=g}}class Yi{constructor(e){this.sections=e}static fromString(e){return new Yi([new ia(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Yi?e:Yi.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class ao{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ao({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ns(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Js(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Hr||t instanceof jr||t instanceof Yi||t instanceof ao)return!0;if(Array.isArray(t)){for(const e of t)if(!Js(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Js(t[e]))return!1;return!0}return!1}function ti(t){if(null===t)return as;if("string"==typeof t)return Fn;if("boolean"==typeof t)return Lt;if("number"==typeof t)return Zt;if(t instanceof Hr)return Zn;if(t instanceof jr)return oo;if(t instanceof Yi)return Yr;if(t instanceof ao)return Co;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const h=ti(s);if(n){if(n===h)continue;n=$n;break}n=h}return Jn(n||$n,e)}return Nr}function Ni(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Hr||t instanceof Yi||t instanceof ao?t.toString():JSON.stringify(t)}class xa{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Js(e[1]))return n.error("invalid value");const s=e[1];let h=ti(s);const g=n.expectedType;return"array"!==h.kind||0!==h.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(h=g),new xa(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Hr?["rgba"].concat(this.value.toArray()):this.value instanceof Yi?this.value.serialize():this.value}}var ki=xa,Vr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Ts={string:Fn,number:Zt,boolean:Lt,object:Nr};class Ko{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,h=1;const g=e[0];if("array"===g){let w,T;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in Ts)||"object"===D)return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=Ts[D],h++}else w=$n;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}s=Jn(w,T)}else s=Ts[g];const _=[];for(;h<e.length;h++){const w=n.parse(e[h],h,$n);if(!w)return null;_.push(w)}return new Ko(s,_)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!Ln(this.type,ti(s)))return s;if(n===this.args.length-1)throw new Vr(`Expected value to be of type ${br(this.type)}, but found ${br(ti(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(s=>s.serialize()))}}var So=Ko;class Ji{constructor(e){this.type=Yr,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=e.length-1;++_){const w=e[_];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let T=null;if(w["font-scale"]&&(T=n.parse(w["font-scale"],1,Zt),!T))return null;let D=null;if(w["text-font"]&&(D=n.parse(w["text-font"],1,Jn(Fn)),!D))return null;let P=null;if(w["text-color"]&&(P=n.parse(w["text-color"],1,Zn),!P))return null;const O=h[h.length-1];O.scale=T,O.font=D,O.textColor=P}else{const T=n.parse(e[_],1,$n);if(!T)return null;const D=T.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new Ji(h)}evaluate(e){return new Yi(this.sections.map(n=>{const s=n.content.evaluate(e);return ti(s)===Co?new ia("",s,null,null,null):new ia(Ni(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Yo{constructor(e){this.type=Co,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Fn);return s?new Yo(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=ao.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Fa={"to-boolean":Lt,"to-color":Zn,"to-number":Zt,"to-string":Fn};class No{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");const h=Fa[s],g=[];for(let _=1;_<e.length;_++){const w=n.parse(e[_],_,$n);if(!w)return null;g.push(w)}return new No(h,g)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,s;for(const h of this.args){if(n=h.evaluate(e),s=null,n instanceof Hr)return n;if("string"==typeof n){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ns(n[0],n[1],n[2],n[3]),!s))return new Hr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Vr(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Vr(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Yi.fromString(Ni(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ao.fromString(Ni(this.args[0].evaluate(e))):Ni(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ji([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Yo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Mo=No;const za=["Unknown","Point","LineString","Polygon"];var Ds=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?za[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Hr.parse(t)),e}};class cs{constructor(e,n,s,h){this.name=e,this.type=n,this._evaluate=s,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],h=cs.definitions[s];if(!h)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=_.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let T=null;for(const[D,P]of w){T=new Vs(n.registry,n.path,null,n.scope);const O=[];let B=!1;for(let V=1;V<e.length;V++){const $=e[V],J=Array.isArray(D)?D[V-1]:D.type,ue=T.parse($,1+O.length,J);if(!ue){B=!0;break}O.push(ue)}if(!B)if(Array.isArray(D)&&D.length!==O.length)T.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const $=Array.isArray(D)?D[V]:D.type,J=O[V];T.concat(V+1).checkSubtype($,J.type)}if(0===T.errors.length)return new cs(s,g,P,O)}}if(1===w.length)n.errors.push(...T.errors);else{const D=(w.length?w:_).map(([O])=>{return B=O,Array.isArray(B)?`(${B.map(br).join(", ")})`:`(${br(B.type)}...)`;var B}).join(" | "),P=[];for(let O=1;O<e.length;O++){const B=n.parse(e[O],1+P.length);if(!B)return null;P.push(br(B.type))}n.error(`Expected arguments of type ${D}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){cs.definitions=n;for(const s in n)e[s]=cs}}var Uo=cs;class oa{constructor(e,n,s){this.type=oo,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const h=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Lt);if(!h)return null;const g=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Lt);if(!g)return null;let _=null;return s.locale&&(_=n.parse(s.locale,1,Fn),!_)?null:new oa(h,g,_)}evaluate(e){return new jr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Us=8192;function lo(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function sa(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ba(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*Us),Math.round(s*h*Us)]}function Cs(t,e,n){const s=t[0]-e[0],h=t[1]-e[1],g=t[0]-n[0],_=t[1]-n[1];return s*_-g*h==0&&s*g<=0&&h*_<=0}function aa(t,e){let n=!1;for(let _=0,w=e.length;_<w;_++){const T=e[_];for(let D=0,P=T.length;D<P-1;D++){if(Cs(t,T[D],T[D+1]))return!1;(h=T[D])[1]>(s=t)[1]!=(g=T[D+1])[1]>s[1]&&s[0]<(g[0]-h[0])*(s[1]-h[1])/(g[1]-h[1])+h[0]&&(n=!n)}}var s,h,g;return n}function vo(t,e){for(let n=0;n<e.length;n++)if(aa(t,e[n]))return!0;return!1}function la(t,e,n,s){const h=s[0]-n[0],g=s[1]-n[1],_=(t[0]-n[0])*g-h*(t[1]-n[1]),w=(e[0]-n[0])*g-h*(e[1]-n[1]);return _>0&&w<0||_<0&&w>0}function Io(t,e,n){for(const D of n)for(let P=0;P<D.length-1;++P)if((w=[(_=D[P+1])[0]-(g=D[P])[0],_[1]-g[1]])[0]*(T=[(h=e)[0]-(s=t)[0],h[1]-s[1]])[1]-w[1]*T[0]!=0&&la(s,h,g,_)&&la(g,_,s,h))return!0;var s,h,g,_,w,T;return!1}function js(t,e){for(let n=0;n<t.length;++n)if(!aa(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Io(t[n],t[n+1],e))return!1;return!0}function Na(t,e){for(let n=0;n<e.length;n++)if(js(t,e[n]))return!0;return!1}function ca(t,e,n){const s=[];for(let h=0;h<t.length;h++){const g=[];for(let _=0;_<t[h].length;_++){const w=Ba(t[h][_],n);lo(e,w),g.push(w)}s.push(g)}return s}function po(t,e,n){const s=[];for(let h=0;h<t.length;h++){const g=ca(t[h],e,n);s.push(g)}return s}function wa(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const h=.5*s;let g=t[0]-n[0]>h?-s:n[0]-t[0]>h?s:0;0===g&&(g=t[0]-n[2]>h?-s:n[2]-t[0]>h?s:0),t[0]+=g}lo(e,t)}function us(t,e,n,s){const h=Math.pow(2,s.z)*Us,g=[s.x*Us,s.y*Us],_=[];if(!t)return _;for(const w of t)for(const T of w){const D=[T.x+g[0],T.y+g[1]];wa(D,e,n,h),_.push(D)}return _}function gr(t,e,n,s){const h=Math.pow(2,s.z)*Us,g=[s.x*Us,s.y*Us],_=[];if(!t)return _;for(const T of t){const D=[];for(const P of T){const O=[P.x+g[0],P.y+g[1]];lo(e,O),D.push(O)}_.push(D)}if(e[2]-e[0]<=h/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of _)for(const D of T)wa(D,e,n,h)}var w;return _}class ba{constructor(e,n){this.type=Lt,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Js(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const g=s.features[h].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new ba(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new ba(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new ba(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if("Polygon"===s.type){const w=ca(s.coordinates,g,_),T=us(n.geometry(),h,g,_);if(!sa(h,g))return!1;for(const D of T)if(!aa(D,w))return!1}if("MultiPolygon"===s.type){const w=po(s.coordinates,g,_),T=us(n.geometry(),h,g,_);if(!sa(h,g))return!1;for(const D of T)if(!vo(D,w))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if("Polygon"===s.type){const w=ca(s.coordinates,g,_),T=gr(n.geometry(),h,g,_);if(!sa(h,g))return!1;for(const D of T)if(!js(D,w))return!1}if("MultiPolygon"===s.type){const w=po(s.coordinates,g,_),T=gr(n.geometry(),h,g,_);if(!sa(h,g))return!1;for(const D of T)if(!Na(D,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Jo=ba;function hs(t){if(t instanceof Uo&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Jo)return!1;let e=!0;return t.eachChild(n=>{e&&!hs(n)&&(e=!1)}),e}function Qo(t){if(t instanceof Uo&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Qo(n)&&(e=!1)}),e}function Zi(t,e){if(t instanceof Uo&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!Zi(s,e)&&(n=!1)}),n}class Ao{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Ao(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var xo=Ao;class Qi{constructor(e,n=[],s,h=new Ks,g=[]){this.registry=e,this.path=n,this.key=n.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=g,this.expectedType=s}parse(e,n,s,h,g={}){return n?this.concat(n,s,h)._parse(e,g):this._parse(e,g)}_parse(e,n){function s(h,g,_){return"assert"===_?new So(g,[h]):"coerce"===_?new Mo(g,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let _=g.parse(e,this);if(!_)return null;if(this.expectedType){const w=this.expectedType,T=_.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else _=s(_,w,n.typeAnnotation||"coerce");else _=s(_,w,n.typeAnnotation||"assert")}if(!(_ instanceof ki)&&"resolvedImage"!==_.type.kind&&Ss(_)){const w=new Ds;try{_=new ki(_.type,_.evaluate(w))}catch(T){return this.error(T.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const h="number"==typeof e?this.path.concat(e):this.path,g=s?this.scope.concat(s):this.scope;return new Qi(this.registry,h,n||null,g,this.errors)}error(e,...n){const s=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new oi(s,e))}checkSubtype(e,n){const s=Ln(e,n);return s&&this.error(s),s}}var Vs=Qi;function Ss(t){if(t instanceof xo)return Ss(t.boundExpression);if(t instanceof Uo&&"error"===t.name||t instanceof oa||t instanceof Jo)return!1;const e=t instanceof Mo||t instanceof So;let n=!0;return t.eachChild(s=>{n=e?n&&Ss(s):n&&s instanceof ki}),!!n&&hs(t)&&Zi(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function hi(t,e){const n=t.length-1;let s,h,g=0,_=n,w=0;for(;g<=_;)if(w=Math.floor((g+_)/2),s=t[w],h=t[w+1],s<=e){if(w===n||e<h)return w;g=w+1}else{if(!(s>e))throw new Vr("Input is not a number.");_=w-1}return 0}class ua{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,g]of s)this.labels.push(h),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Zt);if(!s)return null;const h=[];let g=null;n.expectedType&&"value"!==n.expectedType.kind&&(g=n.expectedType);for(let _=1;_<e.length;_+=2){const w=1===_?-1/0:e[_],T=e[_+1],D=_,P=_+1;if("number"!=typeof w)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=n.parse(T,P,g);if(!O)return null;g=g||O.type,h.push([w,O])}return new ua(g,s,h)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;return h>=n[g-1]?s[g-1].evaluate(e):s[hi(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Ms=ua;function Qn(t,e,n){return t*(1-n)+e*n}var $s=Object.freeze({__proto__:null,number:Qn,color:function(t,e,n){return new Hr(Qn(t.r,e.r,n),Qn(t.g,e.g,n),Qn(t.b,e.b,n),Qn(t.a,e.a,n))},array:function(t,e,n){return t.map((s,h)=>Qn(s,e[h],n))}});const Ua=.95047,jo=1.08883,Wr=4/29,ha=6/29,es=3*ha*ha,Qa=Math.PI/180,Is=180/Math.PI;function Gs(t){return t>.008856451679035631?Math.pow(t,1/3):t/es+Wr}function wo(t){return t>ha?t*t*t:es*(t-Wr)}function tr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Qs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function As(t){const e=Qs(t.r),n=Qs(t.g),s=Qs(t.b),h=Gs((.4124564*e+.3575761*n+.1804375*s)/Ua),g=Gs((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Gs((.0193339*e+.119192*n+.9503041*s)/jo)),alpha:t.a}}function ea(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*wo(e),n=Ua*wo(n),s=jo*wo(s),new Hr(tr(3.2404542*n-1.5371385*e-.4985314*s),tr(-.969266*n+1.8760108*e+.041556*s),tr(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function bi(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ea={forward:As,reverse:ea,interpolate:function(t,e,n){return{l:Qn(t.l,e.l,n),a:Qn(t.a,e.a,n),b:Qn(t.b,e.b,n),alpha:Qn(t.alpha,e.alpha,n)}}},Po={forward:function(t){const{l:e,a:n,b:s}=As(t),h=Math.atan2(s,n)*Is;return{h:h<0?h+360:h,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Qa,n=t.c;return ea({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:bi(t.h,e.h,n),c:Qn(t.c,e.c,n),l:Qn(t.l,e.l,n),alpha:Qn(t.alpha,e.alpha,n)}}};var da=Object.freeze({__proto__:null,lab:Ea,hcl:Po});class Ta{constructor(e,n,s,h,g){this.type=e,this.operator=n,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[_,w]of g)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(e,n,s,h){let g=0;if("exponential"===e.name)g=Ft(n,e.base,s,h);else if("linear"===e.name)g=Ft(n,1,s,h);else if("cubic-bezier"===e.name){const _=e.controlPoints;g=new jt(_[0],_[1],_[2],_[3]).solve(Ft(n,1,s,h))}return g}static parse(e,n){let[s,h,g,..._]=e;if(!Array.isArray(h)||0===h.length)return n.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const D=h[1];if("number"!=typeof D)return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:D}}else{if("cubic-bezier"!==h[0])return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const D=h.slice(1);if(4!==D.length||D.some(P=>"number"!=typeof P||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Zt),!g)return null;const w=[];let T=null;"interpolate-hcl"===s||"interpolate-lab"===s?T=Zn:n.expectedType&&"value"!==n.expectedType.kind&&(T=n.expectedType);for(let D=0;D<_.length;D+=2){const P=_[D],O=_[D+1],B=D+3,V=D+4;if("number"!=typeof P)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(w.length&&w[w.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const $=n.parse(O,V,T);if(!$)return null;T=T||$.type,w.push([P,$])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new Ta(T,s,h,g,w):n.error(`Type ${br(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;if(h>=n[g-1])return s[g-1].evaluate(e);const _=hi(n,h),w=Ta.interpolationFactor(this.interpolation,h,n[_],n[_+1]),T=s[_].evaluate(e),D=s[_+1].evaluate(e);return"interpolate"===this.operator?$s[this.type.kind.toLowerCase()](T,D,w):"interpolate-hcl"===this.operator?Po.reverse(Po.interpolate(Po.forward(T),Po.forward(D),w)):Ea.reverse(Ea.interpolate(Ea.forward(T),Ea.forward(D),w))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Ft(t,e,n,s){const h=s-n,g=t-n;return 0===h?0:1===e?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}var ar=Ta;class ta{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const h=n.expectedType;h&&"value"!==h.kind&&(s=h);const g=[];for(const w of e.slice(1)){const T=n.parse(w,1+g.length,s,void 0,{typeAnnotation:"omit"});if(!T)return null;s=s||T.type,g.push(T)}const _=h&&g.some(w=>Ln(h,w.type));return new ta(_?$n:s,g)}evaluate(e){let n,s=null,h=0;for(const g of this.args){if(h++,s=g.evaluate(e),s&&s instanceof ao&&!s.available&&(n||(n=s),s=null,h===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var el=ta;class $i{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if("string"!=typeof _)return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=n.parse(e[g+1],g+1);if(!w)return null;s.push([_,w])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return h?new $i(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var dl=$i;class Ps{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Zt),h=n.parse(e[2],2,Jn(n.expectedType||$n));return s&&h?new Ps(h.type.itemType,s,h):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Vr(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Vr(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Vr(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var bo=Ps;class Vo{constructor(e,n){this.type=Lt,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,$n),h=n.parse(e[2],2,$n);return s&&h?ls(s.type,[Lt,Fn,Zt,as,$n])?new Vo(s,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${br(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!wi(n,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${br(ti(n))} instead.`);if(!wi(s,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${br(ti(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var $o=Vo;class ds{constructor(e,n,s){this.type=Zt,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,$n),h=n.parse(e[2],2,$n);if(!s||!h)return null;if(!ls(s.type,[Lt,Fn,Zt,as,$n]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${br(s.type)} instead`);if(4===e.length){const g=n.parse(e[3],3,Zt);return g?new ds(s,h,g):null}return new ds(s,h)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!wi(n,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${br(ti(n))} instead.`);if(!wi(s,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${br(ti(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(n,h)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var kl=ds;class Da{constructor(e,n,s,h,g,_){this.inputType=e,this.type=n,this.input=s,this.cases=h,this.outputs=g,this.otherwise=_}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,h;n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);const g={},_=[];for(let D=2;D<e.length-1;D+=2){let P=e[D];const O=e[D+1];Array.isArray(P)||(P=[P]);const B=n.concat(D);if(0===P.length)return B.error("Expected at least one branch label.");for(const $ of P){if("number"!=typeof $&&"string"!=typeof $)return B.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return B.error("Numeric branch labels must be integer values.");if(s){if(B.checkSubtype(s,ti($)))return null}else s=ti($);if(void 0!==g[String($)])return B.error("Branch labels must be unique.");g[String($)]=_.length}const V=n.parse(O,D,h);if(!V)return null;h=h||V.type,_.push(V)}const w=n.parse(e[1],1,$n);if(!w)return null;const T=n.parse(e[e.length-1],e.length-1,h);return T?"value"!==w.type.kind&&n.concat(1).checkSubtype(s,w.type)?null:new Da(s,h,w,g,_,T):null}evaluate(e){const n=this.input.evaluate(e);return(ti(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],h={};for(const _ of n){const w=h[this.cases[_]];void 0===w?(h[this.cases[_]]=s.length,s.push([this.cases[_],[_]])):s[w][1].push(_)}const g=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,w]of s)e.push(1===w.length?g(w[0]):w.map(g)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}var Gi=Da;class Ro{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const w=n.parse(e[_],_,Lt);if(!w)return null;const T=n.parse(e[_+1],_+1,s);if(!T)return null;h.push([w,T]),s=s||T.type}const g=n.parse(e[e.length-1],e.length-1,s);return g?new Ro(s,h,g):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var fl=Ro;class Go{constructor(e,n,s,h){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,$n),h=n.parse(e[2],2,Zt);if(!s||!h)return null;if(!ls(s.type,[Jn($n),Fn,$n]))return n.error(`Expected first argument to be of type array or string, but found ${br(s.type)} instead`);if(4===e.length){const g=n.parse(e[3],3,Zt);return g?new Go(s.type,s,h,g):null}return new Go(s.type,s,h)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!wi(n,["string","array"]))throw new Vr(`Expected first argument to be of type array or string, but found ${br(ti(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(s,h)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Q=Go;function M(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function A(t,e,n,s){return 0===s.compare(e,n)}function j(t,e,n){const s="=="!==t&&"!="!==t;return class $0{constructor(g,_,w){this.type=Lt,this.lhs=g,this.rhs=_,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===_.type.kind}static parse(g,_){if(3!==g.length&&4!==g.length)return _.error("Expected two or three arguments.");const w=g[0];let T=_.parse(g[1],1,$n);if(!T)return null;if(!M(w,T.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${br(T.type)}'.`);let D=_.parse(g[2],2,$n);if(!D)return null;if(!M(w,D.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${br(D.type)}'.`);if(T.type.kind!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return _.error(`Cannot compare types '${br(T.type)}' and '${br(D.type)}'.`);s&&("value"===T.type.kind&&"value"!==D.type.kind?T=new So(D.type,[T]):"value"!==T.type.kind&&"value"===D.type.kind&&(D=new So(T.type,[D])));let P=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return _.error("Cannot use collator to compare non-string types.");if(P=_.parse(g[3],3,oo),!P)return null}return new $0(T,D,P)}evaluate(g){const _=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(s&&this.hasUntypedArgument){const T=ti(_),D=ti(w);if(T.kind!==D.kind||"string"!==T.kind&&"number"!==T.kind)throw new Vr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${T.kind}, ${D.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const T=ti(_),D=ti(w);if("string"!==T.kind||"string"!==D.kind)return e(g,_,w)}return this.collator?n(g,_,w,this.collator.evaluate(g)):e(g,_,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[t];return this.eachChild(_=>{g.push(_.serialize())}),g}}}const ne=j("==",function(t,e,n){return e===n},A),ge=j("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!A(0,e,n,s)}),Oe=j("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),ze=j(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),Qe=j("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),Et=j(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class mn{constructor(e,n,s,h,g,_){this.type=Fn,this.number=e,this.locale=n,this.currency=s,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Zt);if(!s)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,Fn),!g))return null;let _=null;if(h.currency&&(_=n.parse(h.currency,1,Fn),!_))return null;let w=null;if(h.unit&&(w=n.parse(h.unit,1,Fn),!w))return null;let T=null;if(h["min-fraction-digits"]&&(T=n.parse(h["min-fraction-digits"],1,Zt),!T))return null;let D=null;return h["max-fraction-digits"]&&(D=n.parse(h["max-fraction-digits"],1,Zt),!D)?null:new mn(s,g,_,w,T,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gn{constructor(e){this.type=Zt,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${br(s.type)} instead.`):new gn(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new Vr(`Expected value to be of type string or array, but found ${br(ti(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const ur={"==":ne,"!=":ge,">":ze,"<":Oe,">=":Et,"<=":Qe,array:So,at:bo,boolean:So,case:fl,coalesce:el,collator:oa,format:Ji,image:Yo,in:$o,"index-of":kl,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:gn,let:dl,literal:ki,match:Gi,number:So,"number-format":mn,object:So,slice:Q,step:Ms,string:So,"to-boolean":Mo,"to-color":Mo,"to-number":Mo,"to-string":Mo,var:xo,within:Jo};function hr(t,[e,n,s,h]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const g=h?h.evaluate(t):1,_=Ns(e,n,s,g);if(_)throw new Vr(_);return new Hr(e/255*g,n/255*g,s/255*g,g)}function Vn(t,e){return t in e}function Xn(t,e){const n=e[t];return void 0===n?null:n}function pr(t){return{type:t}}Uo.register(ur,{error:[{kind:"error"},[Fn],(t,[e])=>{throw new Vr(e.evaluate(t))}],typeof:[Fn,[$n],(t,[e])=>br(ti(e.evaluate(t)))],"to-rgba":[Jn(Zt,4),[Zn],(t,[e])=>e.evaluate(t).toArray()],rgb:[Zn,[Zt,Zt,Zt],hr],rgba:[Zn,[Zt,Zt,Zt,Zt],hr],has:{type:Lt,overloads:[[[Fn],(t,[e])=>Vn(e.evaluate(t),t.properties())],[[Fn,Nr],(t,[e,n])=>Vn(e.evaluate(t),n.evaluate(t))]]},get:{type:$n,overloads:[[[Fn],(t,[e])=>Xn(e.evaluate(t),t.properties())],[[Fn,Nr],(t,[e,n])=>Xn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[$n,[Fn],(t,[e])=>Xn(e.evaluate(t),t.featureState||{})],properties:[Nr,[],t=>t.properties()],"geometry-type":[Fn,[],t=>t.geometryType()],id:[$n,[],t=>t.id()],zoom:[Zt,[],t=>t.globals.zoom],pitch:[Zt,[],t=>t.globals.pitch||0],"distance-from-center":[Zt,[],t=>t.distanceFromCenter()],"heatmap-density":[Zt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Zt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Zt,[],t=>t.globals.skyRadialProgress||0],accumulated:[$n,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Zt,pr(Zt),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[Zt,pr(Zt),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:Zt,overloads:[[[Zt,Zt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Zt],(t,[e])=>-e.evaluate(t)]]},"/":[Zt,[Zt,Zt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Zt,[Zt,Zt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Zt,[Zt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Zt,[Zt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Zt,[Zt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Zt,[Zt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Zt,[Zt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Zt,[Zt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Zt,[Zt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Zt,pr(Zt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Zt,pr(Zt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Zt,[Zt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Zt,[Zt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Zt,[Zt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Zt,[Zt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Lt,[Fn,$n],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Lt,[$n],(t,[e])=>t.id()===e.value],"filter-type-==":[Lt,[Fn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Lt,[Fn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Lt,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[Lt,[Fn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>h}],"filter-id->":[Lt,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[Lt,[Fn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Lt,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[Lt,[Fn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Lt,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[Lt,[$n],(t,[e])=>e.value in t.properties()],"filter-has-id":[Lt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Lt,[Jn(Fn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Lt,[Jn($n)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Lt,[Fn,Jn($n)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Lt,[Fn,Jn($n)],(t,[e,n])=>function(s,h,g,_){for(;g<=_;){const w=g+_>>1;if(h[w]===s)return!0;h[w]>s?_=w-1:g=w+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[pr(Lt),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[pr(Lt),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Lt,[Lt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Lt,[Fn],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Fn,[Fn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Fn,[Fn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Fn,pr($n),(t,e)=>e.map(n=>Ni(n.evaluate(t))).join("")],"resolved-locale":[Fn,[oo],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Br=ur;function Jr(t){return{result:"success",value:t}}function Pr(t){return{result:"error",value:t}}function qr(t){return"data-driven"===t["property-type"]}function Sr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ei(t){return!!t.expression&&t.expression.interpolated}function Bn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Ho(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function fs(t){return t}function F(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],h=s||!(s||void 0!==t.property),g=t.type||(Ei(e)?"exponential":"interval");if(n&&((t=io({},t)).stops&&(t.stops=t.stops.map(D=>[D[0],Hr.parse(D[1])])),t.default=Hr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!da[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let _,w,T;if("exponential"===g)_=Se;else if("interval"===g)_=ae;else if("categorical"===g){_=N,w=Object.create(null);for(const D of t.stops)w[D[0]]=D[1];T=typeof t.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);_=ot}if(s){const D={},P=[];for(let V=0;V<t.stops.length;V++){const $=t.stops[V],J=$[0].zoom;void 0===D[J]&&(D[J]={zoom:J,type:t.type,property:t.property,default:t.default,stops:[]},P.push(J)),D[J].stops.push([$[0].value,$[1]])}const O=[];for(const V of P)O.push([D[V].zoom,F(D[V],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:ar.interpolationFactor.bind(void 0,B),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},$)=>Se({stops:O,base:t.base},e,V).evaluate(V,$)}}if(h){const D="exponential"===g?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:ar.interpolationFactor.bind(void 0,D),zoomStops:t.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(t,e,P,w,T)}}return{kind:"source",evaluate(D,P){const O=P&&P.properties?P.properties[t.property]:void 0;return void 0===O?X(t.default,e.default):_(t,e,O,w,T)}}}function X(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function N(t,e,n,s,h){return X(typeof n===h?s[n]:void 0,t.default,e.default)}function ae(t,e,n){if("number"!==Bn(n))return X(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const h=hi(t.stops.map(g=>g[0]),n);return t.stops[h][1]}function Se(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==Bn(n))return X(t.default,e.default);const h=t.stops.length;if(1===h||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[h-1][0])return t.stops[h-1][1];const g=hi(t.stops.map(P=>P[0]),n),_=function(P,O,B,V){const $=V-B,J=P-B;return 0===$?0:1===O?J/$:(Math.pow(O,J)-1)/(Math.pow(O,$)-1)}(n,s,t.stops[g][0],t.stops[g+1][0]),w=t.stops[g][1],T=t.stops[g+1][1];let D=$s[e.type]||fs;if(t.colorSpace&&"rgb"!==t.colorSpace){const P=da[t.colorSpace];D=(O,B)=>P.reverse(P.interpolate(P.forward(O),P.forward(B),_))}return"function"==typeof w.evaluate?{evaluate(...P){const O=w.evaluate.apply(void 0,P),B=T.evaluate.apply(void 0,P);if(void 0!==O&&void 0!==B)return D(O,B,_)}}:D(w,T,_)}function ot(t,e,n){return"color"===e.type?n=Hr.parse(n):"formatted"===e.type?n=Yi.fromString(n.toString()):"resolvedImage"===e.type?n=ao.fromString(n.toString()):Bn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),X(n,t.default,e.default)}class I{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new Ds,this._defaultValue=n?"color"===(s=n).type&&(Ho(s.default)||Array.isArray(s.default))?new Hr(0,0,0,0):"color"===s.type?Hr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,h,g,_,w,T){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,h,g,_,w,T){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Vr(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function k(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Br}function G(t,e){const n=new Vs(Br,[],e?function(h){const g={color:Zn,string:Fn,number:Zt,enum:Fn,boolean:Lt,formatted:Yr,resolvedImage:Co};return"array"===h.type?Jn(g[h.value]||$n,h.length):g[h.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Jr(new I(s,e)):Pr(n.errors)}class _e{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!Qo(n.expression)}evaluateWithoutErrorHandling(e,n,s,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,_)}evaluate(e,n,s,h,g,_){return this._styleExpression.evaluate(e,n,s,h,g,_)}}class $e{constructor(e,n,s,h){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!Qo(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,s,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,_)}evaluate(e,n,s,h,g,_){return this._styleExpression.evaluate(e,n,s,h,g,_)}interpolationFactor(e,n,s){return this.interpolationType?ar.interpolationFactor(this.interpolationType,e,n,s):0}}function Gt(t,e){if("error"===(t=G(t,e)).result)return t;const n=t.value.expression,s=hs(n);if(!s&&!qr(e))return Pr([new oi("","data expressions not supported")]);const h=Zi(n,["zoom","pitch","distance-from-center"]);if(!h&&!Sr(e))return Pr([new oi("","zoom expressions not supported")]);const g=nr(n);return g||h?g instanceof oi?Pr([g]):g instanceof ar&&!Ei(e)?Pr([new oi("",'"interpolate" expressions cannot be used with this property')]):Jr(g?new $e(s?"camera":"composite",t.value,g.labels,g instanceof ar?g.interpolation:void 0):new _e(s?"constant":"source",t.value)):Pr([new oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class An{constructor(e,n){this._parameters=e,this._specification=n,io(this,F(this._parameters,this._specification))}static deserialize(e){return new An(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function nr(t){let e=null;if(t instanceof dl)e=nr(t.result);else if(t instanceof el){for(const n of t.args)if(e=nr(n),e)break}else(t instanceof Ms||t instanceof ar)&&t.input instanceof Uo&&"zoom"===t.input.name&&(e=t);return e instanceof oi||t.eachChild(n=>{const s=nr(n);s instanceof oi?e=s:!e&&s?e=new oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new oi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class mt{constructor(e,n,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),null!=n&&n.__line__&&(this.line=n.__line__)}}function ai(t){const e=t.key,n=t.value,s=t.valueSpec||{},h=t.objectElementValidators||{},g=t.style,_=t.styleSpec;let w=[];const T=Bn(n);if("object"!==T)return[new mt(e,n,`object expected, ${T} found`)];for(const D in n){const P=D.split(".")[0];let B;h[P]?B=h[P]:s[P]?B=Lo:h["*"]?B=h["*"]:s["*"]&&(B=Lo),B?w=w.concat(B({key:(e&&`${e}.`)+D,value:n[D],valueSpec:s[P]||s["*"],style:g,styleSpec:_,object:n,objectKey:D},n)):w.push(new mt(e,n[D],`unknown property "${D}"`))}for(const D in s)h[D]||s[D].required&&void 0===s[D].default&&void 0===n[D]&&w.push(new mt(e,n,`missing required property "${D}"`));return w}function ko(t){const e=t.value,n=t.valueSpec,s=t.style,h=t.styleSpec,g=t.key,_=t.arrayElementValidator||Lo;if("array"!==Bn(e))return[new mt(g,e,`array expected, ${Bn(e)} found`)];if(n.length&&e.length!==n.length)return[new mt(g,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new mt(g,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let w={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};h.$version<7&&(w.function=n.function),"object"===Bn(n.value)&&(w=n.value);let T=[];for(let D=0;D<e.length;D++)T=T.concat(_({array:e,arrayIndex:D,value:e[D],valueSpec:w,style:s,styleSpec:h,key:`${g}[${D}]`}));return T}function Ti(t){const e=t.key,n=t.value,s=t.valueSpec;let h=Bn(n);if("number"===h&&n!=n&&(h="NaN"),"number"!==h)return[new mt(e,n,`number expected, ${h} found`)];if("minimum"in s){let g=s.minimum;if("array"===Bn(s.minimum)&&(g=s.minimum[t.arrayIndex]),n<g)return[new mt(e,n,`${n} is less than the minimum value ${g}`)]}if("maximum"in s){let g=s.maximum;if("array"===Bn(s.maximum)&&(g=s.maximum[t.arrayIndex]),n>g)return[new mt(e,n,`${n} is greater than the maximum value ${g}`)]}return[]}function Hi(t){const e=t.valueSpec,n=Wn(t.value.type);let s,h,g,_={};const w="categorical"!==n&&void 0===t.value.property,T=!w,D="array"===Bn(t.value.stops)&&"array"===Bn(t.value.stops[0])&&"object"===Bn(t.value.stops[0][0]),P=ai({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(V){if("identity"===n)return[new mt(V.key,V.value,'identity function may not have a "stops" property')];let $=[];const J=V.value;return $=$.concat(ko({key:V.key,value:J,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),"array"===Bn(J)&&0===J.length&&$.push(new mt(V.key,J,"array must have at least one stop")),$},default:function(V){return Lo({key:V.key,value:V.value,valueSpec:e,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===n&&w&&P.push(new mt(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||P.push(new mt(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Ei(t.valueSpec)&&P.push(new mt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(T&&!qr(t.valueSpec)?P.push(new mt(t.key,t.value,"property functions not supported")):w&&!Sr(t.valueSpec)&&P.push(new mt(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!D||void 0!==t.value.property||P.push(new mt(t.key,t.value,'"property" property is required')),P;function O(V){let $=[];const J=V.value,ue=V.key;if("array"!==Bn(J))return[new mt(ue,J,`array expected, ${Bn(J)} found`)];if(2!==J.length)return[new mt(ue,J,`array length 2 expected, length ${J.length} found`)];if(D){if("object"!==Bn(J[0]))return[new mt(ue,J,`object expected, ${Bn(J[0])} found`)];if(void 0===J[0].zoom)return[new mt(ue,J,"object stop key must have zoom")];if(void 0===J[0].value)return[new mt(ue,J,"object stop key must have value")];const xe=Wn(J[0].zoom);if("number"!=typeof xe)return[new mt(ue,J[0].zoom,"stop zoom values must be numbers")];if(g&&g>xe)return[new mt(ue,J[0].zoom,"stop zoom values must appear in ascending order")];xe!==g&&(g=xe,h=void 0,_={}),$=$.concat(ai({key:`${ue}[0]`,value:J[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Ti,value:B}}))}else $=$.concat(B({key:`${ue}[0]`,value:J[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},J));return k(_i(J[1]))?$.concat([new mt(`${ue}[1]`,J[1],"expressions are not allowed in function stops.")]):$.concat(Lo({key:`${ue}[1]`,value:J[1],valueSpec:e,style:V.style,styleSpec:V.styleSpec}))}function B(V,$){const J=Bn(V.value),ue=Wn(V.value),xe=null!==V.value?V.value:$;if(s){if(J!==s)return[new mt(V.key,xe,`${J} stop domain type must match previous stop domain type ${s}`)]}else s=J;if("number"!==J&&"string"!==J&&"boolean"!==J&&"number"!=typeof ue&&"string"!=typeof ue&&"boolean"!=typeof ue)return[new mt(V.key,xe,"stop domain value must be a number, string, or boolean")];if("number"!==J&&"categorical"!==n){let Me=`number expected, ${J} found`;return qr(e)&&void 0===n&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new mt(V.key,xe,Me)]}return"categorical"!==n||"number"!==J||"number"==typeof ue&&isFinite(ue)&&Math.floor(ue)===ue?"categorical"!==n&&"number"===J&&"number"==typeof ue&&"number"==typeof h&&void 0!==h&&ue<h?[new mt(V.key,xe,"stop domain values must appear in ascending order")]:(h=ue,"categorical"===n&&ue in _?[new mt(V.key,xe,"stop domain values must be unique")]:(_[ue]=!0,[])):[new mt(V.key,xe,`integer expected, found ${String(ue)}`)]}}function Ui(t){const e=("property"===t.expressionContext?Gt:G)(_i(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new mt(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new mt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Qo(n))return[new mt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Hs(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Zi(n,["zoom","feature-state"]))return[new mt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!hs(n))return[new mt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)n.delete(h);if(0===n.size)return[];const s=[];return t instanceof Uo&&n.has(t.name)?[new mt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(h=>{s.push(...Hs(h,e))}),s)}function Wo(t){const e=t.key,n=t.value,s=t.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(Wn(n))&&h.push(new mt(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(Wn(n))&&h.push(new mt(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function ec(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ec(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ca(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ec(t)||(t=Ll(t));const n=t;let s=!0;try{s=function(D){if(!eo(D))return D;let P=_i(D);return tc(P),P=Sa(P),P}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const h=ht[`filter_${e}`],g=G(s,h);let _=null;if("error"===g.result)throw new Error(g.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,P,O)=>g.value.evaluate(D,P,{},O);let w=null,T=null;if(s!==n){const D=G(n,h);if("error"===D.result)throw new Error(D.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,O,B,V,$)=>D.value.evaluate(P,O,{},B,void 0,void 0,V,$),T=!hs(D.value.expression)}return{filter:_,dynamicFilter:w||void 0,needGeometry:Pu(s),needFeature:!!T}}function Sa(t){if(!Array.isArray(t))return t;const e=function(n){if(ja.has(n[0]))for(let s=1;s<n.length;s++)if(eo(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>Sa(n))}function tc(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||eo(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||eo(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||eo(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)tc(t[s])}function eo(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(eo(t[n]))return!0;return!1}const ja=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function pl(t,e){return t<e?-1:t>e?1:0}function Pu(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Pu(t[e]))return!0;return!1}function Ll(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Pc(t[1],t[2],"=="):"!="===e?Ol(Pc(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Pc(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Ll))):"all"===e?["all"].concat(t.slice(1).map(Ll)):"none"===e?["all"].concat(t.slice(1).map(Ll).map(Ol)):"in"===e?Rc(t[1],t.slice(2)):"!in"===e?Ol(Rc(t[1],t.slice(2))):"has"===e?fa(t[1]):"!has"===e?Ol(fa(t[1])):"within"!==e||t;var n}function Pc(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Rc(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(pl)]]:["filter-in-small",t,["literal",e]]}}function fa(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ol(t){return["!",t]}function Fl(t){return ec(_i(t.value))?Ui(io({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):ml(t)}function ml(t){const e=t.value,n=t.key;if("array"!==Bn(e))return[new mt(n,e,`array expected, ${Bn(e)} found`)];const s=t.styleSpec;let h,g=[];if(e.length<1)return[new mt(n,e,"filter array must have at least 1 element")];switch(g=g.concat(Wo({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),Wn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Wn(e[1])&&g.push(new mt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&g.push(new mt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Bn(e[1]),"string"!==h&&g.push(new mt(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let _=2;_<e.length;_++)h=Bn(e[_]),"$type"===Wn(e[1])?g=g.concat(Wo({key:`${n}[${_}]`,value:e[_],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&g.push(new mt(`${n}[${_}]`,e[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)g=g.concat(ml({key:`${n}[${_}]`,value:e[_],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":h=Bn(e[1]),2!==e.length?g.push(new mt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&g.push(new mt(`${n}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Bn(e[1]),2!==e.length?g.push(new mt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&g.push(new mt(`${n}[1]`,e[1],`object expected, ${h} found`))}return g}function nc(t,e){const n=t.key,s=t.style,h=t.styleSpec,g=t.value,_=t.objectKey,w=h[`${e}_${t.layerType}`];if(!w)return[];const T=_.match(/^(.*)-transition$/);if("paint"===e&&T&&w[T[1]]&&w[T[1]].transition)return Lo({key:n,value:g,valueSpec:h.transition,style:s,styleSpec:h});const D=t.valueSpec||w[_];if(!D)return[new mt(n,g,`unknown property "${_}"`)];let P;if("string"===Bn(g)&&qr(D)&&!D.tokens&&(P=/^{([^}]+)}$/.exec(g)))return[new mt(n,g,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const O=[];return"symbol"===t.layerType&&("text-field"===_&&s&&!s.glyphs&&O.push(new mt(n,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Ho(_i(g))&&"identity"===Wn(g.type)&&O.push(new mt(n,g,'"text-font" does not support identity functions'))),O.concat(Lo({key:t.key,value:g,valueSpec:D,style:s,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:_}))}function kc(t){return nc(t,"paint")}function gl(t){return nc(t,"layout")}function nu(t){let e=[];const n=t.value,s=t.key,h=t.style,g=t.styleSpec;n.type||n.ref||e.push(new mt(s,n,'either "type" or "ref" is required'));let _=Wn(n.type);const w=Wn(n.ref);if(n.id){const T=Wn(n.id);for(let D=0;D<t.arrayIndex;D++){const P=h.layers[D];Wn(P.id)===T&&e.push(new mt(s,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(D=>{D in n&&e.push(new mt(s,n[D],`"${D}" is prohibited for ref layers`))}),h.layers.forEach(D=>{Wn(D.id)===w&&(T=D)}),T?T.ref?e.push(new mt(s,n.ref,"ref cannot reference another ref layer")):_=Wn(T.type):"string"==typeof w&&e.push(new mt(s,n.ref,`ref layer "${w}" not found`))}else if("background"!==_&&"sky"!==_)if(n.source){const T=h.sources&&h.sources[n.source],D=T&&Wn(T.type);T?"vector"===D&&"raster"===_?e.push(new mt(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===D&&"raster"!==_?e.push(new mt(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==D||n["source-layer"]?"raster-dem"===D&&"hillshade"!==_?e.push(new mt(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===D&&T.lineMetrics||e.push(new mt(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new mt(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new mt(s,n.source,`source "${n.source}" not found`))}else e.push(new mt(s,n,'missing required property "source"'));return e=e.concat(ai({key:s,value:n,valueSpec:g.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Lo({key:`${s}.type`,value:n.type,valueSpec:g.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:T=>Fl(io({layerType:_},T)),layout:T=>ai({layer:n,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>gl(io({layerType:_},D))}}),paint:T=>ai({layer:n,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>kc(io({layerType:_},D))}})}})),e}function _l(t){const e=t.value,n=t.key,s=Bn(e);return"string"!==s?[new mt(n,e,`string expected, ${s} found`)]:[]}const rc={promoteId:function({key:t,value:e}){if("string"===Bn(e))return _l({key:t,value:e});{const n=[];for(const s in e)n.push(..._l({key:`${t}.${s}`,value:e[s]}));return n}}};function zl(t){const e=t.value,n=t.key,s=t.styleSpec,h=t.style;if(!e.type)return[new mt(n,e,'"type" is required')];const g=Wn(e.type);let _;switch(g){case"vector":case"raster":case"raster-dem":return _=ai({key:n,value:e,valueSpec:s[`source_${g.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:rc}),_;case"geojson":if(_=ai({key:n,value:e,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:rc}),e.cluster)for(const w in e.clusterProperties){const[T,D]=e.clusterProperties[w],P="string"==typeof T?[T,["accumulated"],["get",w]]:T;_.push(...Ui({key:`${n}.${w}.map`,value:D,expressionContext:"cluster-map"})),_.push(...Ui({key:`${n}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return _;case"video":return ai({key:n,value:e,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return ai({key:n,value:e,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new mt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wo({key:`${n}.type`,value:e.type,valueSpec:{values:ts(s)},style:h,styleSpec:s})}}function ts(t){return t.source.reduce((e,n)=>{const s=t[n];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function Ru(t){const e=t.value,n=t.styleSpec,s=n.light,h=t.style;let g=[];const _=Bn(e);if(void 0===e)return g;if("object"!==_)return g=g.concat([new mt("light",e,`object expected, ${_} found`)]),g;for(const w in e){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&s[T[1]]&&s[T[1]].transition?Lo({key:w,value:e[w],valueSpec:n.transition,style:h,styleSpec:n}):s[w]?Lo({key:w,value:e[w],valueSpec:s[w],style:h,styleSpec:n}):[new mt(w,e[w],`unknown property "${w}"`)])}return g}function Va(t){const e=t.value,n=t.key,s=t.style,h=t.styleSpec,g=h.terrain;let _=[];const w=Bn(e);if(void 0===e)return _;if("object"!==w)return _=_.concat([new mt("terrain",e,`object expected, ${w} found`)]),_;for(const T in e){const D=T.match(/^(.*)-transition$/);_=_.concat(D&&g[D[1]]&&g[D[1]].transition?Lo({key:T,value:e[T],valueSpec:h.transition,style:s,styleSpec:h}):g[T]?Lo({key:T,value:e[T],valueSpec:g[T],style:s,styleSpec:h}):[new mt(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=s.sources&&s.sources[e.source],D=T&&Wn(T.type);T?"raster-dem"!==D&&_.push(new mt(n,e.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):_.push(new mt(n,e.source,`source "${e.source}" not found`))}else _.push(new mt(n,e,'terrain is missing required property "source"'));return _}function tl(t){const e=t.value,n=t.style,s=t.styleSpec,h=s.fog;let g=[];const _=Bn(e);if(void 0===e)return g;if("object"!==_)return g=g.concat([new mt("fog",e,`object expected, ${_} found`)]),g;for(const w in e){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&h[T[1]]&&h[T[1]].transition?Lo({key:w,value:e[w],valueSpec:s.transition,style:n,styleSpec:s}):h[w]?Lo({key:w,value:e[w],valueSpec:h[w],style:n,styleSpec:s}):[new mt(w,e[w],`unknown property "${w}"`)])}return g}const Lc={"*":()=>[],array:ko,boolean:function(t){const e=t.value,n=t.key,s=Bn(e);return"boolean"!==s?[new mt(n,e,`boolean expected, ${s} found`)]:[]},number:Ti,color:function(t){const e=t.key,n=t.value,s=Bn(n);return"string"!==s?[new mt(e,n,`color expected, ${s} found`)]:null===Ys(n)?[new mt(e,n,`color expected, "${n}" found`)]:[]},enum:Wo,filter:Fl,function:Hi,layer:nu,object:ai,source:zl,light:Ru,terrain:Va,fog:tl,string:_l,formatted:function(t){return 0===_l(t).length?[]:Ui(t)},resolvedImage:function(t){return 0===_l(t).length?[]:Ui(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,h=t.style;let g=[];const _=Bn(e);if("object"===_)for(const w in e)g=g.concat(Lo({key:w,value:e[w],valueSpec:s[w],style:h,styleSpec:n}));else"string"!==_&&(g=g.concat([new mt("projection",e,`object or string expected, ${_} found`)]));return g}};function Lo(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&Ho(Wn(e))?Hi(t):n.expression&&k(_i(e))?Ui(t):n.type&&Lc[n.type]?Lc[n.type](t):ai(io({},t,{valueSpec:n.type?s[n.type]:n}))}function hh(t){const e=t.value,n=t.key,s=_l(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new mt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new mt(n,e,'"glyphs" url must include a "{range}" token'))),s}function Bl(t,e=ht){return na(Lo({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:hh,"*":()=>[]}}))}const dh=t=>na(kc(t)),ic=t=>na(gl(t));function na(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Rs(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new fo(new Error(s.message))),n=!0;return n}var yl=qo;function qo(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var h=new Int32Array(this.arrayBuffer);t=h[0],this.d=(e=h[1])+2*(n=h[2]);for(var g=0;g<this.d*this.d;g++){var _=h[3+g],w=h[3+g+1];s.push(_===w?null:h.subarray(_,w))}var T=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],T),this.bboxes=h.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var D=0;D<this.d*this.d;D++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var P=n/e*t;this.min=-P,this.max=t+P}qo.prototype.insert=function(t,e,n,s,h){this._forEachCell(e,n,s,h,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(h)},qo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qo.prototype._insertCell=function(t,e,n,s,h,g){this.cells[h].push(g)},qo.prototype.query=function(t,e,n,s,h){var g=this.min,_=this.max;if(t<=g&&e<=g&&_<=n&&_<=s&&!h)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(t,e,n,s,this._queryCell,w,{},h),w},qo.prototype._queryCell=function(t,e,n,s,h,g,_,w){var T=this.cells[h];if(null!==T)for(var D=this.keys,P=this.bboxes,O=0;O<T.length;O++){var B=T[O];if(void 0===_[B]){var V=4*B;(w?w(P[V+0],P[V+1],P[V+2],P[V+3]):t<=P[V+2]&&e<=P[V+3]&&n>=P[V+0]&&s>=P[V+1])?(_[B]=!0,g.push(D[B])):_[B]=!1}}},qo.prototype._forEachCell=function(t,e,n,s,h,g,_,w){for(var T=this._convertToCellCoord(t),D=this._convertToCellCoord(e),P=this._convertToCellCoord(n),O=this._convertToCellCoord(s),B=T;B<=P;B++)for(var V=D;V<=O;V++){var $=this.d*V+B;if((!w||w(this._convertFromCellCoord(B),this._convertFromCellCoord(V),this._convertFromCellCoord(B+1),this._convertFromCellCoord(V+1)))&&h.call(this,t,e,n,s,$,g,_,w))return}},qo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},qo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},qo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var h=new Int32Array(e+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var g=e,_=0;_<t.length;_++){var w=t[_];h[3+_]=g,h.set(w,g),g+=w.length}return h[3+t.length]=g,h.set(this.keys,g),h[3+t.length+1]=g+=this.keys.length,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer};const nl={};function fn(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),nl[e]={klass:t,omit:n.omit||[]}}fn(Object,"Object"),yl.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},yl.deserialize=function(t){return new yl(t.buffer)},Object.defineProperty(yl,"name",{value:"Grid"}),fn(yl,"Grid"),fn(Hr,"Color"),fn(Error,"Error"),fn(gt,"AJAXError"),fn(ao,"ResolvedImage"),fn(An,"StylePropertyFunction"),fn(I,"StyleExpression",{omit:["_evaluator"]}),fn($e,"ZoomDependentExpression"),fn(_e,"ZoomConstantExpression"),fn(Uo,"CompoundExpression",{omit:["_evaluate"]});for(const t in Br)nl[Br[t]._classRegistryKey]||fn(Br[t],`Expression${t}`);function ks(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function rl(t){return Ie.ImageBitmap&&t instanceof Ie.ImageBitmap}function vl(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ks(t)||rl(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Ie.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(vl(s,e));return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const h=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const g in t)t.hasOwnProperty(g)&&(nl[s].omit.indexOf(g)>=0||(h[g]=vl(t[g],e)));t instanceof Error&&(h.message=t.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof t)}function $a(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ks(t)||rl(t)||ArrayBuffer.isView(t)||t instanceof Ie.ImageData)return t;if(Array.isArray(t))return t.map($a);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=nl[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const h of Object.keys(t))"$name"!==h&&(s[h]=$a(t[h]));return s}throw new Error("can't deserialize object of type "+typeof t)}const ru=t=>t>=1536&&t<=1791,iu=t=>t>=1872&&t<=1919,di=t=>t>=2208&&t<=2303,ou=t=>t>=11904&&t<=12031,ku=t=>t>=12032&&t<=12255,Lu=t=>t>=12272&&t<=12287,Oc=t=>t>=12288&&t<=12351,Fc=t=>t>=12352&&t<=12447,oc=t=>t>=12448&&t<=12543,Ou=t=>t>=12544&&t<=12591,sc=t=>t>=12704&&t<=12735,sd=t=>t>=12736&&t<=12783,Nl=t=>t>=12784&&t<=12799,Eo=t=>t>=12800&&t<=13055,ac=t=>t>=13056&&t<=13311,Ul=t=>t>=13312&&t<=19903,su=t=>t>=19968&&t<=40959,Ws=t=>t>=40960&&t<=42127,il=t=>t>=42128&&t<=42191,au=t=>t>=44032&&t<=55215,lc=t=>t>=63744&&t<=64255,ol=t=>t>=64336&&t<=65023,cc=t=>t>=65040&&t<=65055,p=t=>t>=65072&&t<=65103,r=t=>t>=65104&&t<=65135,c=t=>t>=65136&&t<=65279,a=t=>t>=65280&&t<=65519;function f(t){for(const e of t)if(x(e.charCodeAt(0)))return!0;return!1}function d(t){for(const e of t)if(!y(e.charCodeAt(0)))return!1;return!0}function y(t){return!(ru(t)||iu(t)||di(t)||ol(t)||c(t))}function x(t){return!(746!==t&&747!==t&&(t<4352||!(sc(t)||Ou(t)||p(t)&&!(t>=65097&&t<=65103)||lc(t)||ac(t)||ou(t)||sd(t)||!(!Oc(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ul(t)||su(t)||Eo(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||au(t)||Fc(t)||Lu(t)||(e=>e>=12688&&e<=12703)(t)||ku(t)||Nl(t)||oc(t)&&12540!==t||!(!a(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!r(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||cc(t)||(e=>e>=19904&&e<=19967)(t)||Ws(t)||il(t))));var e}function E(t){return!(x(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n=>n>=8192&&n<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&9251!==e||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Oc(e)||oc(e)||(n=>n>=57344&&n<=63743)(e)||p(e)||r(e)||a(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function C(t){return t>=1424&&t<=2303||ol(t)||c(t)}function R(t,e){return!(!e&&C(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function U(t){for(const e of t)if(C(e.charCodeAt(0)))return!0;return!1}const Y="deferred",oe="loading",ce="loaded";let de=null,me="unavailable",te=null;const be=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(me="error"),de&&de(t)};function ye(){De.fire(new kr("pluginStateChange",{pluginStatus:me,pluginURL:te}))}const De=new yo,Re=function(){return me},Ae=function(){if(me!==Y||!te)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");me=oe,ye(),te&&Ai({url:te},t=>{t?be(t):(me=ce,ye())})},Be={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>me===ce||null!=Be.applyArabicShaping,isLoading:()=>me===oe,setState(t){me=t.pluginStatus,te=t.pluginURL},isParsed:()=>null!=Be.applyArabicShaping&&null!=Be.processBidirectionalText&&null!=Be.processStyledBidirectionalText,getPluginURL:()=>te};class He{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const h of n)if(!R(h.charCodeAt(0),s))return!1;return!0}(e,Be.isLoaded())}}class Ze{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,h){if(Ho(s))return new An(s,h);if(k(s)){const g=Gt(s,h);if("error"===g.result)throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=s;return"string"==typeof s&&"color"===h.type&&(g=Hr.parse(s)),{kind:"constant",evaluate:()=>g}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Je{constructor(e){this.property=e,this.value=new Ze(e,void 0)}transitioned(e,n){return new We(this.property,this.value,n,rt({},e.transition,this.transition),e.now)}untransitioned(){return new We(this.property,this.value,null,{},0)}}class Ht{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Qt(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Je(this._values[e].property)),this._values[e].value=new Ze(this._values[e].property,null===n?void 0:Qt(n))}getTransition(e){return Qt(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Je(this._values[e].property)),this._values[e].transition=Qt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const h=this.getTransition(n);void 0!==h&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const s=new Dt(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,n._values[h]);return s}untransitioned(){const e=new Dt(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class We{constructor(e,n,s,h,g){const _=h.delay||0,w=h.duration||0;g=g||0,this.property=e,this.value=n,this.begin=g+_,this.end=this.begin+w,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const h=e.now||0,g=this.value.possiblyEvaluate(e,n,s),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(e,n,s);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,n,s),g,_n(w))}}return g}}class Dt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const h=new Ke(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ut{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Qt(this._values[e].value)}setValue(e,n){this._values[e]=new Ze(this._values[e].property,null===n?void 0:Qt(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const h=new Ke(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}}class kt{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,h){return this.property.evaluate(this.value,this.parameters,e,n,s,h)}}class Ke{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ge{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const h=$s[this.specification.type];return h?h(e,n,s):e}}class tt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,h){return new kt(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,h)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new kt(this,{kind:"constant",value:void 0},e.parameters);const h=$s[this.specification.type];return h?new kt(this,{kind:"constant",value:h(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,h,g,_){return"constant"===e.kind?e.value:e.evaluate(n,s,h,g,_)}}class It{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,h){return!!e.expression.evaluate(n,null,{},s,h)}interpolate(){return!1}}class zt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new He(0,{});for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const g=this.defaultPropertyValues[s]=new Ze(h,void 0),_=this.defaultTransitionablePropertyValues[s]=new Je(h);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=g.possiblyEvaluate(n)}}}function Mn(t,e){return 256*(t=Bt(Math.floor(t),0,255))+Bt(Math.floor(e),0,255)}fn(tt,"DataDrivenProperty"),fn(Ge,"DataConstantProperty"),fn(It,"ColorRampProperty");const _r={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wn{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function kn(t,e=1){let n=0,s=0;return{members:t.map(h=>{const g=_r[h.type].BYTES_PER_ELEMENT,_=n=Mr(n,Math.max(e,g)),w=h.components||1;return s=Math.max(s,g),n+=g*w,{name:h.name,type:h.type,components:w,offset:_}}),size:Mr(n,Math.max(s,e)),alignment:e}}function Mr(t,e){return Math.ceil(t/e)*e}class Nn extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=s,e}}Nn.prototype.bytesPerElement=4,fn(Nn,"StructArrayLayout2i4");class Qr extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.int16[g+0]=n,this.int16[g+1]=s,this.int16[g+2]=h,e}}Qr.prototype.bytesPerElement=6,fn(Qr,"StructArrayLayout3i6");class fi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=4*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.int16[_+2]=h,this.int16[_+3]=g,e}}fi.prototype.bytesPerElement=8,fn(fi,"StructArrayLayout4i8");class pi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,g,_,w)}emplace(e,n,s,h,g,_,w,T){const D=6*e,P=12*e,O=3*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.uint8[P+4]=h,this.uint8[P+5]=g,this.uint8[P+6]=_,this.uint8[P+7]=w,this.float32[O+2]=T,e}}pi.prototype.bytesPerElement=12,fn(pi,"StructArrayLayout2i4ub1f12");class Di extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=4*e;return this.float32[_+0]=n,this.float32[_+1]=s,this.float32[_+2]=h,this.float32[_+3]=g,e}}Di.prototype.bytesPerElement=16,fn(Di,"StructArrayLayout4f16");class Oo extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h,g)}emplace(e,n,s,h,g,_){const w=6*e,T=3*e;return this.uint16[w+0]=n,this.uint16[w+1]=s,this.uint16[w+2]=h,this.uint16[w+3]=g,this.float32[T+2]=_,e}}Oo.prototype.bytesPerElement=12,fn(Oo,"StructArrayLayout4ui1f12");class Ls extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=4*e;return this.uint16[_+0]=n,this.uint16[_+1]=s,this.uint16[_+2]=h,this.uint16[_+3]=g,e}}Ls.prototype.bytesPerElement=8,fn(Ls,"StructArrayLayout4ui8");class sl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,s,h,g,_)}emplace(e,n,s,h,g,_,w){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=w,e}}sl.prototype.bytesPerElement=12,fn(sl,"StructArrayLayout6i12");class jl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,P,O,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,n,s,h,g,_,w,T,D,P,O,B)}emplace(e,n,s,h,g,_,w,T,D,P,O,B,V){const $=12*e;return this.int16[$+0]=n,this.int16[$+1]=s,this.int16[$+2]=h,this.int16[$+3]=g,this.uint16[$+4]=_,this.uint16[$+5]=w,this.uint16[$+6]=T,this.uint16[$+7]=D,this.int16[$+8]=P,this.int16[$+9]=O,this.int16[$+10]=B,this.int16[$+11]=V,e}}jl.prototype.bytesPerElement=24,fn(jl,"StructArrayLayout4i4ui4i24");class Wi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,s,h,g,_)}emplace(e,n,s,h,g,_,w){const T=10*e,D=5*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.float32[D+2]=g,this.float32[D+3]=_,this.float32[D+4]=w,e}}Wi.prototype.bytesPerElement=20,fn(Wi,"StructArrayLayout3i3f20");class Ci extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Ci.prototype.bytesPerElement=4,fn(Ci,"StructArrayLayout1ul4");class Zr extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,P,O,B,V){const $=this.length;return this.resize($+1),this.emplace($,e,n,s,h,g,_,w,T,D,P,O,B,V)}emplace(e,n,s,h,g,_,w,T,D,P,O,B,V,$){const J=20*e,ue=10*e;return this.int16[J+0]=n,this.int16[J+1]=s,this.int16[J+2]=h,this.int16[J+3]=g,this.int16[J+4]=_,this.float32[ue+3]=w,this.float32[ue+4]=T,this.float32[ue+5]=D,this.float32[ue+6]=P,this.int16[J+14]=O,this.uint32[ue+8]=B,this.uint16[J+18]=V,this.uint16[J+19]=$,e}}Zr.prototype.bytesPerElement=40,fn(Zr,"StructArrayLayout5i4f1i1ul2ui40");class co extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,g,_,w)}emplace(e,n,s,h,g,_,w,T){const D=8*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.int16[D+2]=h,this.int16[D+4]=g,this.int16[D+5]=_,this.int16[D+6]=w,this.int16[D+7]=T,e}}co.prototype.bytesPerElement=16,fn(co,"StructArrayLayout3i2i2i16");class ps extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h,g)}emplace(e,n,s,h,g,_){const w=4*e,T=8*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=h,this.int16[T+6]=g,this.int16[T+7]=_,e}}ps.prototype.bytesPerElement=16,fn(ps,"StructArrayLayout2f1f2i16");class yi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=12*e,w=3*e;return this.uint8[_+0]=n,this.uint8[_+1]=s,this.float32[w+1]=h,this.float32[w+2]=g,e}}yi.prototype.bytesPerElement=12,fn(yi,"StructArrayLayout2ub2f12");class ms extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=h,e}}ms.prototype.bytesPerElement=12,fn(ms,"StructArrayLayout3f12");class gs extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=s,this.uint16[g+2]=h,e}}gs.prototype.bytesPerElement=6,fn(gs,"StructArrayLayout3ui6");class xl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,P,O,B,V,$,J,ue,xe,Me,ve,Ce,ke){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,n,s,h,g,_,w,T,D,P,O,B,V,$,J,ue,xe,Me,ve,Ce,ke)}emplace(e,n,s,h,g,_,w,T,D,P,O,B,V,$,J,ue,xe,Me,ve,Ce,ke,Pe){const Xe=30*e,qe=15*e,vt=60*e;return this.int16[Xe+0]=n,this.int16[Xe+1]=s,this.int16[Xe+2]=h,this.float32[qe+2]=g,this.float32[qe+3]=_,this.uint16[Xe+8]=w,this.uint16[Xe+9]=T,this.uint32[qe+5]=D,this.uint32[qe+6]=P,this.uint32[qe+7]=O,this.uint16[Xe+16]=B,this.uint16[Xe+17]=V,this.uint16[Xe+18]=$,this.float32[qe+10]=J,this.float32[qe+11]=ue,this.uint8[vt+48]=xe,this.uint8[vt+49]=Me,this.uint8[vt+50]=ve,this.uint32[qe+13]=Ce,this.int16[Xe+28]=ke,this.uint8[vt+58]=Pe,e}}xl.prototype.bytesPerElement=60,fn(xl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qs extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,P,O,B,V,$,J,ue,xe,Me,ve,Ce,ke,Pe,Xe,qe,vt,Nt,it,bt,Tt,Ot){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,e,n,s,h,g,_,w,T,D,P,O,B,V,$,J,ue,xe,Me,ve,Ce,ke,Pe,Xe,qe,vt,Nt,it,bt,Tt,Ot)}emplace(e,n,s,h,g,_,w,T,D,P,O,B,V,$,J,ue,xe,Me,ve,Ce,ke,Pe,Xe,qe,vt,Nt,it,bt,Tt,Ot,Ut){const lt=38*e,tn=19*e;return this.int16[lt+0]=n,this.int16[lt+1]=s,this.int16[lt+2]=h,this.float32[tn+2]=g,this.float32[tn+3]=_,this.int16[lt+8]=w,this.int16[lt+9]=T,this.int16[lt+10]=D,this.int16[lt+11]=P,this.int16[lt+12]=O,this.int16[lt+13]=B,this.uint16[lt+14]=V,this.uint16[lt+15]=$,this.uint16[lt+16]=J,this.uint16[lt+17]=ue,this.uint16[lt+18]=xe,this.uint16[lt+19]=Me,this.uint16[lt+20]=ve,this.uint16[lt+21]=Ce,this.uint16[lt+22]=ke,this.uint16[lt+23]=Pe,this.uint16[lt+24]=Xe,this.uint16[lt+25]=qe,this.uint16[lt+26]=vt,this.uint16[lt+27]=Nt,this.uint16[lt+28]=it,this.uint32[tn+15]=bt,this.float32[tn+16]=Tt,this.float32[tn+17]=Ot,this.float32[tn+18]=Ut,e}}qs.prototype.bytesPerElement=76,fn(qs,"StructArrayLayout3i2f6i15ui1ul3f76");class pa extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}pa.prototype.bytesPerElement=4,fn(pa,"StructArrayLayout1f4");class Ma extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h,g)}emplace(e,n,s,h,g,_){const w=5*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=h,this.float32[w+3]=g,this.float32[w+4]=_,e}}Ma.prototype.bytesPerElement=20,fn(Ma,"StructArrayLayout5f20");class wl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=6*e;return this.uint32[3*e+0]=n,this.uint16[_+2]=s,this.uint16[_+3]=h,this.uint16[_+4]=g,e}}wl.prototype.bytesPerElement=12,fn(wl,"StructArrayLayout1ul3ui12");class bl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,e}}bl.prototype.bytesPerElement=4,fn(bl,"StructArrayLayout2ui4");class al extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}al.prototype.bytesPerElement=2,fn(al,"StructArrayLayout1ui2");class zc extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=s,e}}zc.prototype.bytesPerElement=8,fn(zc,"StructArrayLayout2f8");class em extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}em.prototype.size=40;class cf extends Zr{get(e){return new em(this,e)}}fn(cf,"CollisionBoxArray");class uf extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}uf.prototype.size=60;class tm extends xl{get(e){return new uf(this,e)}}fn(tm,"PlacedSymbolArray");class nm extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}nm.prototype.size=76;class ma extends qs{get(e){return new nm(this,e)}}fn(ma,"SymbolInstanceArray");class ad extends pa{getoffsetX(e){return this.float32[1*e+0]}}fn(ad,"GlyphOffsetArray");class hf extends Nn{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}fn(hf,"SymbolLineVertexArray");class ld extends wn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ld.prototype.size=12;class Zs extends wl{get(e){return new ld(this,e)}}fn(Zs,"FeatureIndexArray");class Fu extends bl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}fn(Fu,"FillExtrusionCentroidArray");const rm=kn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),im=kn([{name:"a_dash",components:4,type:"Uint16"}]);var lu={},om={get exports(){return lu},set exports(t){lu=t}},df={};({get exports(){return df},set exports(t){df=t}}).exports=function(t,e){var n,s,h,g,_,w,T,D;for(s=t.length-(n=3&t.length),h=e,_=3432918353,w=461845907,D=0;D<s;)T=255&t.charCodeAt(D)|(255&t.charCodeAt(++D))<<8|(255&t.charCodeAt(++D))<<16|(255&t.charCodeAt(++D))<<24,++D,h=27492+(65535&(g=5*(65535&(h=(h^=T=(65535&(T=(T=(65535&T)*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&t.charCodeAt(D+2))<<16;case 2:T^=(255&t.charCodeAt(D+1))<<8;case 1:h^=T=(65535&(T=(T=(65535&(T^=255&t.charCodeAt(D)))*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return h^=t.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var cd={};({get exports(){return cd},set exports(t){cd=t}}).exports=function(t,e){for(var n,s=t.length,h=e^s,g=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++g;switch(s){case 3:h^=(255&t.charCodeAt(g+2))<<16;case 2:h^=(255&t.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&t.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var sm=df,am=cd;om.exports=sm,lu.murmur3=sm,lu.murmur2=am;class ud{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,h){this.ids.push(lm(e)),this.positions.push(n,s,h)}getPositions(e){const n=lm(e);let s=0,h=this.ids.length-1;for(;s<h;){const _=s+h>>1;this.ids[_]>=n?h=_:s=_+1}const g=[];for(;this.ids[s]===n;)g.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return g}static serialize(e,n){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return fh(s,h,0,s.length-1),n&&n.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(e){const n=new ud;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function lm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:lu(String(t))}function fh(t,e,n,s){for(;n<s;){const h=t[n+s>>1];let g=n-1,_=s+1;for(;;){do{g++}while(t[g]<h);do{_--}while(t[_]>h);if(g>=_)break;zu(t,g,_),zu(e,3*g,3*_),zu(e,3*g+1,3*_+1),zu(e,3*g+2,3*_+2)}_-n<s-_?(fh(t,e,n,_),n=_+1):(fh(t,e,_+1,s),s=_)}}function zu(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}fn(ud,"FeaturePositionMap");class uc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Bc extends uc{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class cm extends uc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class um extends uc{constructor(e){super(e),this.current=Hr.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const ff=new Float32Array(16),pf=new Float32Array(9),hm=new Float32Array(4);function Nc(t){return[Mn(255*t.r,255*t.g),Mn(255*t.b,255*t.a)]}class cu{constructor(e,n,s){this.value=e,this.uniformNames=n.map(h=>`u_${h}`),this.type=s}setUniform(e,n,s,h,g){n.set(e,g,h.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new um(e):new Bc(e)}}class uu{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,h,g){const _="u_pattern"===g||"u_dash"===g?this.pattern:"u_pixel_ratio"===g?this.pixelRatio:null;_&&n.set(e,g,_)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new cm(e):new Bc(e)}}class hc{constructor(e,n,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,s,h,g,_){const w=this.paintVertexArray.length,T=this.expression.evaluate(new He(0),n,{},g,h,_);this.paintVertexArray.resize(e),this._setPaintValue(w,e,T)}updatePaintArray(e,n,s,h,g){const _=this.expression.evaluate({zoom:0},s,h,void 0,g);this._setPaintValue(e,n,_)}_setPaintValue(e,n,s){if("color"===this.type){const h=Nc(s);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ga{constructor(e,n,s,h,g,_){this.expression=e,this.uniformNames=n.map(w=>`u_${w}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,n,s,h,g,_){const w=this.expression.evaluate(new He(this.zoom),n,{},g,h,_),T=this.expression.evaluate(new He(this.zoom+1),n,{},g,h,_),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,w,T)}updatePaintArray(e,n,s,h,g){const _=this.expression.evaluate({zoom:this.zoom},s,h,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,g);this._setPaintValue(e,n,_,w)}_setPaintValue(e,n,s,h){if("color"===this.type){const g=Nc(s),_=Nc(h);for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,g[0],g[1],_[0],_[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,h,g){const _=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,w=Bt(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);n.set(e,g,w)}getBinding(e,n){return new Bc(e)}}class Uc{constructor(e,n,s,h,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=("array"===s?im:rm).members;for(let _=0;_<n.length;++_);this.paintVertexArray=new h}populatePaintArray(e,n,s){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,h,g,_){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],_)}_setPaintValues(e,n,s,h){if(!h||!s)return;const g=h[s];if(!g)return;const{tl:_,br:w,pixelRatio:T}=g;for(let D=e;D<n;D++)this.paintVertexArray.emplace(D,_[0],_[1],w[0],w[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jc{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const g in e.paint._values){if(!s(g))continue;const _=e.paint.get(g);if(!(_ instanceof kt&&qr(_.property.specification)))continue;const w=Ug(g,e.type),T=_.value,D=_.property.specification.type,P=_.property.useIntegerZoom,O="line-dasharray"===g||g.endsWith("pattern"),B="line-dasharray"===g&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==T.kind||B)if("source"===T.kind||B||O){const V=hd(g,D,"source");this.binders[g]=O?new Uc(T,w,D,V,e.id):new hc(T,w,D,V),h.push(`/a_${g}`)}else{const V=hd(g,D,"composite");this.binders[g]=new Ga(T,w,D,P,n,V),h.push(`/z_${g}`)}else this.binders[g]=O?new uu(T.value,w):new cu(T.value,w,D),h.push(`/u_${g}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof hc||n instanceof Ga?n.maxValue:0}populatePaintArrays(e,n,s,h,g,_){for(const w in this.binders){const T=this.binders[w];(T instanceof hc||T instanceof Ga||T instanceof Uc)&&T.populatePaintArray(e,n,s,h,g,_)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof uu&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,h,g,_){let w=!1;for(const T in e){const D=n.getPositions(T);for(const P of D){const O=s.feature(P.index);for(const B in this.binders){const V=this.binders[B];if((V instanceof hc||V instanceof Ga||V instanceof Uc)&&!0===V.expression.isStateDependent){const $=h.paint.get(B);V.expression=$.value,V.updatePaintArray(P.start,P.end,O,e[T],g,_),w=!0}}}}return w}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof cu||s instanceof uu)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof hc||s instanceof Ga||s instanceof Uc)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof cu||s instanceof uu||s instanceof Ga)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof cu||h instanceof uu||h instanceof Ga)for(const g of h.uniformNames)n.push({name:g,property:s,binding:h.getBinding(e,g)})}return n}setUniforms(e,n,s,h,g){for(const{name:_,property:w,binding:T}of s)this.binders[w].setUniform(e,T,g,h.get(w),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof hc||n instanceof Ga||n instanceof Uc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof hc||s instanceof Ga||s instanceof Uc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof hc||n instanceof Ga||n instanceof Uc)&&n.destroy()}}}class hu{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new jc(h,n,s);this.needsUpload=!1,this._featureMap=new ud,this._bufferOffset=0}populatePaintArrays(e,n,s,h,g,_,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,n,h,g,_,w);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,h,g){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,n,_,h,g)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ng={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ug(t,e){return Ng[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const jg={"line-pattern":{source:Oo,composite:Oo},"fill-pattern":{source:Oo,composite:Oo},"fill-extrusion-pattern":{source:Oo,composite:Oo},"line-dasharray":{source:Ls,composite:Ls}},dm={color:{source:zc,composite:Di},number:{source:pa,composite:zc}};function hd(t,e,n){const s=jg[t];return s&&s[n]||dm[e][n]}fn(cu,"ConstantBinder"),fn(uu,"PatternConstantBinder"),fn(hc,"SourceExpressionBinder"),fn(Uc,"PatternCompositeBinder"),fn(Ga,"CompositeExpressionBinder"),fn(jc,"ProgramConfiguration",{omit:["_buffers"]}),fn(hu,"ProgramConfigurationSet");const ph="-transition";class Ha extends yo{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new ut(n.layout)),n.paint)){this._transitionablePaint=new Ht(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ke(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){null!=n&&this._validate(ic,`layers.${this.id}.layout.${e}`,e,n,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return mr(e,ph)?this._transitionablePaint.getTransition(e.slice(0,-ph.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(null!=n&&this._validate(dh,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(mr(e,ph))return this._transitionablePaint.setTransition(e.slice(0,-ph.length),n||void 0),!1;{const h=this._transitionablePaint._values[e],g=h.value.isDataDriven(),_=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value,T=w.isDataDriven(),D=mr(e,"pattern")||"line-dasharray"===e;return T||g||D||this._handleOverridablePaintPropertyUpdate(e,_,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),yn(e,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(e,n,s,h,g={}){return(!g||!1!==g.validate)&&Rs(this,e.call(Bl,{key:n,layerType:this.type,objectKey:s,value:h,styleSpec:ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof kt&&qr(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ca(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Vg=kn([{name:"a_pos",components:2,type:"Int16"}],4),$g=kn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mo{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,h){let g=this.segments[this.segments.length-1];return e>mo.MAX_VERTEX_ARRAY_LENGTH&&ir(`Max vertices per segment is ${mo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>mo.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,h){return new mo([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}mo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,fn(mo,"SegmentVector");var er=8192;class Ia{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ur?new Ur(e.lng,e.lat):Ur.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ur?new Ur(e.lng,e.lat):Ur.convert(e),this}extend(e){const n=this._sw,s=this._ne;let h,g;if(e instanceof Ur)h=e,g=e;else{if(!(e instanceof Ia))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ia.convert(e)):this.extend(Ur.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(Ur.convert(e)):this;if(h=e._sw,g=e._ne,!h||!g)return this}return n||s?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),s.lng=Math.max(g.lng,s.lng),s.lat=Math.max(g.lat,s.lat)):(this._sw=new Ur(h.lng,h.lat),this._ne=new Ur(g.lng,g.lat)),this}getCenter(){return new Ur((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ur(this.getWest(),this.getNorth())}getSouthEast(){return new Ur(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Ur.convert(e);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){return!e||e instanceof Ia?e:new Ia(e)}}var mh=1e-6,ga=typeof Float32Array<"u"?Float32Array:Array;function fm(){var t=new ga(9);return ga!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Gg(t,e,n){var s=e[0],h=e[1],g=e[2],_=e[3],w=e[4],T=e[5],D=e[6],P=e[7],O=e[8],B=n[0],V=n[1],$=n[2],J=n[3],ue=n[4],xe=n[5],Me=n[6],ve=n[7],Ce=n[8];return t[0]=B*s+V*_+$*D,t[1]=B*h+V*w+$*P,t[2]=B*g+V*T+$*O,t[3]=J*s+ue*_+xe*D,t[4]=J*h+ue*w+xe*P,t[5]=J*g+ue*T+xe*O,t[6]=Me*s+ve*_+Ce*D,t[7]=Me*h+ve*w+Ce*P,t[8]=Me*g+ve*T+Ce*O,t}function Aa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mf(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=e[4],w=e[5],T=e[6],D=e[7],P=e[8],O=e[9],B=e[10],V=e[11],$=e[12],J=e[13],ue=e[14],xe=e[15],Me=n*w-s*_,ve=n*T-h*_,Ce=n*D-g*_,ke=s*T-h*w,Pe=s*D-g*w,Xe=h*D-g*T,qe=P*J-O*$,vt=P*ue-B*$,Nt=P*xe-V*$,it=O*ue-B*J,bt=O*xe-V*J,Tt=B*xe-V*ue,Ot=Me*Tt-ve*bt+Ce*it+ke*Nt-Pe*vt+Xe*qe;return Ot?(t[0]=(w*Tt-T*bt+D*it)*(Ot=1/Ot),t[1]=(h*bt-s*Tt-g*it)*Ot,t[2]=(J*Xe-ue*Pe+xe*ke)*Ot,t[3]=(B*Pe-O*Xe-V*ke)*Ot,t[4]=(T*Nt-_*Tt-D*vt)*Ot,t[5]=(n*Tt-h*Nt+g*vt)*Ot,t[6]=(ue*Ce-$*Xe-xe*ve)*Ot,t[7]=(P*Xe-B*Ce+V*ve)*Ot,t[8]=(_*bt-w*Nt+D*qe)*Ot,t[9]=(s*Nt-n*bt-g*qe)*Ot,t[10]=($*Pe-J*Ce+xe*Me)*Ot,t[11]=(O*Ce-P*Pe-V*Me)*Ot,t[12]=(w*vt-_*it-T*qe)*Ot,t[13]=(n*it-s*vt+h*qe)*Ot,t[14]=(J*ve-$*ke-ue*Me)*Ot,t[15]=(P*ke-O*ve+B*Me)*Ot,t):null}function Vc(t,e,n){var s=e[0],h=e[1],g=e[2],_=e[3],w=e[4],T=e[5],D=e[6],P=e[7],O=e[8],B=e[9],V=e[10],$=e[11],J=e[12],ue=e[13],xe=e[14],Me=e[15],ve=n[0],Ce=n[1],ke=n[2],Pe=n[3];return t[0]=ve*s+Ce*w+ke*O+Pe*J,t[1]=ve*h+Ce*T+ke*B+Pe*ue,t[2]=ve*g+Ce*D+ke*V+Pe*xe,t[3]=ve*_+Ce*P+ke*$+Pe*Me,t[4]=(ve=n[4])*s+(Ce=n[5])*w+(ke=n[6])*O+(Pe=n[7])*J,t[5]=ve*h+Ce*T+ke*B+Pe*ue,t[6]=ve*g+Ce*D+ke*V+Pe*xe,t[7]=ve*_+Ce*P+ke*$+Pe*Me,t[8]=(ve=n[8])*s+(Ce=n[9])*w+(ke=n[10])*O+(Pe=n[11])*J,t[9]=ve*h+Ce*T+ke*B+Pe*ue,t[10]=ve*g+Ce*D+ke*V+Pe*xe,t[11]=ve*_+Ce*P+ke*$+Pe*Me,t[12]=(ve=n[12])*s+(Ce=n[13])*w+(ke=n[14])*O+(Pe=n[15])*J,t[13]=ve*h+Ce*T+ke*B+Pe*ue,t[14]=ve*g+Ce*D+ke*V+Pe*xe,t[15]=ve*_+Ce*P+ke*$+Pe*Me,t}function Bu(t,e,n){var s,h,g,_,w,T,D,P,O,B,V,$,J=n[0],ue=n[1],xe=n[2];return e===t?(t[12]=e[0]*J+e[4]*ue+e[8]*xe+e[12],t[13]=e[1]*J+e[5]*ue+e[9]*xe+e[13],t[14]=e[2]*J+e[6]*ue+e[10]*xe+e[14],t[15]=e[3]*J+e[7]*ue+e[11]*xe+e[15]):(h=e[1],g=e[2],_=e[3],w=e[4],T=e[5],D=e[6],P=e[7],O=e[8],B=e[9],V=e[10],$=e[11],t[0]=s=e[0],t[1]=h,t[2]=g,t[3]=_,t[4]=w,t[5]=T,t[6]=D,t[7]=P,t[8]=O,t[9]=B,t[10]=V,t[11]=$,t[12]=s*J+w*ue+O*xe+e[12],t[13]=h*J+T*ue+B*xe+e[13],t[14]=g*J+D*ue+V*xe+e[14],t[15]=_*J+P*ue+$*xe+e[15]),t}function $c(t,e,n){var s=n[0],h=n[1],g=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*h,t[5]=e[5]*h,t[6]=e[6]*h,t[7]=e[7]*h,t[8]=e[8]*g,t[9]=e[9]*g,t[10]=e[10]*g,t[11]=e[11]*g,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gh(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[4],_=e[5],w=e[6],T=e[7],D=e[8],P=e[9],O=e[10],B=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=g*h+D*s,t[5]=_*h+P*s,t[6]=w*h+O*s,t[7]=T*h+B*s,t[8]=D*h-g*s,t[9]=P*h-_*s,t[10]=O*h-w*s,t[11]=B*h-T*s,t}function _h(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[0],_=e[1],w=e[2],T=e[3],D=e[8],P=e[9],O=e[10],B=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*h-D*s,t[1]=_*h-P*s,t[2]=w*h-O*s,t[3]=T*h-B*s,t[8]=g*s+D*h,t[9]=_*s+P*h,t[10]=w*s+O*h,t[11]=T*s+B*h,t}function yh(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vh(t,e,n){var s,h,g,_=n[0],w=n[1],T=n[2],D=Math.hypot(_,w,T);return D<mh?null:(_*=D=1/D,w*=D,T*=D,s=Math.sin(e),h=Math.cos(e),t[0]=_*_*(g=1-h)+h,t[1]=w*_*g+T*s,t[2]=T*_*g-w*s,t[3]=0,t[4]=_*w*g-T*s,t[5]=w*w*g+h,t[6]=T*w*g+_*s,t[7]=0,t[8]=_*T*g+w*s,t[9]=w*T*g-_*s,t[10]=T*T*g+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var pm=Vc;function xh(){var t=new ga(3);return ga!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dd(t){var e=new ga(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function du(t){return Math.hypot(t[0],t[1],t[2])}function Vl(t,e,n){var s=new ga(3);return s[0]=t,s[1]=e,s[2]=n,s}function dc(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function fd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function mm(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function wh(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function bh(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Pa(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Nu(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function _s(t,e){var n=e[0],s=e[1],h=e[2],g=n*n+s*s+h*h;return g>0&&(g=1/Math.sqrt(g)),t[0]=e[0]*g,t[1]=e[1]*g,t[2]=e[2]*g,t}function Ra(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Gc(t,e,n){var s=e[0],h=e[1],g=e[2],_=n[0],w=n[1],T=n[2];return t[0]=h*T-g*w,t[1]=g*_-s*T,t[2]=s*w-h*_,t}function go(t,e,n){var s=e[0],h=e[1],g=e[2],_=n[3]*s+n[7]*h+n[11]*g+n[15];return t[0]=(n[0]*s+n[4]*h+n[8]*g+n[12])/(_=_||1),t[1]=(n[1]*s+n[5]*h+n[9]*g+n[13])/_,t[2]=(n[2]*s+n[6]*h+n[10]*g+n[14])/_,t}function gm(t,e,n){var s=n[0],h=n[1],g=n[2],_=e[0],w=e[1],T=e[2],D=h*T-g*w,P=g*_-s*T,O=s*w-h*_,B=h*O-g*P,V=g*D-s*O,$=s*P-h*D,J=2*n[3];return P*=J,O*=J,V*=2,$*=2,t[0]=_+(D*=J)+(B*=2),t[1]=w+P+V,t[2]=T+O+$,t}var pd,El=fd,gf=mm,Hg=du;function _f(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Eh(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=n*n+s*s+h*h+g*g;return _>0&&(_=1/Math.sqrt(_)),t[0]=n*_,t[1]=s*_,t[2]=h*_,t[3]=g*_,t}function fc(t,e,n){var s=e[0],h=e[1],g=e[2],_=e[3];return t[0]=n[0]*s+n[4]*h+n[8]*g+n[12]*_,t[1]=n[1]*s+n[5]*h+n[9]*g+n[13]*_,t[2]=n[2]*s+n[6]*h+n[10]*g+n[14]*_,t[3]=n[3]*s+n[7]*h+n[11]*g+n[15]*_,t}function yf(){var t=new ga(4);return ga!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vf(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function xf(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],_=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T+_*w,t[1]=h*T+g*w,t[2]=g*T-h*w,t[3]=_*T-s*w,t}function wf(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],_=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T-g*w,t[1]=h*T+_*w,t[2]=g*T+s*w,t[3]=_*T-h*w,t}xh(),pd=new ga(4),ga!=Float32Array&&(pd[0]=0,pd[1]=0,pd[2]=0,pd[3]=0);var Wg=Eh;xh(),Vl(1,0,0),Vl(0,1,0),yf(),yf(),fm();const qg=kn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_m}=qg,ym=kn([{name:"a_pos_3",components:3,type:"Int16"}]);var Th=kn([{name:"a_pos",type:"Int16",components:2}]);class $l{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const h=Ra(n,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/h;return s[0]=this.pos[0]+this.dir[0]*g,s[1]=this.pos[1]+this.dir[1]*g,s[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,n,s){if(J=(V=this.pos)[0],ue=V[1],xe=V[2],Me=($=e)[0],ve=$[1],Ce=$[2],Math.abs(J-Me)<=mh*Math.max(1,Math.abs(J),Math.abs(Me))&&Math.abs(ue-ve)<=mh*Math.max(1,Math.abs(ue),Math.abs(ve))&&Math.abs(xe-Ce)<=mh*Math.max(1,Math.abs(xe),Math.abs(Ce))||0===n)return s[0]=s[1]=s[2]=0,!1;var V,$,J,ue,xe,Me,ve,Ce;const[h,g,_]=this.dir,w=this.pos[0]-e[0],T=this.pos[1]-e[1],D=this.pos[2]-e[2],P=h*h+g*g+_*_,O=2*(w*h+T*g+D*_),B=O*O-4*P*(w*w+T*T+D*D-n*n);if(B<0){const V=Math.max(-O/2,0),$=w+h*V,J=T+g*V,ue=D+_*V,xe=Math.hypot($,J,ue);return s[0]=$*n/xe,s[1]=J*n/xe,s[2]=ue*n/xe,!1}{const V=(-O-Math.sqrt(B))/(2*P);if(V<0){const $=Math.hypot(w,T,D);return s[0]=w*n/$,s[1]=T*n/$,s[2]=D*n/$,!1}return s[0]=w+h*V,s[1]=T+g*V,s[2]=D+_*V,!0}}}class fu{constructor(e,n,s,h,g){this.TL=e,this.TR=n,this.BR=s,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(e,n,s){const h=[-1,1,1],g=[1,1,1],_=[1,-1,1],w=[-1,-1,1],T=go(h,h,e),D=go(g,g,e),P=go(_,_,e),O=go(w,w,e);return new fu(T,D,P,O,n/s)}}class bf{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,h){const g=Math.pow(2,s),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const D=fc([],T,e),P=1/D[3]/n*g;return(O=D)[0]=(B=D)[0]*(V=[P,P,h?1/D[3]:P,P])[0],O[1]=B[1]*V[1],O[2]=B[2]*V[2],O[3]=B[3]*V[3],O;var O,B,V}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const D=_s([],Gc([],El([],_[T[0]],_[T[1]]),El([],_[T[2]],_[T[1]]))),P=-Ra(D,_[T[1]]);return D.concat(P)});return new bf(_,w)}}class _a{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const h of e)wh(n,n,h),bh(s,s,h);return new _a(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let h=0;h<s.length;++h)go(s[h],s[h],n);return _a.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=Pa([],dc([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=dd(this.min),h=dd(this.max);for(let g=0;g<n.length;g++)s[g]=n[g]?this.min[g]:this.center[g],h[g]=n[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new _a(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let h=0;h<e.planes.length;h++){const g=e.planes[h];let _=0;for(let w=0;w<n.length;w++)_+=Ra(g,n[w])+g[3]>=0;if(0===_)return 0;_!==n.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let g=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][h]-this.min[h];g=Math.min(g,T),_=Math.max(_,T)}if(_<0||g>this.max[h]-this.min[h])return 0}return 1}}const pc=er/Math.PI/2,md=[64,32,16],Tl=-pc,Wa=pc,Zg=[new _a([Tl,Tl,Tl],[Wa,Wa,Wa]),new _a([Tl,Tl,Tl],[0,0,Wa]),new _a([0,Tl,Tl],[Wa,0,Wa]),new _a([Tl,0,Tl],[0,Wa,Wa]),new _a([0,0,Tl],[Wa,Wa,Wa])];function gd(t){return t*pc/Mh}function vm(t,e,n,s=!0){const h=Pa([],t._camera.position,t.worldSize),g=[e,n,1,1];fc(g,g,t.pixelMatrixInverse),_f(g,g,1/g[3]);const _=_s([],El([],g,h)),w=t.globeMatrix,T=[w[12],w[13],w[14]],D=El([],T,h),P=du(D),O=_s([],D),B=t.worldSize/(2*Math.PI),V=Ra(O,_),$=Math.asin(B/P);if($<Math.acos(V)){if(!s)return null;const Nt=[],it=[];Pa(Nt,_,P/V),_s(it,El(it,Nt,D)),_s(_,dc(_,D,Pa(_,it,Math.tan($)*P)))}const J=[];new $l(h,_).closestPointOnSphere(T,B,J);const ue=_s([],vn(w,0)),xe=_s([],vn(w,1)),Me=_s([],vn(w,2)),ve=Ra(ue,J),Ce=Ra(xe,J),ke=Ra(Me,J),Pe=pt(Math.asin(-Ce/B));let Xe=pt(Math.atan2(ve,ke));Xe=t.center.lng+function(Nt,it){const bt=(it-Nt+180)%360-180;return bt<-180?bt+360:bt}(t.center.lng,Xe);const qe=Cl(Xe),vt=Bt(Sl(Pe),0,1);return new Ih(qe,vt)}class Xg{constructor(e,n,s){this.a=El([],e,s),this.b=El([],n,s),this.center=s;const h=_s([],this.a),g=_s([],this.b);this.angle=Math.acos(Ra(h,g))}}function Dh(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,h,g,_){const w=Math.sin(g);return s*(Math.sin((1-_)*g)/w)+h*(Math.sin(_*g)/w)}(t.a[e],t.b[e],t.angle,Bt(n,0,1))+t.center[e]}function Os(t){if(t.z<=1)return Zg[t.z+2*t.y+t.x];const e=wm(Df(t));return _a.fromPoints(e)}function Dl(t,e,n){return Pa(t,t,1-n),Nu(t,t,e,n)}function Ef(t,e){const n=Vu(e.zoom);if(0===n)return Os(t);const s=Df(t),h=wm(s),g=Cl(s.getWest())*e.worldSize,_=Cl(s.getEast())*e.worldSize,w=Sl(s.getNorth())*e.worldSize,T=Sl(s.getSouth())*e.worldSize,D=[g,w,0],P=[_,w,0],O=[g,T,0],B=[_,T,0],V=mf([],e.globeMatrix);return go(D,D,V),go(P,P,V),go(O,O,V),go(B,B,V),h[0]=Dl(h[0],O,n),h[1]=Dl(h[1],B,n),h[2]=Dl(h[2],P,n),h[3]=Dl(h[3],D,n),_a.fromPoints(h)}function Tf(t,e,n){for(const s of t)go(s,s,e),Pa(s,s,n)}function Df({x:t,y:e,z:n}){const s=1/(1<<n),h=new Ur(qa(t*s),Fs((e+1)*s)),g=new Ur(qa((t+1)*s),Fs(e*s));return new Ia(h,g)}function wm(t){const e=Ne(t.getNorth()),n=Ne(t.getSouth()),s=Math.cos(e),h=Math.cos(n),g=Math.sin(e),_=Math.sin(n),w=t.getWest(),T=t.getEast();return[Ch(h,_,w),Ch(h,_,T),Ch(s,g,T),Ch(s,g,w)]}function Ch(t,e,n,s=pc){return n=Ne(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function Hc(t,e,n){return Ch(Math.cos(Ne(t)),Math.sin(Ne(t)),e,n)}function pu(t,e,n,s){const h=1<<n.z,g=(t/er+n.x)/h;return Hc(Fs((e/er+n.y)/h),qa(g),s)}function Cf({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Kg=new Float64Array(16);function ju(t){const e=Cf(t),n=yh(Kg,[e,e,e]);return Bu(n,n,((s=[])[0]=-(h=t.min)[0],s[1]=-h[1],s[2]=-h[2],s));var s,h}function Sf(t){const e=(s=t.min,(n=Kg)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const h=1/Cf(t);return $c(e,e,[h,h,h])}function bm(t,e,n,s,h){const g=function(T){const D=er/(2*Math.PI);return T/(2*Math.PI)/D}(n),_=[t,e,-n/(2*Math.PI)],w=Aa(new Float64Array(16));return Bu(w,w,_),$c(w,w,[g,g,g]),gh(w,w,Ne(-h)),_h(w,w,Ne(-s)),w}function Vu(t){return un(5,6,t)}function Em(t,e){const n=Hc(e.lat,e.lng);return _=(h=fd([],function($){const J=Hc($._center.lat,$._center.lng);let ue=Gc([],Vl(0,1,0),J);const xe=vh([],-$.angle,J);ue=go(ue,ue,xe),vh(xe,-$._pitch,ue);const Me=_s([],J);return Pa(Me,Me,gd($.cameraToCenterDistance/$.pixelsPerMeter)),go(Me,Me,xe),dc([],J,Me)}(t),n))[0],w=h[1],T=h[2],D=(g=n)[0],P=g[1],O=g[2],V=(B=Math.sqrt(_*_+w*w+T*T)*Math.sqrt(D*D+P*P+O*O))&&Ra(h,g)/B,Math.acos(Math.min(Math.max(V,-1),1));var h,g,_,w,T,D,P,O,B,V}function _d(t,e){return Em(t,e)>Math.PI/2*1.01}const Sh=Ne(85),Yg=Math.cos(Sh),Mf=Math.sin(Sh),Mh=6371008.8,Zo=2*Math.PI*Mh;class Ur{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ur(rr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,h=e.lat*n,g=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Mh*Math.acos(Math.min(g,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Ia(new Ur(this.lng-s,this.lat-n),new Ur(this.lng+s,this.lat+n))}toEcef(e){const n=gd(e);return Hc(this.lat,this.lng,pc+n)}static convert(e){if(e instanceof Ur)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Ur(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Ur(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function If(t){return Zo*Math.cos(t*Math.PI/180)}function Cl(t){return(180+t)/360}function Sl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ml(t,e){return t/If(e)}function qa(t){return 360*t-180}function Fs(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Tm(t,e){return t*If(Fs(e))}const ys=85.051129;function Jg(t){return 1/Math.cos(t*Math.PI/180)}class Ih{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Ur.convert(e);return new Ih(Cl(s.lng),Sl(s.lat),Ml(n,s.lat))}toLngLat(){return new Ur(qa(this.x),Fs(this.y))}toAltitude(){return Tm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Zo*Jg(Fs(this.y))}}function mu(t,e,n,s,h,g,_,w,T){const D=(e+s)/2,P=(n+h)/2,O=new st(D,P);w(O),function(B,V,$,J,ue,xe){const Me=$-ue,ve=J-xe;return Math.abs((J-V)*Me-($-B)*ve)/Math.hypot(Me,ve)}(O.x,O.y,g.x,g.y,_.x,_.y)>=T?(mu(t,e,n,D,P,g,O,w,T),mu(t,D,P,s,h,O,_,w,T)):t.push(_)}function yd(t,e,n){let s=t[0],h=s.x,g=s.y;e(s);const _=[s];for(let w=1;w<t.length;w++){const T=t[w],{x:D,y:P}=T;e(T),mu(_,h,g,D,P,s,T,e,n),h=D,g=P,s=T}return _}function vd(t,e,n,s){if(s(e,n)){const h=e.add(n)._mult(.5);vd(t,e,h,s),vd(t,h,n,s)}else t.push(n)}function Dm(t,e){let n=t[0];const s=[n];for(let h=1;h<t.length;h++){const g=t[h];vd(s,n,g,e),n=g}return s}const xd=Math.pow(2,14)-1,Cm=-xd-1;function Qg(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Bt(n,Cm,xd),t.y=Bt(s,Cm,xd),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&ir("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Gl(t,e,n){const s=t.loadGeometry(),h=t.extent,g=er/h;if(e&&n&&n.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:w,x:T,y:D,projection:P}=n,O=B=>{const V=qa((e.x+B.x/h)/_),$=Fs((e.y+B.y/h)/_),J=P.project(V,$);B.x=(J.x*w-T)*h,B.y=(J.y*w-D)*h};for(let B=0;B<s.length;B++)if(1!==t.type)s[B]=yd(s[B],O,1);else{const V=[];for(const $ of s[B])$.x<0||$.x>=h||$.y<0||$.y>=h||(O($),V.push($));s[B]=V}}for(const _ of s)for(const w of _)Qg(w,g);return s}function Wc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Gl(t):[]}}function $u(t,e,n,s,h){t.emplaceBack(2*e+(s+1)/2,2*n+(h+1)/2)}function Af(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Nn,this.indexArray=new gs,this.segments=new mo,this.programConfigurations=new hu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){const g=this.layers[0],_=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:D,id:P,index:O,sourceLayerIndex:B}of e){const V=this.layers[0]._featureFilter.needGeometry,$=Wc(D,V);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),$,s))continue;const J=w?w.evaluate($,{},s):void 0,ue={id:P,properties:D.properties,type:D.type,sourceLayerIndex:B,index:O,geometry:V?$.geometry:Gl(D,s,h),patterns:{},sortKey:J};_.push(ue)}w&&_.sort((D,P)=>D.sortKey-P.sortKey);let T=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new sl,T=h.projection);for(const D of _){const{geometry:P,index:O,sourceLayerIndex:B}=D,V=e[O].feature;this.addFeature(D,P,O,n.availableImages,s,T),n.featureIndex.insert(V,P,O,B,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$g.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,h,g,_){for(const w of n)for(const T of w){const D=T.x,P=T.y;if(D<0||D>=er||P<0||P>=er)continue;if(_){const V=_.projectTilePoint(D,P,g),$=_.upVector(g,D,P),J=this.globeExtVertexArray;Af(J,V,$),Af(J,V,$),Af(J,V,$),Af(J,V,$)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=O.vertexLength;$u(this.layoutVertexArray,D,P,-1,-1),$u(this.layoutVertexArray,D,P,1,-1),$u(this.layoutVertexArray,D,P,1,1),$u(this.layoutVertexArray,D,P,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,g)}}function Sm(t,e){for(let n=0;n<t.length;n++)if(gc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(gc(t,e[n]))return!0;return!!mc(t,e)}function Pf(t,e,n){return!!gc(t,e)||!!Ph(e,t,n)}function Rf(t,e){if(1===t.length)return Im(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let h=0;h<s.length;h++)if(gc(t,s[h]))return!0}for(let n=0;n<t.length;n++)if(Im(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(mc(t,e[n]))return!0;return!1}function Mm(t,e,n){if(t.length>1){if(mc(t,e))return!0;for(let s=0;s<e.length;s++)if(Ph(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(Ph(t[s],e,n))return!0;return!1}function mc(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],h=t[n+1];for(let g=0;g<e.length-1;g++)if(e_(s,h,e[g],e[g+1]))return!0}return!1}function e_(t,e,n,s){return Xr(t,n,s)!==Xr(e,n,s)&&Xr(t,e,n)!==Xr(t,e,s)}function Ph(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(Rh(t,e[h-1],e[h])<s)return!0;return!1}function Rh(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const h=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function Im(t,e){let n,s,h,g=!1;for(let _=0;_<t.length;_++){n=t[_];for(let w=0,T=n.length-1;w<n.length;T=w++)s=n[w],h=n[T],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(g=!g)}return g}function gc(t,e){let n=!1;for(let s=0,h=t.length-1;s<t.length;h=s++){const g=t[s],_=t[h];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function kh(t,e,n,s,h){for(const _ of t)if(e<=_.x&&n<=_.y&&s>=_.x&&h>=_.y)return!0;const g=[new st(e,n),new st(e,h),new st(s,h),new st(s,n)];if(t.length>2)for(const _ of g)if(gc(t,_))return!0;for(let _=0;_<t.length-1;_++)if(gu(t[_],t[_+1],g))return!0;return!1}function gu(t,e,n){const s=n[0],h=n[2];if(t.x<s.x&&e.x<s.x||t.x>h.x&&e.x>h.x||t.y<s.y&&e.y<s.y||t.y>h.y&&e.y>h.y)return!1;const g=Xr(t,e,n[0]);return g!==Xr(t,e,n[1])||g!==Xr(t,e,n[2])||g!==Xr(t,e,n[3])}function _u(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Gu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Am(t,e,n,s,h){if(!e[0]&&!e[1])return t;const g=st.convert(e)._mult(h);"viewport"===n&&g._rotate(-s);const _=[];for(let w=0;w<t.length;w++)_.push(t[w].sub(g));return _}function Pm(t,e,n,s){const h=st.convert(t)._mult(s);return"viewport"===e&&h._rotate(-n),h}fn(Ah,"CircleBucket",{omit:["layers"]});const Rm=new zt({"circle-sort-key":new tt(ht.layout_circle["circle-sort-key"])});var Hu={paint:new zt({"circle-radius":new tt(ht.paint_circle["circle-radius"]),"circle-color":new tt(ht.paint_circle["circle-color"]),"circle-blur":new tt(ht.paint_circle["circle-blur"]),"circle-opacity":new tt(ht.paint_circle["circle-opacity"]),"circle-translate":new Ge(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Ge(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ge(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ge(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tt(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tt(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tt(ht.paint_circle["circle-stroke-opacity"])}),layout:Rm};function km(t,e,n,s,h,g,_,w,T){if(g&&t.queryGeometry.isAboveHorizon)return!1;g&&(T*=t.pixelToTileUnitsFactor);const D=t.tileID.canonical,P=n.projection.upVectorScale(D,n.center.lat,n.worldSize).metersToTile;for(const O of e)for(const B of O){const V=B.add(w),$=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(V.x,V.y,!0):0,J=n.projection.projectTilePoint(V.x,V.y,D);if($>0){const ve=n.projection.upVector(D,V.x,V.y);J.x+=ve[0]*P*$,J.y+=ve[1]*P*$,J.z+=ve[2]*P*$}const ue=g?V:t_(J.x,J.y,J.z,s),xe=g?t.tilespaceRays.map(ve=>n_(ve,$)):t.queryGeometry.screenGeometry,Me=fc([],[J.x,J.y,J.z,1],s);if(!_&&g?T*=Me[3]/n.cameraToCenterDistance:_&&!g&&(T*=n.cameraToCenterDistance/Me[3]),g){const ve=Fs((B.y/er+D.y)/(1<<D.z));T/=n.projection.pixelsPerMeter(ve,1)/Ml(1,ve)}if(Pf(xe,ue,T))return!0}return!1}function t_(t,e,n,s){const h=fc([],[t,e,n,1],s);return new st(h[0]/h[3],h[1]/h[3])}const Lm=Vl(0,0,0),kf=Vl(0,0,1);function n_(t,e){const n=xh();return Lm[2]=e,t.intersectsPlane(Lm,kf,n),new st(n[0],n[1])}class Lf extends Ah{}function Om(t,{width:e,height:n},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=h,t}function Of(t,e,n){const{width:s,height:h}=e;s===t.width&&h===t.height||(Fm(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,h)},n),t.width=s,t.height=h,t.data=e.data)}function Fm(t,e,n,s,h,g){if(0===h.width||0===h.height)return e;if(h.width>t.width||h.height>t.height||n.x>t.width-h.width||n.y>t.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=t.data,w=e.data;for(let T=0;T<h.height;T++){const D=((n.y+T)*t.width+n.x)*g,P=((s.y+T)*e.width+s.x)*g;for(let O=0;O<h.width*g;O++)w[P+O]=_[D+O]}return e}fn(Lf,"HeatmapBucket",{omit:["layers"]});class _c{constructor(e,n){Om(this,e,1,n)}resize(e){Of(this,new _c(e),1)}clone(){return new _c({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){Fm(e,n,s,h,g,1)}}class zs{constructor(e,n){Om(this,e,4,n)}resize(e){Of(this,new zs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new zs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){Fm(e,n,s,h,g,4)}}fn(_c,"AlphaImage"),fn(zs,"RGBAImage");var r_={paint:new zt({"heatmap-radius":new tt(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tt(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ge(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new It(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ge(ht.paint_heatmap["heatmap-opacity"])})};function qc(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,h=t.image||new zs({width:n,height:s}),g=(_,w,T)=>{e[t.evaluationKey]=T;const D=t.expression.evaluate(e);h.data[_+w+0]=Math.floor(255*D.r/D.a),h.data[_+w+1]=Math.floor(255*D.g/D.a),h.data[_+w+2]=Math.floor(255*D.b/D.a),h.data[_+w+3]=Math.floor(255*D.a)};if(t.clips)for(let _=0,w=0;_<s;++_,w+=4*n)for(let T=0,D=0;T<n;T++,D+=4){const P=T/(n-1),{start:O,end:B}=t.clips[_];g(w,D,O*(1-P)+B*P)}else for(let _=0,w=0;_<n;_++,w+=4)g(0,w,_/(n-1));return h}var Lh={paint:new zt({"hillshade-illumination-direction":new Ge(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ge(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ge(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ge(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ge(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ge(ht.paint_hillshade["hillshade-accent-color"])})};const i_=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:zm}=i_;var Wu={};function wd(t,e,n){n=n||2;var s,h,g,_,w,T,D,P=e&&e.length,O=P?e[0]*n:t.length,B=Bm(t,0,O,n,!0),V=[];if(!B||B.next===B.prev)return V;if(P&&(B=function(J,ue,xe,Me){var ve,Ce,ke,Pe=[];for(ve=0,Ce=ue.length;ve<Ce;ve++)(ke=Bm(J,ue[ve]*Me,ve<Ce-1?ue[ve+1]*Me:J.length,Me,!1))===ke.next&&(ke.steiner=!0),Pe.push(l_(ke));for(Pe.sort(Fh),ve=0;ve<Pe.length;ve++)xe=s_(Pe[ve],xe);return xe}(t,e,B,n)),t.length>80*n){s=g=t[0],h=_=t[1];for(var $=n;$<O;$+=n)(w=t[$])<s&&(s=w),(T=t[$+1])<h&&(h=T),w>g&&(g=w),T>_&&(_=T);D=0!==(D=Math.max(g-s,_-h))?32767/D:0}return Oh(B,V,n,s,h,D,0),V}function Bm(t,e,n,s,h){var g,_;if(h===Sd(t,e,n,s)>0)for(g=e;g<n;g+=s)_=Uf(g,t[g],t[g+1],_);else for(g=n-s;g>=e;g-=s)_=Uf(g,t[g],t[g+1],_);return _&&yc(_,_.next)&&(Dd(_),_=_.next),_}function Zc(t,e){if(!t)return t;e||(e=t);var n,s=t;do{if(n=!1,s.steiner||!yc(s,s.next)&&0!==To(s.prev,s,s.next))s=s.next;else{if(Dd(s),(s=e=s.prev)===s.next)break;n=!0}}while(n||s!==e);return e}function Oh(t,e,n,s,h,g,_){if(t){!_&&g&&function(P,O,B,V){var $=P;do{0===$.z&&($.z=Nf($.x,$.y,O,B,V)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next}while($!==P);$.prevZ.nextZ=null,$.prevZ=null,function(J){var ue,xe,Me,ve,Ce,ke,Pe,Xe,qe=1;do{for(xe=J,J=null,Ce=null,ke=0;xe;){for(ke++,Me=xe,Pe=0,ue=0;ue<qe&&(Pe++,Me=Me.nextZ);ue++);for(Xe=qe;Pe>0||Xe>0&&Me;)0!==Pe&&(0===Xe||!Me||xe.z<=Me.z)?(ve=xe,xe=xe.nextZ,Pe--):(ve=Me,Me=Me.nextZ,Xe--),Ce?Ce.nextZ=ve:J=ve,ve.prevZ=Ce,Ce=ve;xe=Me}Ce.nextZ=null,qe*=2}while(ke>1)}($)}(t,s,h,g);for(var w,T,D=t;t.prev!==t.next;)if(w=t.prev,T=t.next,g?zf(t,s,h,g):Ff(t))e.push(w.i/n|0),e.push(t.i/n|0),e.push(T.i/n|0),Dd(t),t=T.next,D=T.next;else if((t=T)===D){_?1===_?Oh(t=o_(Zc(t),e,n),e,n,s,h,g,2):2===_&&Bf(t,e,n,s,h,g):Oh(Zc(t),e,n,s,h,g,1);break}}}function Ff(t){var e=t.prev,n=t,s=t.next;if(To(e,n,s)>=0)return!1;for(var h=e.x,g=n.x,_=s.x,w=e.y,T=n.y,D=s.y,P=h<g?h<_?h:_:g<_?g:_,O=w<T?w<D?w:D:T<D?T:D,B=h>g?h>_?h:_:g>_?g:_,V=w>T?w>D?w:D:T>D?T:D,$=s.next;$!==e;){if($.x>=P&&$.x<=B&&$.y>=O&&$.y<=V&&qu(h,w,g,T,_,D,$.x,$.y)&&To($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function zf(t,e,n,s){var h=t.prev,g=t,_=t.next;if(To(h,g,_)>=0)return!1;for(var w=h.x,T=g.x,D=_.x,P=h.y,O=g.y,B=_.y,V=w<T?w<D?w:D:T<D?T:D,$=P<O?P<B?P:B:O<B?O:B,J=w>T?w>D?w:D:T>D?T:D,ue=P>O?P>B?P:B:O>B?O:B,xe=Nf(V,$,e,n,s),Me=Nf(J,ue,e,n,s),ve=t.prevZ,Ce=t.nextZ;ve&&ve.z>=xe&&Ce&&Ce.z<=Me;){if(ve.x>=V&&ve.x<=J&&ve.y>=$&&ve.y<=ue&&ve!==h&&ve!==_&&qu(w,P,T,O,D,B,ve.x,ve.y)&&To(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,Ce.x>=V&&Ce.x<=J&&Ce.y>=$&&Ce.y<=ue&&Ce!==h&&Ce!==_&&qu(w,P,T,O,D,B,Ce.x,Ce.y)&&To(Ce.prev,Ce,Ce.next)>=0))return!1;Ce=Ce.nextZ}for(;ve&&ve.z>=xe;){if(ve.x>=V&&ve.x<=J&&ve.y>=$&&ve.y<=ue&&ve!==h&&ve!==_&&qu(w,P,T,O,D,B,ve.x,ve.y)&&To(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;Ce&&Ce.z<=Me;){if(Ce.x>=V&&Ce.x<=J&&Ce.y>=$&&Ce.y<=ue&&Ce!==h&&Ce!==_&&qu(w,P,T,O,D,B,Ce.x,Ce.y)&&To(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.nextZ}return!0}function o_(t,e,n){var s=t;do{var h=s.prev,g=s.next.next;!yc(h,g)&&Hl(h,s,s.next,g)&&Td(h,g)&&Td(g,h)&&(e.push(h.i/n|0),e.push(s.i/n|0),e.push(g.i/n|0),Dd(s),Dd(s.next),s=t=g),s=s.next}while(s!==t);return Zc(s)}function Bf(t,e,n,s,h,g){var _=t;do{for(var w=_.next.next;w!==_.prev;){if(_.i!==w.i&&c_(_,w)){var T=u_(_,w);return _=Zc(_,_.next),T=Zc(T,T.next),Oh(_,e,n,s,h,g,0),void Oh(T,e,n,s,h,g,0)}w=w.next}_=_.next}while(_!==t)}function Fh(t,e){return t.x-e.x}function s_(t,e){var n=function(h,g){var _,w=g,T=h.x,D=h.y,P=-1/0;do{if(D<=w.y&&D>=w.next.y&&w.next.y!==w.y){var O=w.x+(D-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=T&&O>P&&(P=O,_=w.x<w.next.x?w:w.next,O===T))return _}w=w.next}while(w!==g);if(!_)return null;var B,V=_,$=_.x,J=_.y,ue=1/0;w=_;do{T>=w.x&&w.x>=$&&T!==w.x&&qu(D<J?T:P,D,$,J,D<J?P:T,D,w.x,w.y)&&(B=Math.abs(D-w.y)/(T-w.x),Td(w,h)&&(B<ue||B===ue&&(w.x>_.x||w.x===_.x&&a_(_,w)))&&(_=w,ue=B)),w=w.next}while(w!==V);return _}(t,e);if(!n)return e;var s=u_(n,t);return Zc(s,s.next),Zc(n,n.next)}function a_(t,e){return To(t.prev,t,e.prev)<0&&To(e.next,t,t.next)<0}function Nf(t,e,n,s,h){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function l_(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function qu(t,e,n,s,h,g,_,w){return(h-_)*(e-w)>=(t-_)*(g-w)&&(t-_)*(s-w)>=(n-_)*(e-w)&&(n-_)*(g-w)>=(h-_)*(s-w)}function c_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==s.i&&h.next.i!==s.i&&Hl(h,h.next,n,s))return!0;h=h.next}while(h!==n);return!1}(t,e)&&(Td(t,e)&&Td(e,t)&&function(n,s){var h=n,g=!1,_=(n.x+s.x)/2,w=(n.y+s.y)/2;do{h.y>w!=h.next.y>w&&h.next.y!==h.y&&_<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next}while(h!==n);return g}(t,e)&&(To(t.prev,t,e.prev)||To(t,e.prev,e))||yc(t,e)&&To(t.prev,t,t.next)>0&&To(e.prev,e,e.next)>0)}function To(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function yc(t,e){return t.x===e.x&&t.y===e.y}function Hl(t,e,n,s){var h=Ed(To(t,e,n)),g=Ed(To(t,e,s)),_=Ed(To(n,s,t)),w=Ed(To(n,s,e));return h!==g&&_!==w||!(0!==h||!bd(t,n,e))||!(0!==g||!bd(t,s,e))||!(0!==_||!bd(n,t,s))||!(0!==w||!bd(n,e,s))}function bd(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ed(t){return t>0?1:t<0?-1:0}function Td(t,e){return To(t.prev,t,t.next)<0?To(t,e,t.next)>=0&&To(t,t.prev,e)>=0:To(t,e,t.prev)<0||To(t,t.next,e)<0}function u_(t,e){var n=new Cd(t.i,t.x,t.y),s=new Cd(e.i,e.x,e.y),h=t.next,g=e.prev;return t.next=e,e.prev=t,n.next=h,h.prev=n,s.next=n,n.prev=s,g.next=s,s.prev=g,s}function Uf(t,e,n,s){var h=new Cd(t,e,n);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Dd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Cd(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sd(t,e,n,s){for(var h=0,g=e,_=n-s;g<n;g+=s)h+=(t[_]-t[g])*(t[g+1]+t[_+1]),_=g;return h}function h_(t,e,n,s,h){jf(t,e,n||0,s||t.length-1,h||d_)}function jf(t,e,n,s,h){for(;s>n;){if(s-n>600){var g=s-n+1,_=e-n+1,w=Math.log(g),T=.5*Math.exp(2*w/3),D=.5*Math.sqrt(w*T*(g-T)/g)*(_-g/2<0?-1:1);jf(t,e,Math.max(n,Math.floor(e-_*T/g+D)),Math.min(s,Math.floor(e+(g-_)*T/g+D)),h)}var P=t[e],O=n,B=s;for(zh(t,n,e),h(t[s],P)>0&&zh(t,n,s);O<B;){for(zh(t,O,B),O++,B--;h(t[O],P)<0;)O++;for(;h(t[B],P)>0;)B--}0===h(t[n],P)?zh(t,n,B):zh(t,++B,s),B<=e&&(n=B+1),e<=B&&(s=B-1)}}function zh(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function d_(t,e){return t<e?-1:t>e?1:0}function Za(t,e){const n=t.length;if(n<=1)return[t];const s=[];let h,g;for(let _=0;_<n;_++){const w=Tn(t[_]);0!==w&&(t[_].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(h&&s.push(h),h=[t[_]]):h.push(t[_]))}if(h&&s.push(h),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(h_(s[_],e,1,s[_].length-1,f_),s[_]=s[_].slice(0,e));return s}function f_(t,e){return e.area-t.area}function Md(t,e,n){const s=n.patternDependencies;let h=!1;for(const g of e){const _=g.paint.get(`${t}-pattern`);_.isConstant()||(h=!0);const w=_.constantOr(null);w&&(h=!0,s[w]=!0)}return h}function Vf(t,e,n,s,h){const g=h.patternDependencies;for(const _ of e){const w=_.paint.get(`${t}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:s},n,{},h.availableImages);T=T&&T.name?T.name:T,g[T]=!0,n.patterns[_.id]=T}}return n}({get exports(){return Wu},set exports(t){Wu=t}}).exports=wd,Wu.default=wd,wd.deviation=function(t,e,n,s){var h=e&&e.length,g=Math.abs(Sd(t,0,h?e[0]*n:t.length,n));if(h)for(var _=0,w=e.length;_<w;_++)g-=Math.abs(Sd(t,e[_]*n,_<w-1?e[_+1]*n:t.length,n));var T=0;for(_=0;_<s.length;_+=3){var D=s[_]*n,P=s[_+1]*n,O=s[_+2]*n;T+=Math.abs((t[D]-t[O])*(t[P+1]-t[D+1])-(t[D]-t[P])*(t[O+1]-t[D+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},wd.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,h=0;h<t.length;h++){for(var g=0;g<t[h].length;g++)for(var _=0;_<e;_++)n.vertices.push(t[h][g][_]);h>0&&n.holes.push(s+=t[h-1].length)}return n};class Id{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Nn,this.indexArray=new gs,this.indexArray2=new bl,this.programConfigurations=new hu(e.layers,e.zoom),this.segments=new mo,this.segments2=new mo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,h){this.hasPattern=Md("fill",this.layers,n);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:w,id:T,index:D,sourceLayerIndex:P}of e){const O=this.layers[0]._featureFilter.needGeometry,B=Wc(w,O);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),B,s))continue;const V=g?g.evaluate(B,{},s,n.availableImages):void 0,$={id:T,properties:w.properties,type:w.type,sourceLayerIndex:P,index:D,geometry:O?B.geometry:Gl(w,s,h),patterns:{},sortKey:V};_.push($)}g&&_.sort((w,T)=>w.sortKey-T.sortKey);for(const w of _){const{geometry:T,index:D,sourceLayerIndex:P}=w;if(this.hasPattern){const O=Vf("fill",this.layers,w,this.zoom,n);this.patternFeatures.push(O)}else this.addFeature(w,T,D,s,{},n.availableImages);n.featureIndex.insert(e[D].feature,T,D,P,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,g){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,h,g,_=[]){for(const w of Za(n,500)){let T=0;for(const $ of w)T+=$.length;const D=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=D.vertexLength,O=[],B=[];for(const $ of w){if(0===$.length)continue;$!==w[0]&&B.push(O.length/2);const J=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),ue=J.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(ue+$.length-1,ue),O.push($[0].x),O.push($[0].y);for(let xe=1;xe<$.length;xe++)this.layoutVertexArray.emplaceBack($[xe].x,$[xe].y),this.indexArray2.emplaceBack(ue+xe-1,ue+xe),O.push($[xe].x),O.push($[xe].y);J.vertexLength+=$.length,J.primitiveLength+=$.length}const V=Wu(O,B);for(let $=0;$<V.length;$+=3)this.indexArray.emplaceBack(P+V[$],P+V[$+1],P+V[$+2]);D.vertexLength+=T,D.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,_,h)}}fn(Id,"FillBucket",{omit:["layers","patternFeatures"]});const p_=new zt({"fill-sort-key":new tt(ht.layout_fill["fill-sort-key"])});var m_={paint:new zt({"fill-antialias":new Ge(ht.paint_fill["fill-antialias"]),"fill-opacity":new tt(ht.paint_fill["fill-opacity"]),"fill-color":new tt(ht.paint_fill["fill-color"]),"fill-outline-color":new tt(ht.paint_fill["fill-outline-color"]),"fill-translate":new Ge(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Ge(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new tt(ht.paint_fill["fill-pattern"])}),layout:p_};const Nm=kn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),g_=kn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),__=kn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:y_}=Nm;var Er={},Um=st,$f=yu;function yu(t,e,n,s,h){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=h,t.readFields(v_,this,e)}function v_(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,h){for(var g=s.readVarint()+s.pos;s.pos<g;){var _=h._keys[s.readVarint()],w=h._values[s.readVarint()];h.properties[_]=w}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function x_(t){for(var e,n,s=0,h=0,g=t.length,_=g-1;h<g;_=h++)s+=((n=t[_]).x-(e=t[h]).x)*(e.y+n.y);return s}yu.types=["Unknown","Point","LineString","Polygon"],yu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,h=0,g=0,_=0,w=[];t.pos<n;){if(h<=0){var T=t.readVarint();s=7&T,h=T>>3}if(h--,1===s||2===s)g+=t.readSVarint(),_+=t.readSVarint(),1===s&&(e&&w.push(e),e=[]),e.push(new Um(g,_));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&w.push(e),w},yu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,h=0,g=0,_=1/0,w=-1/0,T=1/0,D=-1/0;t.pos<e;){if(s<=0){var P=t.readVarint();n=7&P,s=P>>3}if(s--,1===n||2===n)(h+=t.readSVarint())<_&&(_=h),h>w&&(w=h),(g+=t.readSVarint())<T&&(T=g),g>D&&(D=g);else if(7!==n)throw new Error("unknown command "+n)}return[_,T,w,D]},yu.prototype.toGeoJSON=function(t,e,n){var s,h,g=this.extent*Math.pow(2,n),_=this.extent*t,w=this.extent*e,T=this.loadGeometry(),D=yu.types[this.type];function P(V){for(var $=0;$<V.length;$++){var J=V[$];V[$]=[360*(J.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(s=0;s<T.length;s++)O[s]=T[s][0];P(T=O);break;case 2:for(s=0;s<T.length;s++)P(T[s]);break;case 3:for(T=function(V){var $=V.length;if($<=1)return[V];for(var J,ue,xe=[],Me=0;Me<$;Me++){var ve=x_(V[Me]);0!==ve&&(void 0===ue&&(ue=ve<0),ue===ve<0?(J&&xe.push(J),J=[V[Me]]):J.push(V[Me]))}return J&&xe.push(J),xe}(T),s=0;s<T.length;s++)for(h=0;h<T[s].length;h++)P(T[s][h])}1===T.length?T=T[0]:D="Multi"+D;var B={type:"Feature",geometry:{type:D,coordinates:T},properties:this.properties};return"id"in this&&(B.id=this.id),B};var jm=$f,Vm=Gf;function Gf(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(w_,this,e),this.length=this._features.length}function w_(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var h=null,g=s.readVarint()+s.pos;s.pos<g;){var _=s.readVarint()>>3;h=1===_?s.readString():2===_?s.readFloat():3===_?s.readDouble():4===_?s.readVarint64():5===_?s.readVarint():6===_?s.readSVarint():7===_?s.readBoolean():null}return h}(n))}Gf.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new jm(this._pbf,e,this.extent,this._keys,this._values)};var b_=Vm;function zy(t,e,n){if(3===t){var s=new b_(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var Ad=Er.VectorTile=function(t,e){this.layers=t.readFields(zy,{},e)},Bh=Er.VectorTileFeature=$f;function Wl(t,e,n,s){const h=[],g=0===s?(_,w,T,D,P,O)=>{_.push(new st(O,T+(O-w)/(D-w)*(P-T)))}:(_,w,T,D,P,O)=>{_.push(new st(w+(O-T)/(P-T)*(D-w),O))};for(const _ of t){const w=[];for(const T of _){if(T.length<=2)continue;const D=[];for(let B=0;B<T.length-1;B++){const V=T[B].x,$=T[B].y,J=T[B+1].x,ue=T[B+1].y,xe=0===s?V:$,Me=0===s?J:ue;xe<e?Me>e&&g(D,V,$,J,ue,e):xe>n?Me<n&&g(D,V,$,J,ue,n):D.push(T[B]),Me<e&&xe>=e&&g(D,V,$,J,ue,e),Me>n&&xe<=n&&g(D,V,$,J,ue,n)}let P=T[T.length-1];const O=0===s?P.x:P.y;O>=e&&O<=n&&D.push(P),D.length&&(P=D[D.length-1],D[0].x===P.x&&D[0].y===P.y||D.push(D[0]),w.push(D))}w.length&&h.push(w)}return h}Er.VectorTileLayer=Vm;const E_=Bh.types,Hf=Math.pow(2,13);function vu(t,e,n,s,h,g,_,w){t.emplaceBack((e<<1)+_,(n<<1)+g,(Math.floor(s*Hf)<<1)+h,Math.round(w))}function Nh(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class T_{constructor(){this.acc=new st(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new st(e.x,e.y),this.max=new st(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,h=this.max;e.x<s.x?s.x=e.x:e.x>h.x&&(h.x=e.x),e.y<s.y?s.y=e.y:e.y>h.y&&(h.y=e.y),((0===e.x||e.x===er)&&e.x===n.x)!=((0===e.y||e.y===er)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,Qn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>er!=e.x>er&&this.addBorderIntersection(1,Qn(n.y,e.y,(er-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Qn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>er!=e.y>er&&this.addBorderIntersection(3,Qn(n.x,e.x,(er-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==e?this.acc.div(e)._round():new st(0,0)}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Pd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new fi,this.centroidVertexArray=new Fu,this.indexArray=new gs,this.programConfigurations=new hu(e.layers,e.zoom),this.segments=new mo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,h){this.features=[],this.hasPattern=Md("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const _=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*_/(_*_+1)/er/(1<<g.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:_,index:w,sourceLayerIndex:T}of e){const D=this.layers[0]._featureFilter.needGeometry,P=Wc(g,D);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),P,s))continue;const O={id:_,sourceLayerIndex:T,index:w,geometry:D?P.geometry:Gl(g,s,h),properties:g.properties,type:g.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(Vf("fill-extrusion",this.layers,O,this.zoom,n)):this.addFeature(O,O.geometry,w,s,{},n.availableImages,h),n.featureIndex.insert(g,O.geometry,w,T,this.index,B)}this.sortBorders()}addFeatures(e,n,s,h,g){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,n,s,h,g)}this.sortBorders()}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,y_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,__.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,g_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,h,g,_,w){const T=[new st(0,0),new st(er,er)],D=w.projection,P="globe"===D.name,O=this.enableTerrain&&!P?new T_:null,B="Polygon"===E_[e.type];P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new sl);const V=Za(n,500);for(let xe=V.length-1;xe>=0;xe--){const Me=V[xe];(0===Me.length||($=Me[0]).every(ve=>ve.x<=0)||$.every(ve=>ve.x>=er)||$.every(ve=>ve.y<=0)||$.every(ve=>ve.y>=er))&&V.splice(xe,1)}var $;let J;if(P)J=qf(V,T,h);else{J=[];for(const xe of V)J.push({polygon:xe,bounds:T})}const ue=B?this.edgeRadius:0;for(const{polygon:xe,bounds:Me}of J){let ve=0,Ce=0;for(const Pe of xe)B&&!Pe[0].equals(Pe[Pe.length-1])&&Pe.push(Pe[0]),Ce+=B?Pe.length-1:Pe.length;const ke=this.segments.prepareSegment((B?5:4)*Ce,this.layoutVertexArray,this.indexArray);if(B){const Pe=[],Xe=[];ve=ke.vertexLength;for(const vt of xe){let Nt,it;vt.length&&vt!==xe[0]&&Xe.push(Pe.length/2),Nt=vt[1].sub(vt[0])._perp()._unit();for(let bt=1;bt<vt.length;bt++){const Tt=vt[bt],Ot=vt[bt===vt.length-1?1:bt+1];let{x:Ut,y:lt}=Tt;if(ue){it=Ot.sub(Tt)._perp()._unit();const tn=Nt.add(it)._unit(),Un=ue*Math.min(4,1/(Nt.x*tn.x+Nt.y*tn.y));Ut+=Un*tn.x,lt+=Un*tn.y,Nt=it}vu(this.layoutVertexArray,Ut,lt,0,0,1,1,0),ke.vertexLength++,Pe.push(Tt.x,Tt.y),P&&Nh(this.layoutVertexExtArray,D.projectTilePoint(Ut,lt,h),D.upVector(h,Ut,lt))}}const qe=Wu(Pe,Xe);for(let vt=0;vt<qe.length;vt+=3)this.indexArray.emplaceBack(ve+qe[vt],ve+qe[vt+2],ve+qe[vt+1]),ke.primitiveLength++}for(const Pe of xe){O&&Pe.length&&O.startRing(Pe[0]);let Xe,qe,vt,Nt=Pe.length>4&&$m(Pe[Pe.length-2],Pe[0],Pe[1]),it=ue?C_(Pe[Pe.length-2],Pe[0],Pe[1],ue):0;qe=Pe[1].sub(Pe[0])._perp()._unit();let bt=!0;for(let Tt=1,Ot=0;Tt<Pe.length;Tt++){let Ut=Pe[Tt-1],lt=Pe[Tt];const tn=Pe[Tt===Pe.length-1?1:Tt+1];if(O&&B&&O.currentPolyCount.top++,S_(lt,Ut,Me)){ue&&(qe=tn.sub(lt)._perp()._unit(),bt=!bt);continue}O&&O.append(lt,Ut);const Un=lt.sub(Ut)._perp(),cn=Un.x/(Math.abs(Un.x)+Math.abs(Un.y)),Cn=Un.y>0?1:0,rn=Ut.dist(lt);if(Ot+rn>32768&&(Ot=0),ue){vt=tn.sub(lt)._perp()._unit();let Tr=Wf(Ut,lt,tn,D_(qe,vt),ue);isNaN(Tr)&&(Tr=0);const Kn=lt.sub(Ut)._unit();Ut=Ut.add(Kn.mult(it))._round(),lt=lt.add(Kn.mult(-Tr))._round(),it=Tr,qe=vt}const qn=ke.vertexLength,Ir=Pe.length>4&&$m(Ut,lt,tn);let Dr=xu(Ot,Nt,bt);if(vu(this.layoutVertexArray,Ut.x,Ut.y,cn,Cn,0,0,Dr),vu(this.layoutVertexArray,Ut.x,Ut.y,cn,Cn,0,1,Dr),Ot+=rn,Dr=xu(Ot,Ir,!bt),Nt=Ir,vu(this.layoutVertexArray,lt.x,lt.y,cn,Cn,0,0,Dr),vu(this.layoutVertexArray,lt.x,lt.y,cn,Cn,0,1,Dr),ke.vertexLength+=4,this.indexArray.emplaceBack(qn+0,qn+1,qn+2),this.indexArray.emplaceBack(qn+1,qn+3,qn+2),ke.primitiveLength+=2,ue){const Tr=ve+(1===Tt?Pe.length-2:Tt-2),Kn=1===Tt?ve:Tr+1;if(this.indexArray.emplaceBack(qn+1,Tr,qn+3),this.indexArray.emplaceBack(Tr,Kn,qn+3),ke.primitiveLength+=2,void 0===Xe&&(Xe=qn),!S_(tn,Pe[Tt],Me)){const li=Tt===Pe.length-1?Xe:ke.vertexLength;this.indexArray.emplaceBack(qn+2,qn+3,li),this.indexArray.emplaceBack(qn+3,li+1,li),this.indexArray.emplaceBack(qn+3,Kn,li+1),ke.primitiveLength+=3}bt=!bt}if(P){const Tr=this.layoutVertexExtArray,Kn=D.projectTilePoint(Ut.x,Ut.y,h),li=D.projectTilePoint(lt.x,lt.y,h),lr=D.upVector(h,Ut.x,Ut.y),Rr=D.upVector(h,lt.x,lt.y);Nh(Tr,Kn,lr),Nh(Tr,Kn,lr),Nh(Tr,li,Rr),Nh(Tr,li,Rr)}}B&&(ve+=Pe.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const xe=O.borders,Me=this.featuresOnBorder.push(O)-1;for(let ve=0;ve<4;ve++)xe[ve][0]!==Number.MAX_VALUE&&this.borders[ve].push(Me)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,_,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let h,g;if(e)if(0!==e.y){const w=n.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else h=Math.ceil(7*(e.x+450)),g=0;else h=0,g=+s;let _=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const w of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(_++,h,g);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(_++,0,g),this.centroidVertexArray.emplace(_++,h,g)}}}function D_(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function C_(t,e,n,s){const h=e.sub(t)._perp()._unit(),g=n.sub(e)._perp()._unit();return Wf(t,e,n,D_(h,g),s)}function Wf(t,e,n,s,h){const g=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,h*g/s)}function S_(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function $m(t,e,n){if(t.x<0||t.x>=er||e.x<0||e.x>=er||n.x<0||n.x>=er)return!1;const s=n.sub(e),h=s.perp(),g=t.sub(e);return(s.x*g.x+s.y*g.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function xu(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function Gm(){const t=Math.PI/32,e=Math.tan(t),n=Mh;return n*Math.sqrt(1+2*e*e)-n}function qf(t,e,n){const s=1<<n.z,h=qa(n.x/s),g=qa((n.x+1)/s),_=Fs(n.y/s),w=Fs((n.y+1)/s);return function(T,D,P,O,B=0,V){const $=[];if(!T.length||!P||!O)return $;const J=(Pe,Xe)=>{for(const qe of Pe)$.push({polygon:qe,bounds:Xe})},ue=Math.ceil(Math.log2(P)),xe=Math.ceil(Math.log2(O)),Me=ue-xe,ve=[];for(let Pe=0;Pe<Math.abs(Me);Pe++)ve.push(Me>0?0:1);for(let Pe=0;Pe<Math.min(ue,xe);Pe++)ve.push(0),ve.push(1);let Ce=T;if(Ce=Wl(Ce,D[0].y-B,D[1].y+B,1),Ce=Wl(Ce,D[0].x-B,D[1].x+B,0),!Ce.length)return $;const ke=[];for(ve.length?ke.push({polygons:Ce,bounds:D,depth:0}):J(Ce,D);ke.length;){const Pe=ke.pop(),Xe=Pe.depth,qe=ve[Xe],vt=Pe.bounds[0],Nt=Pe.bounds[1],it=0===qe?vt.x:vt.y,bt=0===qe?Nt.x:Nt.y,Tt=V?V(qe,it,bt):.5*(it+bt),Ot=Wl(Pe.polygons,it-B,Tt+B,qe),Ut=Wl(Pe.polygons,Tt-B,bt+B,qe);if(Ot.length){const lt=[vt,new st(0===qe?Tt:Nt.x,1===qe?Tt:Nt.y)];ve.length>Xe+1?ke.push({polygons:Ot,bounds:lt,depth:Xe+1}):J(Ot,lt)}if(Ut.length){const lt=[new st(0===qe?Tt:vt.x,1===qe?Tt:vt.y),Nt];ve.length>Xe+1?ke.push({polygons:Ut,bounds:lt,depth:Xe+1}):J(Ut,lt)}}return $}(t,e,Math.ceil((g-h)/11.25),Math.ceil((_-w)/11.25),1,(T,D,P)=>{if(0===T)return.5*(D+P);{const O=Fs((n.y+D/er)/s);return(Sl(.5*(Fs((n.y+P/er)/s)+O))*s-n.y)*er}})}fn(Pd,"FillExtrusionBucket",{omit:["layers","features"]}),fn(T_,"PartMetadata");const Rd=new zt({"fill-extrusion-edge-radius":new Ge(ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var M_={paint:new zt({"fill-extrusion-opacity":new Ge(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tt(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ge(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ge(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new tt(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new tt(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tt(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ge(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ge(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ge(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Rd};function Zf(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class kd{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Uh(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=(_=this.y,w=this.z,T=Zf(256*(g=this.x),256*(_=Math.pow(2,w)-_-1),w),D=Zf(256*(g+1),256*(_+1),w),T[0]+","+T[1]+","+D[0]+","+D[1]),h=function(g,_,w){let T,D="";for(let P=g;P>0;P--)T=1<<P-1,D+=(_&T?1:0)+(w&T?2:0);return D}(this.z,this.x,this.y);var g,_,w,T,D;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hm{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Uh(e,n.z,n.z,n.x,n.y)}}class ra{constructor(e,n,s,h,g){this.overscaledZ=e,this.wrap=n,this.canonical=new kd(s,+h,+g),this.key=0===n&&e===s?this.canonical.key:Uh(n,e,s,h,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new ra(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ra(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Uh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Uh(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ra(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new ra(n,this.wrap,n,s,h),new ra(n,this.wrap,n,s+1,h),new ra(n,this.wrap,n,s,h+1),new ra(n,this.wrap,n,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ra(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ra(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Uh(t,e,n,s,h){const g=1<<Math.min(n,22);let _=g*(h%g)+s%g;return t&&n<22&&(_+=g*g*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*_+n)+(e-n)}fn(kd,"CanonicalTileID"),fn(ra,"OverscaledTileID",{omit:["projMatrix"]});class Zu extends st{constructor(e,n,s){super(e,n),this.z=s}}function Xu(t,e){return t.x*e.x+t.y*e.y}function Wm(t,e){if(1===t.length){let n=0;const s=e[n++];let h;for(;!h||s.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const g=e[n],_=t[0],w=h.sub(s),T=g.sub(s),D=_.sub(s),P=Xu(w,w),O=Xu(w,T),B=Xu(T,T),V=Xu(D,w),$=Xu(D,T),J=P*B-O*O,ue=(B*V-O*$)/J,xe=(P*$-O*V)/J,Me=s.z*(1-ue-xe)+h.z*ue+g.z*xe;if(isFinite(Me))return Me}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function Xf(t,e,n,s,h,g,_,w){const T=_*h.getElevationAt(t,e,!0,!0),D=0!==g[0],P=D?0===g[1]?_*(g[0]/7-450):_*function(O,B,V){const $=Math.floor(B[0]/8),J=Math.floor(B[1]/8),ue=10*(B[0]-8*$),xe=10*(B[1]-8*J),Me=O.getElevationAt($,J,!0,!0),ve=O.getMeterToDEM(V),Ce=Math.floor(.5*(ue*ve-1)),ke=Math.floor(.5*(xe*ve-1)),Pe=O.tileCoordToPixel($,J),Xe=2*Ce+1,qe=2*ke+1,vt=(Un=Xe,cn=qe,[(Ut=O).getElevationAtPixel(lt=Pe.x-Ce,tn=Pe.y-ke,!0),Ut.getElevationAtPixel(lt+cn,tn,!0),Ut.getElevationAtPixel(lt,tn+cn,!0),Ut.getElevationAtPixel(lt+Un,tn+cn,!0)]),Nt=Math.abs(vt[0]-vt[1]),it=Math.abs(vt[2]-vt[3]),bt=Math.abs(vt[0]-vt[2])+Math.abs(vt[1]-vt[3]),Tt=Math.min(.25,.5*ve*(Nt+it)/Xe),Ot=Math.min(.25,.5*ve*bt/qe);var Ut,lt,tn,Un,cn;return Me+Math.max(Tt*ue,Ot*xe)}(h,g,w):T;return{base:T+(0===n)?-1:n,top:D?Math.max(P+s,T+n+2):T+s}}const qm=kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Kf}=qm,By=kn([{name:"a_packed",components:4,type:"Float32"}]),{members:Yf}=By,I_=Bh.types,Ny=Math.cos(Math.PI/180*37.5);class vc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new pi,this.layoutVertexArray2=new Di,this.indexArray=new gs,this.programConfigurations=new hu(e.layers,e.zoom),this.segments=new mo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){this.hasPattern=Md("line",this.layers,n);const g=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:P,id:O,index:B,sourceLayerIndex:V}of e){const $=this.layers[0]._featureFilter.needGeometry,J=Wc(P,$);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),J,s))continue;const ue=g?g.evaluate(J,{},s):void 0,xe={id:O,properties:P.properties,type:P.type,sourceLayerIndex:V,index:B,geometry:$?J.geometry:Gl(P,s,h),patterns:{},sortKey:ue};_.push(xe)}g&&_.sort((P,O)=>P.sortKey-O.sortKey);const{lineAtlas:w,featureIndex:T}=n,D=this.addConstantDashes(w);for(const P of _){const{geometry:O,index:B,sourceLayerIndex:V}=P;if(D&&this.addFeatureDashes(P,w),this.hasPattern){const $=Vf("line",this.layers,P,this.zoom,n);this.patternFeatures.push($)}else this.addFeature(P,O,B,s,w.positions,n.availableImages);T.insert(e[B].feature,O,B,V,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,g=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==g.kind)n=!0;else{const _=g.value,w=h.value;if(!w)continue;e.addDash(w,_)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===_.kind)continue;let w,T;if("constant"===g.kind){if(w=g.value,!w)continue}else w=g.evaluate({zoom:s},e);T="constant"===_.kind?_.value:_.evaluate({zoom:s},e),n.addDash(w,T),e.patterns[h.id]=n.getKey(w,T)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,g){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Yf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,h,g,_){const w=this.layers[0].layout,T=w.get("line-join").evaluate(e,{}),D=w.get("line-cap").evaluate(e,{}),P=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of n)this.addLine(B,e,T,D,P,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,_,h)}addLine(e,n,s,h,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<e.length-1;xe++)this.totalDistance+=e[xe].dist(e[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===I_[n.type];let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let D=0;for(;D<T-1&&e[D].equals(e[D+1]);)D++;if(T<(w?3:2))return;"bevel"===s&&(g=1.05);const P=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let B,V,$,J,ue;this.e1=this.e2=-1,w&&(B=e[T-2],ue=e[D].sub(B)._unit()._perp());for(let xe=D;xe<T;xe++){if($=xe===T-1?w?e[D+1]:void 0:e[xe+1],$&&e[xe].equals($))continue;ue&&(J=ue),B&&(V=B),B=e[xe],ue=$?$.sub(B)._unit()._perp():J,J=J||ue;let Me=J.add(ue);0===Me.x&&0===Me.y||Me._unit();const ve=J.x*ue.x+J.y*ue.y,Ce=Me.x*ue.x+Me.y*ue.y,ke=0!==Ce?1/Ce:1/0,Pe=2*Math.sqrt(2-2*Ce),Xe=Ce<Ny&&V&&$,qe=J.x*ue.y-J.y*ue.x>0;if(Xe&&xe>D){const it=B.dist(V);if(it>2*P){const bt=B.sub(B.sub(V)._mult(P/it)._round());this.updateDistance(V,bt),this.addCurrentVertex(bt,J,0,0,O),V=bt}}const vt=V&&$;let Nt=vt?s:w?"butt":h;if(vt&&"round"===Nt&&(ke<_?Nt="miter":ke<=2&&(Nt="fakeround")),"miter"===Nt&&ke>g&&(Nt="bevel"),"bevel"===Nt&&(ke>2&&(Nt="flipbevel"),ke<g&&(Nt="miter")),V&&this.updateDistance(V,B),"miter"===Nt)Me._mult(ke),this.addCurrentVertex(B,Me,0,0,O);else if("flipbevel"===Nt){if(ke>100)Me=ue.mult(-1);else{const it=ke*J.add(ue).mag()/J.sub(ue).mag();Me._perp()._mult(it*(qe?-1:1))}this.addCurrentVertex(B,Me,0,0,O),this.addCurrentVertex(B,Me.mult(-1),0,0,O)}else if("bevel"===Nt||"fakeround"===Nt){const it=-Math.sqrt(ke*ke-1),bt=qe?it:0,Tt=qe?0:it;if(V&&this.addCurrentVertex(B,J,bt,Tt,O),"fakeround"===Nt){const Ot=Math.round(180*Pe/Math.PI/20);for(let Ut=1;Ut<Ot;Ut++){let lt=Ut/Ot;if(.5!==lt){const Un=lt-.5;lt+=lt*Un*(lt-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*Un*Un+(.848013+ve*(.215638*ve-1.06021)))}const tn=ue.sub(J)._mult(lt)._add(J)._unit()._mult(qe?-1:1);this.addHalfVertex(B,tn.x,tn.y,!1,qe,0,O)}}$&&this.addCurrentVertex(B,ue,-bt,-Tt,O)}else if("butt"===Nt)this.addCurrentVertex(B,Me,0,0,O);else if("square"===Nt){const it=V?1:-1;V||this.addCurrentVertex(B,Me,it,it,O),this.addCurrentVertex(B,Me,0,0,O),V&&this.addCurrentVertex(B,Me,it,it,O)}else"round"===Nt&&(V&&(this.addCurrentVertex(B,J,0,0,O),this.addCurrentVertex(B,J,1,1,O,!0)),$&&(this.addCurrentVertex(B,ue,-1,-1,O,!0),this.addCurrentVertex(B,ue,0,0,O)));if(Xe&&xe<T-1){const it=B.dist($);if(it>2*P){const bt=B.add($.sub(B)._mult(P/it)._round());this.updateDistance(B,bt),this.addCurrentVertex(bt,ue,0,0,O),B=bt}}}}addCurrentVertex(e,n,s,h,g,_=!1){const w=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,_,!1,s,g),this.addHalfVertex(e,w,T,_,!0,-h,g)}addHalfVertex({x:e,y:n},s,h,g,_,w,T){this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),T.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}fn(vc,"LineBucket",{omit:["layers","patternFeatures"]});const Zm=new zt({"line-cap":new tt(ht.layout_line["line-cap"]),"line-join":new tt(ht.layout_line["line-join"]),"line-miter-limit":new Ge(ht.layout_line["line-miter-limit"]),"line-round-limit":new Ge(ht.layout_line["line-round-limit"]),"line-sort-key":new tt(ht.layout_line["line-sort-key"])});var Xm={paint:new zt({"line-opacity":new tt(ht.paint_line["line-opacity"]),"line-color":new tt(ht.paint_line["line-color"]),"line-translate":new Ge(ht.paint_line["line-translate"]),"line-translate-anchor":new Ge(ht.paint_line["line-translate-anchor"]),"line-width":new tt(ht.paint_line["line-width"]),"line-gap-width":new tt(ht.paint_line["line-gap-width"]),"line-offset":new tt(ht.paint_line["line-offset"]),"line-blur":new tt(ht.paint_line["line-blur"]),"line-dasharray":new tt(ht.paint_line["line-dasharray"]),"line-pattern":new tt(ht.paint_line["line-pattern"]),"line-gradient":new It(ht.paint_line["line-gradient"]),"line-trim-offset":new Ge(ht.paint_line["line-trim-offset"])}),layout:Zm};const Jf=new class extends tt{possiblyEvaluate(t,e){return e=new He(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=rt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(Xm.paint.properties["line-width"].specification);function Km(t,e){return e>0?e+2*t:t}Jf.useIntegerZoom=!0;const A_=kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ld=kn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ku=kn([{name:"a_projected_pos",components:4,type:"Float32"}],4);kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Qf=kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jh=kn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);kn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Od=kn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Fd=kn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);kn([{name:"triangle",components:3,type:"Uint16"}]),kn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),kn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),kn([{type:"Float32",name:"offsetX"}]),kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var vs=24;const ll=128;function Vh(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new He(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=n;let g=0;for(;g<s.length&&s[g]<=t;)g++;g=Math.max(0,g-1);let _=g;for(;_<s.length&&s[_]<t+1;)_++;_=Math.min(s.length-1,_);const w=s[g],T=s[_];return"composite"===n.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:T,minSize:n.evaluate(new He(w)),maxSize:n.evaluate(new He(T)),interpolationType:h}}}function Yu(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:h}){return"source"===t.kind?s/ll:"composite"===t.kind?Qn(s/ll,h/ll,n):e}function wu(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:h,minZoom:g,maxZoom:_}=t,w=h?Bt(ar.interpolationFactor(h,e,g,_),0,1):0;"camera"===t.kind?s=Qn(t.minSize,t.maxSize,w):n=w}return{uSizeT:n,uSize:s}}var ep=Object.freeze({__proto__:null,getSizeData:Vh,evaluateSizeForFeature:Yu,evaluateSizeForZoom:wu,SIZE_PACK_FACTOR:ll});function P_(t,e,n){return t.sections.forEach(s=>{s.text=function(h,g,_){const w=g.layout.get("text-transform").evaluate(_,{});return"uppercase"===w?h=h.toLocaleUpperCase():"lowercase"===w&&(h=h.toLocaleLowerCase()),Be.applyArabicShaping&&(h=Be.applyArabicShaping(h)),h}(s.text,e,n)}),t}const $h={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Ym(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function R_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Ju=Si,tp=function(t,e,n,s,h){var g,_,w=8*h-s-1,T=(1<<w)-1,D=T>>1,P=-7,O=n?h-1:0,B=n?-1:1,V=t[e+O];for(O+=B,g=V&(1<<-P)-1,V>>=-P,P+=w;P>0;g=256*g+t[e+O],O+=B,P-=8);for(_=g&(1<<-P)-1,g>>=-P,P+=s;P>0;_=256*_+t[e+O],O+=B,P-=8);if(0===g)g=1-D;else{if(g===T)return _?NaN:1/0*(V?-1:1);_+=Math.pow(2,s),g-=D}return(V?-1:1)*_*Math.pow(2,g-s)},Jm=function(t,e,n,s,h,g){var _,w,T,D=8*g-h-1,P=(1<<D)-1,O=P>>1,B=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,V=s?0:g-1,$=s?1:-1,J=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,_=P):(_=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-_))<1&&(_--,T*=2),(e+=_+O>=1?B/T:B*Math.pow(2,1-O))*T>=2&&(_++,T/=2),_+O>=P?(w=0,_=P):_+O>=1?(w=(e*T-1)*Math.pow(2,h),_+=O):(w=e*Math.pow(2,O-1)*Math.pow(2,h),_=0));h>=8;t[n+V]=255&w,V+=$,w/=256,h-=8);for(_=_<<h|w,D+=h;D>0;t[n+V]=255&_,V+=$,_/=256,D-=8);t[n+V-$]|=128*J};function Si(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Si.Varint=0,Si.Fixed64=1,Si.Bytes=2,Si.Fixed32=5;var ya=4294967296,np=1/ya,Qm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Xc(t){return t.type===Si.Bytes?t.readVarint()+t.pos:t.pos+1}function rp(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var h=n.pos-1;h>=t;h--)n.buf[h+s]=n.buf[h]}function k_(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function L_(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function O_(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function eg(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function F_(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function z_(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function ip(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function B_(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function N_(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function zd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Qu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function tg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function ql(t,e,n){e.glyphs=[],1===t&&n.readMessage(op,e)}function op(t,e,n){if(3===t){const{id:s,bitmap:h,width:g,height:_,left:w,top:T,advance:D}=n.readMessage(U_,{});e.glyphs.push({id:s,bitmap:new _c({width:g+6,height:_+6},h),metrics:{width:g,height:_,left:w,top:T,advance:D}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function U_(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function sp(t){let e=0,n=0;for(const _ of t)e+=_.w*_.h,n=Math.max(n,_.w);t.sort((_,w)=>w.h-_.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,g=0;for(const _ of t)for(let w=s.length-1;w>=0;w--){const T=s[w];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===T.w&&_.h===T.h){const D=s.pop();w<s.length&&(s[w]=D)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(s.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:h,h:g,fill:e/(h*g)||0}}Si.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),h=s>>3,g=this.pos;this.type=7&s,t(h,e,this),this.pos===g&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=zd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=tg(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=zd(this.buf,this.pos)+zd(this.buf,this.pos+4)*ya;return this.pos+=8,t},readSFixed64:function(){var t=zd(this.buf,this.pos)+tg(this.buf,this.pos+4)*ya;return this.pos+=8,t},readFloat:function(){var t=tp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=tp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(h,g,_){var w,T,D=_.buf;if(w=(112&(T=D[_.pos++]))>>4,T<128||(w|=(127&(T=D[_.pos++]))<<3,T<128)||(w|=(127&(T=D[_.pos++]))<<10,T<128)||(w|=(127&(T=D[_.pos++]))<<17,T<128)||(w|=(127&(T=D[_.pos++]))<<24,T<128)||(w|=(1&(T=D[_.pos++]))<<31,T<128))return function Kc(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(h,w,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Qm?Qm.decode(this.buf.subarray(e,t)):function(n,s,h){for(var g="",_=s;_<h;){var w,T,D,P=n[_],O=null,B=P>239?4:P>223?3:P>191?2:1;if(_+B>h)break;1===B?P<128&&(O=P):2===B?128==(192&(w=n[_+1]))&&(O=(31&P)<<6|63&w)<=127&&(O=null):3===B?(T=n[_+2],128==(192&(w=n[_+1]))&&128==(192&T)&&((O=(15&P)<<12|(63&w)<<6|63&T)<=2047||O>=55296&&O<=57343)&&(O=null)):4===B&&(T=n[_+2],D=n[_+3],128==(192&(w=n[_+1]))&&128==(192&T)&&128==(192&D)&&((O=(15&P)<<18|(63&w)<<12|(63&T)<<6|63&D)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,B=1):O>65535&&(O-=65536,g+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),g+=String.fromCharCode(O),_+=B}return g}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Si.Bytes)return t.push(this.readVarint(e));var n=Xc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Si.Bytes)return t.push(this.readSVarint());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Si.Bytes)return t.push(this.readBoolean());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Si.Bytes)return t.push(this.readFloat());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Si.Bytes)return t.push(this.readDouble());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Si.Bytes)return t.push(this.readFixed32());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Si.Bytes)return t.push(this.readSFixed32());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Si.Bytes)return t.push(this.readFixed64());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Si.Bytes)return t.push(this.readSFixed64());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Si.Varint)for(;this.buf[this.pos++]>127;);else if(e===Si.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Si.Fixed32)this.pos+=4;else{if(e!==Si.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Qu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Qu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Qu(this.buf,-1&t,this.pos),Qu(this.buf,Math.floor(t*np),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Qu(this.buf,-1&t,this.pos),Qu(this.buf,Math.floor(t*np),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,h,g,w;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),g=s,(w=n).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,_){var w=(7&g)<<4;_.buf[_.pos++]|=w|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(h,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,h,g){for(var _,w,T=0;T<h.length;T++){if((_=h.charCodeAt(T))>55295&&_<57344){if(!w){_>56319||T+1===h.length?(s[g++]=239,s[g++]=191,s[g++]=189):w=_;continue}if(_<56320){s[g++]=239,s[g++]=191,s[g++]=189,w=_;continue}_=w-55296<<10|_-56320|65536,w=null}else w&&(s[g++]=239,s[g++]=191,s[g++]=189,w=null);_<128?s[g++]=_:(_<2048?s[g++]=_>>6|192:(_<65536?s[g++]=_>>12|224:(s[g++]=_>>18|240,s[g++]=_>>12&63|128),s[g++]=_>>6&63|128),s[g++]=63&_|128)}return g}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&rp(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Jm(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Jm(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&rp(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,Si.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,k_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,L_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,F_,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,O_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,eg,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,z_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ip,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,B_,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,N_,e)},writeBytesField:function(t,e){this.writeTag(t,Si.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Si.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Si.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Si.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Si.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Si.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Si.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Si.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Si.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Si.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Bd{constructor(e,{pixelRatio:n,version:s,stretchX:h,stretchY:g,content:_}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=_,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ng{constructor(e,n){const s={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,s,g),this.addImages(n,h,g);const{w:_,h:w}=sp(g),T=new zs({width:_||1,height:w||1});for(const D in e){const P=e[D],O=s[D].paddedRect;zs.copy(P.data,T,{x:0,y:0},{x:O.x+1,y:O.y+1},P.data)}for(const D in n){const P=n[D],O=h[D].paddedRect,B=O.x+1,V=O.y+1,$=P.data.width,J=P.data.height;zs.copy(P.data,T,{x:0,y:0},{x:B,y:V},P.data),zs.copy(P.data,T,{x:0,y:J-1},{x:B,y:V-1},{width:$,height:1}),zs.copy(P.data,T,{x:0,y:0},{x:B,y:V+J},{width:$,height:1}),zs.copy(P.data,T,{x:$-1,y:0},{x:B-1,y:V},{width:1,height:J}),zs.copy(P.data,T,{x:0,y:0},{x:B+$,y:V},{width:1,height:J})}this.image=T,this.iconPositions=s,this.patternPositions=h}addImages(e,n,s){for(const h in e){const g=e[h],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};s.push(_),n[h]=new Bd(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,g]=e.tl;s.update(n.data,void 0,{x:h,y:g})}}fn(Bd,"ImagePosition"),fn(ng,"ImageAtlas");const Xa={horizontal:1,vertical:2,horizontalOnly:3};class Gh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Gh;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Gh;return n.imageName=e,n}}class Yc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new Yc;for(let h=0;h<e.sections.length;h++){const g=e.sections[h];g.image?s.addImageSection(g):s.addTextSection(g,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let h="";for(let g=0;g<n.length;g++){const _=n.charCodeAt(g+1)||null,w=n.charCodeAt(g-1)||null;h+=!s&&(_&&E(_)&&!$h[n[g+1]]||w&&E(w)&&!$h[n[g-1]])||!$h[n[g]]?n[g]:$h[n[g]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Nd[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Nd[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new Yc;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Gh.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void ir("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Gh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):ir("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ap(t,e,n,s,h,g,_,w,T,D,P,O,B,V,$){const J=Yc.fromFeature(t,h);O===Xa.vertical&&J.verticalizePunctuation(B);let ue=[];const xe=function(Pe,Xe,qe,vt,Nt,it){if(!Pe)return[];const bt=[],Tt=function(tn,Un,cn,Cn,rn,qn){let Ir=0;for(let Dr=0;Dr<tn.length();Dr++){const Tr=tn.getSection(Dr);Ir+=jd(tn.getCharCode(Dr),Tr,Cn,rn,Un,qn)}return Ir/Math.max(1,Math.ceil(Ir/cn))}(Pe,Xe,qe,vt,Nt,it),Ot=Pe.text.indexOf("\u200b")>=0;let Ut=0;for(let tn=0;tn<Pe.length();tn++){const Un=Pe.getSection(tn),cn=Pe.getCharCode(tn);if(Nd[cn]||(Ut+=jd(cn,Un,vt,Nt,Xe,it)),tn<Pe.length()-1){const Cn=!((lt=cn)<11904||!(sc(lt)||Ou(lt)||p(lt)||lc(lt)||ac(lt)||ou(lt)||sd(lt)||Oc(lt)||Ul(lt)||su(lt)||Eo(lt)||a(lt)||Fc(lt)||Lu(lt)||ku(lt)||Nl(lt)||oc(lt)||cc(lt)||il(lt)||Ws(lt)));(Ud[cn]||Cn||Un.imageName)&&bt.push(Vd(tn+1,Ut,Tt,bt,Uy(cn,Pe.getCharCode(tn+1),Cn&&Ot),!1))}}var lt;return j_(Vd(Pe.length(),Ut,Tt,bt,0,!0))}(J,D,g,e,s,V),{processBidirectionalText:Me,processStyledBidirectionalText:ve}=Be;if(Me&&1===J.sections.length){const Pe=Me(J.toString(),xe);for(const Xe of Pe){const qe=new Yc;qe.text=Xe,qe.sections=J.sections;for(let vt=0;vt<Xe.length;vt++)qe.sectionIndex.push(0);ue.push(qe)}}else if(ve){const Pe=ve(J.text,J.sectionIndex,xe);for(const Xe of Pe){const qe=new Yc;qe.text=Xe[0],qe.sectionIndex=Xe[1],qe.sections=J.sections,ue.push(qe)}}else ue=function(Pe,Xe){const qe=[],vt=Pe.text;let Nt=0;for(const it of Xe)qe.push(Pe.substring(Nt,it)),Nt=it;return Nt<vt.length&&qe.push(Pe.substring(Nt,vt.length)),qe}(J,xe);const Ce=[],ke={positionedLines:Ce,text:J.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,Xe,qe,vt,Nt,it,bt,Tt,Ot,Ut,lt,tn){let Un=0,cn=0,Cn=0;const rn="right"===Tt?1:"left"===Tt?0:.5;let qn=!1;for(const lr of Nt){const Rr=lr.getSections();for(const mi of Rr){if(mi.imageName)continue;const Li=Xe[mi.fontStack];if(Li&&(qn=void 0!==Li.ascender&&void 0!==Li.descender,!qn))break}if(!qn)break}let Ir=0;for(const lr of Nt){lr.trim();const Rr=lr.getMaxScale(),mi=(Rr-1)*vs,Li={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[Ir]=Li;const Mi=Li.positionedGlyphs;let Oi=0;if(!lr.length()){cn+=it,++Ir;continue}let ji=0,uo=0;for(let ci=0;ci<lr.length();ci++){const Fo=lr.getSection(ci),Do=lr.getSectionIndex(ci),$r=lr.getCharCode(ci);let Xi=Fo.scale,Xo=null,gi=null,_o=null,Bs=vs,rs=0;const is=!(Ot===Xa.horizontal||!lt&&!x($r)||lt&&(Nd[$r]||(Dr=$r,ru(Dr)||iu(Dr)||di(Dr)||ol(Dr)||c(Dr))));if(Fo.imageName){const Xs=vt[Fo.imageName];if(!Xs)continue;_o=Fo.imageName,Pe.iconsInText=Pe.iconsInText||!0,gi=Xs.paddedRect;const os=Xs.displaySize;Xi=Xi*vs/tn,Xo={width:os[0],height:os[1],left:1,top:-3,advance:is?os[1]:os[0],localGlyph:!1},rs=qn?-Xo.height*Xi:Rr*vs-17-os[1]*Xi,Bs=Xo.advance;const Yl=(is?os[0]:os[1])*Xi-vs*Rr;Yl>0&&Yl>Oi&&(Oi=Yl)}else{const Xs=qe[Fo.fontStack];if(!Xs)continue;Xs[$r]&&(gi=Xs[$r]);const os=Xe[Fo.fontStack];if(!os)continue;const Yl=os.glyphs[$r];if(!Yl)continue;if(Xo=Yl.metrics,Bs=8203!==$r?vs:0,qn){const Iu=void 0!==os.ascender?Math.abs(os.ascender):0,lh=void 0!==os.descender?Math.abs(os.descender):0,ch=(Iu+lh)*Xi;ji<ch&&(ji=ch,uo=(Iu-lh)/2*Xi),rs=-Iu*Xi}else rs=(Rr-Xi)*vs-17}is?(Pe.verticalizable=!0,Mi.push({glyph:$r,imageName:_o,x:Un,y:cn+rs,vertical:is,scale:Xi,localGlyph:Xo.localGlyph,fontStack:Fo.fontStack,sectionIndex:Do,metrics:Xo,rect:gi}),Un+=Bs*Xi+Ut):(Mi.push({glyph:$r,imageName:_o,x:Un,y:cn+rs,vertical:is,scale:Xi,localGlyph:Xo.localGlyph,fontStack:Fo.fontStack,sectionIndex:Do,metrics:Xo,rect:gi}),Un+=Xo.advance*Xi+Ut)}0!==Mi.length&&(Cn=Math.max(Un-Ut,Cn),qn?lp(Mi,rn,Oi,uo,it*Rr/2):lp(Mi,rn,Oi,0,it/2)),Un=0;const ws=it*Rr+Oi;Li.lineOffset=Math.max(Oi,mi),cn+=ws,++Ir}var Dr;const Tr=cn,{horizontalAlign:Kn,verticalAlign:li}=$d(bt);(function(lr,Rr,mi,Li,Mi,Oi){const ji=(Rr-mi)*Mi,uo=-Oi*Li;for(const ws of lr)for(const ci of ws.positionedGlyphs)ci.x+=ji,ci.y+=uo})(Pe.positionedLines,rn,Kn,li,Cn,Tr),Pe.top+=-li*Tr,Pe.bottom=Pe.top+Tr,Pe.left+=-Kn*Cn,Pe.right=Pe.left+Cn,Pe.hasBaseline=qn}(ke,e,n,s,ue,_,w,T,O,D,B,$),!function(Pe){for(const Xe of Pe)if(0!==Xe.positionedGlyphs.length)return!1;return!0}(Ce)&&ke}const Nd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ud={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jd(t,e,n,s,h,g){if(e.imageName){const _=s[e.imageName];return _?_.displaySize[0]*e.scale*vs/g+h:0}{const _=n[e.fontStack],w=_&&_.glyphs[t];return w?w.metrics.advance*e.scale+h:0}}function Hh(t,e,n,s){const h=Math.pow(t-e,2);return s?t<e?h/2:2*h:h+Math.abs(n)*n}function Uy(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function Vd(t,e,n,s,h,g){let _=null,w=Hh(e,n,h,g);for(const T of s){const D=Hh(e-T.x,n,h,g)+T.badness;D<=w&&(_=T,w=D)}return{index:t,x:e,priorBreak:_,badness:w}}function j_(t){return t?j_(t.priorBreak).concat(t.index):[]}function $d(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function lp(t,e,n,s,h){if(!(e||n||s||h))return;const g=t.length-1,_=t[g],w=(_.x+_.metrics.advance*_.scale)*e;for(let T=0;T<=g;T++)t[T].x-=w,t[T].y+=n+s+h}function rg(t,e,n){const{horizontalAlign:s,verticalAlign:h}=$d(n),g=e[0]-t.displaySize[0]*s,_=e[1]-t.displaySize[1]*h;return{image:t,top:_,bottom:_+t.displaySize[1],left:g,right:g+t.displaySize[0]}}function cp(t,e,n,s,h,g){const _=t.image;let w;if(_.content){const ue=_.content,xe=_.pixelRatio||1;w=[ue[0]/xe,ue[1]/xe,_.displaySize[0]-ue[2]/xe,_.displaySize[1]-ue[3]/xe]}const T=e.left*g,D=e.right*g;let P,O,B,V;"width"===n||"both"===n?(V=h[0]+T-s[3],O=h[0]+D+s[1]):(V=h[0]+(T+D-_.displaySize[0])/2,O=V+_.displaySize[0]);const $=e.top*g,J=e.bottom*g;return"height"===n||"both"===n?(P=h[1]+$-s[0],B=h[1]+J+s[2]):(P=h[1]+($+J-_.displaySize[1])/2,B=P+_.displaySize[1]),{image:_,top:P,right:O,bottom:B,left:V,collisionPadding:w}}class Il extends st{constructor(e,n,s,h,g){super(e,n),this.angle=h,this.z=s,void 0!==g&&(this.segment=g)}clone(){return new Il(this.x,this.y,this.z,this.angle,this.segment)}}function Zl(t,e,n,s,h){if(void 0===e.segment)return!0;let g=e,_=e.segment+1,w=0;for(;w>-n/2;){if(_--,_<0)return!1;w-=t[_].dist(g),g=t[_]}w+=t[_].dist(t[_+1]),_++;const T=[];let D=0;for(;w<n/2;){const P=t[_],O=t[_+1];if(!O)return!1;let B=t[_-1].angleTo(P)-P.angleTo(O);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:B}),D+=B;w-T[0].distance>s;)D-=T.shift().angleDelta;if(D>h)return!1;_++,w+=P.dist(O)}return!0}function Wh(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function qh(t,e,n){return t?.6*e*n:0}function eh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function V_(t,e,n,s,h,g){const _=qh(n,h,g),w=eh(n,s)*g;let T=0;const D=Wh(t)/2;for(let P=0;P<t.length-1;P++){const O=t[P],B=t[P+1],V=O.dist(B);if(T+V>D){const $=(D-T)/V,J=Qn(O.x,B.x,$),ue=Qn(O.y,B.y,$),xe=new Il(J,ue,0,B.angleTo(O),P);return!_||Zl(t,xe,w,_,e)?xe:void 0}T+=V}}function ig(t,e,n,s,h,g,_,w,T){const D=qh(s,g,_),P=eh(s,h),O=P*_,B=0===t[0].x||t[0].x===T||0===t[0].y||t[0].y===T;return e-O<e/4&&(e=O+e/4),up(t,B?e/2*w%e:(P/2+2*g)*_*w%e,e,D,n,O,B,!1,T)}function up(t,e,n,s,h,g,_,w,T){const D=g/2,P=Wh(t);let O=0,B=e-n,V=[];for(let $=0;$<t.length-1;$++){const J=t[$],ue=t[$+1],xe=J.dist(ue),Me=ue.angleTo(J);for(;B+n<O+xe;){B+=n;const ve=(B-O)/xe,Ce=Qn(J.x,ue.x,ve),ke=Qn(J.y,ue.y,ve);if(Ce>=0&&Ce<T&&ke>=0&&ke<T&&B-D>=0&&B+D<=P){const Pe=new Il(Ce,ke,0,Me,$);Pe._round(),s&&!Zl(t,Pe,g,s,h)||V.push(Pe)}}O+=xe}return w||V.length||_||(V=up(t,O/2,n,s,h,g,_,!0,T)),V}function og(t,e,n,s,h){const g=[];for(let _=0;_<t.length;_++){const w=t[_];let T;for(let D=0;D<w.length-1;D++){let P=w[D],O=w[D+1];P.x<e&&O.x<e||(P.x<e?P=new st(e,P.y+(e-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x<e&&(O=new st(e,P.y+(e-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y<n&&O.y<n||(P.y<n?P=new st(P.x+(n-P.y)/(O.y-P.y)*(O.x-P.x),n)._round():O.y<n&&(O=new st(P.x+(n-P.y)/(O.y-P.y)*(O.x-P.x),n)._round()),P.x>=s&&O.x>=s||(P.x>=s?P=new st(s,P.y+(s-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x>=s&&(O=new st(s,P.y+(s-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y>=h&&O.y>=h||(P.y>=h?P=new st(P.x+(h-P.y)/(O.y-P.y)*(O.x-P.x),h)._round():O.y>=h&&(O=new st(P.x+(h-P.y)/(O.y-P.y)*(O.x-P.x),h)._round()),T&&P.equals(T[T.length-1])||(T=[P],g.push(T)),T.push(O)))))}}return g}fn(Il,"Anchor");const Zh=1e20;function th(t,e,n,s,h,g,_,w,T){for(let D=e;D<e+s;D++)sg(t,n*g+D,g,h,_,w,T);for(let D=n;D<n+h;D++)sg(t,D*g+e,1,s,_,w,T)}function sg(t,e,n,s,h,g,_){g[0]=0,_[0]=-Zh,_[1]=Zh,h[0]=t[e];for(let w=1,T=0,D=0;w<s;w++){h[w]=t[e+w*n];const P=w*w;do{const O=g[T];D=(h[w]-h[O]+P-O*O)/(w-O)/2}while(D<=_[T]&&--T>-1);T++,g[T]=w,_[T]=D,_[T+1]=Zh}for(let w=0,T=0;w<s;w++){for(;_[T+1]<w;)T++;const D=g[T],P=w-D;t[e+w*n]=h[D]+P*P}}const ag={none:0,ideographs:1,all:2};class nh{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const h in e)for(const g of e[h])s.push({stack:h,id:g});Vt(s,({stack:h,id:g},_)=>{let w=this.entries[h];w||(w=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[g];if(void 0!==T)return void _(null,{stack:h,id:g,glyph:T});if(T=this._tinySDF(w,h,g),T)return w.glyphs[g]=T,void _(null,{stack:h,id:g,glyph:T});const D=Math.floor(g/256);if(256*D>65535)return void _(new Error("glyphs > 65535 not supported"));if(w.ranges[D])return void _(null,{stack:h,id:g,glyph:T});let P=w.requests[D];P||(P=w.requests[D]=[],nh.loadGlyphRange(h,D,this.url,this.requestManager,(O,B)=>{if(B){w.ascender=B.ascender,w.descender=B.descender;for(const V in B.glyphs)this._doesCharSupportLocalGlyph(+V)||(w.glyphs[+V]=B.glyphs[+V]);w.ranges[D]=!0}for(const V of P)V(O,B);delete w.requests[D]})),P.push((O,B)=>{O?_(O):B&&_(null,{stack:h,id:g,glyph:B.glyphs[g]||null})})},(h,g)=>{if(h)n(h);else if(g){const _={};for(const{stack:w,id:T,glyph:D}of g)void 0===_[w]&&(_[w]={}),void 0===_[w].glyphs&&(_[w].glyphs={}),_[w].glyphs[T]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},_[w].ascender=this.entries[w].ascender,_[w].descender=this.entries[w].descender;n(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ag.none&&(this.localGlyphMode===ag.all?!!this.localFontFamily:!!this.localFontFamily&&(su(e)||au(e)||Fc(e)||oc(e)||Oc(e)))}_tinySDF(e,n,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let g=e.tinySDF;if(!g){let J="400";/bold/i.test(n)?J="900":/medium/i.test(n)?J="500":/light/i.test(n)&&(J="200"),g=e.tinySDF=new nh.TinySDF({fontFamily:h,fontWeight:J,fontSize:48,buffer:6,radius:16}),g.fontWeight=J}if(this.localGlyphs[g.fontWeight][s])return this.localGlyphs[g.fontWeight][s];const _=String.fromCharCode(s),{data:w,width:T,height:D,glyphWidth:P,glyphHeight:O,glyphLeft:B,glyphTop:V,glyphAdvance:$}=g.draw(_);return this.localGlyphs[g.fontWeight][s]={id:s,bitmap:new _c({width:T,height:D},w),metrics:{width:P/2,height:O/2,left:B/2,top:V/2-27,advance:$/2,localGlyph:!0}}}}function lg(t,e,n,s){const h=[],g=t.image,_=g.pixelRatio,w=g.paddedRect.w-2,T=g.paddedRect.h-2,D=t.right-t.left,P=t.bottom-t.top,O=g.stretchX||[[0,w]],B=g.stretchY||[[0,T]],V=(it,bt)=>it+bt[1]-bt[0],$=O.reduce(V,0),J=B.reduce(V,0),ue=w-$,xe=T-J;let Me=0,ve=$,Ce=0,ke=J,Pe=0,Xe=ue,qe=0,vt=xe;if(g.content&&s){const it=g.content;Me=Gd(O,0,it[0]),Ce=Gd(B,0,it[1]),ve=Gd(O,it[0],it[2]),ke=Gd(B,it[1],it[3]),Pe=it[0]-Me,qe=it[1]-Ce,Xe=it[2]-it[0]-ve,vt=it[3]-it[1]-ke}const Nt=(it,bt,Tt,Ot)=>{const Ut=Hd(it.stretch-Me,ve,D,t.left),lt=Wd(it.fixed-Pe,Xe,it.stretch,$),tn=Hd(bt.stretch-Ce,ke,P,t.top),Un=Wd(bt.fixed-qe,vt,bt.stretch,J),cn=Hd(Tt.stretch-Me,ve,D,t.left),Cn=Wd(Tt.fixed-Pe,Xe,Tt.stretch,$),rn=Hd(Ot.stretch-Ce,ke,P,t.top),qn=Wd(Ot.fixed-qe,vt,Ot.stretch,J),Ir=new st(Ut,tn),Dr=new st(cn,tn),Tr=new st(cn,rn),Kn=new st(Ut,rn),li=new st(lt/_,Un/_),lr=new st(Cn/_,qn/_),Rr=e*Math.PI/180;if(Rr){const Mi=Math.sin(Rr),Oi=Math.cos(Rr),ji=[Oi,-Mi,Mi,Oi];Ir._matMult(ji),Dr._matMult(ji),Kn._matMult(ji),Tr._matMult(ji)}const mi=it.stretch+it.fixed,Li=bt.stretch+bt.fixed;return{tl:Ir,tr:Dr,bl:Kn,br:Tr,tex:{x:g.paddedRect.x+1+mi,y:g.paddedRect.y+1+Li,w:Tt.stretch+Tt.fixed-mi,h:Ot.stretch+Ot.fixed-Li},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:li,pixelOffsetBR:lr,minFontScaleX:Xe/_/D,minFontScaleY:vt/_/P,isSDF:n}};if(s&&(g.stretchX||g.stretchY)){const it=cg(O,ue,$),bt=cg(B,xe,J);for(let Tt=0;Tt<it.length-1;Tt++){const Ot=it[Tt],Ut=it[Tt+1];for(let lt=0;lt<bt.length-1;lt++)h.push(Nt(Ot,bt[lt],Ut,bt[lt+1]))}}else h.push(Nt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return h}function Gd(t,e,n){let s=0;for(const h of t)s+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return s}function cg(t,e,n){const s=[{fixed:-1,stretch:0}];for(const[h,g]of t){const _=s[s.length-1];s.push({fixed:h-_.stretch,stretch:_.stretch}),s.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return s.push({fixed:e+1,stretch:n}),s}function Hd(t,e,n,s){return t/e*n+s}function Wd(t,e,n,s){return t-e*n/s}function $_(t,e,n,s){const h=e+t.positionedLines[s].lineOffset;return 0===s?n+h/2:n+(h+(e+t.positionedLines[s-1].lineOffset))/2}nh.loadGlyphRange=function(t,e,n,s,h){const g=256*e,_=g+255,w=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${g}-${_}`),xn.Glyphs);Ai(w,(T,D)=>{if(T)h(T);else if(D){const P={},O=new Ju(D).readFields(ql,{});for(const B of O.glyphs)P[B.id]=B;h(null,{glyphs:P,ascender:O.ascender,descender:O.descender})}})},nh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const w=this.size=t+4*e,T=this._createCanvas(w),D=this.ctx=T.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${g} ${t}px ${h}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(t),_=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,_+Math.ceil(s)),D=w+2*this.buffer,P=T+2*this.buffer,O=Math.max(D*P,0),B=new Uint8ClampedArray(O),V={data:B,width:D,height:P,glyphWidth:w,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===w||0===T)return V;const{ctx:$,buffer:J,gridInner:ue,gridOuter:xe}=this;$.clearRect(J,J,w,T),$.fillText(t,J,J+_);const Me=$.getImageData(J,J,w,T);xe.fill(Zh,0,O),ue.fill(0,0,O);for(let ve=0;ve<T;ve++)for(let Ce=0;Ce<w;Ce++){const ke=Me.data[4*(ve*w+Ce)+3]/255;if(0===ke)continue;const Pe=(ve+J)*D+Ce+J;if(1===ke)xe[Pe]=0,ue[Pe]=Zh;else{const Xe=.5-ke;xe[Pe]=Xe>0?Xe*Xe:0,ue[Pe]=Xe<0?Xe*Xe:0}}th(xe,0,0,D,P,D,this.f,this.v,this.z),th(ue,J,J,w,T,D,this.f,this.v,this.z);for(let ve=0;ve<O;ve++){const Ce=Math.sqrt(xe[ve])-Math.sqrt(ue[ve]);B[ve]=Math.round(255-255*(Ce/this.radius+this.cutoff))}return V}};class ug{constructor(e=[],n=hp){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,h=n[e];for(;e>0;){const g=e-1>>1,_=n[g];if(s(h,_)>=0)break;n[e]=_,e=g}n[e]=h}_down(e){const{data:n,compare:s}=this,h=this.length>>1,g=n[e];for(;e<h;){let _=1+(e<<1),w=n[_];const T=_+1;if(T<this.length&&s(n[T],w)<0&&(_=T,w=n[T]),s(w,g)>=0)break;n[e]=w,e=_}n[e]=g}}function hp(t,e){return t<e?-1:t>e?1:0}function G_(t,e=1,n=!1){let s=1/0,h=1/0,g=-1/0,_=-1/0;const w=t[0];for(let V=0;V<w.length;V++){const $=w[V];(!V||$.x<s)&&(s=$.x),(!V||$.y<h)&&(h=$.y),(!V||$.x>g)&&(g=$.x),(!V||$.y>_)&&(_=$.y)}const T=Math.min(g-s,_-h);let D=T/2;const P=new ug([],dp);if(0===T)return new st(s,h);for(let V=s;V<g;V+=T)for(let $=h;$<_;$+=T)P.push(new rh(V+D,$+D,D,t));let O=function(V){let $=0,J=0,ue=0;const xe=V[0];for(let Me=0,ve=xe.length,Ce=ve-1;Me<ve;Ce=Me++){const ke=xe[Me],Pe=xe[Ce],Xe=ke.x*Pe.y-Pe.x*ke.y;J+=(ke.x+Pe.x)*Xe,ue+=(ke.y+Pe.y)*Xe,$+=3*Xe}return new rh(J/$,ue/$,0,V)}(t),B=P.length;for(;P.length;){const V=P.pop();(V.d>O.d||!O.d)&&(O=V,n&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,B)),V.max-O.d<=e||(D=V.h/2,P.push(new rh(V.p.x-D,V.p.y-D,D,t)),P.push(new rh(V.p.x+D,V.p.y-D,D,t)),P.push(new rh(V.p.x-D,V.p.y+D,D,t)),P.push(new rh(V.p.x+D,V.p.y+D,D,t)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${O.d}`)),O.p}function dp(t,e){return e.max-t.max}function rh(t,e,n,s){this.p=new st(t,e),this.h=n,this.d=function(h,g){let _=!1,w=1/0;for(let T=0;T<g.length;T++){const D=g[T];for(let P=0,O=D.length,B=O-1;P<O;B=P++){const V=D[P],$=D[B];V.y>h.y!=$.y>h.y&&h.x<($.x-V.x)*(h.y-V.y)/($.y-V.y)+V.x&&(_=!_),w=Math.min(w,Rh(h,V,$))}}return(_?1:-1)*Math.sqrt(w)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const fp=Number.POSITIVE_INFINITY,H_=Math.sqrt(2);function hg(t,[e,n]){let s=0,h=0;if(n===fp){e<0&&(e=0);const g=e/H_;switch(t){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(t){case"top-right":case"bottom-right":s=-g;break;case"top-left":case"bottom-left":s=g;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":h=n-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,h]}function W_(t,e,n,s,h,g,_,w,T,D){t.createArrays(),t.tilePixelRatio=er/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const P=t.layers[0].layout,O=t.layers[0]._unevaluatedLayout._values,B={};if("composite"===t.textSizeData.kind){const{minZoom:J,maxZoom:ue}=t.textSizeData;B.compositeTextSizes=[O["text-size"].possiblyEvaluate(new He(J),w),O["text-size"].possiblyEvaluate(new He(ue),w)]}if("composite"===t.iconSizeData.kind){const{minZoom:J,maxZoom:ue}=t.iconSizeData;B.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new He(J),w),O["icon-size"].possiblyEvaluate(new He(ue),w)]}B.layoutTextSize=O["text-size"].possiblyEvaluate(new He(T+1),w),B.layoutIconSize=O["icon-size"].possiblyEvaluate(new He(T+1),w),B.textMaxSize=O["text-size"].possiblyEvaluate(new He(18),w);const V="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),$=P.get("text-size");for(const J of t.features){const ue=P.get("text-font").evaluate(J,{},w).join(","),xe=$.evaluate(J,{},w),Me=B.layoutTextSize.evaluate(J,{},w),ve=(B.layoutIconSize.evaluate(J,{},w),{horizontal:{},vertical:void 0}),Ce=J.text;let ke,Pe=[0,0];if(Ce){const vt=Ce.toString(),Nt=P.get("text-letter-spacing").evaluate(J,{},w)*vs,it=P.get("text-line-height").evaluate(J,{},w)*vs,bt=d(vt)?Nt:0,Tt=P.get("text-anchor").evaluate(J,{},w),Ot=P.get("text-variable-anchor");if(!Ot){const cn=P.get("text-radial-offset").evaluate(J,{},w);Pe=cn?hg(Tt,[cn*vs,fp]):P.get("text-offset").evaluate(J,{},w).map(Cn=>Cn*vs)}let Ut=V?"center":P.get("text-justify").evaluate(J,{},w);const lt="point"===P.get("symbol-placement"),tn=lt?P.get("text-max-width").evaluate(J,{},w)*vs:1/0,Un=cn=>{t.allowVerticalPlacement&&f(vt)&&(ve.vertical=ap(Ce,e,n,h,ue,tn,it,Tt,cn,bt,Pe,Xa.vertical,!0,Me,xe))};if(!V&&Ot){const cn="auto"===Ut?Ot.map(rn=>pp(rn)):[Ut];let Cn=!1;for(let rn=0;rn<cn.length;rn++){const qn=cn[rn];if(!ve.horizontal[qn])if(Cn)ve.horizontal[qn]=ve.horizontal[0];else{const Ir=ap(Ce,e,n,h,ue,tn,it,"center",qn,bt,Pe,Xa.horizontal,!1,Me,xe);Ir&&(ve.horizontal[qn]=Ir,Cn=1===Ir.positionedLines.length)}}Un("left")}else{if("auto"===Ut&&(Ut=pp(Tt)),lt||P.get("text-writing-mode").indexOf("horizontal")>=0||!f(vt)){const cn=ap(Ce,e,n,h,ue,tn,it,Tt,Ut,bt,Pe,Xa.horizontal,!1,Me,xe);cn&&(ve.horizontal[Ut]=cn)}Un(lt?"left":Ut)}}let Xe=!1;if(J.icon&&J.icon.name){const vt=s[J.icon.name];vt&&(ke=rg(h[J.icon.name],P.get("icon-offset").evaluate(J,{},w),P.get("icon-anchor").evaluate(J,{},w)),Xe=vt.sdf,void 0===t.sdfIcons?t.sdfIcons=vt.sdf:t.sdfIcons!==vt.sdf&&ir("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(vt.pixelRatio!==t.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const qe=dg(ve.horizontal)||ve.vertical;t.iconsInText||(t.iconsInText=!!qe&&qe.iconsInText),(qe||ke)&&q_(t,J,ve,ke,s,B,Me,0,Pe,Xe,_,w,D)}g&&t.generateCollisionDebugBuffers(T,t.collisionBoxArray)}function pp(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function q_(t,e,n,s,h,g,_,w,T,D,P,O,B){let V=g.textMaxSize.evaluate(e,{},O);void 0===V&&(V=_);const $=t.layers[0].layout,J=$.get("icon-offset").evaluate(e,{},O),ue=dg(n.horizontal)||n.vertical,xe="globe"===B.name,Me=_/24,ve=t.tilePixelRatio*V/24,Ce=(bt=t.overscaling,t.zoom>18&&bt>2&&(bt>>=1),Math.max(er/(512*bt),1)*$.get("symbol-spacing")),ke=$.get("text-padding")*t.tilePixelRatio,Pe=$.get("icon-padding")*t.tilePixelRatio,Xe=Ne($.get("text-max-angle")),qe="map"===$.get("text-rotation-alignment")&&"point"!==$.get("symbol-placement"),vt="map"===$.get("icon-rotation-alignment")&&"point"!==$.get("symbol-placement"),Nt=$.get("symbol-placement"),it=Ce/2;var bt;const Tt=$.get("icon-text-fit");let Ot;s&&"none"!==Tt&&(t.allowVerticalPlacement&&n.vertical&&(Ot=cp(s,n.vertical,Tt,$.get("icon-text-fit-padding"),J,Me)),ue&&(s=cp(s,ue,Tt,$.get("icon-text-fit-padding"),J,Me)));const Ut=(lt,tn,Un)=>{if(tn.x<0||tn.x>=er||tn.y<0||tn.y>=er)return;let cn=null;if(xe){const{x:Cn,y:rn,z:qn}=B.projectTilePoint(tn.x,tn.y,Un);cn={anchor:new Il(Cn,rn,qn,0,void 0),up:B.upVector(Un,tn.x,tn.y)}}!function(Cn,rn,qn,Ir,Dr,Tr,Kn,li,lr,Rr,mi,Li,Mi,Oi,ji,uo,ws,ci,Fo,Do,$r,Xi,Xo,gi,_o){const Bs=Cn.addToLineVertexArray(rn,Ir);let rs,is,Xs,os,Yl,Iu,lh,ch=0,jp=0,Vp=0,Qc=0,$p=-1,Gp=-1;const va={};let ty=lu("");const Mc=qn?qn.anchor:rn;let Eg=0,rf=0;if(void 0===lr._unevaluatedLayout.getValue("text-radial-offset")?[Eg,rf]=lr.layout.get("text-offset").evaluate($r,{},_o).map(La=>La*vs):(Eg=lr.layout.get("text-radial-offset").evaluate($r,{},_o)*vs,rf=fp),Cn.allowVerticalPlacement&&Dr.vertical){const La=Dr.vertical;if(ji)Iu=qd(La),li&&(lh=qd(li));else{const Oa=lr.layout.get("text-rotate").evaluate($r,{},_o)+90;Xs=gp(Rr,Mc,rn,mi,Li,Mi,La,Oi,Oa,uo),li&&(os=gp(Rr,Mc,rn,mi,Li,Mi,li,ci,Oa))}}if(Tr){const La=lr.layout.get("icon-rotate").evaluate($r,{},_o),Oa="none"!==lr.layout.get("icon-text-fit"),id=lg(Tr,La,Xo,Oa),eu=li?lg(li,La,Xo,Oa):void 0;is=gp(Rr,Mc,rn,mi,Li,Mi,Tr,ci,La),ch=4*id.length;const Dg=Cn.iconSizeData;let Jl=null;"source"===Dg.kind?(Jl=[ll*lr.layout.get("icon-size").evaluate($r,{},_o)],Jl[0]>xc&&ir(`${Cn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Dg.kind&&(Jl=[ll*Xi.compositeIconSizes[0].evaluate($r,{},_o),ll*Xi.compositeIconSizes[1].evaluate($r,{},_o)],(Jl[0]>xc||Jl[1]>xc)&&ir(`${Cn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Cn.addSymbols(Cn.icon,id,Jl,Do,Fo,$r,!1,qn,rn,Bs.lineStartIndex,Bs.lineLength,-1,gi,_o),$p=Cn.icon.placedSymbolArray.length-1,eu&&(jp=4*eu.length,Cn.addSymbols(Cn.icon,eu,Jl,Do,Fo,$r,Xa.vertical,qn,rn,Bs.lineStartIndex,Bs.lineLength,-1,gi,_o),Gp=Cn.icon.placedSymbolArray.length-1)}for(const La in Dr.horizontal){const Oa=Dr.horizontal[La];rs||(ty=lu(Oa.text),ji?Yl=qd(Oa):rs=gp(Rr,Mc,rn,mi,Li,Mi,Oa,Oi,lr.layout.get("text-rotate").evaluate($r,{},_o),uo));const id=1===Oa.positionedLines.length;if(Vp+=mp(Cn,qn,rn,Oa,Kn,lr,ji,$r,uo,Bs,Dr.vertical?Xa.horizontal:Xa.horizontalOnly,id?Object.keys(Dr.horizontal):[La],va,$p,Xi,gi,_o),id)break}Dr.vertical&&(Qc+=mp(Cn,qn,rn,Dr.vertical,Kn,lr,ji,$r,uo,Bs,Xa.vertical,["vertical"],va,Gp,Xi,gi,_o));let Ic=-1;const Tg=(La,Oa)=>La?Math.max(La,Oa):Oa;Ic=Tg(Yl,Ic),Ic=Tg(Iu,Ic),Ic=Tg(lh,Ic);const dr=Ic>-1?1:0;Cn.glyphOffsetArray.length>=Jc.MAX_GLYPHS&&ir("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==$r.sortKey&&Cn.addToSortKeyRanges(Cn.symbolInstances.length,$r.sortKey),Cn.symbolInstances.emplaceBack(Mc.x,Mc.y,Mc.z,rn.x,rn.y,va.right>=0?va.right:-1,va.center>=0?va.center:-1,va.left>=0?va.left:-1,va.vertical>=0?va.vertical:-1,$p,Gp,ty,void 0!==rs?rs:Cn.collisionBoxArray.length,void 0!==rs?rs+1:Cn.collisionBoxArray.length,void 0!==Xs?Xs:Cn.collisionBoxArray.length,void 0!==Xs?Xs+1:Cn.collisionBoxArray.length,void 0!==is?is:Cn.collisionBoxArray.length,void 0!==is?is+1:Cn.collisionBoxArray.length,os||Cn.collisionBoxArray.length,os?os+1:Cn.collisionBoxArray.length,mi,Vp,Qc,ch,jp,dr,0,Eg,rf,Ic)}(t,tn,cn,lt,n,s,h,Ot,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ke,qe,T,0,Pe,vt,J,e,g,D,P,O)};if("line"===Nt)for(const lt of og(e.geometry,0,0,er,er)){const tn=ig(lt,Ce,Xe,n.vertical||ue,s,24,ve,t.overscaling,er);for(const Un of tn)ue&&jy(t,ue.text,it,Un)||Ut(lt,Un,O)}else if("line-center"===Nt){for(const lt of e.geometry)if(lt.length>1){const tn=V_(lt,Xe,n.vertical||ue,s,24,ve);tn&&Ut(lt,tn,O)}}else if("Polygon"===e.type)for(const lt of Za(e.geometry,0)){const tn=G_(lt,16);Ut(lt[0],new Il(tn.x,tn.y,0,0,void 0),O)}else if("LineString"===e.type)for(const lt of e.geometry)Ut(lt,new Il(lt[0].x,lt[0].y,0,0,void 0),O);else if("Point"===e.type)for(const lt of e.geometry)for(const tn of lt)Ut([tn],new Il(tn.x,tn.y,0,0,void 0),O)}const xc=32640;function mp(t,e,n,s,h,g,_,w,T,D,P,O,B,V,$,J,ue){const xe=function(Ce,ke,Pe,Xe,qe,vt,Nt,it){const bt=[];if(0===ke.positionedLines.length)return bt;const Tt=Xe.layout.get("text-rotate").evaluate(vt,{})*Math.PI/180,Ot=function(cn){const Cn=cn[0],rn=cn[1],qn=Cn*rn;return qn>0?[Cn,-rn]:qn<0?[-Cn,rn]:0===Cn?[rn,Cn]:[rn,-Cn]}(Pe);let Ut=Math.abs(ke.top-ke.bottom);for(const cn of ke.positionedLines)Ut-=cn.lineOffset;const lt=ke.positionedLines.length,tn=Ut/lt;let Un=ke.top-Pe[1];for(let cn=0;cn<lt;++cn){const Cn=ke.positionedLines[cn];Un=$_(ke,tn,Un,cn);for(const rn of Cn.positionedGlyphs){if(!rn.rect)continue;const qn=rn.rect||{};let Ir=4,Dr=!0,Tr=1,Kn=0;if(rn.imageName){const gi=Nt[rn.imageName];if(!gi)continue;if(gi.sdf){ir("SDF images are not supported in formatted text and will be ignored.");continue}Dr=!1,Tr=gi.pixelRatio,Ir=1/Tr}const li=(qe||it)&&rn.vertical,lr=rn.metrics.advance*rn.scale/2,Rr=rn.metrics,mi=rn.rect;if(null===mi)continue;it&&ke.verticalizable&&(Kn=rn.imageName?lr-rn.metrics.width*rn.scale/2:0);const Li=qe?[rn.x+lr,rn.y]:[0,0];let Mi=[0,0],Oi=[0,0],ji=!1;qe||(li?(Oi=[rn.x+lr+Ot[0],rn.y+Ot[1]-Kn],ji=!0):Mi=[rn.x+lr+Pe[0],rn.y+Pe[1]-Kn]);const uo=mi.w*rn.scale/(Tr*(rn.localGlyph?2:1)),ws=mi.h*rn.scale/(Tr*(rn.localGlyph?2:1));let ci,Fo,Do,$r;if(li){const gi=rn.y-Un,_o=new st(-lr,lr-gi),Bs=-Math.PI/2,rs=new st(...Oi);ci=new st(-lr+Mi[0],Mi[1]),ci._rotateAround(Bs,_o)._add(rs),ci.x+=-gi+lr,ci.y-=(Rr.left-Ir)*rn.scale;const is=rn.imageName?Rr.advance*rn.scale:vs*rn.scale,Xs=String.fromCharCode(rn.glyph);Ym(Xs)?ci.x+=(1-Ir)*rn.scale:R_(Xs)?ci.x+=is-Rr.height*rn.scale+(-Ir-1)*rn.scale:ci.x+=rn.imageName||Rr.width+2*Ir===mi.w&&Rr.height+2*Ir===mi.h?(is-ws)/2:(is-(Rr.height+2*Ir)*rn.scale)/2,Fo=new st(ci.x,ci.y-uo),Do=new st(ci.x+ws,ci.y),$r=new st(ci.x+ws,ci.y-uo)}else{const gi=(Rr.left-Ir)*rn.scale-lr+Mi[0],_o=(-Rr.top-Ir)*rn.scale+Mi[1],Bs=gi+uo,rs=_o+ws;ci=new st(gi,_o),Fo=new st(Bs,_o),Do=new st(gi,rs),$r=new st(Bs,rs)}if(Tt){let gi;gi=qe?new st(0,0):ji?new st(Ot[0],Ot[1]):new st(Pe[0],Pe[1]),ci._rotateAround(Tt,gi),Fo._rotateAround(Tt,gi),Do._rotateAround(Tt,gi),$r._rotateAround(Tt,gi)}const Xi=new st(0,0),Xo=new st(0,0);bt.push({tl:ci,tr:Fo,bl:Do,br:$r,tex:qn,writingMode:ke.writingMode,glyphOffset:Li,sectionIndex:rn.sectionIndex,isSDF:Dr,pixelOffsetTL:Xi,pixelOffsetBR:Xo,minFontScaleX:0,minFontScaleY:0})}}return bt}(0,s,T,g,_,w,h,t.allowVerticalPlacement),Me=t.textSizeData;let ve=null;"source"===Me.kind?(ve=[ll*g.layout.get("text-size").evaluate(w,{},ue)],ve[0]>xc&&ir(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Me.kind&&(ve=[ll*$.compositeTextSizes[0].evaluate(w,{},ue),ll*$.compositeTextSizes[1].evaluate(w,{},ue)],(ve[0]>xc||ve[1]>xc)&&ir(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,xe,ve,T,_,w,P,e,n,D.lineStartIndex,D.lineLength,V,J,ue);for(const Ce of O)B[Ce]=t.text.placedSymbolArray.length-1;return 4*xe.length}function dg(t){for(const e in t)return t[e];return null}function gp(t,e,n,s,h,g,_,w,T,D){let P=_.top,O=_.bottom,B=_.left,V=_.right;const $=_.collisionPadding;if($&&(B-=$[0],P-=$[1],V+=$[2],O+=$[3]),T){const J=new st(B,P),ue=new st(V,P),xe=new st(B,O),Me=new st(V,O),ve=Ne(T);let Ce=new st(0,0);D&&(Ce=new st(D[0],D[1])),J._rotateAround(ve,Ce),ue._rotateAround(ve,Ce),xe._rotateAround(ve,Ce),Me._rotateAround(ve,Ce),B=Math.min(J.x,ue.x,xe.x,Me.x),V=Math.max(J.x,ue.x,xe.x,Me.x),P=Math.min(J.y,ue.y,xe.y,Me.y),O=Math.max(J.y,ue.y,xe.y,Me.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,B,P,V,O,w,s,h,g),t.length-1}function qd(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function jy(t,e,n,s){const h=t.compareText;if(e in h){const g=h[e];for(let _=g.length-1;_>=0;_--)if(s.dist(g[_])<n)return!0}else h[e]=[];return h[e].push(s),!1}function Xh(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,h=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),g=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),_=Math.sin(t._pitch)*g+h;return Math.min(1.01*_,h*(1/t._horizonShift))}function bu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,h=(t.x+1)*n,g=t.y*n,_=(t.y+1)*n,w=qa(s),T=qa(h),D=Fs(g),P=Fs(_),O=e.project(w,D),B=e.project(T,D),V=e.project(T,P),$=e.project(w,P);let J=Math.min(O.x,B.x,V.x,$.x),ue=Math.min(O.y,B.y,V.y,$.y),xe=Math.max(O.x,B.x,V.x,$.x),Me=Math.max(O.y,B.y,V.y,$.y);const ve=n/16;function Ce(Pe,Xe,qe,vt,Nt,it){const bt=(qe+Nt)/2,Tt=(vt+it)/2,Ot=e.project(qa(bt),Fs(Tt)),Ut=Math.max(0,J-Ot.x,ue-Ot.y,Ot.x-xe,Ot.y-Me);J=Math.min(J,Ot.x),xe=Math.max(xe,Ot.x),ue=Math.min(ue,Ot.y),Me=Math.max(Me,Ot.y),Ut>ve&&(Ce(Pe,Ot,qe,vt,bt,Tt),Ce(Ot,Xe,bt,Tt,Nt,it))}Ce(O,B,s,g,h,g),Ce(B,V,h,g,h,_),Ce(V,$,h,_,s,_),Ce($,O,s,_,s,g),J-=ve,ue-=ve,xe+=ve,Me+=ve;const ke=1/Math.max(xe-J,Me-ue);return{scale:ke,x:J*ke,y:ue*ke,x2:xe*ke,y2:Me*ke,projection:e}}const Z_=Aa(new Float32Array(16));class Xl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Ur(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return Ml(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return Xh(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,h){const g=e.horizonLineFromTop(!1),_=new st(n,Math.max(g,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,h))}pointCoordinate3D(e,n,s){const h=new st(n,s);if(e.elevation)return e.elevation.pointCoordinate(h);{const g=this.pointCoordinate(e,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return Z_}createTileMatrix(e,n,s){let h,g,_;const w=s.canonical,T=Aa(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=bu(w,this);h=1,g=D.x+s.wrap*D.scale,_=D.y,$c(T,T,[h/D.scale,h/D.scale,e.pixelsPerMeter/n])}else h=n/e.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*s.wrap)*h,_=w.y*h;return Bu(T,T,[g,_,0]),$c(T,T,[h/er,h/er,1]),T}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class X_ extends Xl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Ne(n));this.n=(h+Math.sin(Ne(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:h,r0:g}=this,_=Ne(e-this.center[0]),w=Ne(n),T=Math.sqrt(h-2*s*Math.sin(w))/s;return{x:T*Math.sin(_*s),y:T*Math.cos(_*s)-g,z:0}}unproject(e,n){const{n:s,c:h,r0:g}=this,_=g+n;let w=Math.atan2(e,Math.abs(_))*Math.sign(_);_*s<0&&(w-=Math.PI*Math.sign(e)*Math.sign(_));const T=Ne(this.center[0])*s;w=rr(w,-Math.PI-T,Math.PI-T);const D=Bt(pt(w/s)+this.center[0],-180,180),P=Math.asin(Bt((h-(e*e+_*_)*s*s)/(2*s),-1,1)),O=Bt(pt(P),-ys,ys);return new Ur(D,O)}}const ka=1.340264,wc=-.081106,ns=893e-6,Al=.003796,Eu=Math.sqrt(3)/2;class cl extends Xl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Eu*Math.sin(n)),h=s*s,g=h*h*h;return{x:.5*(e*Math.cos(s)/(Eu*(ka+3*wc*h+g*(7*ns+9*Al*h)))/Math.PI+.5),y:1-.5*(s*(ka+wc*h+g*(ns+Al*h))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=s*s,g=h*h*h;for(let P,O,B,V=0;V<12&&(O=s*(ka+wc*h+g*(ns+Al*h))-n,B=ka+3*wc*h+g*(7*ns+9*Al*h),P=O/B,s=Bt(s-P,-Math.PI/3,Math.PI/3),h=s*s,g=h*h*h,!(Math.abs(P)<1e-12));++V);const _=Eu*e*(ka+3*wc*h+g*(7*ns+9*Al*h))/Math.cos(s),w=Math.asin(Math.sin(s)/Eu),T=Bt(180*_/Math.PI,-180,180),D=Bt(180*w/Math.PI,-ys,ys);return new Ur(T,D)}}class _p extends Xl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),h=Bt(360*(.5-n),-ys,ys);return new Ur(s,h)}}const Pl=Math.PI/2;function bc(t){return Math.tan((Pl+t)/2)}class ih extends Xl{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let h=Ne(n),g=Ne(s);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const _=Math.cos(h),w=bc(h);this.n=h===g?Math.sin(h):Math.log(_/Math.cos(g))/Math.log(bc(g)/w),this.f=_*Math.pow(bc(h),this.n)/this.n}project(e,n){n=Ne(n),this.southernCenter&&(n=-n),e=Ne(e-this.center[0]);const s=1e-6,{n:h,f:g}=this;g>0?n<-Pl+s&&(n=-Pl+s):n>Pl-s&&(n=Pl-s);const _=g/Math.pow(bc(n),h);let w=_*Math.sin(h*e),T=g-_*Math.cos(h*e);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:h}=this,g=h-n,_=Math.sign(g),w=Math.sign(s)*Math.sqrt(e*e+g*g);let T=Math.atan2(e,Math.abs(g))*_;g*s<0&&(T-=Math.PI*Math.sign(e)*_);const D=Bt(pt(T/s)+this.center[0],-180,180),P=Bt(pt(2*Math.atan(Math.pow(h/w,1/s))-Pl),-ys,ys);return new Ur(D,this.southernCenter?-P:P)}}class Tu extends Xl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Cl(e),y:Sl(n),z:0}}unproject(e,n){const s=qa(e),h=Fs(n);return new Ur(s,h)}}const Du=Ne(ys);class oh extends Xl{project(e,n){const s=(n=Ne(n))*n,h=s*s;return{x:.5*((e=Ne(e))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=25,g=0,_=s*s;do{_=s*s;const D=_*_;g=(s*(1.007226+_*(.015085+D*(.028874*_-.044475-.005916*D)))-n)/(1.007226+_*(.045255+D*(.259866*_-.311325-.005916*11*D))),s=Bt(s-g,-Du,Du)}while(Math.abs(g)>1e-6&&--h>0);_=s*s;const w=Bt(pt(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=pt(s);return new Ur(w,T)}}const Cu=Ne(ys);class sh extends Xl{project(e,n){n=Ne(n),e=Ne(e);const s=Math.cos(n),h=2/Math.PI,g=Math.acos(s*Math.cos(e/2)),_=Math.sin(g)/g,w=.5*(e*h+2*s*Math.sin(e/2)/_)||0,T=.5*(n+Math.sin(n)/_)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,h=n=(2*(1-n)-1)*Math.PI,g=25;const _=1e-6;let w=0,T=0;do{const D=Math.cos(h),P=Math.sin(h),O=2*P*D,B=P*P,V=D*D,$=Math.cos(s/2),J=Math.sin(s/2),ue=2*$*J,xe=J*J,Me=1-V*$*$,ve=Me?1/Me:0,Ce=Me?Math.acos(D*$)*Math.sqrt(1/Me):0,ke=.5*(2*Ce*D*J+2*s/Math.PI)-e,Pe=.5*(Ce*P+h)-n,Xe=.5*ve*(V*xe+Ce*D*$*B)+1/Math.PI,qe=ve*(ue*O/4-Ce*P*J),vt=.125*ve*(O*J-Ce*P*V*ue),Nt=.5*ve*(B*$+Ce*xe*D)+.5,it=qe*vt-Nt*Xe;w=(Pe*qe-ke*Nt)/it,T=(ke*vt-Pe*Xe)/it,s=Bt(s-w,-Math.PI,Math.PI),h=Bt(h-T,-Cu,Cu)}while((Math.abs(w)>_||Math.abs(T)>_)&&--g>0);return new Ur(pt(s),pt(h))}}class Su extends Xl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:h}=this;return{x:Ne(e)*h*s+.5,y:-Math.sin(Ne(n))/h*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:h}=this,g=-(n-.5)/s,_=Bt(pt((e-.5)/s)/h,-180,180),w=Math.asin(Bt(g*h,-1,1)),T=Bt(pt(w),-ys,ys);return new Ur(_,T)}}class fg extends Tu{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){const h=pu(e,n,s);return go(h,h,ju(Os(s))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,n){const s=Hc(n.lat,n.lng),h=_s([],s),g=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Nu(s,s,h,Ml(1,0)*er*g);const _=Aa(new Float64Array(16));return Vc(_,e.pixelMatrix,e.globeMatrix),go(s,s,_),new st(s[0],s[1])}pixelsPerMeter(e,n){return Ml(1,0)*n}pixelSpaceConversion(e,n,s){const h=Ml(1,e)*n,g=Qn(Ml(1,45)*n,h,s);return this.pixelsPerMeter(e,n)/g}createTileMatrix(e,n,s){const h=Sf(Os(s.canonical));return Vc(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,n){const{center:s}=e,h=ju(Os(n));return _h(h,h,Ne(s.lng)),gh(h,h,Ne(s.lat)),$c(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,n,s,h){return vm(e,n,s,!0)||new Ih(0,0)}pointCoordinate3D(e,n,s){const h=this.pointCoordinate(e,n,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,n){return!vm(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(h,g){const _=h.cameraToCenterDistance,w=h._centerAltitude*g,T=h._camera,D=h._camera.forward(),P=dc([],Pa([],D,-_),[0,0,w]),O=h.worldSize/(2*Math.PI),B=[0,0,-O],V=h.width/h.height,$=Math.tan(h.fovAboveCenter),J=Pa([],T.up(),$),ue=Pa([],T.right(),$*V),xe=_s([],dc([],dc([],D,J),ue)),Me=[];let ve;if(new $l(P,xe).closestPointOnSphere(B,O,Me)){const Ce=dc([],Me,B),ke=El([],Ce,P);ve=Math.cos(h.fovAboveCenter)*du(ke)}else{const Ce=El([],P,B),ke=El([],B,P);_s(ke,ke);const Pe=du(Ce)-O;ve=Math.sqrt(Pe*(Pe+2*O));const Xe=Math.acos(ve/(O+Pe))-Math.acos(Ra(D,ke));ve*=Math.cos(Xe)}return 1.01*ve}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Vu(e.zoom);if(s>0){const h=Xh(e,Ml(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Qn(n,h+g*(1-Math.cos(_)),Math.pow(s,10))}return n}upVector(e,n,s){return pu(n,s,e,1)}upVectorScale(e){return{metersToTile:gd(Cf(Os(e)))}}}function yp(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Tu(t);case"equirectangular":return new _p(t);case"naturalEarth":return new oh(t);case"equalEarth":return new cl(t);case"winkelTripel":return new sh(t);case"albers":return n?new Su(t):new X_(t);case"lambertConformalConic":return n?new Su(t):new ih(t);case"globe":return new fg(t)}throw new Error(`Invalid projection name: ${t.name}`)}const pg=Bh.types,mg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kh(t,e,n,s,h,g,_,w,T,D,P,O,B){const V=w?Math.min(xc,Math.round(w[0])):0,$=w?Math.min(xc,Math.round(w[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*h),g,_,(V<<1)+(T?1:0),$,16*D,16*P,256*O,256*B)}function Yh(t,e,n,s,h,g,_){t.emplaceBack(e,n,s,h,g,_)}function Jh(t,e,n,s,h){t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h)}function gg(t){for(const e of t.sections)if(U(e.text))return!0;return!1}class Zd{constructor(e){this.layoutVertexArray=new jl,this.indexArray=new gs,this.programConfigurations=e,this.segments=new mo,this.dynamicLayoutVertexArray=new Di,this.opacityVertexArray=new Ci,this.placedSymbolArray=new tm,this.globeExtVertexArray=new Wi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,A_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ku.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,mg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ld.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}fn(Zd,"SymbolBuffers");class vp{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new mo,this.collisionVertexArray=new yi,this.collisionVertexArrayExt=new ms}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Qf.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,jh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}fn(vp,"CollisionBuffers");class Jc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Aa([]),this.placementViewportMatrix=Aa([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vh(this.zoom,n["text-size"]),this.iconSizeData=Vh(this.zoom,n["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),g=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(_=>Xa[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Zd(new hu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Zd(new hu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ad,this.lineVertexArray=new hf,this.symbolInstances=new ma}calculateGlyphDependencies(e,n,s,h,g){for(let _=0;_<e.length;_++)if(n[e.charCodeAt(_)]=!0,h&&g){const w=$h[e.charAt(_)];w&&(n[w.charCodeAt(0)]=!0)}}populate(e,n,s,h){const g=this.layers[0],_=g.layout,w="globe"===this.projection.name,T=_.get("text-font"),D=_.get("text-field"),P=_.get("icon-image"),O=("constant"!==D.value.kind||D.value.value instanceof Yi&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),B="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,V=_.get("symbol-sort-key");if(this.features=[],!O&&!B)return;const $=n.iconDependencies,J=n.glyphDependencies,ue=n.availableImages,xe=new He(this.zoom);for(const{feature:Me,id:ve,index:Ce,sourceLayerIndex:ke}of e){const Pe=g._featureFilter.needGeometry,Xe=Wc(Me,Pe);if(!g._featureFilter.filter(xe,Xe,s))continue;if(Pe||(Xe.geometry=Gl(Me,s,h)),w&&1!==Me.type&&s.z<=5){const it=Xe.geometry,bt=.98078528056,Tt=(Ot,Ut)=>Ra(pu(Ot.x,Ot.y,s,1),pu(Ut.x,Ut.y,s,1))<bt;for(let Ot=0;Ot<it.length;Ot++)it[Ot]=Dm(it[Ot],Tt)}let qe,vt;if(O){const it=g.getValueAndResolveTokens("text-field",Xe,s,ue),bt=Yi.factory(it);gg(bt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Re()||this.hasRTLText&&Be.isParsed())&&(qe=P_(bt,g,Xe))}if(B){const it=g.getValueAndResolveTokens("icon-image",Xe,s,ue);vt=it instanceof ao?it:ao.fromString(it)}if(!qe&&!vt)continue;const Nt=this.sortFeaturesByKey?V.evaluate(Xe,{},s):void 0;if(this.features.push({id:ve,text:qe,icon:vt,index:Ce,sourceLayerIndex:ke,geometry:Xe.geometry,properties:Me.properties,type:pg[Me.type],sortKey:Nt}),vt&&($[vt.name]=!0),qe){const it=T.evaluate(Xe,{},s).join(","),bt="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xa.vertical)>=0;for(const Tt of qe.sections)if(Tt.image)$[Tt.image.name]=!0;else{const Ot=f(qe.toString()),Ut=Tt.fontStack||it,lt=J[Ut]=J[Ut]||{};this.calculateGlyphDependencies(Tt.text,lt,bt,this.allowVerticalPlacement,Ot)}}}"line"===_.get("symbol-placement")&&(this.features=function(Me){const ve={},Ce={},ke=[];let Pe=0;function Xe(it){ke.push(Me[it]),Pe++}function qe(it,bt,Tt){const Ot=Ce[it];return delete Ce[it],Ce[bt]=Ot,ke[Ot].geometry[0].pop(),ke[Ot].geometry[0]=ke[Ot].geometry[0].concat(Tt[0]),Ot}function vt(it,bt,Tt){const Ot=ve[bt];return delete ve[bt],ve[it]=Ot,ke[Ot].geometry[0].shift(),ke[Ot].geometry[0]=Tt[0].concat(ke[Ot].geometry[0]),Ot}function Nt(it,bt,Tt){const Ot=Tt?bt[0][bt[0].length-1]:bt[0][0];return`${it}:${Ot.x}:${Ot.y}`}for(let it=0;it<Me.length;it++){const bt=Me[it],Tt=bt.geometry,Ot=bt.text?bt.text.toString():null;if(!Ot){Xe(it);continue}const Ut=Nt(Ot,Tt),lt=Nt(Ot,Tt,!0);if(Ut in Ce&&lt in ve&&Ce[Ut]!==ve[lt]){const tn=vt(Ut,lt,Tt),Un=qe(Ut,lt,ke[tn].geometry);delete ve[Ut],delete Ce[lt],Ce[Nt(Ot,ke[Un].geometry,!0)]=Un,ke[tn].geometry=null}else Ut in Ce?qe(Ut,lt,Tt):lt in ve?vt(Ut,lt,Tt):(Xe(it),ve[Ut]=Pe-1,Ce[lt]=Pe-1)}return ke.filter(it=>it.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Me,ve)=>Me.sortKey-ve.sortKey)}update(e,n,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=yp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:h,y:g}of n)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,h,g,_,w,T,D,P,O,B,V,$){const J=e.indexArray,ue=e.layoutVertexArray,xe=e.globeExtVertexArray,Me=e.segments.prepareSegment(4*n.length,ue,J,this.canOverlap?_.sortKey:void 0),ve=this.glyphOffsetArray.length,Ce=Me.vertexLength,ke=this.allowVerticalPlacement&&w===Xa.vertical?Math.PI/2:0,Pe=_.text&&_.text.sections;for(let qe=0;qe<n.length;qe++){const{tl:vt,tr:Nt,bl:it,br:bt,tex:Tt,pixelOffsetTL:Ot,pixelOffsetBR:Ut,minFontScaleX:lt,minFontScaleY:tn,glyphOffset:Un,isSDF:cn,sectionIndex:Cn}=n[qe],rn=Me.vertexLength,qn=Un[1];if(Kh(ue,D.x,D.y,vt.x,qn+vt.y,Tt.x,Tt.y,s,cn,Ot.x,Ot.y,lt,tn),Kh(ue,D.x,D.y,Nt.x,qn+Nt.y,Tt.x+Tt.w,Tt.y,s,cn,Ut.x,Ot.y,lt,tn),Kh(ue,D.x,D.y,it.x,qn+it.y,Tt.x,Tt.y+Tt.h,s,cn,Ot.x,Ut.y,lt,tn),Kh(ue,D.x,D.y,bt.x,qn+bt.y,Tt.x+Tt.w,Tt.y+Tt.h,s,cn,Ut.x,Ut.y,lt,tn),T){const{x:Ir,y:Dr,z:Tr}=T.anchor,[Kn,li,lr]=T.up;Yh(xe,Ir,Dr,Tr,Kn,li,lr),Yh(xe,Ir,Dr,Tr,Kn,li,lr),Yh(xe,Ir,Dr,Tr,Kn,li,lr),Yh(xe,Ir,Dr,Tr,Kn,li,lr),Jh(e.dynamicLayoutVertexArray,Ir,Dr,Tr,ke)}else Jh(e.dynamicLayoutVertexArray,D.x,D.y,D.z,ke);J.emplaceBack(rn,rn+1,rn+2),J.emplaceBack(rn+1,rn+2,rn+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Un[0]),qe!==n.length-1&&Cn===n[qe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ue.length,_,_.index,{},V,$,Pe&&Pe[Cn])}const Xe=T?T.anchor:D;e.placedSymbolArray.emplaceBack(Xe.x,Xe.y,Xe.z,D.x,D.y,ve,this.glyphOffsetArray.length-ve,Ce,P,O,D.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],w,0,!1,0,B,0)}_commitLayoutVertex(e,n,s,h,g,_,w){e.emplaceBack(n,s,h,g,_,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,n,s,h,g,_,w){const T=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),D=T.vertexLength,P=w.tileAnchorX,O=w.tileAnchorY;for(let V=0;V<4;V++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,P,O,new st(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,P,O,new st(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,P,O,new st(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,P,O,new st(e.x1,e.y2)),T.vertexLength+=4;const B=s.indexArray;B.emplaceBack(D,D+1),B.emplaceBack(D+1,D+2),B.emplaceBack(D+2,D+3),B.emplaceBack(D+3,D),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceTextSize(e,_,n,w);this._addCollisionDebugVertices(T,D,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceIconSize(e,n,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,D,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(co,Od.members,bl),this.iconCollisionBox=new vp(co,Od.members,bl);const s=wu(this.iconSizeData,e),h=wu(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,e,n,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,e,n,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,n,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,n,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,n,s,h){const g=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),_=Yu(this.textSizeData,e,g)/vs;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,n,s){const h=this.icon.placedSymbolArray.get(s),g=Yu(this.iconSizeData,e,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceTextSize(e,_,n,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,T.padding)}}_updateIconDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceIconSize(e,n,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,T.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=wu(this.iconSizeData,e),h=wu(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(h,e,n,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,e,n,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(s,e,n,_.iconBoxStartIndex,_.iconBoxEndIndex,_.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,h,g,_,w,T,D){const P={};if(n<s){const{x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce,featureIndex:ke}=e.get(n);P.textBox={x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce},P.textFeatureIndex=ke}if(h<g){const{x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce,featureIndex:ke}=e.get(h);P.verticalTextBox={x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce},P.verticalTextFeatureIndex=ke}if(_<w){const{x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce,featureIndex:ke}=e.get(_);P.iconBox={x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce},P.iconFeatureIndex=ke}if(T<D){const{x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce,featureIndex:ke}=e.get(T);P.verticalIconBox={x1:O,y1:B,x2:V,y2:$,padding:J,projectedAnchorX:ue,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Ce},P.verticalIconFeatureIndex=ke}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),h=s.vertexStartIndex+4*s.numGlyphs;for(let g=s.vertexStartIndex;g<h;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),h=[],g=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const T=this.symbolInstances.get(w);h.push(0|Math.round(n*T.tileAnchorX+s*T.tileAnchorY)),g.push(T.featureIndex)}return _.sort((w,T)=>h[w]-h[T]||g[T]-g[w]),_}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:D}=s;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}fn(Jc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Jc.MAX_GLYPHS=65535,Jc.addDynamicAttributes=Jh;const _g=new zt({"symbol-placement":new Ge(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Ge(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ge(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tt(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ge(ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ge(ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ge(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ge(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ge(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new tt(ht.layout_symbol["icon-size"]),"icon-text-fit":new Ge(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ge(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new tt(ht.layout_symbol["icon-image"]),"icon-rotate":new tt(ht.layout_symbol["icon-rotate"]),"icon-padding":new Ge(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Ge(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new tt(ht.layout_symbol["icon-offset"]),"icon-anchor":new tt(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ge(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ge(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ge(ht.layout_symbol["text-rotation-alignment"]),"text-field":new tt(ht.layout_symbol["text-field"]),"text-font":new tt(ht.layout_symbol["text-font"]),"text-size":new tt(ht.layout_symbol["text-size"]),"text-max-width":new tt(ht.layout_symbol["text-max-width"]),"text-line-height":new tt(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new tt(ht.layout_symbol["text-letter-spacing"]),"text-justify":new tt(ht.layout_symbol["text-justify"]),"text-radial-offset":new tt(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ge(ht.layout_symbol["text-variable-anchor"]),"text-anchor":new tt(ht.layout_symbol["text-anchor"]),"text-max-angle":new Ge(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Ge(ht.layout_symbol["text-writing-mode"]),"text-rotate":new tt(ht.layout_symbol["text-rotate"]),"text-padding":new Ge(ht.layout_symbol["text-padding"]),"text-keep-upright":new Ge(ht.layout_symbol["text-keep-upright"]),"text-transform":new tt(ht.layout_symbol["text-transform"]),"text-offset":new tt(ht.layout_symbol["text-offset"]),"text-allow-overlap":new Ge(ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ge(ht.layout_symbol["text-ignore-placement"]),"text-optional":new Ge(ht.layout_symbol["text-optional"])});var xp={paint:new zt({"icon-opacity":new tt(ht.paint_symbol["icon-opacity"]),"icon-color":new tt(ht.paint_symbol["icon-color"]),"icon-halo-color":new tt(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new tt(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tt(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Ge(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ge(ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new tt(ht.paint_symbol["text-opacity"]),"text-color":new tt(ht.paint_symbol["text-color"],{runtimeType:Zn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new tt(ht.paint_symbol["text-halo-color"]),"text-halo-width":new tt(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new tt(ht.paint_symbol["text-halo-blur"]),"text-translate":new Ge(ht.paint_symbol["text-translate"]),"text-translate-anchor":new Ge(ht.paint_symbol["text-translate-anchor"])}),layout:_g};class wp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:as,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}fn(wp,"FormatSectionOverride",{omit:["defaultValue"]});class ah extends Ha{constructor(e){super(e,xp)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const g of s)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,h){const g=this.layout.get(e).evaluate(n,{},s,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||k(_.value)||!g?g:(w=n.properties,g.replace(/{([^{}]+)}/g,(D,P)=>P in w?String(w[P]):""));var w}createBucket(e){return new Jc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xp.paint.overridableProperties){if(!ah.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new wp(n),h=new I(s,n.property.specification);let g=null;g="constant"===n.value.kind||"source"===n.value.kind?new _e("source",h):new $e("composite",h,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new kt(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&ah.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),h=xp.paint.properties[n];let g=!1;const _=w=>{for(const T of w)if(h.overrides&&h.overrides.hasOverride(T))return void(g=!0)};if("constant"===s.value.kind&&s.value.value instanceof Yi)_(s.value.value.sections);else if("source"===s.value.kind){const w=D=>{g||(D instanceof ki&&ti(D.value)===Yr?_(D.value.sections):D instanceof Ji?_(D.sections):D.eachChild(w))},T=s.value;T._styleExpression&&w(T._styleExpression.expression)}return g}getProgramConfiguration(e){return new jc(this,e)}}var bp={paint:new zt({"background-color":new Ge(ht.paint_background["background-color"]),"background-pattern":new Ge(ht.paint_background["background-pattern"]),"background-opacity":new Ge(ht.paint_background["background-opacity"])})},K_={paint:new zt({"raster-opacity":new Ge(ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ge(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ge(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ge(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Ge(ht.paint_raster["raster-saturation"]),"raster-contrast":new Ge(ht.paint_raster["raster-contrast"]),"raster-resampling":new Ge(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Ge(ht.paint_raster["raster-fade-duration"])})};class Xd extends Ha{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Kd={paint:new zt({"sky-type":new Ge(ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ge(ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ge(ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ge(ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ge(ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new It(ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ge(ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ge(ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ge(ht.paint_sky["sky-opacity"])})};function Qh(t,e,n){const s=[0,0,1],h=vf([]);return wf(h,h,n?-Ne(t)+Math.PI:Ne(t)),xf(h,h,-Ne(e)),gm(s,s,h),_s(s,s)}const Y_={circle:class extends Ha{constructor(t){super(t,Hu)}createBucket(t){return new Ah(t)}queryRadius(t){const e=t;return _u("circle-radius",this,e)+_u("circle-stroke-width",this,e)+Gu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,h,g,_,w){const T=Pm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return km(t,s,g,_,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,D)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new jc(this,t)}},heatmap:class extends Ha{createBucket(t){return new Lf(t)}constructor(t){super(t,r_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return _u("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,h,g,_,w){const T=this.paint.get("heatmap-radius").evaluate(e,n);return km(t,s,g,_,w,!0,!0,new st(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new jc(this,t)}},hillshade:class extends Ha{constructor(t){super(t,Lh)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ha{constructor(t){super(t,m_)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new jc(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Id(t)}queryRadius(){return Gu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,h,g){return!t.queryGeometry.isAboveHorizon&&Rf(Am(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ha{constructor(t){super(t,M_)}createBucket(t){return new Pd(t)}queryRadius(){return Gu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new jc(this,t)}queryIntersectsFeature(t,e,n,s,h,g,_,w,T){const D=Pm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,n),O=this.paint.get("fill-extrusion-base").evaluate(e,n),B=[0,0],V=w&&g.elevation,$=g.elevation?g.elevation.exaggeration():1,J=t.tile.getBucket(this);if(V&&J instanceof Pd){const Ce=J.centroidVertexArray,ke=T+1;ke<Ce.length&&(B[0]=Ce.geta_centroid_pos0(ke),B[1]=Ce.geta_centroid_pos1(ke))}if(0===B[0]&&1===B[1])return!1;"globe"===g.projection.name&&(s=qf([s],[new st(0,0),new st(er,er)],t.tileID.canonical).map(Ce=>Ce.polygon).flat());const ue=V?w:null,[xe,Me]=(ke=s,Pe=O,Xe=P,qe=D,vt=_,Nt=ue,it=B,bt=$,Tt=g.center.lat,"globe"===(Ce=g).projection.name?function(Ut,lt,tn,Un,cn,Cn,rn,qn,Ir,Dr,Tr){const Kn=[],li=[],lr=Ut.projection.upVectorScale(Tr,Ut.center.lat,Ut.worldSize).metersToTile,Rr=[0,0,0,1],mi=[0,0,0,1],Li=(Oi,ji,uo,ws)=>{Oi[0]=ji,Oi[1]=uo,Oi[2]=ws,Oi[3]=1},Mi=Gm();tn>0&&(tn+=Mi),Un+=Mi;for(const Oi of lt){const ji=[],uo=[];for(const ws of Oi){const ci=ws.x+cn.x,Fo=ws.y+cn.y,Do=Ut.projection.projectTilePoint(ci,Fo,Tr),$r=Ut.projection.upVector(Tr,ws.x,ws.y);let Xi=tn,Xo=Un;if(rn){const gi=Xf(ci,Fo,tn,Un,rn,qn,Ir,Dr);Xi+=gi.base,Xo+=gi.top}0!==tn?Li(Rr,Do.x+$r[0]*lr*Xi,Do.y+$r[1]*lr*Xi,Do.z+$r[2]*lr*Xi):Li(Rr,Do.x,Do.y,Do.z),Li(mi,Do.x+$r[0]*lr*Xo,Do.y+$r[1]*lr*Xo,Do.z+$r[2]*lr*Xo),go(Rr,Rr,Cn),go(mi,mi,Cn),ji.push(new Zu(Rr[0],Rr[1],Rr[2])),uo.push(new Zu(mi[0],mi[1],mi[2]))}Kn.push(ji),li.push(uo)}return[Kn,li]}(Ce,ke,Pe,Xe,qe,vt,Nt,it,bt,Tt,t.tileID.canonical):Nt?function(Ut,lt,tn,Un,cn,Cn,rn,qn,Ir){const Dr=[],Tr=[],Kn=[0,0,0,1];for(const li of Ut){const lr=[],Rr=[];for(const mi of li){const Li=mi.x+Un.x,Mi=mi.y+Un.y,Oi=Xf(Li,Mi,lt,tn,Cn,rn,qn,Ir);Kn[0]=Li,Kn[1]=Mi,Kn[2]=Oi.base,Kn[3]=1,fc(Kn,Kn,cn),Kn[3]=Math.max(Kn[3],1e-5);const ji=new Zu(Kn[0]/Kn[3],Kn[1]/Kn[3],Kn[2]/Kn[3]);Kn[0]=Li,Kn[1]=Mi,Kn[2]=Oi.top,Kn[3]=1,fc(Kn,Kn,cn),Kn[3]=Math.max(Kn[3],1e-5);const uo=new Zu(Kn[0]/Kn[3],Kn[1]/Kn[3],Kn[2]/Kn[3]);lr.push(ji),Rr.push(uo)}Dr.push(lr),Tr.push(Rr)}return[Dr,Tr]}(ke,Pe,Xe,qe,vt,Nt,it,bt,Tt):function(Ut,lt,tn,Un,cn){const Cn=[],rn=[],qn=cn[8]*lt,Ir=cn[9]*lt,Dr=cn[10]*lt,Tr=cn[11]*lt,Kn=cn[8]*tn,li=cn[9]*tn,lr=cn[10]*tn,Rr=cn[11]*tn;for(const mi of Ut){const Li=[],Mi=[];for(const Oi of mi){const ji=Oi.x+Un.x,uo=Oi.y+Un.y,ws=cn[0]*ji+cn[4]*uo+cn[12],ci=cn[1]*ji+cn[5]*uo+cn[13],Fo=cn[2]*ji+cn[6]*uo+cn[14],Do=cn[3]*ji+cn[7]*uo+cn[15],$r=ws+qn,Xi=ci+Ir,Xo=Fo+Dr,gi=Math.max(Do+Tr,1e-5),_o=ws+Kn,Bs=ci+li,rs=Fo+lr,is=Math.max(Do+Rr,1e-5);Li.push(new Zu($r/gi,Xi/gi,Xo/gi)),Mi.push(new Zu(_o/is,Bs/is,rs/is))}Cn.push(Li),rn.push(Mi)}return[Cn,rn]}(ke,Pe,Xe,qe,vt)),ve=t.queryGeometry;var Ce,ke,Pe,Xe,qe,vt,Nt,it,bt,Tt;return function(Ce,ke,Pe){let Xe=1/0;Rf(Pe,ke)&&(Xe=Wm(Pe,ke[0]));for(let qe=0;qe<ke.length;qe++){const vt=ke[qe],Nt=Ce[qe];for(let it=0;it<vt.length-1;it++){const bt=vt[it],Tt=[bt,vt[it+1],Nt[it+1],Nt[it],bt];Sm(Pe,Tt)&&(Xe=Math.min(Xe,Wm(Pe,Tt)))}}return Xe!==1/0&&Xe}(xe,Me,ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},line:class extends Ha{constructor(t){super(t,Xm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ms,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Jf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new vc(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new jc(this,t)}queryRadius(t){const e=t,n=Km(_u("line-width",this,e),_u("line-gap-width",this,e)),s=_u("line-offset",this,e);return n/2+Math.abs(s)+Gu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,h,g){if(t.queryGeometry.isAboveHorizon)return!1;const _=Am(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),w=t.pixelToTileUnitsFactor/2*Km(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),T=this.paint.get("line-offset").evaluate(e,n);return T&&(s=function(D,P){const O=[],B=new st(0,0);for(let V=0;V<D.length;V++){const $=D[V],J=[];for(let ue=0;ue<$.length;ue++){const Me=$[ue],ve=$[ue+1],Ce=0===ue?B:Me.sub($[ue-1])._unit()._perp(),ke=ue===$.length-1?B:ve.sub(Me)._unit()._perp(),Pe=Ce._add(ke)._unit();Pe._mult(1/(Pe.x*ke.x+Pe.y*ke.y)),J.push(Pe._mult(P)._add(Me))}O.push(J)}return O}(s,T*t.pixelToTileUnitsFactor)),function(D,P,O){for(let B=0;B<P.length;B++){const V=P[B];if(D.length>=3)for(let $=0;$<V.length;$++)if(gc(D,V[$]))return!0;if(Mm(D,V,O))return!0}return!1}(_,s,w)}isTileClipped(){return!0}},symbol:ah,background:class extends Ha{constructor(t){super(t,bp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ha{constructor(t){super(t,K_)}getProgramIds(){return["raster"]}},sky:class extends Ha{constructor(t){super(t,Kd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),h=!s,g=t.style.light,_=g.properties.get("position");return h&&"viewport"===g.properties.get("anchor")&&ir("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Qh(_.azimuthal,90-_.polar,e):Qh(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return Qh(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Mu{constructor(e,n,s,h){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,s){const{width:h,height:g}=e,{context:_}=this,{gl:w}=_,{HTMLImageElement:T,HTMLCanvasElement:D,HTMLVideoElement:P,ImageData:O,ImageBitmap:B}=Ie;if(w.bindTexture(w.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===g){const{x:V,y:$}=s||{x:0,y:0};e instanceof T||e instanceof D||e instanceof P||e instanceof O||B&&e instanceof B?w.texSubImage2D(w.TEXTURE_2D,0,V,$,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,V,$,h,g,w.RGBA,w.UNSIGNED_BYTE,e.data)}else this.size=[h,g],e instanceof T||e instanceof D||e instanceof P||e instanceof O||B&&e instanceof B?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,h,g,0,this.format,w.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ep{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tp{constructor(){this.tasks={},this.taskQueue=[],fr(["process"],this),this.invoker=new Ep(this.process),this.nextId=0}add(e,n){const s=this.nextId++,h=function({type:g,isSymbolTile:_,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||_?"parseTile"!==g||_?"parseTile"===g&&_?300-w:"maybePrepare"===g&&_?400-w:500:200-w:100-w}(n);if(0===h){ni();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){ni();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<n&&(n=g.priority,e=h)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Dp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Cp=["tile","layer","source","sourceLayer","state"];class Sp{constructor(e,n,s,h,g){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=h,this.properties=e.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of Cp)void 0!==this[n]&&(e[n]=this[n]);return e}}const Ka=32,ul=33,Ec=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,h=0,g=0,_=0,w=0;for(1&e?h=g=_=Ka:n=s=w=Ka;(e>>=1)>1;){const D=n+h>>1,P=s+g>>1;1&e?(h=n,g=s,n=_,s=w):(n=h,s=g,h=_,g=w),_=D,w=P}const T=4*t;Ec[T+0]=n,Ec[T+1]=s,Ec[T+2]=h,Ec[T+3]=g}const Kl=new Uint16Array(2178),Tc=new Uint8Array(1089),ed=new Uint16Array(1089);function Mp(t){return 0===t?-.03125:32===t?.03125:0}var Ip=kn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const yg={type:2,extent:er,loadGeometry:()=>[[new st(0,0),new st(8193,0),new st(8193,8193),new st(0,8193),new st(0,0)]]};class Yd{constructor(e,n,s,h,g){this.tileID=e,this.uid=At(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<xr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=bu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,g){const _={};if(!g)return _;for(const w of h){const T=w.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(D=>T.filter(P=>P.id===D)[0]));for(const D of T)_[D.id]=w}}return _}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof Jc){if(this.hasSymbolBuckets=!0,!s)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof Jc&&g.hasRTLText){this.hasRTLText=!0,Be.isLoading()||Be.isLoaded()||"deferred"!==Re()||Ae();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new cf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mu(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mu(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Mu(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,h,g,_,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:w,transform:_,params:g,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),g=n?n.sourceLayer:"",_=h._geojsonTileLayer||h[g];if(!_)return;const w=Ca(n&&n.filter),{z:T,x:D,y:P}=this.tileID.canonical,O={z:T,x:D,y:P};for(let B=0;B<_.length;B++){const V=_.feature(B);if(w.needGeometry){const ue=Wc(V,!0);if(!w.filter(new He(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!w.filter(new He(this.tileID.overscaledZ),V))continue;const $=s.getId(V,g),J=new Sp(V,T,D,P,$);J.tile=O,e.push(J)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=Dn(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const g=this.expirationTime-n;g?this.expirationTime=s+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),h=n.style.listImages();for(const g in this.buckets){if(!n.style.hasLayer(g))continue;const _=this.buckets[g],w=_.layers[0].sourceLayer||"_geojsonTileLayer",T=s[w],D=e[w];if(!T||!D||0===Object.keys(D).length)continue;if(_.update(D,T,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof vc||_ instanceof Id){const O=n.style._getSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&O&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(O.id,this.tileID)}const P=n&&n.style&&n.style.getLayer(g);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=xr.now()+e}setTexture(e,n){const s=n.context,h=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Mu(s,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,n){const s={};for(const h of n)s[h]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const h=this.dependencies[s];if(h)for(const g of n)if(h[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=Gl(yg,this.tileID.canonical,this.tileTransform)[0],h=new Nn,g=new al;for(let _=0;_<s.length;_++){const{x:w,y:T}=s[_];h.emplaceBack(w,T),g.emplaceBack(_)}g.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(g),this._tileDebugBuffer=e.createVertexBuffer(h,Th.members),this._tileDebugSegments=mo.simpleSegment(0,0,h.length,g.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=Gl(yg,this.tileID.canonical,this.tileTransform)[0];let h,g;if(this.isRaster){const _=function(w,T){const D=bu(w,T),P=Math.pow(2,w.z);for(let ue=0;ue<ul;ue++)for(let xe=0;xe<ul;xe++){const Me=qa((w.x+(xe+Mp(xe))/Ka)/P),ve=Fs((w.y+(ue+Mp(ue))/Ka)/P),Ce=T.project(Me,ve),ke=ue*ul+xe;Kl[2*ke+0]=Math.round((Ce.x*D.scale-D.x)*er),Kl[2*ke+1]=Math.round((Ce.y*D.scale-D.y)*er)}Tc.fill(0),ed.fill(0);for(let ue=2045;ue>=0;ue--){const xe=4*ue,Me=Ec[xe+0],ve=Ec[xe+1],Ce=Ec[xe+2],ke=Ec[xe+3],Pe=Me+Ce>>1,Xe=ve+ke>>1,qe=Pe+Xe-ve,vt=Xe+Me-Pe,Nt=ve*ul+Me,it=ke*ul+Ce,bt=Xe*ul+Pe,Tt=Math.hypot((Kl[2*Nt+0]+Kl[2*it+0])/2-Kl[2*bt+0],(Kl[2*Nt+1]+Kl[2*it+1])/2-Kl[2*bt+1])>=16;Tc[bt]=Tc[bt]||(Tt?1:0),ue<1022&&(Tc[bt]=Tc[bt]||Tc[(ve+vt>>1)*ul+(Me+qe>>1)]||Tc[(ke+vt>>1)*ul+(Ce+qe>>1)])}const O=new fi,B=new gs;let V=0;function $(ue,xe){const Me=xe*ul+ue;return 0===ed[Me]&&(O.emplaceBack(Kl[2*Me+0],Kl[2*Me+1],ue*er/Ka,xe*er/Ka),ed[Me]=++V),ed[Me]-1}function J(ue,xe,Me,ve,Ce,ke){const Pe=ue+Me>>1,Xe=xe+ve>>1;if(Math.abs(ue-Ce)+Math.abs(xe-ke)>1&&Tc[Xe*ul+Pe])J(Ce,ke,ue,xe,Pe,Xe),J(Me,ve,Ce,ke,Pe,Xe);else{const qe=$(ue,xe),vt=$(Me,ve),Nt=$(Ce,ke);B.emplaceBack(qe,vt,Nt)}}return J(0,0,Ka,Ka,Ka,0),J(Ka,Ka,0,0,0,Ka),{vertices:O,indices:B}}(this.tileID.canonical,n);h=_.vertices,g=_.indices}else{h=new fi,g=new gs;for(const{x:w,y:T}of s)h.emplaceBack(w,T,0,0);const _=Wu(h.int16,void 0,4);for(let w=0;w<_.length;w+=3)g.emplaceBack(_[w],_[w+1],_[w+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,Ip.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(g),this._tileBoundsSegments=mo.simpleSegment(0,0,h.length,g.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const h=this.tileID.canonical,g=ju(Ef(h,n)),_=Vu(n.zoom);let w;_>0&&(w=mf(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,n,g,w,_),this._makeGlobeTileDebugTextBuffer(e,h,n,g,w,_)}_globePoint(e,n,s,h,g,_,w){let T=pu(e,n,s);if(_){const D=1<<s.z,P=Cl(h.center.lng),O=Sl(h.center.lat),B=(s.x+.5)/D-P;let V=0;B>.5?V=-1:B<-.5&&(V=1);let $=(e/er+s.x)/D+V,J=(n/er+s.y)/D;$=($-P)*h._pixelsPerMercatorPixel+P,J=(J-O)*h._pixelsPerMercatorPixel+O;const ue=[$*h.worldSize,J*h.worldSize,0];go(ue,ue,_),T=Dl(T,ue,w)}return go(T,T,g)}_makeGlobeTileDebugBorderBuffer(e,n,s,h,g,_){const w=new Nn,T=new al,D=new Qr,P=(B,V,$,J,ue)=>{const xe=($-B)/(ue-1),Me=(J-V)/(ue-1),ve=w.length;for(let Ce=0;Ce<ue;Ce++){const ke=B+Ce*xe,Pe=V+Ce*Me;w.emplaceBack(ke,Pe);const Xe=this._globePoint(ke,Pe,n,s,h,g,_);D.emplaceBack(Xe[0],Xe[1],Xe[2]),T.emplaceBack(ve+Ce)}},O=er;P(0,0,O,0,16),P(O,0,O,O,16),P(O,O,0,O,16),P(0,O,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(T),this._tileDebugBuffer=e.createVertexBuffer(w,Th.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(D,ym.members),this._tileDebugSegments=mo.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(e,n,s,h,g,_){const w=new Nn,T=new gs,D=new Qr,P=25;T.reserve(32),w.reserve(P),D.reserve(P);const O=(B,V)=>P*B+V;for(let B=0;B<P;B++){const V=2048*B;for(let $=0;$<P;$++){const J=2048*$;w.emplaceBack(J,V);const ue=this._globePoint(J,V,n,s,h,g,_);D.emplaceBack(ue[0],ue[1],ue[2])}}for(let B=0;B<4;B++)for(let V=0;V<4;V++){const $=O(B,V),J=O(B,V+1),ue=O(B+1,V),xe=O(B+1,V+1);T.emplaceBack($,J,ue),T.emplaceBack(ue,J,xe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(w,Th.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(D,ym.members),this._tileDebugTextSegments=mo.simpleSegment(0,0,P,32)}}class vg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const h=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},rt(this.stateChanges[e][h],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const g in this.state[e])g!==h&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const g in this.state[e][h])s[g]||(this.deletedStates[e][h][g]=null)}else for(const g in s)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][g]&&delete this.deletedStates[e][h][g]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const h=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][h])for(s in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][s]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),h=rt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const g=this.deletedStates[e][n];if(null===g)return{};for(const _ in g)delete h[_]}return h}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),rt(this.state[h][_],this.stateChanges[h][_]),g[_]=this.state[h][_];s[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(null===this.deletedStates[h])for(const _ in this.state[h])g[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else if(this.state[h][_])for(const w of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][w];g[_]=this.state[h][_]}s[h]=s[h]||{},rt(s[h],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in e)e[h].setFeatureState(s,n)}}class Jd{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Qd(t,e,n,s){let h=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(s[_])<1e-15){if(n[_]<t[_]||n[_]>e[_])return null}else{const w=1/s[_];let T=(t[_]-n[_])*w,D=(e[_]-n[_])*w;if(T>D){const P=T;T=D,D=P}if(T>h&&(h=T),D<g&&(g=D),h>g)return null}return h}function Ap(t,e,n,s,h,g,_,w,T,D,P){const O=s-t,B=h-e,V=g-n,$=_-t,J=w-e,ue=T-n,xe=P[1]*ue-P[2]*J,Me=P[2]*$-P[0]*ue,ve=P[0]*J-P[1]*$,Ce=O*xe+B*Me+V*ve;if(Math.abs(Ce)<1e-15)return null;const ke=1/Ce,Pe=D[0]-t,Xe=D[1]-e,qe=D[2]-n,vt=(Pe*xe+Xe*Me+qe*ve)*ke;if(vt<0||vt>1)return null;const Nt=Xe*V-qe*B,it=qe*O-Pe*V,bt=Pe*B-Xe*O,Tt=(P[0]*Nt+P[1]*it+P[2]*bt)*ke;return Tt<0||vt+Tt>1?null:($*Nt+J*it+ue*bt)*ke}function Pp(t,e,n){return(t-e)/(n-e)}function Rp(t,e,n,s,h,g,_,w,T){const D=1<<n,P=g-s,O=_-h,B=(t+1)/D*P+s,V=(e+0)/D*O+h,$=(e+1)/D*O+h;w[0]=(t+0)/D*P+s,w[1]=V,T[0]=B,T[1]=$}class kp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(g){const _=Math.ceil(Math.log2(g.dim/8)),w=[];let T=Math.ceil(Math.pow(2,_));const D=1/T,P=(V,$,J,ue,xe)=>{const Me=ue?1:0,ve=(V+1)*J-Me,Ce=$*J,ke=($+1)*J-Me;xe[0]=V*J,xe[1]=Ce,xe[2]=ve,xe[3]=ke};let O=new Jd(T);const B=[];for(let V=0;V<T*T;V++){P(V%T,Math.floor(V/T),D,!1,B);const $=Dc(B[0],B[1],g),J=Dc(B[2],B[1],g),ue=Dc(B[2],B[3],g),xe=Dc(B[0],B[3],g);O.minimums.push(Math.min($,J,ue,xe)),O.maximums.push(Math.max($,J,ue,xe)),O.leaves.push(1)}for(w.push(O),T/=2;T>=1;T/=2){const V=w[w.length-1];O=new Jd(T);for(let $=0;$<T*T;$++){P($%T,Math.floor($/T),2,!0,B);const J=V.getElevation(B[0],B[1]),ue=V.getElevation(B[2],B[1]),xe=V.getElevation(B[2],B[3]),Me=V.getElevation(B[0],B[3]),ve=V.isLeaf(B[0],B[1]),Ce=V.isLeaf(B[2],B[1]),ke=V.isLeaf(B[2],B[3]),Pe=V.isLeaf(B[0],B[3]),Xe=Math.min(J.min,ue.min,xe.min,Me.min),qe=Math.max(J.max,ue.max,xe.max,Me.max),vt=ve&&Ce&&ke&&Pe;O.maximums.push(qe),O.minimums.push(Xe),O.leaves.push(qe-Xe<=5&&vt?1:0)}w.push(O)}return w}(this.dem),s=n.length-1,h=n[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,h,g,_,w=1){return Qd([e,n,-100],[s,h,this.maximums[0]*w],g,_)}raycast(e,n,s,h,g,_,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,n,s,h,g,_,w);if(null==T)return null;const D=[],P=[],O=[],B=[],V=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:$,t:J,nodex:ue,nodey:xe,depth:Me}=V.pop();if(this.leaves[$]){Rp(ue,xe,Me,e,n,s,h,O,B);const Ce=1<<Me,ke=(ue+0)/Ce,Pe=(ue+1)/Ce,Xe=(xe+0)/Ce,qe=(xe+1)/Ce,vt=Dc(ke,Xe,this.dem)*w,Nt=Dc(Pe,Xe,this.dem)*w,it=Dc(Pe,qe,this.dem)*w,bt=Dc(ke,qe,this.dem)*w,Tt=Ap(O[0],O[1],vt,B[0],O[1],Nt,B[0],B[1],it,g,_),Ot=Ap(B[0],B[1],it,O[0],B[1],bt,O[0],O[1],vt,g,_),Ut=Math.min(null!==Tt?Tt:Number.MAX_VALUE,null!==Ot?Ot:Number.MAX_VALUE);if(Ut!==Number.MAX_VALUE)return Ut;{const lt=Nu([],g,_,J);if(Lp(vt,Nt,bt,it,Pp(lt[0],O[0],B[0]),Pp(lt[1],O[1],B[1]))>=lt[2])return J}continue}let ve=0;for(let Ce=0;Ce<this._siblingOffset.length;Ce++){Rp((ue<<1)+this._siblingOffset[Ce][0],(xe<<1)+this._siblingOffset[Ce][1],Me+1,e,n,s,h,O,B),O[2]=-100,B[2]=this.maximums[this.childOffsets[$]+Ce]*w;const ke=Qd(O,B,g,_);if(null!=ke){const Pe=ke;D[Ce]=Pe;let Xe=!1;for(let qe=0;qe<ve&&!Xe;qe++)Pe>=D[P[qe]]&&(P.splice(qe,0,Ce),Xe=!0);Xe||(P[ve]=Ce),ve++}}for(let Ce=0;Ce<ve;Ce++){const ke=P[Ce];V.push({idx:this.childOffsets[$]+ke,t:D[ke],nodex:(ue<<1)+this._siblingOffset[ke][0],nodey:(xe<<1)+this._siblingOffset[ke][1],depth:Me+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,h,g){if(1===e[h].isLeaf(n,s))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=h-1,w=e[_];let T=0,D=0;for(let P=0;P<this._siblingOffset.length;P++){const O=2*n+this._siblingOffset[P][0],B=2*s+this._siblingOffset[P][1],V=w.getElevation(O,B),$=w.isLeaf(O,B),J=this._addNode(V.min,V.max,$);$&&(T|=1<<P),D||(D=J)}for(let P=0;P<this._siblingOffset.length;P++)T&1<<P||this._construct(e,2*n+this._siblingOffset[P][0],2*s+this._siblingOffset[P][1],_,D+P)}}function Lp(t,e,n,s,h,g){return Qn(Qn(t,n,g),Qn(e,s,g),h)}function Dc(t,e,n){const s=n.dim,h=Bt(t*s-.5,0,s-1),g=Bt(e*s-.5,0,s-1),_=Math.floor(h),w=Math.floor(g),T=Math.min(_+1,s-1),D=Math.min(w+1,s-1);return Lp(n.get(_,w),n.get(T,w),n.get(_,D),n.get(T,D),h-_,g-w)}const Op={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class td{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,h=!1,g=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return ir(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const _=this.dim=n.height-2,w=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let T=0;T<_;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(_,T)]=w[this._idx(_-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,_)]=w[this._idx(T,_-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(_,-1)]=w[this._idx(_-1,0)],w[this._idx(-1,_)]=w[this._idx(0,_-1)],w[this._idx(_,_)]=w[this._idx(_-1,_-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new kp(this)}get(e,n,s=!1){s&&(e=Bt(e,-1,this.dim),n=Bt(n,-1,this.dim));const h=4*this._idx(e,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return Op[e]}get unpackVector(){return Op[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}static pack(e,n){const s=[0,0,0,0],h=td.getUnpackVector(n);let g=Math.floor((e+h[3])/h[2]);return s[2]=g%256,g=Math.floor(g/256),s[1]=g%256,g=Math.floor(g/256),s[0]=g,s}getPixels(){return new zs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,_=s*this.dim,w=s*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(s){case-1:_=w-1;break;case 1:w=_+1}const T=-n*this.dim,D=-s*this.dim;for(let P=_;P<w;P++)for(let O=h;O<g;O++){const B=4*this._idx(O,P),V=4*this._idx(O+T,P+D);this.pixels[B+0]=e.pixels[V+0],this.pixels[B+1]=e.pixels[V+1],this.pixels[B+2]=e.pixels[V+2],this.pixels[B+3]=e.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}fn(td,"DEMData"),fn(kp,"DemMinMaxQuadTree",{omit:["dem"]});class ef{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const g={value:n,timeout:void 0};if(void 0!==s&&(g.timeout=setTimeout(()=>{this.remove(e,g)},s)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,h=void 0===n?0:this.data[s].indexOf(n),g=this.data[s][h];return this.data[s].splice(h,1),g.timeout&&clearTimeout(g.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(g.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const h of this.data[s])e(h.value)||n.push(h);for(const s of n)this.remove(s.value.tileID,s)}}class Ya{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}Ya.ReadOnly=!1,Ya.ReadWrite=!0,Ya.disabled=new Ya(519,Ya.ReadOnly,[0,1]);class zp{constructor(e,n,s,h,g,_){this.test=e,this.ref=n,this.mask=s,this.fail=h,this.depthFail=g,this.pass=_}}zp.disabled=new zp({func:519,mask:0},0,0,7680,7680,7680);class hl{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}hl.Replace=[1,0],hl.disabled=new hl(hl.Replace,Hr.transparent,[!1,!1,!1,!1]),hl.unblended=new hl(hl.Replace,Hr.transparent,[!0,!0,!0,!0]),hl.alphaBlended=new hl([1,771],Hr.transparent,[!0,!0,!0,!0]);class Rl{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}Rl.disabled=new Rl(!1,1029,2305),Rl.backCCW=new Rl(!0,1029,2305),Rl.backCW=new Rl(!0,1029,2304),Rl.frontCW=new Rl(!0,1028,2304),Rl.frontCCW=new Rl(!0,1028,2305);class Sc extends yo{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new ef(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new vg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return at(this._tiles).map(e=>e.tileID).sort(J_).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,h)=>{const g=s.tileID,_=h.tileID,w=new st(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new st(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-_.overscaledZ||T.y-w.y||T.x-w.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(J_).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,h){if(h)if(e.state="errored",404!==h.status)this._source.fire(new fo(h,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=xr.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new kr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const g=n[h];if(e.neighboringTiles&&e.neighboringTiles[g]){const _=this.getTileByID(g);s(e,_),s(_,e)}}function s(h,g){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=g.tileID.canonical.x-h.tileID.canonical.x;const w=g.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),D=g.tileID.key;0===_&&0===w||Math.abs(w)>1||(Math.abs(_)>1&&(1===Math.abs(_+T)?_+=T:1===Math.abs(_-T)&&(_-=T)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,_,w),h.neighboringTiles&&h.neighboringTiles[D]&&(h.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,h){for(const g in this._tiles){let _=this._tiles[g];if(h[g]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>s)continue;let w=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const D=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[D.key],_&&_.hasData()&&(w=D)}let T=w;for(;T.overscaledZ>n;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){h[w.key]=w;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const h=e.scaledTo(s),g=this._getLoadedTile(h);if(g)return g}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,h=Math.ceil(e.height/n)+1,g=Math.floor(s*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(w)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),s[g.tileID.key]=g}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new ra(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(h=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(w=>this._source.hasTile(w)))):h=[];const g=this._updateRetainedTiles(h);if(Q_(this._source.type)&&0!==h.length){const w={},T={},D=Object.keys(g);for(const O of D){const B=g[O],V=this._tiles[O];if(!V||V.fadeEndTime&&V.fadeEndTime<=xr.now())continue;const $=this.findLoadedParent(B,Math.max(B.overscaledZ-Sc.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),w[$.tileID.key]=$.tileID),T[O]=B}const P=h[h.length-1].overscaledZ;for(const O in this._tiles){const B=this._tiles[O];if(g[O]||!B.hasData())continue;let V=B.tileID;for(;V.overscaledZ>P;){V=V.scaledTo(V.overscaledZ-1);const $=this._tiles[V.key];if($&&$.hasData()&&T[V.key]){g[O]=B.tileID;break}}}for(const O in w)g[O]||(this._coveredTiles[O]=!0,g[O]=w[O])}for(const w in g)this._tiles[w].clearFadeHold();const _=function(w,T){const D=[];for(const P in w)P in T||D.push(P);return D}(this._tiles,g);for(const w of _){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},h=e.reduce((D,P)=>Math.min(D,P.overscaledZ),1/0),g=e[0].overscaledZ,_=Math.max(g-Sc.maxOverzooming,this._source.minzoom),w=Math.max(g+Sc.maxUnderzooming,this._source.minzoom),T={};for(const D of e){const P=this._addTile(D);n[D.key]=D,P.hasData()||h<this._source.maxzoom&&(T[D.key]=D)}this._retainLoadedChildren(T,h,w,n);for(const D of e){let P=this._tiles[D.key];if(P.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const B=D.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){n[B.key]=B;continue}}else{const B=D.children(this._source.maxzoom);if(n[B[0].key]&&n[B[1].key]&&n[B[2].key]&&n[B[3].key])continue}let O=P.wasRequested();for(let B=D.overscaledZ-1;B>=_;--B){const V=D.scaledTo(B);if(s[V.key]||(s[V.key]=!0,P=this.getTile(V),!P&&O&&(P=this._addTile(V)),P&&(n[V.key]=V,O=P.wasRequested(),P.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}n.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(g),s)break;h=g}for(const g of n)this._loadedParentTiles[g]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const h=this.map?this.map.painter:null;n=new Yd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new kr("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const h=[],g=this.transform;if(!g)return h;const _="globe"===g.projection.name,w=Cl(g.center.lng);for(const T in this._tiles){const D=this._tiles[T];if(s&&D.clearQueryDebugViz(),D.holdingForFade())continue;let P;if(_){const O=D.tileID.canonical;if(0===O.z){const B=[Math.abs(Bt(w,...rd(O,-1))-w),Math.abs(Bt(w,...rd(O,1))-w)];P=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(Bt(w,...rd(O,-1))-w),Math.abs(Bt(w,...rd(O,0))-w),Math.abs(Bt(w,...rd(O,1))-w)];P=[B.indexOf(Math.min(...B))-1]}}else P=[0];for(const O of P){const B=e.containsTile(D,g,n,O);B&&h.push(B)}}return h}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Q_(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=xr.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const h=this._tiles[e];h&&h.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){const s=new Map,h=Array.isArray(e)?e:[e],g=this.map.painter.terrain,_=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const w of h){const T=w.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of T)s.set(D.key,D);this.usedForTerrain&&w.updateElevation(!1)}Vt(Array.from(s.values()),(w,T)=>{const D=new Yd(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,P=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),T(P,D)})},n)}}function J_(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Q_(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function rd(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Sc.maxOverzooming=10,Sc.maxUnderzooming=3;class tf{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const h=s||e.findDEMTileFor(n);if(!h||!h.dem)return;const g=h.dem,_=h.tileID,w=1<<n.canonical.z-_.canonical.z;return new tf(h,h.tileSize/er/w,[(n.canonical.x/w-_.canonical.x)*g.dim,(n.canonical.y/w-_.canonical.y)*g.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),g=Math.floor(s);return new st(h,g)}getElevationAt(e,n,s,h){const g=e*this._scale+this._offset[0],_=n*this._scale+this._offset[1],w=Math.floor(g),T=Math.floor(_),D=this._dem;return h=!!h,s?Qn(Qn(D.get(w,T,h),D.get(w,T+1,h),_-T),Qn(D.get(w+1,T,h),D.get(w+1,T+1,h),_-T),g-w):D.get(w,T,h)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ml(1,e)*this._dem.stride}}class Bp{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new yl(er,16,0),this.featureIndexArray=new Zs,this.promoteId=n}insert(e,n,s,h,g,_=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,g,_);const T=this.grid;for(let D=0;D<n.length;D++){const P=n[D],O=[1/0,1/0,-1/0,-1/0];for(let B=0;B<P.length;B++){const V=P[B];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<er&&O[1]<er&&O[2]>=0&&O[3]>=0&&T.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ad(new Ju(this.rawTileData)).layers,this.sourceLayerCoder=new Dp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,h){this.loadVTLayers();const g=e.params||{},_=Ca(g.filter),w=e.tileResult,T=e.transform,D=w.bufferedTilespaceBounds,P=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,($,J,ue,xe)=>kh(w.bufferedTilespaceGeometry,$,J,ue,xe));P.sort(xs);let O=null;T.elevation&&P.length>0&&(O=tf.create(T.elevation,this.tileID));const B={};let V;for(let $=0;$<P.length;$++){const J=P[$];if(J===V)continue;V=J;const ue=this.featureIndexArray.get(J);let xe=null;this.loadMatchingFeature(B,ue,_,g.layers,g.availableImages,n,s,h,(Me,ve,Ce,ke=0)=>(xe||(xe=Gl(Me,this.tileID.canonical,e.tileTransform)),ve.queryIntersectsFeature(w,Me,Ce,xe,this.z,e.transform,e.pixelPosMatrix,O,ke)))}return B}loadMatchingFeature(e,n,s,h,g,_,w,T,D){const{featureIndex:P,bucketIndex:O,sourceLayerIndex:B,layoutVertexArrayOffset:V}=n,$=this.bucketLayerIDs[O];if(h&&!function(Me,ve){for(let Ce=0;Ce<Me.length;Ce++)if(ve.indexOf(Me[Ce])>=0)return!0;return!1}(h,$))return;const J=this.sourceLayerCoder.decode(B),ue=this.vtLayers[J].feature(P);if(s.needGeometry){const Me=Wc(ue,!0);if(!s.filter(new He(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!s.filter(new He(this.tileID.overscaledZ),ue))return;const xe=this.getId(ue,J);for(let Me=0;Me<$.length;Me++){const ve=$[Me];if(h&&h.indexOf(ve)<0)continue;const Ce=_[ve];if(!Ce)continue;let ke={};void 0!==xe&&T&&(ke=T.getState(Ce.sourceLayer||"_geojsonTileLayer",xe));const Pe=rt({},w[ve]);Pe.paint=xg(Pe.paint,Ce.paint,ue,ke,g),Pe.layout=xg(Pe.layout,Ce.layout,ue,ke,g);const Xe=!D||D(ue,Ce,ke,V);if(!Xe)continue;const qe=new Sp(ue,this.z,this.x,this.y,xe);qe.layer=Pe;let vt=e[ve];void 0===vt&&(vt=e[ve]=[]),vt.push({featureIndex:P,feature:qe,intersectionZ:Xe})}}lookupSymbolFeatures(e,n,s,h,g,_,w,T){const D={};this.loadVTLayers();const P=Ca(g);for(const O of e)this.loadMatchingFeature(D,{bucketIndex:s,sourceLayerIndex:h,featureIndex:O,layoutVertexArrayOffset:0},P,_,w,T,n);return D}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),g=this.vtFeatures[h];if(g[n])return g[n];const _=this.vtLayers[h].feature(n);return g[n]=_,_}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=h&&(s=e.properties[h]),"boolean"==typeof s&&(s=Number(s))}return s}}function xg(t,e,n,s,h){return bn(t,(g,_)=>{const w=e instanceof Ke?e.get(_):null;return w&&w.evaluate?w.evaluate(n,s,h):w})}function xs(t,e){return e-t}fn(Bp,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Np{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new _c({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=qt(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const h=[];let g=e.length%2==1?-e[e.length-1]*s:0,_=e[0]*s,w=!0;h.push({left:g,right:_,isDash:w,zeroLength:0===e[0]});let T=e[0];for(let D=1;D<e.length;D++){w=!w;const P=e[D];g=T*s,T+=P,_=T*s,h.push({left:g,right:_,isDash:w,zeroLength:0===P})}return h}addRoundDash(e,n,s){const h=n/2;for(let g=-s;g<=s;g++){const _=this.width*(this.nextRow+s+g);let w=0,T=e[w];for(let D=0;D<this.width;D++){D/T.right>1&&(T=e[++w]);const P=Math.abs(D-T.left),O=Math.abs(D-T.right),B=Math.min(P,O);let V;const $=g/s*(h+1);if(T.isDash){const J=h-Math.abs($);V=Math.sqrt(B*B+J*J)}else V=h-Math.sqrt(B*B+$*$);this.image.data[_+D]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e,n){for(let T=e.length-1;T>=0;--T){const D=e[T],P=e[T+1];D.zeroLength?e.splice(T,1):P&&P.isDash===D.isDash&&(P.left=D.left,e.splice(T,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const g=this.width*this.nextRow;let _=0,w=e[_];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++_]);const D=Math.abs(T-w.left),P=Math.abs(T-w.right),O=Math.min(D,P);this.image.data[g+T]=Math.max(0,Math.min(255,(w.isDash?O:-O)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const h="round"===n,g=h?7:0,_=2*g+1;if(this.nextRow+_>this.height)return ir("LineAtlas out of space"),null;0===e.length&&e.push(1);let w=0;for(let P=0;P<e.length;P++)e[P]<0&&(ir("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),w+=e[P];if(0!==w){const P=this.width/w,O=this.getDashRanges(e,this.width,P);h?this.addRoundDash(O,P,g):this.addRegularDash(O,"square"===n?.5*P:0)}const T=this.nextRow+g;this.nextRow+=_;const D={tl:[T,g],br:[w,0]};return this.positions[s]=D,D}}fn(Np,"LineAtlas");class wg{constructor(e){const n={},s=[];for(const w in e){const T=e[w],D=n[w]={};for(const P in T.glyphs){const O=T.glyphs[+P];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const B=O.metrics.localGlyph?2:1,V={x:0,y:0,w:O.bitmap.width+2*B,h:O.bitmap.height+2*B};s.push(V),D[P]=V}}const{w:h,h:g}=sp(s),_=new _c({width:h||1,height:g||1});for(const w in e){const T=e[w];for(const D in T.glyphs){const P=T.glyphs[+D];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const O=n[w][D],B=P.metrics.localGlyph?2:1;_c.copy(P.bitmap,_,{x:0,y:0},{x:O.x+B,y:O.y+B},P.bitmap)}}this.image=_,this.positions=n}}fn(wg,"GlyphAtlas");class ey{constructor(e){this.tileID=new ra(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=bu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,h,g){this.status="parsing",this.data=e,this.collisionBoxArray=new cf;const _=new Dp(Object.keys(e.layers).sort()),w=new Bp(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},D=new Np(256,256),P={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:s},O=n.familiesBySource[this.source];for(const ke in O){const Pe=e.layers[ke];if(!Pe)continue;let Xe=!1,qe=!1;for(const it of O[ke])"symbol"===it[0].type?Xe=!0:qe=!0;if(!0===this.isSymbolTile&&!Xe||!1===this.isSymbolTile&&!qe)continue;1===Pe.version&&ir(`Vector tile source "${this.source}" layer "${ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const vt=_.encode(ke),Nt=[];for(let it=0;it<Pe.length;it++){const bt=Pe.feature(it),Tt=w.getId(bt,ke);Nt.push({feature:bt,id:Tt,index:it,sourceLayerIndex:vt})}for(const it of O[ke]){const bt=it[0];void 0!==this.isSymbolTile&&"symbol"===bt.type!==this.isSymbolTile||bt.minzoom&&this.zoom<Math.floor(bt.minzoom)||bt.maxzoom&&this.zoom>=bt.maxzoom||"none"!==bt.visibility&&(nf(it,this.zoom,s),(T[bt.id]=bt.createBucket({index:w.bucketLayerIDs.length,layers:it,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Nt,P,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(it.map(Tt=>Tt.id)))}}let B,V,$,J;D.trim();const ue={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xe=bn(P.glyphDependencies,ke=>Object.keys(ke).map(Number));Object.keys(xe).length?h.send("getGlyphs",{uid:this.uid,stacks:xe},(ke,Pe)=>{B||(B=ke,V=Pe,Ce.call(this))},void 0,!1,ue):V={};const Me=Object.keys(P.iconDependencies);Me.length?h.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"icons"},(ke,Pe)=>{B||(B=ke,$=Pe,Ce.call(this))},void 0,!1,ue):$={};const ve=Object.keys(P.patternDependencies);function Ce(){if(B)return g(B);if(V&&$&&J){const ke=new wg(V),Pe=new ng($,J);for(const Xe in T){const qe=T[Xe];qe instanceof Jc?(nf(qe.layers,this.zoom,s),W_(qe,V,ke.positions,$,Pe.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):qe.hasPattern&&(qe instanceof vc||qe instanceof Id||qe instanceof Pd)&&(nf(qe.layers,this.zoom,s),qe.addFeatures(P,this.tileID.canonical,Pe.patternPositions,s,this.tileTransform))}this.status="done",g(null,{buckets:at(T).filter(Xe=>!Xe.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ke.image,lineAtlas:D,imageAtlas:Pe,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?$:null,glyphPositions:this.returnDependencies?ke.positions:null})}}ve.length?h.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(ke,Pe)=>{B||(B=ke,J=Pe,Ce.call(this))},void 0,!1,ue):J={},Ce.call(this)}}function nf(t,e,n){const s=new He(e);for(const h of t)h.recalculate(s,n)}class bg{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,h){const g=this.entries[e]=this.entries[e]||{callbacks:[]};if(g.result){const[_,w]=g.result;return this.scheduler?this.scheduler.add(()=>{h(_,w)},n):h(_,w),()=>{}}return g.callbacks.push(h),g.cancel||(g.cancel=s((_,w)=>{g.result=[_,w];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(_,w)},n):T(_,w);setTimeout(()=>delete this.entries[e],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(_=>_!==h),g.callbacks.length||(g.cancel(),delete this.entries[e]))}}}function Up(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},h=>{const g=Ai(t.request,(_,w,T,D)=>{_?h(_):w&&h(null,{vectorTile:n?void 0:new Ad(new Ju(w)),rawData:w,cacheControl:T,expires:D})});return()=>{g.cancel(),h()}},e)}u.ARRAY_TYPE=ga,u.AUTH_ERR_MSG=vr,u.Aabb=_a,u.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},fr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ni()?t:Ie,this.scheduler=new Tp}send(t,e,n,s,h=!1,g){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=g,this.callbacks[_]=n);const w=ri(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:t,hasCallback:!!n,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:vl(e,w)},w),{cancel:()=>{n&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||ni()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n($a(e.error)):n(null,$a(e.data)))}else{const n=ri(this.globalScope)?void 0:[],s=e.hasCallback?(g,_)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?vl(g):null,data:vl(_,n)},n)}:g=>{},h=$a(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,s);else if(this.parent.getWorkerSource){const g=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,g[0],h.source)[g[1]](h,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=kd,u.Color=Hr,u.ColorMode=hl,u.CullFaceMode=Rl,u.DEMData=td,u.DataConstantProperty=Ge,u.DedupedRequest=bg,u.DepthMode=Ya,u.EXTENT=er,u.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,h=Math.floor(t.x),g=Math.floor((t.x-h)*s),_=Math.floor(t.y*s),w=this.findDEMTileFor(new ra(n,h,n,g,_));return!(!w||!w.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const h=s.getSource().maxzoom,g=1<<h,_=Math.floor(t.x),w=t.x-_,T=new ra(h,_,h,Math.floor(w*g),Math.floor(t.y*g)),D=this.findDEMTileFor(T);if(!D||!D.dem)return e;const P=D.dem,O=1<<D.tileID.canonical.z,B=(w*O-D.tileID.canonical.x)*P.dim,V=(t.y*O-D.tileID.canonical.y)*P.dim,$=Math.floor(B),J=Math.floor(V);return(n?this.exaggeration():1)*Qn(Qn(P.get($,J),P.get($,J+1),V-J),Qn(P.get($+1,J),P.get($+1,J+1),V-J),B-$)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Ih(t.wrap+(t.canonical.x+e/er)/s,(t.canonical.y+n/er)/s))}getAtTileOffsetFunc(t,e,n,s){return h=>{const g=this.getAtTileOffset(t,h.x,h.y),_=s.upVector(t.canonical,h.x,h.y);return Pa(_,_,g*s.upVectorScale(t.canonical,e,n).metersToTile),_}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const h=tf.create(this,t,s);return!!h&&(e.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,h=1<<t.canonical.z-s.canonical.z;let g=t.canonical.x/h-s.canonical.x,_=t.canonical.y/h-s.canonical.y,w=0;for(let T=0;T<t.canonical.z-s.canonical.z&&!n.leaves[w];T++){g*=2,_*=2;const D=2*Math.floor(_)+Math.floor(g);w=n.childOffsets[w]+D,g%=1,_%=1}return{min:this.exaggeration()*n.minimums[w],max:this.exaggeration()*n.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=fo,u.EvaluationParameters=He,u.Event=kr,u.Evented=yo,u.FillExtrusionBucket=Pd,u.Frustum=bf,u.FrustumCorners=fu,u.GLOBE_RADIUS=pc,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=6,u.GLOBE_ZOOM_THRESHOLD_MIN=5,u.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const n=new Nn,s=new gs,h=[],g=t+1+2,_=e[0]+1,w=e[0]+1+(1+e.length),T=(D,P,O)=>{let B=D===g-1?D-2:0===D?D:D-1;return B+=O?24575:0,[B,P]};for(let D=0;D<g;++D)n.emplaceBack(...T(D,0,!0));for(let D=0;D<_;++D)for(let P=0;P<g;++P)n.emplaceBack(...T(P,D,(0===P||P===g-1)&&!0));for(let D=0;D<e.length;++D){const P=e[D];for(let O=0;O<g;++O)n.emplaceBack(...T(O,P,!0))}for(let D=0;D<e.length;++D){const P=s.length,O=e[D]+1+2,B=new gs;for(let J=0;J<O-1;J++){const ue=J===O-2,xe=ue?g*(w-e.length+D-J):g;for(let Me=0;Me<g-1;Me++){const ve=J*g+Me;0===J||ue||0===Me||Me===g-2?(B.emplaceBack(ve+1,ve,ve+xe),B.emplaceBack(ve+xe,ve+xe+1,ve+1)):(s.emplaceBack(ve+1,ve,ve+xe),s.emplaceBack(ve+xe,ve+xe+1,ve+1))}}const V=mo.simpleSegment(0,P,n.length,s.length-P);for(let J=0;J<B.uint16.length;J+=3)s.emplaceBack(B.uint16[J],B.uint16[J+1],B.uint16[J+2]);const $=mo.simpleSegment(0,P,n.length,s.length-P);h.push({withoutSkirts:V,withSkirts:$})}return{vertices:n,indices:s,segments:h}}_createGrid(t){const e=this._fillGridMeshWithLods(64,md);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Th.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new gs;for(let h=0;h<=64;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Ma,s=new Ma;this._poleSegments=[];for(let h=0,g=0;h<5;h++){const _=360/(1<<h);n.emplaceBack(0,-pc,0,.5,0),s.emplaceBack(0,-pc,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,D=Qn(0,_,T),[P,O,B]=Ch(Yg,Mf,D,pc);n.emplaceBack(P,O,B,T,0),s.emplaceBack(P,O,B,T,1)}this._poleSegments.push(mo.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,_m,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,_m,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new bl,s=64,h=s+1+2,g=1;this._wireframeSegments=[];for(let _=0,w=0;_<md.length;_++){const T=md[_];for(let P=g;P<T+g;P++)for(let O=g;O<s+g;O++){const B=P*h+O;n.emplaceBack(B,B+1),n.emplaceBack(B,B+h),n.emplaceBack(B,B+h+1)}const D=T*s*3;this._wireframeSegments.push(mo.simpleSegment(0,w,(T+1)*h,D)),w+=D}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},u.GlyphManager=nh,u.ImagePosition=Bd,u.LivePerformanceUtils=Ue,u.LngLat=Ur,u.LngLatBounds=Ia,u.LocalGlyphMode=ag,u.MAX_MERCATOR_LATITUDE=ys,u.MercatorCoordinate=Ih,u.ONE_EM=vs,u.OverscaledTileID=ra,u.PerformanceMarkers=pe,u.Properties=zt,u.RGBAImage=zs,u.Ray=$l,u.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ln,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ro(t))return t;const n=Le(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ro(t))return t;const n=Le(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!ro(t))return t;const h=Le(t);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),n&&h.params.push(`language=${n}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const h=Le(t);return ro(t)?(h.path=`/styles/v1${h.path}/sprite${e}${n}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${e}${n}`,$t(h))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ro(t))return t;const s=Le(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${xt.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${wt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${wt.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(g){for(const _ of g){const w=_.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(s.params)||wt.ACCESS_TOKEN;return wt.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(t,e){const n=Le(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${wt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${wt.TILE_URL_VERSION}/`,"")}`;let h=n.params;return e&&(h=h.filter(g=>!g.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&ro(e),s=[];for(const h of t.tiles||[])Vi(h)?s.push(this.canonicalizeTileURL(h,n)):s.push(h);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Le(wt.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const h=t.params.indexOf("secure");h>=0&&t.params.splice(h,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!wt.REQUIRE_ACCESS_TOKEN)return $t(t);if(e=e||wt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(h=>-1===h.indexOf("access_token")),t.params.push(`access_token=${e||""}`),$t(t)}},u.ResourceType=xn,u.SegmentVector=mo,u.SourceCache=Sc,u.StencilMode=zp,u.StructArrayLayout1ui2=al,u.StructArrayLayout2f1f2i16=ps,u.StructArrayLayout2i4=Nn,u.StructArrayLayout2ui4=bl,u.StructArrayLayout3f12=ms,u.StructArrayLayout3ui6=gs,u.StructArrayLayout4i8=fi,u.StructArrayLayout5f20=Ma,u.Texture=Mu,u.Tile=Yd,u.Transitionable=Ht,u.Uniform1f=Bc,u.Uniform1i=class extends uc{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},u.Uniform2f=class extends uc{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},u.Uniform3f=class extends uc{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},u.Uniform4f=cm,u.UniformColor=um,u.UniformMatrix2f=class extends uc{constructor(t){super(t),this.current=hm}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},u.UniformMatrix3f=class extends uc{constructor(t){super(t),this.current=pf}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},u.UniformMatrix4f=class extends uc{constructor(t){super(t),this.current=ff}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},u.UnwrappedTileID=Hm,u.ValidationError=mt,u.VectorTileFeature=Bh,u.VectorTileWorkerSource=class extends yo{constructor(t,e,n,s,h){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=h||Up,this.loading={},this.loaded={},this.deduped=new bg(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,h=s&&s.collectResourceTiming,g=this.loading[n]=new ey(t);g.abort=this.loadVectorData(t,(_,w)=>{const T=!this.loading[n];if(delete this.loading[n],T||_||!w)return g.status="done",T||(this.loaded[n]=g),e(_);const D=w.rawData,P={};w.expires&&(P.expires=w.expires),w.cacheControl&&(P.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new Ad(new Ju(D));const O=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,V)=>{if(B||!V)return e(B);const $={};if(h){const J=en(s);J.length>0&&($.resourceTiming=JSON.parse(JSON.stringify(J)))}e(null,rt({rawTileData:D.slice(0)},V,P,$))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[n]=g})}reloadTile(t,e){const n=this.loaded,s=t.uid,h=this;if(n&&n[s]){const g=n[s];g.showCollisionBoxes=t.showCollisionBoxes,g.enableTerrain=!!t.enableTerrain,g.projection=t.projection,g.tileTransform=bu(t.tileID.canonical,t.projection);const _=(w,T)=>{const D=g.reloadCallback;D&&(delete g.reloadCallback,g.parse(g.vectorTile,h.layerIndex,this.availableImages,h.actor,D)),e(w,T)};"parsing"===g.status?g.reloadCallback=_:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},u.WritingMode=Xa,u.ZoomDependentExpression=$e,u.add=dc,u.addDynamicAttributes=Jh,u.adjoint=function(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=e[4],w=e[5],T=e[6],D=e[7],P=e[8];return t[0]=_*P-w*D,t[1]=h*D-s*P,t[2]=s*w-h*_,t[3]=w*T-g*P,t[4]=n*P-h*T,t[5]=h*g-n*w,t[6]=g*D-_*T,t[7]=s*T-n*D,t[8]=n*_-s*g,t},u.asyncAll=Vt,u.bezier=nn,u.bindAll=fr,u.boundsAttributes=Ip,u.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const h=rr(s-1,-1,t.length-1),g=rr(s+1,-1,t.length-1),_=t[s],w=t[g],T=t[h].sub(_).unit(),D=w.sub(_).unit(),P=D.angleWithSep(T.x,T.y),O=T.add(D).unit().mult(-1*e/Math.sin(P/2));n.push(_.add(O))}return n},u.cacheEntryPossiblyAdded=function(t){zr++,zr>Bo&&(t.getActor().send("enforceCacheSizeLimit",Fr),zr=0)},u.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:s}=t.point,h=bm(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Vc(h,h,Sf(Os(e)))},u.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:s,lat:h}=t._center;return bm(e,n,t.worldSize,s,h)},u.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/Ml(1,t.center.lat),s=Aa(new Float64Array(16));return Bu(s,s,[t.point.x,t.point.y,0]),$c(s,s,[n,n,e]),Float32Array.from(s)},u.circumferenceAtLatitude=If,u.clamp=Bt,u.clearTileCache=function(t){if(!Ii())return;const e=Ie.caches.delete(sr);t&&e.catch(t).then(()=>t())},u.clipLine=og,u.clone=function(t){var e=new ga(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.clone$1=Qt,u.collisionCircleLayout=Fd,u.config=wt,u.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},u.create=function(){var t=new ga(16);return ga!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},u.create$1=fm,u.createExpression=G,u.createLayout=kn,u.createStyleLayer=function(t){return"custom"===t.type?new Xd(t):new Y_[t.type](t)},u.cross=Gc,u.degToRad=Ne,u.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},u.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},u.dot=Ra,u.earthRadius=Mh,u.ease=Yt,u.easeCubicInOut=_n,u.ecefToLatLng=function([t,e,n]){const s=Math.hypot(t,e,n),h=Math.atan2(t,n),g=.5*Math.PI-Math.acos(-e/s);return new Ur(pt(h),pt(g))},u.emitValidationErrors=Rs,u.endsWith=mr,u.enforceCacheSizeLimit=function(t){In(),vi&&vi.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},u.evaluateSizeForFeature=Yu,u.evaluateSizeForZoom=wu,u.evaluateVariableOffset=hg,u.evented=De,u.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},u.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},u.exported=xr,u.exported$1=xt,u.extend=rt,u.extend$1=io,u.fillExtrusionHeightLift=Gm,u.filterObject=yn,u.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},u.fromQuat=function(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=n+n,w=s+s,T=h+h,D=n*_,P=s*_,O=s*w,B=h*_,V=h*w,$=h*T,J=g*_,ue=g*w,xe=g*T;return t[0]=1-O-$,t[1]=P+xe,t[2]=B-ue,t[3]=0,t[4]=P-xe,t[5]=1-D-$,t[6]=V+J,t[7]=0,t[8]=B+ue,t[9]=V-J,t[10]=1-D-O,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},u.fromScaling=yh,u.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return sn[e]},u.getAABBPointSquareDist=function(t,e,n){let s=0;for(let h=0;h<2;++h){const g=n?n[h]:0;t[h]>g&&(s+=(t[h]-g)*(t[h]-g)),e[h]<g&&(s+=(g-e[h])*(g-e[h]))}return s},u.getAnchorAlignment=$d,u.getAnchorJustification=pp,u.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,h=-1/0;for(const g of t)e=Math.min(e,g.x),n=Math.min(n,g.y),s=Math.max(s,g.x),h=Math.max(h,g.y);return{min:new st(e,n),max:new st(s,h)}},u.getColumn=vn,u.getGridMatrix=function(t,e,n,s){const h=e.getNorth(),g=e.getSouth(),_=e.getWest(),w=e.getEast(),T=1<<t.z,D=w-_,P=h-g,O=D/64,B=-P/md[n],V=[0,O,0,B,0,0,h,_,0];if(t.z>0){const $=180/s;Gg(V,V,[$/D+1,0,0,0,$/P+1,0,-.5*$/O,.5*$/B,1])}return V[2]=T,V[5]=t.x,V[8]=t.y,V},u.getImage=ho,u.getJSON=function(t,e){return yr(rt(t,{type:"json"}),e)},u.getLatitudinalLod=function(t){const e=ys-5;t=Bt(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Ne(t))),3);return Math.round(n*(md.length-1))},u.getMapSessionAPI=q,u.getPerformanceMeasurement=en,u.getProjection=yp,u.getRTLTextPluginStatus=Re,u.getReferrer=xi,u.getTilePoint=function(t,{x:e,y:n},s=0){return new st(((e-s)*t.scale-t.x)*er,(n*t.scale-t.y)*er)},u.getTileVec3=function(t,e,n=0){return Vl(((e.x-n)*t.scale-t.x)*er,(e.y*t.scale-t.y)*er,Tm(e.z,e.y))},u.getVideo=function(t,e){const n=Ie.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const h=Ie.document.createElement("source");no(t[s])||(n.crossOrigin="Anonymous"),h.src=t[s],n.appendChild(h)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=Aa(new Float64Array(16));return Vc(n,t.pixelMatrix,t.globeMatrix),go(e,e,n),new st(e[0],e[1])},u.globeDenormalizeECEF=Sf,u.globeECEFOrigin=function(t,e){const n=[0,0,0];return go(n,n,ju(Os(e.canonical))),go(n,n,t),n},u.globeMetersToEcef=gd,u.globeNormalizeECEF=ju,u.globePixelsToTileUnits=function(t,e){return er/(512*Math.pow(2,t))*Cf(Os(e))},u.globePoleMatrixForTile=function(t,e,n){const s=Aa(new Float64Array(16)),h=(e/(1<<t)-.5)*Math.PI*2;return _h(s,n.globeMatrix,h),Float32Array.from(s)},u.globeTileBounds=Os,u.globeTiltAtLngLat=Em,u.globeToMercatorTransition=Vu,u.globeUseCustomAntiAliasing=function(t,e,n){const s=Vu(n.zoom),h=t.style.map._antialias,g=!!e.extStandardDerivatives,_=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!h&&!_&&g},u.identity=Aa,u.identity$1=vf,u.invert=mf,u.isFullscreen=function(){return!!Ie.document.fullscreenElement||!!Ie.document.webkitFullscreenElement},u.isLngLatBehindGlobe=_d,u.isMapAuthenticated=function(t){return re.has(t)},u.isMapboxURL=ro,u.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!ri(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=Fs,u.latLngToECEF=Hc,u.len=Hg,u.length=du,u.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},u.lngFromMercatorX=qa,u.loadVectorTile=Up,u.makeRequest=yr,u.mapValue=function(t,e,n,s,h){return Bt((t-e)/(n-e)*(h-s)+s,s,h)},u.mercatorScale=Jg,u.mercatorXfromLng=Cl,u.mercatorYfromLat=Sl,u.mercatorZfromAltitude=Ml,u.mul=pm,u.mul$1=gf,u.multiply=Vc,u.multiply$1=Gg,u.multiply$2=mm,u.nextPowerOfTwo=qt,u.normalize=_s,u.normalize$1=Wg,u.normalize$2=Eh,u.number=Qn,u.ortho=function(t,e,n,s,h,g,_){var w=1/(e-n),T=1/(s-h),D=1/(g-_);return t[0]=-2*w,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*T,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*D,t[11]=0,t[12]=(e+n)*w,t[13]=(h+s)*T,t[14]=(_+g)*D,t[15]=1,t},u.pbf=Ju,u.perspective=function(t,e,n,s,h){var g,_=1/Math.tan(e/2);return t[0]=_/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=h&&h!==1/0?(t[10]=(h+s)*(g=1/(s-h)),t[14]=2*h*s*g):(t[10]=-1,t[14]=-2*s),t},u.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const h=e[s];h in t&&(n[h]=t[h])}return n},u.plugin=Be,u.pointGeometry=st,u.polesInViewport=function(t){const e=Aa(new Float64Array(16));Vc(e,t.pixelMatrix,t.globeMatrix);const n=[0,Tl,0],s=[0,Wa,0];return go(n,n,e),go(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!_d(t,new Ur(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!_d(t,new Ur(t.center.lat,-90))]},u.polygonContainsPoint=gc,u.polygonIntersectsBox=kh,u.polygonIntersectsPolygon=Sm,u.polygonizeBounds=function(t,e,n=0,s=!0){const h=new st(n,n),g=t.sub(h),_=e.add(h),w=[g,new st(_.x,g.y),_,new st(g.x,_.y)];return s&&w.push(g.clone()),w},u.posAttributes=Th,u.postMapLoadEvent=fe,u.postPerformanceEvent=se,u.postTurnstileEvent=H,u.potpack=sp,u.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},u.radToDeg=pt,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(t){return t({pluginStatus:me,pluginURL:te}),De.on("pluginStateChange",t),t},u.removeAuthState=function(t){re.delete(t)},u.renderColorRamp=qc,u.resample=yd,u.rotateX=gh,u.rotateX$1=xf,u.rotateY=_h,u.rotateY$1=wf,u.rotateZ=function(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[0],_=e[1],w=e[2],T=e[3],D=e[4],P=e[5],O=e[6],B=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*h+D*s,t[1]=_*h+P*s,t[2]=w*h+O*s,t[3]=T*h+B*s,t[4]=D*h-g*s,t[5]=P*h-_*s,t[6]=O*h-w*s,t[7]=B*h-T*s,t},u.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],_=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T+h*w,t[1]=h*T-s*w,t[2]=g*T+_*w,t[3]=_*T-g*w,t},u.scale=$c,u.scale$1=_f,u.scale$2=Pa,u.scaleAndAdd=Nu,u.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},u.setCacheLimits=function(t,e){Fr=t,Bo=e},u.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},u.setRTLTextPlugin=function(t,e,n=!1){if(me===Y||me===oe||me===ce)throw new Error("setRTLTextPlugin cannot be called multiple times.");te=xr.resolveURL(t),me=Y,de=e,ye(),n||Ae()},u.smoothstep=un,u.spec=ht,u.squaredLength=function(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s},u.storeAuthState=function(t,e){e?re.add(t):re.delete(t)},u.sub=El,u.subtract=fd,u.symbolSize=ep,u.tileAABB=function(t,e,n,s,h,g,_,w,T){if("globe"===T.name)return function xm(t,e,n){const s=e/t.worldSize,h=t.globeMatrix;if(n.z<=1){const qe=Os(n).getCorners();return Tf(qe,h,s),_a.fromPoints(qe)}const g=Df(n),_=wm(g);Tf(_,h,s);const w=Number.MAX_VALUE,T=[-w,-w,-w],D=[w,w,w];if(g.contains(t.center)){for(const Nt of _)wh(D,D,Nt),bh(T,T,Nt);T[2]=0;const qe=t.point,vt=[qe.x*s,qe.y*s,0];return wh(D,D,vt),bh(T,T,vt),new _a(D,T)}const P=[h[12]*s,h[13]*s,h[14]*s],O=g.getCenter(),B=Bt(t.center.lat,-ys,ys),V=Bt(O.lat,-ys,ys),$=Cl(t.center.lng),J=Sl(B);let ue=$-Cl(O.lng);const xe=J-Sl(V);ue>.5?ue-=1:ue<-.5&&(ue+=1);let Me=0;Math.abs(ue)>Math.abs(xe)?Me=ue>=0?1:3:(Me=xe>=0?0:2,Nu(P,P,[h[4]*s,h[5]*s,h[6]*s],-Math.sin(Ne(xe>=0?g.getSouth():g.getNorth()))*pc));const ve=_[Me],Ce=_[(Me+1)%4],ke=new Xg(ve,Ce,P),Pe=[Dh(ke,0)||ve[0],Dh(ke,1)||ve[1],Dh(ke,2)||ve[2]],Xe=Vu(t.zoom);if(Xe>0){const qe=function({x:Nt,y:it,z:bt},Tt,Ot,Ut,lt){const tn=1/(1<<bt);let Un=Nt*tn,cn=Un+tn,Cn=it*tn,rn=Cn+tn,qn=0;const Ir=(Un+cn)/2-Ut;return Ir>.5?qn=-1:Ir<-.5&&(qn=1),Un=((Un+qn)*Tt-(Ut*=Tt))*Ot+Ut,cn=((cn+qn)*Tt-Ut)*Ot+Ut,Cn=(Cn*Tt-(lt*=Tt))*Ot+lt,rn=(rn*Tt-lt)*Ot+lt,[[Un,rn,0],[cn,rn,0],[cn,Cn,0],[Un,Cn,0]]}(n,e,t._pixelsPerMercatorPixel,$,J);for(let Nt=0;Nt<_.length;Nt++)Dl(_[Nt],qe[Nt],Xe);const vt=dc([],qe[Me],qe[(Me+1)%4]);Pa(vt,vt,.5),Dl(Pe,vt,Xe)}for(const qe of _)wh(D,D,qe),bh(T,T,qe);return D[2]=Math.min(ve[2],Ce[2]),wh(D,D,Pe),bh(T,T,Pe),new _a(D,T)}(t,e,new kd(n,s,h));const D=bu({z:n,x:s,y:h},T);return new _a([(g+D.x/D.scale)*e,e*(D.y/D.scale),_],[(g+D.x2/D.scale)*e,e*(D.y2/D.scale),w])},u.tileCornersToBounds=Df,u.tileTransform=bu,u.transformMat3=function(t,e,n){var s=e[0],h=e[1],g=e[2];return t[0]=s*n[0]+h*n[3]+g*n[6],t[1]=s*n[1]+h*n[4]+g*n[7],t[2]=s*n[2]+h*n[5]+g*n[8],t},u.transformMat4=go,u.transformMat4$1=fc,u.transformQuat=gm,u.transitionTileAABBinECEF=Ef,u.translate=Bu,u.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],h=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=h}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},u.triggerPluginCompletionEvent=be,u.uniqueId=At,u.updateGlobeVertexNormal=function(t,e,n,s,h){const g=5*e+2;t.float32[g+0]=n,t.float32[g+1]=s,t.float32[g+2]=h},u.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateFilter=t=>na(Fl(t)),u.validateFog=t=>na(tl(t)),u.validateLayer=t=>na(nu(t)),u.validateLight=t=>na(Ru(t)),u.validateSource=t=>na(zl(t)),u.validateStyle=Bl,u.validateTerrain=t=>na(Va(t)),u.values=at,u.vectorTile=Er,u.version=Xt,u.warnOnce=ir,u.window=Ie,u.wrap=rr}),ee(0,function(u){function Ie(he){if("number"==typeof he||"boolean"==typeof he||"string"==typeof he||null==he)return JSON.stringify(he);if(Array.isArray(he)){let K="[";for(const fe of he)K+=`${Ie(fe)},`;return`${K}]`}let H="{";for(const K of Object.keys(he).sort())H+=`${K}:${Ie(he[K])},`;return`${H}}`}function Xt(he){let H="";for(const K of u.refProperties)H+=`/${Ie(he[K])}`;return H}class St{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,K){for(const Ee of H)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=u.createStyleLayer(Ee)).compileFilter(),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of K)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const fe=function(Ee,se){const ie={};for(let re=0;re<Ee.length;re++){const pe=se&&se[Ee[re].id]||Xt(Ee[re]);se&&(se[Ee[re].id]=pe);let Ue=ie[pe];Ue||(Ue=ie[pe]=[]),Ue.push(Ee[re])}const q=[];for(const re in ie)q.push(ie[re]);return q}(u.values(this._layerConfigs),this.keyCache);for(const Ee of fe){const se=Ee.map(ft=>this._layers[ft.id]),ie=se[0];if("none"===ie.visibility)continue;const q=ie.source||"";let re=this.familiesBySource[q];re||(re=this.familiesBySource[q]={});const pe=ie.sourceLayer||"_geojsonTileLayer";let Ue=re[pe];Ue||(Ue=re[pe]=[]),Ue.push(se)}}}class wt{loadTile(H,K){const{uid:fe,encoding:Ee,rawImageData:se,padding:ie,buildQuadTree:q}=H,re=u.window.ImageBitmap&&se instanceof u.window.ImageBitmap?this.getImageData(se,ie):se;K(null,new u.DEMData(fe,re,Ee,ie<1,q))}getImageData(H,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const fe=this.offscreenCanvasContext.getImageData(-K,-K,H.width+2*K,H.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),fe}}var xt=function he(H,K){var fe,Ee=H&&H.type;if("FeatureCollection"===Ee)for(fe=0;fe<H.features.length;fe++)he(H.features[fe],K);else if("GeometryCollection"===Ee)for(fe=0;fe<H.geometries.length;fe++)he(H.geometries[fe],K);else if("Feature"===Ee)he(H.geometry,K);else if("Polygon"===Ee)nt(H.coordinates,K);else if("MultiPolygon"===Ee)for(fe=0;fe<H.coordinates.length;fe++)nt(H.coordinates[fe],K);return H};function nt(he,H){if(0!==he.length){yt(he[0],H);for(var K=1;K<he.length;K++)yt(he[K],!H)}}function yt(he,H){for(var K=0,fe=0,Ee=0,se=he.length,ie=se-1;Ee<se;ie=Ee++){var q=(he[Ee][0]-he[ie][0])*(he[ie][1]+he[Ee][1]),re=K+q;fe+=Math.abs(K)>=Math.abs(q)?K-re+q:q-re+K,K=re}K+fe>=0!=!!H&&he.reverse()}const Ct=u.VectorTileFeature.prototype.toGeoJSON;class jn{constructor(H){this._feature=H,this.extent=u.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(1===this._feature.type){const H=[];for(const K of this._feature.geometry)H.push([new u.pointGeometry(K[0],K[1])]);return H}{const H=[];for(const K of this._feature.geometry){const fe=[];for(const Ee of K)fe.push(new u.pointGeometry(Ee[0],Ee[1]));H.push(fe)}return H}}toGeoJSON(H,K,fe){return Ct.call(this,H,K,fe)}}class Kt{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=H.length,this._features=H}feature(H){return new jn(this._features[H])}}var ln={},jt={get exports(){return ln},set exports(he){ln=he}},Gn=u.pointGeometry,st=u.vectorTile.VectorTileFeature,Pn=Or;function Or(he,H){this.options=H||{},this.features=he,this.length=he.length}function Ye(he,H){this.id="number"==typeof he.id?he.id:void 0,this.type=he.type,this.rawGeometry=1===he.type?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=H||4096}Or.prototype.feature=function(he){return new Ye(this.features[he],this.options.extent)},Ye.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var H=0;H<he.length;H++){for(var K=he[H],fe=[],Ee=0;Ee<K.length;Ee++)fe.push(new Gn(K[Ee][0],K[Ee][1]));this.geometry.push(fe)}return this.geometry},Ye.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,H=1/0,K=-1/0,fe=1/0,Ee=-1/0,se=0;se<he.length;se++)for(var ie=he[se],q=0;q<ie.length;q++){var re=ie[q];H=Math.min(H,re.x),K=Math.max(K,re.x),fe=Math.min(fe,re.y),Ee=Math.max(Ee,re.y)}return[H,fe,K,Ee]},Ye.prototype.toGeoJSON=st.prototype.toGeoJSON;var Ne=u.pbf,pt=Pn;function sn(he){var H=new Ne;return function(K,fe){for(var Ee in K.layers)fe.writeMessage(3,_n,K.layers[Ee])}(he,H),H.finish()}function _n(he,H){var K;H.writeVarintField(15,he.version||1),H.writeStringField(1,he.name||""),H.writeVarintField(5,he.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<he.length;K++)fe.feature=he.feature(K),H.writeMessage(2,nn,fe);var Ee=fe.keys;for(K=0;K<Ee.length;K++)H.writeStringField(3,Ee[K]);var se=fe.values;for(K=0;K<se.length;K++)H.writeMessage(4,Vt,se[K])}function nn(he,H){var K=he.feature;void 0!==K.id&&H.writeVarintField(1,K.id),H.writeMessage(2,Yt,he),H.writeVarintField(3,K.type),H.writeMessage(4,rr,K)}function Yt(he,H){var K=he.feature,fe=he.keys,Ee=he.values,se=he.keycache,ie=he.valuecache;for(var q in K.properties){var re=K.properties[q],pe=se[q];if(null!==re){void 0===pe&&(fe.push(q),se[q]=pe=fe.length-1),H.writeVarint(pe);var Ue=typeof re;"string"!==Ue&&"boolean"!==Ue&&"number"!==Ue&&(re=JSON.stringify(re));var ft=Ue+":"+re,dt=ie[ft];void 0===dt&&(Ee.push(re),ie[ft]=dt=Ee.length-1),H.writeVarint(dt)}}}function Bt(he,H){return(H<<3)+(7&he)}function un(he){return he<<1^he>>31}function rr(he,H){for(var K=he.loadGeometry(),fe=he.type,Ee=0,se=0,ie=K.length,q=0;q<ie;q++){var re=K[q],pe=1;1===fe&&(pe=re.length),H.writeVarint(Bt(1,pe));for(var Ue=3===fe?re.length-1:re.length,ft=0;ft<Ue;ft++){1===ft&&1!==fe&&H.writeVarint(Bt(2,Ue-1));var dt=re[ft].x-Ee,en=re[ft].y-se;H.writeVarint(un(dt)),H.writeVarint(un(en)),Ee+=dt,se+=en}3===fe&&H.writeVarint(Bt(7,1))}}function Vt(he,H){var K=typeof he;"string"===K?H.writeStringField(1,he):"boolean"===K?H.writeBooleanField(7,he):"number"===K&&(he%1!=0?H.writeDoubleField(3,he):he<0?H.writeSVarintField(6,he):H.writeVarintField(5,he))}function at(he,H,K,fe,Ee,se){if(Ee-fe<=K)return;const ie=fe+Ee>>1;rt(he,H,ie,fe,Ee,se%2),at(he,H,K,fe,ie-1,se+1),at(he,H,K,ie+1,Ee,se+1)}function rt(he,H,K,fe,Ee,se){for(;Ee>fe;){if(Ee-fe>600){const pe=Ee-fe+1,Ue=K-fe+1,ft=Math.log(pe),dt=.5*Math.exp(2*ft/3),en=.5*Math.sqrt(ft*dt*(pe-dt)/pe)*(Ue-pe/2<0?-1:1);rt(he,H,K,Math.max(fe,Math.floor(K-Ue*dt/pe+en)),Math.min(Ee,Math.floor(K+(pe-Ue)*dt/pe+en)),se)}const ie=H[2*K+se];let q=fe,re=Ee;for(Mt(he,H,fe,K),H[2*Ee+se]>ie&&Mt(he,H,fe,Ee);q<re;){for(Mt(he,H,q,re),q++,re--;H[2*q+se]<ie;)q++;for(;H[2*re+se]>ie;)re--}H[2*fe+se]===ie?Mt(he,H,fe,re):(re++,Mt(he,H,re,Ee)),re<=K&&(fe=re+1),K<=re&&(Ee=re-1)}}function Mt(he,H,K,fe){At(he,K,fe),At(H,2*K,2*fe),At(H,2*K+1,2*fe+1)}function At(he,H,K){const fe=he[H];he[H]=he[K],he[K]=fe}function Wt(he,H,K,fe){const Ee=he-K,se=H-fe;return Ee*Ee+se*se}jt.exports=sn,ln.fromVectorTileJs=sn,ln.fromGeojsonVt=function(he,H){H=H||{};var K={};for(var fe in he)K[fe]=new pt(he[fe].features,H),K[fe].name=fe,K[fe].version=H.version,K[fe].extent=H.extent;return sn({layers:K})},ln.GeoJSONWrapper=pt;const qt=he=>he[0],Rn=he=>he[1];class fr{constructor(H,K=qt,fe=Rn,Ee=64,se=Float64Array){this.nodeSize=Ee,this.points=H;const ie=H.length<65536?Uint16Array:Uint32Array,q=this.ids=new ie(H.length),re=this.coords=new se(2*H.length);for(let pe=0;pe<H.length;pe++)q[pe]=pe,re[2*pe]=K(H[pe]),re[2*pe+1]=fe(H[pe]);at(q,re,Ee,0,q.length-1,0)}range(H,K,fe,Ee){return function(se,ie,q,re,pe,Ue,ft){const dt=[0,se.length-1,0],en=[];let hn,dn;for(;dt.length;){const an=dt.pop(),or=dt.pop(),xr=dt.pop();if(or-xr<=ft){for(let kr=xr;kr<=or;kr++)hn=ie[2*kr],dn=ie[2*kr+1],hn>=q&&hn<=pe&&dn>=re&&dn<=Ue&&en.push(se[kr]);continue}const Sn=Math.floor((xr+or)/2);hn=ie[2*Sn],dn=ie[2*Sn+1],hn>=q&&hn<=pe&&dn>=re&&dn<=Ue&&en.push(se[Sn]);const Cr=(an+1)%2;(0===an?q<=hn:re<=dn)&&(dt.push(xr),dt.push(Sn-1),dt.push(Cr)),(0===an?pe>=hn:Ue>=dn)&&(dt.push(Sn+1),dt.push(or),dt.push(Cr))}return en}(this.ids,this.coords,H,K,fe,Ee,this.nodeSize)}within(H,K,fe){return function(Ee,se,ie,q,re,pe){const Ue=[0,Ee.length-1,0],ft=[],dt=re*re;for(;Ue.length;){const en=Ue.pop(),hn=Ue.pop(),dn=Ue.pop();if(hn-dn<=pe){for(let Cr=dn;Cr<=hn;Cr++)Wt(se[2*Cr],se[2*Cr+1],ie,q)<=dt&&ft.push(Ee[Cr]);continue}const an=Math.floor((dn+hn)/2),or=se[2*an],xr=se[2*an+1];Wt(or,xr,ie,q)<=dt&&ft.push(Ee[an]);const Sn=(en+1)%2;(0===en?ie-re<=or:q-re<=xr)&&(Ue.push(dn),Ue.push(an-1),Ue.push(Sn)),(0===en?ie+re>=or:q+re>=xr)&&(Ue.push(an+1),Ue.push(hn),Ue.push(Sn))}return ft}(this.ids,this.coords,H,K,fe,this.nodeSize)}}const mr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},bn=Math.fround||(yn=new Float32Array(1),he=>(yn[0]=+he,yn[0]));var yn;class Qt{constructor(H){this.options=ri(Object.create(mr),H),this.trees=new Array(this.options.maxZoom+1)}load(H){const{log:K,minZoom:fe,maxZoom:Ee,nodeSize:se}=this.options;K&&console.time("total time");const ie=`prepare ${H.length} points`;K&&console.time(ie),this.points=H;let q=[];for(let re=0;re<H.length;re++)H[re].geometry&&q.push(ir(H[re],re));this.trees[Ee+1]=new fr(q,qi,vn,se,Float32Array),K&&console.timeEnd(ie);for(let re=Ee;re>=fe;re--){const pe=+Date.now();q=this._cluster(q,re),this.trees[re]=new fr(q,qi,vn,se,Float32Array),K&&console.log("z%d: %d clusters in %dms",re,q.length,+Date.now()-pe)}return K&&console.timeEnd("total time"),this}getClusters(H,K){let fe=((H[0]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,H[1]));let se=180===H[2]?180:((H[2]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)fe=-180,se=180;else if(fe>se){const Ue=this.getClusters([fe,Ee,180,ie],K),ft=this.getClusters([-180,Ee,se,ie],K);return Ue.concat(ft)}const q=this.trees[this._limitZoom(K)],re=q.range(ni(fe),Dn(ie),ni(se),Dn(Ee)),pe=[];for(const Ue of re){const ft=q.points[Ue];pe.push(ft.numPoints?Xr(ft):this.points[ft.index])}return pe}getChildren(H){const K=this._getOriginId(H),fe=this._getOriginZoom(H),Ee="No cluster with the specified id.",se=this.trees[fe];if(!se)throw new Error(Ee);const ie=se.points[K];if(!ie)throw new Error(Ee);const q=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),re=se.within(ie.x,ie.y,q),pe=[];for(const Ue of re){const ft=se.points[Ue];ft.parentId===H&&pe.push(ft.numPoints?Xr(ft):this.points[ft.index])}if(0===pe.length)throw new Error(Ee);return pe}getLeaves(H,K,fe){const Ee=[];return this._appendLeaves(Ee,H,K=K||10,fe=fe||0,0),Ee}getTile(H,K,fe){const Ee=this.trees[this._limitZoom(H)],se=Math.pow(2,H),{extent:ie,radius:q}=this.options,re=q/ie,pe=(fe-re)/se,Ue=(fe+1+re)/se,ft={features:[]};return this._addTileFeatures(Ee.range((K-re)/se,pe,(K+1+re)/se,Ue),Ee.points,K,fe,se,ft),0===K&&this._addTileFeatures(Ee.range(1-re/se,pe,1,Ue),Ee.points,se,fe,se,ft),K===se-1&&this._addTileFeatures(Ee.range(0,pe,re/se,Ue),Ee.points,-1,fe,se,ft),ft.features.length?ft:null}getClusterExpansionZoom(H){let K=this._getOriginZoom(H)-1;for(;K<=this.options.maxZoom;){const fe=this.getChildren(H);if(K++,1!==fe.length)break;H=fe[0].properties.cluster_id}return K}_appendLeaves(H,K,fe,Ee,se){const ie=this.getChildren(K);for(const q of ie){const re=q.properties;if(re&&re.cluster?se+re.point_count<=Ee?se+=re.point_count:se=this._appendLeaves(H,re.cluster_id,fe,Ee,se):se<Ee?se++:H.push(q),H.length===fe)break}return se}_addTileFeatures(H,K,fe,Ee,se,ie){for(const q of H){const re=K[q],pe=re.numPoints;let Ue,ft,dt;if(pe)Ue=Tn(re),ft=re.x,dt=re.y;else{const dn=this.points[re.index];Ue=dn.properties,ft=ni(dn.geometry.coordinates[0]),dt=Dn(dn.geometry.coordinates[1])}const en={type:1,geometry:[[Math.round(this.options.extent*(ft*se-fe)),Math.round(this.options.extent*(dt*se-Ee))]],tags:Ue};let hn;pe?hn=re.id:this.options.generateId?hn=re.index:this.points[re.index].id&&(hn=this.points[re.index].id),void 0!==hn&&(en.id=hn),ie.features.push(en)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,K){const fe=[],{radius:Ee,extent:se,reduce:ie,minPoints:q}=this.options,re=Ee/(se*Math.pow(2,K));for(let pe=0;pe<H.length;pe++){const Ue=H[pe];if(Ue.zoom<=K)continue;Ue.zoom=K;const ft=this.trees[K+1],dt=ft.within(Ue.x,Ue.y,re),en=Ue.numPoints||1;let hn=en;for(const dn of dt){const an=ft.points[dn];an.zoom>K&&(hn+=an.numPoints||1)}if(hn>en&&hn>=q){let dn=Ue.x*en,an=Ue.y*en,or=ie&&en>1?this._map(Ue,!0):null;const xr=(pe<<5)+(K+1)+this.points.length;for(const Sn of dt){const Cr=ft.points[Sn];if(Cr.zoom<=K)continue;Cr.zoom=K;const kr=Cr.numPoints||1;dn+=Cr.x*kr,an+=Cr.y*kr,Cr.parentId=xr,ie&&(or||(or=this._map(Ue,!0)),ie(or,this._map(Cr)))}Ue.parentId=xr,fe.push(wr(dn/hn,an/hn,xr,hn,or))}else if(fe.push(Ue),hn>1)for(const dn of dt){const an=ft.points[dn];an.zoom<=K||(an.zoom=K,fe.push(an))}}return fe}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,K){if(H.numPoints)return K?ri({},H.properties):H.properties;const fe=this.points[H.index].properties,Ee=this.options.map(fe);return K&&Ee===fe?ri({},Ee):Ee}}function wr(he,H,K,fe,Ee){return{x:bn(he),y:bn(H),zoom:1/0,id:K,parentId:-1,numPoints:fe,properties:Ee}}function ir(he,H){const[K,fe]=he.geometry.coordinates;return{x:bn(ni(K)),y:bn(Dn(fe)),zoom:1/0,index:H,parentId:-1}}function Xr(he){return{type:"Feature",id:he.id,properties:Tn(he),geometry:{type:"Point",coordinates:[(H=he.x,360*(H-.5)),ei(he.y)]}};var H}function Tn(he){const H=he.numPoints,K=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H;return ri(ri({},he.properties),{cluster:!0,cluster_id:he.id,point_count:H,point_count_abbreviated:K})}function ni(he){return he/360+.5}function Dn(he){const H=Math.sin(he*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function ei(he){const H=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function ri(he,H){for(const K in H)he[K]=H[K];return he}function qi(he){return he.x}function vn(he){return he.y}function sr(he,H,K,fe){for(var Ee,se=fe,ie=K-H>>1,q=K-H,re=he[H],pe=he[H+1],Ue=he[K],ft=he[K+1],dt=H+3;dt<K;dt+=3){var en=vi(he[dt],he[dt+1],re,pe,Ue,ft);if(en>se)Ee=dt,se=en;else if(en===se){var hn=Math.abs(dt-ie);hn<q&&(Ee=dt,q=hn)}}se>fe&&(Ee-H>3&&sr(he,H,Ee,fe),he[Ee+2]=se,K-Ee>3&&sr(he,Ee,K,fe))}function vi(he,H,K,fe,Ee,se){var ie=Ee-K,q=se-fe;if(0!==ie||0!==q){var re=((he-K)*ie+(H-fe)*q)/(ie*ie+q*q);re>1?(K=Ee,fe=se):re>0&&(K+=ie*re,fe+=q*re)}return(ie=he-K)*ie+(q=H-fe)*q}function Kr(he,H,K,fe){var Ee={id:void 0===he?null:he,type:H,geometry:K,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var ie=se.geometry,q=se.type;if("Point"===q||"MultiPoint"===q||"LineString"===q)Fr(se,ie);else if("Polygon"===q||"MultiLineString"===q)for(var re=0;re<ie.length;re++)Fr(se,ie[re]);else if("MultiPolygon"===q)for(re=0;re<ie.length;re++)for(var pe=0;pe<ie[re].length;pe++)Fr(se,ie[re][pe])}(Ee),Ee}function Fr(he,H){for(var K=0;K<H.length;K+=3)he.minX=Math.min(he.minX,H[K]),he.minY=Math.min(he.minY,H[K+1]),he.maxX=Math.max(he.maxX,H[K]),he.maxY=Math.max(he.maxY,H[K+1])}function Bo(he,H,K,fe){if(H.geometry){var Ee=H.geometry.coordinates,se=H.geometry.type,ie=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),q=[],re=H.id;if(K.promoteId?re=H.properties[K.promoteId]:K.generateId&&(re=fe||0),"Point"===se)Ii(Ee,q);else if("MultiPoint"===se)for(var pe=0;pe<Ee.length;pe++)Ii(Ee[pe],q);else if("LineString"===se)In(Ee,q,ie,!1);else if("MultiLineString"===se){if(K.lineMetrics){for(pe=0;pe<Ee.length;pe++)In(Ee[pe],q=[],ie,!1),he.push(Kr(re,"LineString",q,H.properties));return}to(Ee,q,ie,!1)}else if("Polygon"===se)to(Ee,q,ie,!0);else{if("MultiPolygon"!==se){if("GeometryCollection"===se){for(pe=0;pe<H.geometry.geometries.length;pe++)Bo(he,{id:re,geometry:H.geometry.geometries[pe],properties:H.properties},K,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<Ee.length;pe++){var Ue=[];to(Ee[pe],Ue,ie,!0),q.push(Ue)}}he.push(Kr(re,se,q,H.properties))}}function Ii(he,H){H.push(zr(he[0])),H.push(xn(he[1])),H.push(0)}function In(he,H,K,fe){for(var Ee,se,ie=0,q=0;q<he.length;q++){var re=zr(he[q][0]),pe=xn(he[q][1]);H.push(re),H.push(pe),H.push(0),q>0&&(ie+=fe?(Ee*pe-re*se)/2:Math.sqrt(Math.pow(re-Ee,2)+Math.pow(pe-se,2))),Ee=re,se=pe}var Ue=H.length-3;H[2]=1,sr(H,0,Ue,K),H[Ue+2]=1,H.size=Math.abs(ie),H.start=0,H.end=H.size}function to(he,H,K,fe){for(var Ee=0;Ee<he.length;Ee++){var se=[];In(he[Ee],se,K,fe),H.push(se)}}function zr(he){return he/360+.5}function xn(he){var H=Math.sin(he*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function gt(he,H,K,fe,Ee,se,ie,q){if(fe/=H,se>=(K/=H)&&ie<fe)return he;if(ie<K||se>=fe)return null;for(var re=[],pe=0;pe<he.length;pe++){var Ue=he[pe],ft=Ue.geometry,dt=Ue.type,en=0===Ee?Ue.minX:Ue.minY,hn=0===Ee?Ue.maxX:Ue.maxY;if(en>=K&&hn<fe)re.push(Ue);else if(!(hn<K||en>=fe)){var dn=[];if("Point"===dt||"MultiPoint"===dt)xi(ft,dn,K,fe,Ee);else if("LineString"===dt)yr(ft,dn,K,fe,Ee,!1,q.lineMetrics);else if("MultiLineString"===dt)no(ft,dn,K,fe,Ee,!1);else if("Polygon"===dt)no(ft,dn,K,fe,Ee,!0);else if("MultiPolygon"===dt)for(var an=0;an<ft.length;an++){var or=[];no(ft[an],or,K,fe,Ee,!0),or.length&&dn.push(or)}if(dn.length){if(q.lineMetrics&&"LineString"===dt){for(an=0;an<dn.length;an++)re.push(Kr(Ue.id,dt,dn[an],Ue.tags));continue}"LineString"!==dt&&"MultiLineString"!==dt||(1===dn.length?(dt="LineString",dn=dn[0]):dt="MultiLineString"),"Point"!==dt&&"MultiPoint"!==dt||(dt=3===dn.length?"Point":"MultiPoint"),re.push(Kr(Ue.id,dt,dn,Ue.tags))}}}return re.length?re:null}function xi(he,H,K,fe,Ee){for(var se=0;se<he.length;se+=3){var ie=he[se+Ee];ie>=K&&ie<=fe&&(H.push(he[se]),H.push(he[se+1]),H.push(he[se+2]))}}function yr(he,H,K,fe,Ee,se,ie){for(var q,re,pe=Ai(he),Ue=0===Ee?Pi:Ar,ft=he.start,dt=0;dt<he.length-3;dt+=3){var en=he[dt],hn=he[dt+1],dn=he[dt+2],an=he[dt+3],or=he[dt+4],xr=0===Ee?en:hn,Sn=0===Ee?an:or,Cr=!1;ie&&(q=Math.sqrt(Math.pow(en-an,2)+Math.pow(hn-or,2))),xr<K?Sn>K&&(re=Ue(pe,en,hn,an,or,K),ie&&(pe.start=ft+q*re)):xr>fe?Sn<fe&&(re=Ue(pe,en,hn,an,or,fe),ie&&(pe.start=ft+q*re)):Fi(pe,en,hn,dn),Sn<K&&xr>=K&&(re=Ue(pe,en,hn,an,or,K),Cr=!0),Sn>fe&&xr<=fe&&(re=Ue(pe,en,hn,an,or,fe),Cr=!0),!se&&Cr&&(ie&&(pe.end=ft+q*re),H.push(pe),pe=Ai(he)),ie&&(ft+=q)}var kr=he.length-3;en=he[kr],hn=he[kr+1],dn=he[kr+2],(xr=0===Ee?en:hn)>=K&&xr<=fe&&Fi(pe,en,hn,dn),kr=pe.length-3,se&&kr>=3&&(pe[kr]!==pe[0]||pe[kr+1]!==pe[1])&&Fi(pe,pe[0],pe[1],pe[2]),pe.length&&H.push(pe)}function Ai(he){var H=[];return H.size=he.size,H.start=he.start,H.end=he.end,H}function no(he,H,K,fe,Ee,se){for(var ie=0;ie<he.length;ie++)yr(he[ie],H,K,fe,Ee,se,!1)}function Fi(he,H,K,fe){he.push(H),he.push(K),he.push(fe)}function Pi(he,H,K,fe,Ee,se){var ie=(se-H)/(fe-H);return he.push(se),he.push(K+(Ee-K)*ie),he.push(1),ie}function Ar(he,H,K,fe,Ee,se){var ie=(se-K)/(Ee-K);return he.push(H+(fe-H)*ie),he.push(se),he.push(1),ie}function ho(he,H){for(var K=[],fe=0;fe<he.length;fe++){var Ee,se=he[fe],ie=se.type;if("Point"===ie||"MultiPoint"===ie||"LineString"===ie)Ee=vr(se.geometry,H);else if("MultiLineString"===ie||"Polygon"===ie){Ee=[];for(var q=0;q<se.geometry.length;q++)Ee.push(vr(se.geometry[q],H))}else if("MultiPolygon"===ie)for(Ee=[],q=0;q<se.geometry.length;q++){for(var re=[],pe=0;pe<se.geometry[q].length;pe++)re.push(vr(se.geometry[q][pe],H));Ee.push(re)}K.push(Kr(se.id,ie,Ee,se.tags))}return K}function vr(he,H){var K=[];K.size=he.size,void 0!==he.start&&(K.start=he.start,K.end=he.end);for(var fe=0;fe<he.length;fe+=3)K.push(he[fe]+H,he[fe+1],he[fe+2]);return K}function ro(he,H){if(he.transformed)return he;var K,fe,Ee,se=1<<he.z,ie=he.x,q=he.y;for(K=0;K<he.features.length;K++){var re=he.features[K],pe=re.geometry,Ue=re.type;if(re.geometry=[],1===Ue)for(fe=0;fe<pe.length;fe+=2)re.geometry.push(Vi(pe[fe],pe[fe+1],H,se,ie,q));else for(fe=0;fe<pe.length;fe++){var ft=[];for(Ee=0;Ee<pe[fe].length;Ee+=2)ft.push(Vi(pe[fe][Ee],pe[fe][Ee+1],H,se,ie,q));re.geometry.push(ft)}}return he.transformed=!0,he}function Vi(he,H,K,fe,Ee,se){return[Math.round(K*(he*fe-Ee)),Math.round(K*(H*fe-se))]}function ii(he,H,K,fe,Ee){for(var se=H===Ee.maxZoom?0:Ee.tolerance/((1<<H)*Ee.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:fe,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},q=0;q<he.length;q++){ie.numFeatures++,Hn(ie,he[q],se,Ee);var re=he[q].minX,pe=he[q].minY,Ue=he[q].maxX,ft=he[q].maxY;re<ie.minX&&(ie.minX=re),pe<ie.minY&&(ie.minY=pe),Ue>ie.maxX&&(ie.maxX=Ue),ft>ie.maxY&&(ie.maxY=ft)}return ie}function Hn(he,H,K,fe){var Ee=H.geometry,se=H.type,ie=[];if("Point"===se||"MultiPoint"===se)for(var q=0;q<Ee.length;q+=3)ie.push(Ee[q]),ie.push(Ee[q+1]),he.numPoints++,he.numSimplified++;else if("LineString"===se)_t(ie,Ee,he,K,!1,!1);else if("MultiLineString"===se||"Polygon"===se)for(q=0;q<Ee.length;q++)_t(ie,Ee[q],he,K,"Polygon"===se,0===q);else if("MultiPolygon"===se)for(var re=0;re<Ee.length;re++){var pe=Ee[re];for(q=0;q<pe.length;q++)_t(ie,pe[q],he,K,!0,0===q)}if(ie.length){var Ue=H.tags||null;if("LineString"===se&&fe.lineMetrics){for(var ft in Ue={},H.tags)Ue[ft]=H.tags[ft];Ue.mapbox_clip_start=Ee.start/Ee.size,Ue.mapbox_clip_end=Ee.end/Ee.size}var dt={geometry:ie,type:"Polygon"===se||"MultiPolygon"===se?3:"LineString"===se||"MultiLineString"===se?2:1,tags:Ue};null!==H.id&&(dt.id=H.id),he.features.push(dt)}}function _t(he,H,K,fe,Ee,se){var ie=fe*fe;if(fe>0&&H.size<(Ee?ie:fe))K.numPoints+=H.length/3;else{for(var q=[],re=0;re<H.length;re+=3)(0===fe||H[re+2]>ie)&&(K.numSimplified++,q.push(H[re]),q.push(H[re+1])),K.numPoints++;Ee&&function(pe,Ue){for(var ft=0,dt=0,en=pe.length,hn=en-2;dt<en;hn=dt,dt+=2)ft+=(pe[dt]-pe[hn])*(pe[dt+1]+pe[hn+1]);if(ft>0===Ue)for(dt=0,en=pe.length;dt<en/2;dt+=2){var dn=pe[dt],an=pe[dt+1];pe[dt]=pe[en-2-dt],pe[dt+1]=pe[en-1-dt],pe[en-2-dt]=dn,pe[en-1-dt]=an}}(q,se),he.push(q)}}function Fe(he,H){var K=(H=this.options=function(Ee,se){for(var ie in se)Ee[ie]=se[ie];return Ee}(Object.create(this.options),H)).debug;if(K&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ee,se,ie,q,re,pe,fe=function(Ee,se){var ie=[];if("FeatureCollection"===Ee.type)for(var q=0;q<Ee.features.length;q++)Bo(ie,Ee.features[q],se,q);else Bo(ie,"Feature"===Ee.type?Ee:{geometry:Ee},se);return ie}(he,H);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=Ee=fe,re=gt(Ee,1,-1-(ie=(se=H).buffer/se.extent),ie,0,-1,2,se),pe=gt(Ee,1,1-ie,2+ie,0,-1,2,se),(re||pe)&&(q=gt(Ee,1,-ie,1+ie,0,-1,2,se)||[],re&&(q=ho(re,1).concat(q)),pe&&(q=q.concat(ho(pe,-1)))),(fe=q).length&&this.splitTile(fe,0,0,0),K&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Le(he,H,K){return 32*((1<<he)*K+H)+he}function $t(he,H){const K=he.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const fe=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!fe)return H(null,null);const Ee=new Kt(fe.features);let se=ln(Ee);0===se.byteOffset&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),H(null,{vectorTile:Ee,rawData:se.buffer})}Fe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fe.prototype.splitTile=function(he,H,K,fe,Ee,se,ie){for(var q=[he,H,K,fe],re=this.options,pe=re.debug;q.length;){fe=q.pop(),K=q.pop(),H=q.pop(),he=q.pop();var Ue=1<<H,ft=Le(H,K,fe),dt=this.tiles[ft];if(!dt&&(pe>1&&console.time("creation"),dt=this.tiles[ft]=ii(he,H,K,fe,re),this.tileCoords.push({z:H,x:K,y:fe}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,K,fe,dt.numFeatures,dt.numPoints,dt.numSimplified),console.timeEnd("creation"));var en="z"+H;this.stats[en]=(this.stats[en]||0)+1,this.total++}if(dt.source=he,Ee){if(H===re.maxZoom||H===Ee)continue;var hn=1<<Ee-H;if(K!==Math.floor(se/hn)||fe!==Math.floor(ie/hn))continue}else if(H===re.indexMaxZoom||dt.numPoints<=re.indexMaxPoints)continue;if(dt.source=null,0!==he.length){pe>1&&console.time("clipping");var dn,an,or,xr,Sn,Cr,kr=.5*re.buffer/re.extent,fo=.5-kr,yo=.5+kr,ht=1+kr;dn=an=or=xr=null,Sn=gt(he,Ue,K-kr,K+yo,0,dt.minX,dt.maxX,re),Cr=gt(he,Ue,K+fo,K+ht,0,dt.minX,dt.maxX,re),he=null,Sn&&(dn=gt(Sn,Ue,fe-kr,fe+yo,1,dt.minY,dt.maxY,re),an=gt(Sn,Ue,fe+fo,fe+ht,1,dt.minY,dt.maxY,re),Sn=null),Cr&&(or=gt(Cr,Ue,fe-kr,fe+yo,1,dt.minY,dt.maxY,re),xr=gt(Cr,Ue,fe+fo,fe+ht,1,dt.minY,dt.maxY,re),Cr=null),pe>1&&console.timeEnd("clipping"),q.push(dn||[],H+1,2*K,2*fe),q.push(an||[],H+1,2*K,2*fe+1),q.push(or||[],H+1,2*K+1,2*fe),q.push(xr||[],H+1,2*K+1,2*fe+1)}}},Fe.prototype.getTile=function(he,H,K){var fe=this.options,Ee=fe.extent,se=fe.debug;if(he<0||he>24)return null;var ie=1<<he,q=Le(he,H=(H%ie+ie)%ie,K);if(this.tiles[q])return ro(this.tiles[q],Ee);se>1&&console.log("drilling down to z%d-%d-%d",he,H,K);for(var re,pe=he,Ue=H,ft=K;!re&&pe>0;)pe--,Ue=Math.floor(Ue/2),ft=Math.floor(ft/2),re=this.tiles[Le(pe,Ue,ft)];return re&&re.source?(se>1&&console.log("found parent tile z%d-%d-%d",pe,Ue,ft),se>1&&console.time("drilling down"),this.splitTile(re.source,pe,Ue,ft,he,H,K),se>1&&console.timeEnd("drilling down"),this.tiles[q]?ro(this.tiles[q],Ee):null):null};class Rt extends u.VectorTileWorkerSource{constructor(H,K,fe,Ee,se){super(H,K,fe,Ee,$t),se&&(this.loadGeoJSON=se)}loadData(H,K){const fe=H&&H.request,Ee=fe&&fe.collectResourceTiming;this.loadGeoJSON(H,(se,ie)=>{if(se||!ie)return K(se);if("object"!=typeof ie)return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{xt(ie,!0);try{if(H.filter){const re=u.createExpression(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===re.result)throw new Error(re.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));ie={type:"FeatureCollection",features:ie.features.filter(Ue=>re.value.evaluate({zoom:0},Ue))}}this._geoJSONIndex=H.cluster?new Qt(function({superclusterOptions:re,clusterProperties:pe}){if(!pe||!re)return re;const Ue={},ft={},dt={accumulated:null,zoom:0},en={properties:null},hn=Object.keys(pe);for(const dn of hn){const[an,or]=pe[dn],xr=u.createExpression(or),Sn=u.createExpression("string"==typeof an?[an,["accumulated"],["get",dn]]:an);Ue[dn]=xr.value,ft[dn]=Sn.value}return re.map=dn=>{en.properties=dn;const an={};for(const or of hn)an[or]=Ue[or].evaluate(dt,en);return an},re.reduce=(dn,an)=>{en.properties=an;for(const or of hn)dt.accumulated=dn[or],dn[or]=ft[or].evaluate(dt,en)},re}(H)).load(ie.features):new Fe(re=ie,H.geojsonVtOptions)}catch(re){return K(re)}this.loaded={};const q={};if(Ee){const re=u.getPerformanceMeasurement(fe);re&&(q.resourceTiming={},q.resourceTiming[H.source]=JSON.parse(JSON.stringify(re)))}K(null,q)}var re})}reloadTile(H,K){const fe=this.loaded;return fe&&fe[H.uid]?super.reloadTile(H,K):this.loadTile(H,K)}loadGeoJSON(H,K){if(H.request)u.getJSON(H.request,K);else{if("string"!=typeof H.data)return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(H.data))}catch{return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(fe){K(fe)}}getClusterChildren(H,K){try{K(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(fe){K(fe)}}getClusterLeaves(H,K){try{K(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(fe){K(fe)}}}class On{constructor(H){this.self=H,this.actor=new u.Actor(H,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:Rt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,fe)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=fe},this.self.registerRTLTextPlugin=K=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=K.applyArabicShaping,u.plugin.processBidirectionalText=K.processBidirectionalText,u.plugin.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(H,K,fe){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],fe()}checkIfReady(H,K,fe){fe()}setReferrer(H,K){this.referrer=K}spriteLoaded(H,K){this.isSpriteLoaded[H]=K;for(const fe in this.workerSources[H]){const Ee=this.workerSources[H][fe];for(const se in Ee)Ee[se]instanceof u.VectorTileWorkerSource&&(Ee[se].isSpriteLoaded=K,Ee[se].fire(new u.Event("isSpriteLoaded")))}}setImages(H,K,fe){this.availableImages[H]=K;for(const Ee in this.workerSources[H]){const se=this.workerSources[H][Ee];for(const ie in se)se[ie].availableImages=K}fe()}enableTerrain(H,K,fe){this.terrain=K,fe()}setProjection(H,K){this.projections[H]=u.getProjection(K)}setLayers(H,K,fe){this.getLayerIndex(H).replace(K),fe()}updateLayers(H,K,fe){this.getLayerIndex(H).update(K.layers,K.removedIds),fe()}loadTile(H,K,fe){const Ee=this.enableTerrain?u.extend({enableTerrain:this.terrain},K):K;Ee.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,K.type,K.source).loadTile(Ee,fe)}loadDEMTile(H,K,fe){const Ee=this.enableTerrain?u.extend({buildQuadTree:this.terrain},K):K;this.getDEMWorkerSource(H,K.source).loadTile(Ee,fe)}reloadTile(H,K,fe){const Ee=this.enableTerrain?u.extend({enableTerrain:this.terrain},K):K;Ee.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,K.type,K.source).reloadTile(Ee,fe)}abortTile(H,K,fe){this.getWorkerSource(H,K.type,K.source).abortTile(K,fe)}removeTile(H,K,fe){this.getWorkerSource(H,K.type,K.source).removeTile(K,fe)}removeSource(H,K,fe){if(!this.workerSources[H]||!this.workerSources[H][K.type]||!this.workerSources[H][K.type][K.source])return;const Ee=this.workerSources[H][K.type][K.source];delete this.workerSources[H][K.type][K.source],void 0!==Ee.removeSource?Ee.removeSource(K,fe):fe()}loadWorkerSource(H,K,fe){try{this.self.importScripts(K.url),fe()}catch(Ee){fe(Ee.toString())}}syncRTLPluginState(H,K,fe){try{u.plugin.setState(K);const Ee=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=Ee){this.self.importScripts(Ee);const se=u.plugin.isParsed();fe(se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ee}`),se)}}catch(Ee){fe(Ee.toString())}}getAvailableImages(H){let K=this.availableImages[H];return K||(K=[]),K}getLayerIndex(H){let K=this.layerIndexes[H];return K||(K=this.layerIndexes[H]=new St),K}getWorkerSource(H,K,fe){return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][K]||(this.workerSources[H][K]={}),this.workerSources[H][K][fe]||(this.workerSources[H][K][fe]=new this.workerSourceTypes[K]({send:(se,ie,q,re,pe,Ue)=>{this.actor.send(se,ie,q,H,pe,Ue)},scheduler:this.actor.scheduler},this.getLayerIndex(H),this.getAvailableImages(H),this.isSpriteLoaded[H])),this.workerSources[H][K][fe]}getDEMWorkerSource(H,K){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][K]||(this.demWorkerSources[H][K]=new wt),this.demWorkerSources[H][K]}enforceCacheSizeLimit(H,K){u.enforceCacheSizeLimit(K)}getWorkerPerformanceMetrics(H,K,fe){fe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new On(self)),On}),ee(0,function(u){function Ie(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let c=0;c<p.length;c++)if(!Ie(p[c],r[c]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const c in p)if(!Ie(p[c],r[c]))return!1;return!0}return p===r}var Xt=St;function St(p){return r=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,f,d=new Blob([""],{type:"text/javascript"}),y=URL.createObjectURL(d);try{f=new Worker(y),a=!0}catch{a=!1}return f&&f.terminate(),URL.revokeObjectURL(y),a}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var a=document.createElement("canvas");a.width=a.height=1;var f=a.getContext("2d");if(!f)return!1;var d=f.getImageData(0,0,1,1);return d&&d.width===a.width}()||(void 0===wt[c=r&&r.failIfMajorPerformanceCaveat]&&(wt[c]=function(a){var f,y,x,E,d=(y=a,x=document.createElement("canvas"),(E=Object.create(St.webGLContextAttributes)).failIfMajorPerformanceCaveat=y,x.getContext("webgl",E)||x.getContext("experimental-webgl",E));if(!d)return!1;try{f=d.createShader(d.VERTEX_SHADER)}catch{return!1}return!(!f||d.isContextLost())&&(d.shaderSource(f,"void main() {}"),d.compileShader(f),!0===d.getShaderParameter(f,d.COMPILE_STATUS))}(c)),!wt[c]||document.documentMode));var r,c}var wt={};function xt(p,r,c){const a=u.window.document.createElement(p);return void 0!==r&&(a.className=r),c&&c.appendChild(a),a}function nt(p,r,c){const a=u.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const f of Object.keys(r))a.setAttributeNS(null,f,r[f]);return c&&c.appendChild(a),a}St.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const yt=u.window.document&&u.window.document.documentElement.style,Ct=yt&&void 0!==yt.userSelect?"userSelect":"WebkitUserSelect";let jn;function Kt(){yt&&Ct&&(jn=yt[Ct],yt[Ct]="none")}function ln(){yt&&Ct&&(yt[Ct]=jn)}function jt(p){p.preventDefault(),p.stopPropagation(),u.window.removeEventListener("click",jt,!0)}function Gn(){u.window.addEventListener("click",jt,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",jt,!0)},0)}function st(p,r){const c=p.getBoundingClientRect();return Ye(p,c,r)}function Pn(p,r){const c=p.getBoundingClientRect(),a=[];for(let f=0;f<r.length;f++)a.push(Ye(p,c,r[f]));return a}function Or(p){return void 0!==u.window.InstallTrigger&&2===p.button&&p.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Ye(p,r,c){const a=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new u.pointGeometry((c.clientX-r.left)*a,(c.clientY-r.top)*a)}function Ne(p,r){var c=r[0],a=r[1],f=r[2],d=r[3],y=c*d-f*a;return y?(p[0]=d*(y=1/y),p[1]=-a*y,p[2]=-f*y,p[3]=c*y,p):null}function pt(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class sn extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:c,callback:a}of this.requestors)this._notify(c,a);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,c){this._validate(r,c)&&(this.images[r]=c)}_validate(r,c){let a=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),a=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),a=!1),this._validateContent(c.content,c)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),a=!1),a}_validateStretch(r,c){if(!r)return!0;let a=0;for(const f of r){if(f[0]<a||f[1]<f[0]||c<f[1])return!1;a=f[1]}return!0}_validateContent(r,c){return!(r&&(4!==r.length||r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,c){c.version=this.images[r].version+1,this.images[r]=c,this.updatedImages[r]=!0}removeImage(r){const c=this.images[r];delete this.images[r],delete this.patterns[r],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,c){let a=!0;if(!this.isLoaded())for(const f of r)this.images[f]||(a=!1);this.isLoaded()||a?this._notify(r,c):this.requestors.push({ids:r,callback:c})}_notify(r,c){const a={};for(const f of r){this.images[f]||this.fire(new u.Event("styleimagemissing",{id:f}));const d=this.images[f];d?a[f]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:Boolean(d.userImage&&d.userImage.render)}:u.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,a)}getPixelSize(){const{width:r,height:c}=this.atlasImage;return{width:r,height:c}}getPattern(r){const c=this.patterns[r],a=this.getImage(r);if(!a)return null;if(c&&c.position.version===a.version)return c.position;if(c)c.position.version=a.version;else{const f={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new u.ImagePosition(f,a);this.patterns[r]={bin:f,position:d}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const c=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(r,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const d in this.patterns)r.push(this.patterns[d].bin);const{w:c,h:a}=u.potpack(r),f=this.atlasImage;f.resize({width:c||1,height:a||1});for(const d in this.patterns){const{bin:y}=this.patterns[d],x=y.x+1,E=y.y+1,C=this.images[d].data,R=C.width,U=C.height;u.RGBAImage.copy(C,f,{x:0,y:0},{x,y:E},{width:R,height:U}),u.RGBAImage.copy(C,f,{x:0,y:U-1},{x,y:E-1},{width:R,height:1}),u.RGBAImage.copy(C,f,{x:0,y:0},{x,y:E+U},{width:R,height:1}),u.RGBAImage.copy(C,f,{x:R-1,y:0},{x:x-1,y:E},{width:1,height:U}),u.RGBAImage.copy(C,f,{x:0,y:0},{x:x+R,y:E},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const c of r){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const a=this.images[c];pt(a)&&this.updateImage(c,a)}}}const _n=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(p,r){return function([c,a,f]){const d=u.degToRad(a+90),y=u.degToRad(f);return{x:c*Math.cos(d)*Math.sin(y),y:c*Math.sin(d)*Math.sin(y),z:c*Math.cos(y),azimuthal:a,polar:f}}(p.expression.evaluate(r))}interpolate(p,r,c){return{x:u.number(p.x,r.x,c),y:u.number(p.y,r.y,c),z:u.number(p.z,r.z,c),azimuthal:u.number(p.azimuthal,r.azimuthal,c),polar:u.number(p.polar,r.polar,c)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),nn="-transition";class Yt extends u.Evented{constructor(r){super(),this._transitionable=new u.Transitionable(_n),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c={}){if(!this._validate(u.validateLight,r,c))for(const a in r){const f=r[a];u.endsWith(a,nn)?this._transitionable.setTransition(a.slice(0,-nn.length),f):this._transitionable.setValue(a,f)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,a){return(!a||!1!==a.validate)&&u.emitValidationErrors(this,r.call(u.validateStyle,u.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const Bt=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)}),un="-transition";class rr extends u.Evented{constructor(r,c){super(),this._transitionable=new u.Transitionable(Bt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(r){for(const c in r){const a=r[c];u.endsWith(c,un)?this._transitionable.setTransition(c.slice(0,-un.length),a):this._transitionable.setValue(c,a)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Vt(p,r,c,a){const f=u.smoothstep(45,65,c),[d,y]=at(p,a),x=u.length(r);let E=1-Math.min(1,Math.exp((x-d)/(y-d)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*f*p.alpha}function at(p,r){const c=.5/Math.tan(.5*r);return[p.range[0]+c,p.range[1]+c]}const rt=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])}),Mt="-transition";class At extends u.Evented{constructor(r,c){super(),this._transitionable=new u.Transitionable(rt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const r=this._transform,c="globe"===r.projection.name,a=u.globeToMercatorTransition(r.zoom),f=this.properties.get("range"),d=[.5,3];return{range:c?[u.number(d[0],f[0],a),u.number(d[1],f[1],a)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c={}){if(!this._validate(u.validateFog,r,c)){for(const a of Object.keys(u.spec.fog))r&&void 0===r[a]&&(r[a]=u.spec.fog[a].default);for(const a in r){const f=r[a];u.endsWith(a,Mt)?this._transitionable.setTransition(a.slice(0,-Mt.length),f):this._transitionable.setValue(a,f)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(a,f,d){const y=u.MercatorCoordinate.fromLngLat(f),x=d.elevation?d.elevation.getAtPointOrZero(y):0,E=[y.x,y.y,x];return u.transformMat4(E,E,d.mercatorFogMatrix),Vt(a,E,d.pitch,d._fov)}(this.state,r,c):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?at(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,a){return(!a||!1!==a.validate)&&u.emitValidationErrors(this,r.call(u.validateStyle,u.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class Wt{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const a=this.workerPool.acquire(this.id);for(let f=0;f<a.length;f++){const d=new Wt.Actor(a[f],c,this.id);d.name=`Worker ${f}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,a){u.asyncAll(this.actors,(f,d)=>{f.send(r,c,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qt(p,r,c){return r*(u.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}Wt.Actor=u.Actor;class Rn{constructor(r,c,a,f){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(r,c){let a,f;if(r instanceof u.pointGeometry||"number"==typeof r[0]){const d=u.pointGeometry.convert(r);a=[d],f=c.isPointAboveHorizon(d)}else{const d=u.pointGeometry.convert(r[0]),y=u.pointGeometry.convert(r[1]);a=[d,y],f=u.polygonizeBounds(d,y).every(x=>c.isPointAboveHorizon(x))}return new Rn(a,c.getCameraPoint(),f,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],f=u.polygonizeBounds(c,a,0,!1);return this.cameraPoint.y>a.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<a.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=a.x?f[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(f[3]=this.cameraPoint)),u.bufferConvexPolygon(f,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],f=u.polygonizeBounds(c,a,r),d=this.cameraPoint.clone();switch(3*((d.y>c.y)+(d.y>a.y))+((d.x>c.x)+(d.x>a.x))){case 0:f[0]=d,f[4]=d.clone();break;case 1:f.splice(1,0,d);break;case 2:f[1]=d;break;case 3:f.splice(4,0,d);break;case 5:f.splice(2,0,d);break;case 6:f[3]=d;break;case 7:f.splice(3,0,d);break;case 8:f[2]=d}return f}containsTile(r,c,a,f=0){const d=r.queryPadding/c._pixelsPerMercatorPixel+1,y=a?this._bufferedCameraMercator(d,c):this._bufferedScreenMercator(d,c);let x=r.tileID.wrap+(y.unwrapped?f:0);const E=y.polygon.map(me=>u.getTilePoint(r.tileTransform,me,x));if(!u.polygonIntersectsBox(E,0,0,u.EXTENT,u.EXTENT))return;x=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const C=this.screenGeometryMercator.polygon.map(me=>u.getTileVec3(r.tileTransform,me,x)),R=C.map(me=>new u.pointGeometry(me[0],me[1])),U=c.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),Y=u.getTileVec3(r.tileTransform,U,x),oe=C.map(me=>{const te=u.sub(me,me,Y);return u.normalize(te,te),new u.Ray(Y,te)}),ce=qt(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:oe,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(de=u.getBounds(E),de.min.x=u.clamp(de.min.x,0,u.EXTENT),de.min.y=u.clamp(de.min.y,0,u.EXTENT),de.max.x=u.clamp(de.max.x,0,u.EXTENT),de.max.y=u.clamp(de.max.y,0,u.EXTENT),de),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:ce};var de}_bufferedScreenMercator(r,c){const a=bn(r);if(this._screenRaycastCache[a])return this._screenRaycastCache[a];{let f;return f="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(d=>c.pointCoordinate3D(d)),unwrapped:!0},this._screenRaycastCache[a]=f,f}}_bufferedCameraMercator(r,c){const a=bn(r);if(this._cameraRaycastCache[a])return this._cameraRaycastCache[a];{let f;return f="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(d=>c.pointCoordinate3D(d)),unwrapped:!0},this._cameraRaycastCache[a]=f,f}}_projectAndResample(r,c){const a=function(d,y){const x=u.multiply([],y.pixelMatrix,y.globeMatrix),E=[0,-u.GLOBE_RADIUS,0,1],C=[0,u.GLOBE_RADIUS,0,1],R=[0,0,0,1];u.transformMat4$1(E,E,x),u.transformMat4$1(C,C,x),u.transformMat4$1(R,R,x);const U=new u.pointGeometry(E[0]/E[3],E[1]/E[3]),Y=new u.pointGeometry(C[0]/C[3],C[1]/C[3]),oe=u.polygonContainsPoint(d,U)&&E[3]<R[3],ce=u.polygonContainsPoint(d,Y)&&C[3]<R[3];if(!oe&&!ce)return null;const de=function(Be,He,Ze){for(let Je=1;Je<Be.length;Je++){const Ht=mr(He.pointCoordinate3D(Be[Je-1]).x),We=mr(He.pointCoordinate3D(Be[Je]).x);if(Ze<0){if(Ht<We)return{idx:Je,t:-Ht/(We-1-Ht)}}else if(We<Ht)return{idx:Je,t:(1-Ht)/(We+1-Ht)}}return null}(d,y,oe?-1:1);if(!de)return null;const{idx:me,t:te}=de;let be=me>1?fr(d.slice(0,me),y):[],ye=me<d.length?fr(d.slice(me),y):[];be=be.map(Be=>new u.pointGeometry(mr(Be.x),Be.y)),ye=ye.map(Be=>new u.pointGeometry(mr(Be.x),Be.y));const De=[...be];0===De.length&&De.push(ye[ye.length-1]);const Re=u.number(De[De.length-1].y,(0===ye.length?be[0]:ye[0]).y,te);let Ae;return Ae=oe?[new u.pointGeometry(0,Re),new u.pointGeometry(0,0),new u.pointGeometry(1,0),new u.pointGeometry(1,Re)]:[new u.pointGeometry(1,Re),new u.pointGeometry(1,1),new u.pointGeometry(0,1),new u.pointGeometry(0,Re)],De.push(...Ae),0===ye.length?De.push(be[0]):De.push(...ye),{polygon:De.map(Be=>new u.MercatorCoordinate(Be.x,Be.y)),unwrapped:!1}}(r,c);if(a)return a;const f=function(d,y){let x=!1,E=-1/0,C=0;for(let U=0;U<d.length-1;U++)d[U].x>E&&(E=d[U].x,C=U);for(let U=0;U<d.length-1;U++){const Y=(C+U)%(d.length-1),oe=d[Y],ce=d[Y+1];Math.abs(oe.x-ce.x)>.5&&(oe.x<ce.x?(oe.x+=1,0===Y&&(d[d.length-1].x+=1)):(ce.x+=1,Y+1===d.length-1&&(d[0].x+=1)),x=!0)}const R=u.mercatorXfromLng(y.center.lng);return x&&R<Math.abs(R-1)&&d.forEach(U=>{U.x-=1}),{polygon:d,unwrapped:x}}(fr(r,c).map(d=>new u.pointGeometry(mr(d.x),d.y)),c);return{polygon:f.polygon.map(d=>new u.MercatorCoordinate(d.x,d.y)),unwrapped:f.unwrapped}}}function fr(p,r){return u.resample(p,c=>{const a=r.pointCoordinate3D(c);c.x=a.x,c.y=a.y},1/256)}function mr(p){return p<0?1+p%1:p%1}function bn(p){return 100*p|0}function yn(p,r,c,a,f){const d=function(y,x){if(y)return f(y);if(x){p.url&&x.tiles&&p.tiles&&delete p.tiles;const E=u.pick(u.extend(x,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(C=>C.id)),E.tiles=r.canonicalizeTileset(E,p.url),f(null,E)}};return p.url?u.getJSON(r.transformRequest(r.normalizeSourceURL(p.url,null,c,a),u.ResourceType.Source),d):u.exported.frame(()=>d(null,p))}class Qt{constructor(r,c,a){this.bounds=u.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=c||0,this.maxzoom=a||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const c=Math.pow(2,r.z),a=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*c),f=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*c),d=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*c),y=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*c);return r.x>=a&&r.x<d&&r.y>=f&&r.y<y}}class wr{constructor(r,c,a){this.context=r;const f=r.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ir={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xr{constructor(r,c,a,f){this.length=c.length,this.attributes=a,this.itemSize=c.bytesPerElement,this.dynamicDraw=f,this.context=r;const d=r.gl;this.buffer=d.createBuffer(),r.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let a=0;a<this.attributes.length;a++){const f=c.attributes[this.attributes[a].name];void 0!==f&&r.enableVertexAttribArray(f)}}setVertexAttribPointers(r,c,a){for(let f=0;f<this.attributes.length;f++){const d=this.attributes[f],y=c.attributes[d.name];void 0!==y&&r.vertexAttribPointer(y,d.components,r[ir[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ni extends Tn{getDefault(){return u.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Dn extends Tn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ei extends Tn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class ri extends Tn{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class qi extends Tn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class vn extends Tn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class sr extends Tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class vi extends Tn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Kr extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class Fr extends Tn{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Bo extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ii extends Tn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class In extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class to extends Tn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class zr extends Tn{getDefault(){return u.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class xn extends Tn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class gt extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class xi extends Tn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class yr extends Tn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Ai extends Tn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class no extends Tn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Fi extends Tn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Pi extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ar extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ho extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class vr extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ro extends Tn{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Vi extends Tn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class ii extends Tn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Hn extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class _t extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fe extends Tn{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class Le extends Fe{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class $t extends Fe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Rt extends $t{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class On{constructor(r,c,a,f){this.context=r,this.width=c,this.height=a;const d=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Le(r,d),f&&(this.depthAttachment=new $t(r,d))}destroy(){const r=this.context.gl,c=this.colorAttachment.get();if(c&&r.deleteTexture(c),this.depthAttachment){const a=this.depthAttachment.get();a&&r.deleteRenderbuffer(a)}r.deleteFramebuffer(this.framebuffer)}}class he{constructor(r,c=!1){if(this.gl=r,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const a=r;this.extVertexArrayObject={createVertexArrayOES:a.createVertexArray.bind(r),deleteVertexArrayOES:a.deleteVertexArray.bind(r),bindVertexArrayOES:a.bindVertexArray.bind(r)}}this.clearColor=new ni(this),this.clearDepth=new Dn(this),this.clearStencil=new ei(this),this.colorMask=new ri(this),this.depthMask=new qi(this),this.stencilMask=new vn(this),this.stencilFunc=new sr(this),this.stencilOp=new vi(this),this.stencilTest=new Kr(this),this.depthRange=new Fr(this),this.depthTest=new Bo(this),this.depthFunc=new Ii(this),this.blend=new In(this),this.blendFunc=new to(this),this.blendColor=new zr(this),this.blendEquation=new xn(this),this.cullFace=new gt(this),this.cullFaceSide=new xi(this),this.frontFace=new yr(this),this.program=new Ai(this),this.activeTexture=new no(this),this.viewport=new Fi(this),this.bindFramebuffer=new Pi(this),this.bindRenderbuffer=new Ar(this),this.bindTexture=new ho(this),this.bindVertexBuffer=new vr(this),this.bindElementBuffer=new ro(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Vi(this),this.pixelStoreUnpack=new ii(this),this.pixelStoreUnpackPremultiplyAlpha=new Hn(this),this.pixelStoreUnpackFlipY=new _t(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c){return new wr(this,r,c)}createVertexBuffer(r,c,a){return new Xr(this,r,c,a)}createRenderbuffer(r,c,a){const f=this.gl,d=f.createRenderbuffer();return this.bindRenderbuffer.set(d),f.renderbufferStorage(f.RENDERBUFFER,r,c,a),this.bindRenderbuffer.set(null),d}createFramebuffer(r,c,a){return new On(this,r,c,a)}clear({color:r,depth:c,stencil:a}){const f=this.gl;let d=0;r&&(d|=f.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(d|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==a&&(d|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),f.clear(d)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Ie(r.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class H extends u.Evented{constructor(r,c,a,f){if(super(),this.id=r,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(c,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(r){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=yn(this._options,this.map._requestManager,c,a,(f,d)=>{this._tileJSONRequest=null,this._loaded=!0,f?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),a&&2!==a.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new u.ErrorEvent(f))):d&&(u.extend(this,d),d.bounds&&(this.tileBounds=new Qt(d.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(d.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(f)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}loadTile(r,c){const a=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,u.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(f.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=c:r.request=r.actor.send("reloadTile",f,d.bind(this));else if(r.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",f,d.bind(this),void 0,!0);else{const y=u.loadVectorTile.call({deduped:this._deduped},f,(x,E)=>{x||!E?d.call(this,x):(f.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},r.actor&&r.actor.send("loadTile",f,d.bind(this),void 0,!0))},!0);r.request={cancel:y}}function d(y,x){return delete r.request,r.aborted?c(null):y&&404!==y.status?c(y):(x&&x.resourceTiming&&(r.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&r.setExpiryData(x),r.loadVectorData(x,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class K extends u.Evented{constructor(r,c,a,f){super(),this.id=r,this.dispatcher=a,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},c),u.extend(this,u.pick(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yn(this._options,this.map._requestManager,null,null,(c,a)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new u.ErrorEvent(c)):a&&(u.extend(this,a),a.bounds&&(this.tileBounds=new Qt(a.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(a.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(c)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const a=u.exported.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),a,this.tileSize);r.request=u.getImage(this.map._requestManager.transformRequest(f,u.ResourceType.Tile),(d,y,x,E)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):d?(r.state="errored",c(d)):y?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:x,expires:E}),r.setTexture(y,this.map.painter),r.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(r,c,a){r.setTexture(c,a)}static unloadTileData(r,c){r.texture&&c.saveTileTexture(r.texture)}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c()}unloadTile(r,c){r.texture&&this.map.painter.saveTileTexture(r.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let fe;function Ee(p,r,c,a,f,d,y,x){const E=[p,c,f,r,a,d,1,1,1],C=[y,x,1],R=u.adjoint([],E),[U,Y,oe]=u.transformMat3(C,C,u.transpose(R,R));return u.multiply$1(E,[U,0,0,0,Y,0,0,0,oe],E)}class se extends u.Evented{constructor(r,c,a,f){super(),this.id=r,this.dispatcher=a,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=c,this._dirty=!1}load(r,c){this._loaded=c||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(a,f)=>{if(this._imageRequest=null,this._loaded=!0,a)this.fire(new u.ErrorEvent(a));else if(f){const{HTMLImageElement:d}=u.window;this.image=f instanceof d?u.exported.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const c=r.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(a){let f=1/0,d=1/0,y=-1/0,x=-1/0;for(const U of a)f=Math.min(f,U.x),d=Math.min(d,U.y),y=Math.max(y,U.x),x=Math.max(x,U.y);const E=Math.max(y-f,x-d),C=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),R=Math.pow(2,C);return new u.CanonicalTileID(C,Math.floor((f+y)/2*R),Math.floor((d+x)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const E in this.tiles){const C=this.tiles[E];"loaded"!==C.state&&(C.state="loaded",C.texture=this.texture)}if(this._boundsArray)return;const c=u.tileTransform(this.tileID,this.map.transform.projection),[a,f,d,y]=this.coordinates.map(E=>{const C=c.projection.project(E[0],E[1]);return u.getTilePoint(c,C)._round()});this.perspectiveTransform=function(E,C,R,U,Y,oe,ce,de,me,te){const be=Ee(0,0,E,0,0,C,E,C),ye=Ee(R,U,Y,oe,ce,de,me,te);return u.multiply$1(ye,u.adjoint(be,be),ye),[ye[6]/ye[8]*E/u.EXTENT,ye[7]/ye[8]*C/u.EXTENT]}(this.width,this.height,a.x,a.y,f.x,f.y,y.x,y.y,d.x,d.y);const x=this._boundsArray=new u.StructArrayLayout4i8;x.emplaceBack(a.x,a.y,0,0),x.emplaceBack(f.x,f.y,u.EXTENT,0),x.emplaceBack(y.x,y.y,0,u.EXTENT),x.emplaceBack(d.x,d.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(x,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,c=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new u.Texture(r,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ie={vector:H,raster:K,"raster-dem":class extends K{constructor(p,r,c,a){super(p,r,c,a),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function a(f,d){f&&(p.state="errored",r(f)),d&&(p.dem=d,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=u.getImage(this.map._requestManager.transformRequest(c,u.ResourceType.Tile),function(f,d,y,x){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(f)p.state="errored",r(f);else if(d){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:y,expires:x});const E=u.window.ImageBitmap&&d instanceof u.window.ImageBitmap&&(null==fe&&(fe=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),fe),C=1-(d.width-u.prevPowerOfTwo(d.width))/2;C<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const R=E?d:u.exported.getImageData(d,C),U={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:C};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",U,a.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const r=p.canonical,c=Math.pow(2,r.z),a=(r.x-1+c)%c,f=0===r.x?p.wrap-1:p.wrap,d=(r.x+1+c)%c,y=r.x+1===c?p.wrap+1:p.wrap,x={};return x[new u.OverscaledTileID(p.overscaledZ,f,r.z,a,r.y).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,y,r.z,d,r.y).key]={backfilled:!1},r.y>0&&(x[new u.OverscaledTileID(p.overscaledZ,f,r.z,a,r.y-1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,y,r.z,d,r.y-1).key]={backfilled:!1}),r.y+1<c&&(x[new u.OverscaledTileID(p.overscaledZ,f,r.z,a,r.y+1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,y,r.z,d,r.y+1).key]={backfilled:!1}),x}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends u.Evented{constructor(p,r,c,a){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(a),this._data=r.data,this._options=u.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const f=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*f,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*f,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*f,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},r),this}getClusterLeaves(p,r,c,a){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:r,offset:c},a),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=u.extend({},this.workerOptions),r=this._data;"string"==typeof r?(p.request=this.map._requestManager.transformRequest(u.exported.resolveURL(r),u.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,a)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new u.ErrorEvent(c));else{const f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&a&&a.resourceTiming&&a.resourceTiming[this.id]&&(f.resourceTiming=a.resourceTiming[this.id]),this.fire(new u.Event("data",f)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,r){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(a,f)=>(delete p.request,p.unloadVectorData(),p.aborted?r(null):a?r(a):(p.loadVectorData(f,this.map.painter,"reloadTile"===c),r(null))),void 0,"loadTile"===c)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends se{constructor(p,r,c,a){super(p,r,c,a),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,u.ResourceType.Source).url);u.getVideo(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new u.ErrorEvent(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(p,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:se,canvas:class extends se{constructor(p,r,c,a){super(p,r,c,a),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(f=>!Array.isArray(f)||2!==f.length||f.some(d=>"number"!=typeof d))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends u.Evented{constructor(p,r,c,a){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(a),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Qt(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:c,z:a}=p.canonical;return this._implementation.hasTile({x:r,y:c,z:a})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:c,y:a,z:f}=p.tileID.canonical,d=new u.window.AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:a,z:f},{signal:d.signal})).then(function(y){return delete p.request,p.aborted?(p.state="unloaded",r(null)):void 0===y?(p.state="errored",r(null)):null===y?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null)):(x=y)instanceof u.window.ImageData||x instanceof u.window.HTMLCanvasElement||x instanceof u.window.ImageBitmap||x instanceof u.window.HTMLImageElement?(this.loadTileData(p,y),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var x}.bind(this)).catch(y=>{20!==y.code&&(p.state="errored",r(y))}),p.request.cancel=()=>d.abort()}loadTileData(p,r){K.loadTileData(p,r,this._map.painter)}unloadTileData(p){K.unloadTileData(p,this._map.painter)}unloadTile(p,r){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:c,y:a,z:f}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:a,z:f})}r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},q=function(p,r,c,a){const f=new ie[r.type](p,r,c,a);if(f.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${f.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],f),f};function re(p,r){const c=u.identity([]);return u.scale(c,c,[.5*p.width,.5*-p.height,1]),u.translate(c,c,[1,-1,0]),u.multiply(c,c,p.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(c)}function pe(p,r,c,a,f,d,y,x=!1){const E=p.tilesIn(a,y,x);E.sort(ft);const C=[];for(const U of E)C.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(r,c,p._state,U,f,d,re(p.transform,U.tile.tileID),x)});const R=function(U){const Y={},oe={};for(const ce of U){const de=ce.queryResults,me=ce.wrappedTileID,te=oe[me]=oe[me]||{};for(const be in de){const ye=de[be],De=te[be]=te[be]||{},Re=Y[be]=Y[be]||[];for(const Ae of ye)De[Ae.featureIndex]||(De[Ae.featureIndex]=!0,Re.push(Ae))}}return Y}(C);for(const U in R)R[U].forEach(Y=>{const oe=Y.feature,ce=oe.layer;ce&&"background"!==ce.type&&"sky"!==ce.type&&(oe.source=ce.source,ce["source-layer"]&&(oe.sourceLayer=ce["source-layer"]),oe.state=void 0!==oe.id?p.getFeatureState(ce["source-layer"],oe.id):{})});return R}function Ue(p,r){const c=p.getRenderableIds().map(d=>p.getTileByID(d)),a=[],f={};for(let d=0;d<c.length;d++){const y=c[d],x=y.tileID.canonical.key;f[x]||(f[x]=!0,y.querySourceFeatures(a,r))}return a}function ft(p,r){const c=p.tileID,a=r.tileID;return c.overscaledZ-a.overscaledZ||c.canonical.y-a.canonical.y||c.wrap-a.wrap||c.canonical.x-a.canonical.x}function dt(){return null!=cc.workerClass?new cc.workerClass:new u.window.Worker(cc.workerUrl)}const en="mapboxgl_preloaded_worker_pool";class hn{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<hn.workerCount;)this.workers.push(new dt);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[en]}numActive(){return Object.keys(this.active).length}}let dn;function an(){return dn||(dn=new hn),dn}function or(p,r){const c={};for(const a in p)"ref"!==a&&(c[a]=p[a]);return u.refProperties.forEach(a=>{a in r&&(c[a]=r[a])}),c}function xr(p){p=p.slice();const r=Object.create(null);for(let c=0;c<p.length;c++)r[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=or(p[c],r[p[c].ref]));return p}hn.workerCount=2;const Sn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Cr(p,r,c){c.push({command:Sn.addSource,args:[p,r[p]]})}function kr(p,r,c){r.push({command:Sn.removeSource,args:[p]}),c[p]=!0}function fo(p,r,c,a){kr(p,c,a),Cr(p,r,c)}function yo(p,r,c){let a;for(a in p[c])if(p[c].hasOwnProperty(a)&&"data"!==a&&!Ie(p[c][a],r[c][a]))return!1;for(a in r[c])if(r[c].hasOwnProperty(a)&&"data"!==a&&!Ie(p[c][a],r[c][a]))return!1;return!0}function ht(p,r,c,a,f,d){let y;for(y in r=r||{},p=p||{})p.hasOwnProperty(y)&&(Ie(p[y],r[y])||c.push({command:d,args:[a,y,r[y],f]}));for(y in r)r.hasOwnProperty(y)&&!p.hasOwnProperty(y)&&(Ie(p[y],r[y])||c.push({command:d,args:[a,y,r[y],f]}))}function io(p){return p.id}function Wn(p,r){return p[r.id]=r,p}class _i{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=u.clamp(r,0,1);let c=1,a=this._distances[c];const f=r*this.paddedLength+this.padding;for(;a<f&&c<this._distances.length;)a=this._distances[++c];const d=c-1,y=this._distances[d],x=a-y,E=x>0?(f-y)/x:0;return this.points[d].mult(1-E).add(this.points[c].mult(E))}}class zi{constructor(r,c,a){const f=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(r/a),this.yCellCount=Math.ceil(c/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)f.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,a,f,d){this._forEachCell(c,a,f,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(d)}insertCircle(r,c,a,f){this._forEachCell(c-f,a-f,c+f,a+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(a),this.circles.push(f)}_insertBoxCell(r,c,a,f,d,y){this.boxCells[d].push(y)}_insertCircleCell(r,c,a,f,d,y){this.circleCells[d].push(y)}_query(r,c,a,f,d,y){if(a<0||r>this.width||f<0||c>this.height)return!d&&[];const x=[];if(r<=0&&c<=0&&this.width<=a&&this.height<=f){if(d)return!0;for(let E=0;E<this.boxKeys.length;E++)x.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const C=this.circles[3*E],R=this.circles[3*E+1],U=this.circles[3*E+2];x.push({key:this.circleKeys[E],x1:C-U,y1:R-U,x2:C+U,y2:R+U})}return y?x.filter(y):x}return this._forEachCell(r,c,a,f,this._queryCell,x,{hitTest:d,seenUids:{box:{},circle:{}}},y),d?x.length>0:x}_queryCircle(r,c,a,f,d){const y=r-a,x=r+a,E=c-a,C=c+a;if(x<0||y>this.width||C<0||E>this.height)return!f&&[];const R=[];return this._forEachCell(y,E,x,C,this._queryCellCircle,R,{hitTest:f,circle:{x:r,y:c,radius:a},seenUids:{box:{},circle:{}}},d),f?R.length>0:R}query(r,c,a,f,d){return this._query(r,c,a,f,!1,d)}hitTest(r,c,a,f,d){return this._query(r,c,a,f,!0,d)}hitTestCircle(r,c,a,f){return this._queryCircle(r,c,a,!0,f)}_queryCell(r,c,a,f,d,y,x,E){const C=x.seenUids,R=this.boxCells[d];if(null!==R){const Y=this.bboxes;for(const oe of R)if(!C.box[oe]){C.box[oe]=!0;const ce=4*oe;if(r<=Y[ce+2]&&c<=Y[ce+3]&&a>=Y[ce+0]&&f>=Y[ce+1]&&(!E||E(this.boxKeys[oe]))){if(x.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[oe],x1:Y[ce],y1:Y[ce+1],x2:Y[ce+2],y2:Y[ce+3]})}}}const U=this.circleCells[d];if(null!==U){const Y=this.circles;for(const oe of U)if(!C.circle[oe]){C.circle[oe]=!0;const ce=3*oe;if(this._circleAndRectCollide(Y[ce],Y[ce+1],Y[ce+2],r,c,a,f)&&(!E||E(this.circleKeys[oe]))){if(x.hitTest)return y.push(!0),!0;{const de=Y[ce],me=Y[ce+1],te=Y[ce+2];y.push({key:this.circleKeys[oe],x1:de-te,y1:me-te,x2:de+te,y2:me+te})}}}}}_queryCellCircle(r,c,a,f,d,y,x,E){const C=x.circle,R=x.seenUids,U=this.boxCells[d];if(null!==U){const oe=this.bboxes;for(const ce of U)if(!R.box[ce]){R.box[ce]=!0;const de=4*ce;if(this._circleAndRectCollide(C.x,C.y,C.radius,oe[de+0],oe[de+1],oe[de+2],oe[de+3])&&(!E||E(this.boxKeys[ce])))return y.push(!0),!0}}const Y=this.circleCells[d];if(null!==Y){const oe=this.circles;for(const ce of Y)if(!R.circle[ce]){R.circle[ce]=!0;const de=3*ce;if(this._circlesCollide(oe[de],oe[de+1],oe[de+2],C.x,C.y,C.radius)&&(!E||E(this.circleKeys[ce])))return y.push(!0),!0}}}_forEachCell(r,c,a,f,d,y,x,E){const C=this._convertToXCellCoord(r),R=this._convertToYCellCoord(c),U=this._convertToXCellCoord(a),Y=this._convertToYCellCoord(f);for(let oe=C;oe<=U;oe++)for(let ce=R;ce<=Y;ce++)if(d.call(this,r,c,a,f,this.xCellCount*ce+oe,y,x,E))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,a,f,d,y){const x=f-r,E=d-c,C=a+y;return C*C>x*x+E*E}_circleAndRectCollide(r,c,a,f,d,y,x){const E=(y-f)/2,C=Math.abs(r-(f+E));if(C>E+a)return!1;const R=(x-d)/2,U=Math.abs(c-(d+R));if(U>R+a)return!1;if(C<=E||U<=R)return!0;const Y=C-E,oe=U-R;return Y*Y+oe*oe<=a*a}}const oi=Math.tan(85*Math.PI/180);function Gr(p,r,c,a,f,d,y){const x=u.create();if(c)if("globe"===d.name){const E=u.calculateGlobeLabelMatrix(f,r);u.multiply(x,x,E)}else{const E=Ne([],y);x[0]=E[0],x[1]=E[1],x[4]=E[2],x[5]=E[3],a||u.rotateZ(x,x,f.angle)}else u.multiply(x,f.labelPlaneMatrix,p);return x}function Ks(p,r,c,a,f,d,y){const x=Gr(p,r,c,a,f,d,y);return"globe"===d.name&&c||(x[2]=x[6]=x[10]=x[14]=0),x}function as(p,r,c,a,f,d,y){if(c){if("globe"===d.name){const x=Gr(p,r,c,a,f,d,y);return u.invert(x,x),u.multiply(x,p,x),x}{const x=u.clone(p),E=u.identity([]);return E[0]=y[0],E[1]=y[1],E[4]=y[2],E[5]=y[3],u.multiply(x,x,E),a||u.rotateZ(x,x,-f.angle),x}}return f.glCoordMatrix}function Zt(p,r,c,a){const f=[p,r,c,1];c?u.transformMat4$1(f,f,a):Es(f,f,a);const d=f[3];return f[0]/=d,f[1]/=d,f[2]/=d,f}function Fn(p,r){return Math.min(.5+p/r*.5,1.5)}function Lt(p,r){const c=p[0]/p[3],a=p[1]/p[3];return c>=-r[0]&&c<=r[0]&&a>=-r[1]&&a<=r[1]}function Zn(p,r,c,a,f,d,y,x,E,C){const R=c.transform,U=a?p.textSizeData:p.iconSizeData,Y=u.evaluateSizeForZoom(U,c.transform.zoom),oe="globe"===R.projection.name,ce=[256/c.width*2+1,256/c.height*2+1],de=a?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;de.clear();let me=null;oe&&(me=a?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const te=p.lineVertexArray,be=a?p.text.placedSymbolArray:p.icon.placedSymbolArray,ye=c.transform.width/c.transform.height;let De,Re=!1;for(let Ae=0;Ae<be.length;Ae++){const Be=be.get(Ae),{numGlyphs:He,writingMode:Ze}=Be;if(Ze!==u.WritingMode.vertical||Re||De===u.WritingMode.horizontal||(Re=!0),De=Ze,(Be.hidden||Ze===u.WritingMode.vertical)&&!Re){br(He,de);continue}Re=!1;const Je=new u.pointGeometry(Be.tileAnchorX,Be.tileAnchorY);let{x:Ht,y:We,z:Dt}=R.projection.projectTilePoint(Je.x,Je.y,C.canonical);if(E){const[_r,wn,pn]=E(Je);Ht+=_r,We+=wn,Dt+=pn}const ut=[Ht,We,Dt,1];if(u.transformMat4$1(ut,ut,r),!Lt(ut,ce)){br(He,de);continue}const kt=Fn(c.transform.cameraToCenterDistance,ut[3]),Ke=u.evaluateSizeForFeature(U,Y,Be),Ge=y?Ke/kt:Ke*kt,tt=Zt(Ht,We,Dt,f);if(tt[3]<=0){br(He,de);continue}let It={};const zt=y?null:E,Mn=oo(Be,Ge,!1,x,r,f,d,p.glyphOffsetArray,te,de,me,tt,Je,It,ye,zt,R.projection,C,y);Re=Mn.useVertical,zt&&Mn.needsFlipping&&(It={}),(Mn.notEnoughRoom||Re||Mn.needsFlipping&&oo(Be,Ge,!0,x,r,f,d,p.glyphOffsetArray,te,de,me,tt,Je,It,ye,zt,R.projection,C,y).notEnoughRoom)&&br(He,de)}a?(p.text.dynamicLayoutVertexBuffer.updateData(de),me&&p.text.globeExtVertexBuffer.updateData(me)):(p.icon.dynamicLayoutVertexBuffer.updateData(de),me&&p.icon.globeExtVertexBuffer.updateData(me))}function Nr(p,r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de){const{lineStartIndex:me,glyphStartIndex:te,segment:be}=x,ye=te+x.numGlyphs,De=me+x.lineLength,Re=r.getoffsetX(te),Ae=r.getoffsetX(ye-1),Be=Jn(p*Re,c,a,f,d,y,be,me,De,E,C,R,U,Y,!0,oe,ce,de);if(!Be)return null;const He=Jn(p*Ae,c,a,f,d,y,be,me,De,E,C,R,U,Y,!0,oe,ce,de);return He?{first:Be,last:He}:null}function $n(p,r,c,a){return p===u.WritingMode.horizontal&&Math.abs(a)>Math.abs(c)?{useVertical:!0}:p===u.WritingMode.vertical?a>0?{needsFlipping:!0}:null:0!==r&&(0===(f=c)||Math.abs(a/f)>oi)?1===r?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var f}function oo(p,r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de,me,te,be){const ye=r/24,De=p.lineOffsetX*ye,Re=p.lineOffsetY*ye,{lineStartIndex:Ae,glyphStartIndex:Be,numGlyphs:He,segment:Ze,writingMode:Je,flipState:Ht}=p,We=Ae+p.lineLength,Dt=ut=>{if(R){const[tt,It,zt]=ut.up,Mn=C.length;u.updateGlobeVertexNormal(R,Mn+0,tt,It,zt),u.updateGlobeVertexNormal(R,Mn+1,tt,It,zt),u.updateGlobeVertexNormal(R,Mn+2,tt,It,zt),u.updateGlobeVertexNormal(R,Mn+3,tt,It,zt)}const[kt,Ke,Ge]=ut.point;u.addDynamicAttributes(C,kt,Ke,Ge,ut.angle)};if(He>1){const ut=Nr(ye,x,De,Re,c,U,Y,p,E,d,oe,de,!1,me,te,be);if(!ut)return{notEnoughRoom:!0};if(a&&!c){let[kt,Ke,Ge]=ut.first.point,[tt,It,zt]=ut.last.point;[kt,Ke]=Zt(kt,Ke,Ge,y),[tt,It]=Zt(tt,It,zt,y);const Mn=$n(Je,Ht,(tt-kt)*ce,It-Ke);if(p.flipState=Mn&&Mn.needsFlipping?1:2,Mn)return Mn}Dt(ut.first);for(let kt=Be+1;kt<Be+He-1;kt++){const Ke=Jn(ye*x.getoffsetX(kt),De,Re,c,U,Y,Ze,Ae,We,E,d,oe,de,!1,!1,me,te,be);if(!Ke)return C.length-=4*(kt-Be),{notEnoughRoom:!0};Dt(Ke)}Dt(ut.last)}else{if(a&&!c){const kt=Zt(Y.x,Y.y,0,f),Ke=Ae+Ze+1,Ge=new u.pointGeometry(E.getx(Ke),E.gety(Ke)),tt=Zt(Ge.x,Ge.y,0,f),It=tt[3]>0?tt:Co(Y,Ge,kt,1,f,void 0,me,te.canonical),zt=$n(Je,Ht,(It[0]-kt[0])*ce,It[1]-kt[1]);if(p.flipState=zt&&zt.needsFlipping?1:2,zt)return zt}const ut=Jn(ye*x.getoffsetX(Be),De,Re,c,U,Y,Ze,Ae,We,E,d,oe,de,!1,!1,me,te,be);if(!ut)return{notEnoughRoom:!0};Dt(ut)}return{}}function Yr(p,r,c,a,f){const{x:d,y,z:x}=a.projectTilePoint(p.x,p.y,r);if(!f)return Zt(d,y,x,c);const[E,C,R]=f(p);return Zt(d+E,y+C,x+R,c)}function Co(p,r,c,a,f,d,y,x){const E=Yr(p.sub(r)._unit()._add(p),x,f,y,d);return u.sub(E,c,E),u.normalize(E,E),u.scaleAndAdd(E,c,E,a)}function Jn(p,r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de,me,te){const be=a?p-r:p+r;let ye=be>0?1:-1,De=0;a&&(ye*=-1,De=Math.PI),ye<0&&(De+=Math.PI);let Re=x+y+(ye>0?0:1)|0,Ae=f,Be=f,He=0,Ze=0;const Je=Math.abs(be),Ht=[],We=[];let Dt=d,ut=Dt;const kt=()=>Co(ut,Dt,Be,Je-He+1,R,Y,de,me.canonical);for(;He+Ze<=Je;){if(Re+=ye,Re<x||Re>=E)return null;if(Be=Ae,ut=Dt,Ht.push(Be),oe&&We.push(ut),Dt=new u.pointGeometry(C.getx(Re),C.gety(Re)),Ae=U[Re],!Ae){const pn=Yr(Dt,me.canonical,R,de,Y);Ae=pn[3]>0?U[Re]=pn:kt()}He+=Ze,Ze=u.distance(Be,Ae)}ce&&Y&&(U[Re]&&(Ae=kt(),Ze=u.distance(Be,Ae)),U[Re]=Ae);const Ke=(Je-He)/Ze,Ge=Dt.sub(ut)._mult(Ke)._add(ut),tt=u.sub([],Ae,Be),It=u.scaleAndAdd([],Be,tt,Ke);let zt=[0,0,1],Mn=tt[0],_r=tt[1];if(te&&(zt=de.upVector(me.canonical,Ge.x,Ge.y),0!==zt[0]||0!==zt[1]||1!==zt[2])){const pn=[zt[2],0,-zt[0]],kn=u.cross([],zt,pn);u.normalize(pn,pn),u.normalize(kn,kn),Mn=u.dot(tt,pn),_r=u.dot(tt,kn)}if(c){const pn=u.cross([],zt,tt);u.normalize(pn,pn),u.scaleAndAdd(It,It,pn,c*ye)}const wn=De+Math.atan2(_r,Mn);return Ht.push(It),oe&&We.push(Ge),{point:It,angle:wn,path:Ht,tilePath:We,up:zt}}function br(p,r){const c=r.length,a=c+4*p;r.resize(a),r.float32.fill(-1/0,4*c,4*a)}function Es(p,r,c){const a=r[0],f=r[1];return p[0]=c[0]*a+c[4]*f+c[12],p[1]=c[1]*a+c[5]*f+c[13],p[3]=c[3]*a+c[7]*f+c[15],p}const Ln=100;class ls{constructor(r,c,a=new zi(r.width+200,r.height+200,25),f=new zi(r.width+200,r.height+200,25)){this.transform=r,this.grid=a,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ln,this.screenBottomBoundary=r.height+Ln,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,a,f,d,y,x,E){let C=a.projectedAnchorX,R=a.projectedAnchorY,U=a.projectedAnchorZ;const Y=a.elevation,oe=a.tileID,ce=r.getProjection();if(Y&&oe){const[Ae,Be,He]=ce.upVector(oe.canonical,a.tileAnchorX,a.tileAnchorY),Ze=ce.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=Ae*Y*Ze,R+=Be*Y*Ze,U+=He*Y*Ze}const de=this.projectAndGetPerspectiveRatio(x,C,R,U,a.tileID,"globe"===ce.name||!!Y||this.transform.pitch>0,ce),me=y*de.perspectiveRatio,te=(a.x1*c+f.x-a.padding)*me+de.point.x,be=(a.y1*c+f.y-a.padding)*me+de.point.y,ye=(a.x2*c+f.x+a.padding)*me+de.point.x,De=(a.y2*c+f.y+a.padding)*me+de.point.y,Re=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(te,be,ye,De)||!d&&this.grid.hitTest(te,be,ye,De,E)||Re?{box:[],offscreen:!1,occluded:de.occluded}:{box:[te,be,ye,De],offscreen:this.isOffscreen(te,be,ye,De),occluded:!1}}placeCollisionCircles(r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de){const me=[],te=this.transform.elevation,be=r.getProjection(),ye=te?te.getAtTileOffsetFunc(de,this.transform.center.lat,this.transform.worldSize,be):null,De=new u.pointGeometry(a.tileAnchorX,a.tileAnchorY);let{x:Re,y:Ae,z:Be}=be.projectTilePoint(De.x,De.y,de.canonical);if(ye){const[Ge,tt,It]=ye(De);Re+=Ge,Ae+=tt,Be+=It}const He="globe"===be.name,Ze=this.projectAndGetPerspectiveRatio(x,Re,Ae,Be,de,He||!!te||this.transform.pitch>0,be),{perspectiveRatio:Je}=Ze,Ht=(U?y/Je:y*Je)/u.ONE_EM,We=Zt(Re,Ae,Be,E),Dt=Ze.signedDistanceFromCamera>0?Nr(Ht,d,a.lineOffsetX*Ht,a.lineOffsetY*Ht,!1,We,De,a,f,E,{},te&&!U?ye:null,U&&!!te,be,de,U):null;let ut=!1,kt=!1,Ke=!0;if(Dt&&!Ze.occluded){const Ge=.5*oe*Je+ce,tt=new u.pointGeometry(-100,-100),It=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),zt=new _i,{first:Mn,last:_r}=Dt,wn=Mn.path.length;let pn=[];for(let Nn=wn-1;Nn>=1;Nn--)pn.push(Mn.path[Nn]);for(let Nn=1;Nn<_r.path.length;Nn++)pn.push(_r.path[Nn]);const kn=2.5*Ge;C&&(pn=pn.map(([Nn,Qr,fi],pi)=>(ye&&!He&&(fi=ye(pi<wn-1?Mn.tilePath[wn-1-pi]:_r.tilePath[pi-wn+2])[2]),Zt(Nn,Qr,fi,C))),pn.some(Nn=>Nn[3]<=0)&&(pn=[]));let Mr=[];if(pn.length>0){let Nn=1/0,Qr=-1/0,fi=1/0,pi=-1/0;for(const Di of pn)Nn=Math.min(Nn,Di[0]),fi=Math.min(fi,Di[1]),Qr=Math.max(Qr,Di[0]),pi=Math.max(pi,Di[1]);Qr>=tt.x&&Nn<=It.x&&pi>=tt.y&&fi<=It.y&&(Mr=[pn.map(Di=>new u.pointGeometry(Di[0],Di[1]))],(Nn<tt.x||Qr>It.x||fi<tt.y||pi>It.y)&&(Mr=u.clipLine(Mr,tt.x,tt.y,It.x,It.y)))}for(const Nn of Mr){zt.reset(Nn,.25*Ge);let Qr=0;Qr=zt.length<=.5*Ge?1:Math.ceil(zt.paddedLength/kn)+1;for(let fi=0;fi<Qr;fi++){const pi=fi/Math.max(Qr-1,1),Di=zt.lerp(pi),Oo=Di.x+Ln,Ls=Di.y+Ln;me.push(Oo,Ls,Ge,0);const sl=Oo-Ge,jl=Ls-Ge,Wi=Oo+Ge,Ci=Ls+Ge;if(Ke=Ke&&this.isOffscreen(sl,jl,Wi,Ci),kt=kt||this.isInsideGrid(sl,jl,Wi,Ci),!c&&this.grid.hitTestCircle(Oo,Ls,Ge,Y)&&(ut=!0,!R))return{circles:[],offscreen:!1,collisionDetected:ut,occluded:!1}}}}return{circles:!R&&ut||!kt?[]:me,offscreen:Ke,collisionDetected:ut,occluded:Ze.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let a=1/0,f=1/0,d=-1/0,y=-1/0;for(const R of r){const U=new u.pointGeometry(R.x+Ln,R.y+Ln);a=Math.min(a,U.x),f=Math.min(f,U.y),d=Math.max(d,U.x),y=Math.max(y,U.y),c.push(U)}const x=this.grid.query(a,f,d,y).concat(this.ignoredGrid.query(a,f,d,y)),E={},C={};for(const R of x){const U=R.key;if(void 0===E[U.bucketInstanceId]&&(E[U.bucketInstanceId]={}),E[U.bucketInstanceId][U.featureIndex])continue;const Y=[new u.pointGeometry(R.x1,R.y1),new u.pointGeometry(R.x2,R.y1),new u.pointGeometry(R.x2,R.y2),new u.pointGeometry(R.x1,R.y2)];u.polygonIntersectsPolygon(c,Y)&&(E[U.bucketInstanceId][U.featureIndex]=!0,void 0===C[U.bucketInstanceId]&&(C[U.bucketInstanceId]=[]),C[U.bucketInstanceId].push(U.featureIndex))}return C}insertCollisionBox(r,c,a,f,d){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:f,collisionGroupID:d},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,a,f,d){const y=c?this.ignoredGrid:this.grid,x={bucketInstanceId:a,featureIndex:f,collisionGroupID:d};for(let E=0;E<r.length;E+=4)y.insertCircle(x,r[E],r[E+1],r[E+2])}projectAndGetPerspectiveRatio(r,c,a,f,d,y,x){const E=[c,a,f,1];let C=!1;f||this.transform.pitch>0?(u.transformMat4$1(E,E,r),this.fogState&&d&&"globe"!==x.name&&(C=function(oe,ce,de,me,te,be){const ye=be.calculateFogTileMatrix(te),De=[ce,de,me];return u.transformMat4(De,De,ye),Vt(oe,De,be.pitch,be._fov)}(this.fogState,c,a,f,d.toUnwrapped(),this.transform)>.9)):Es(E,E,r);const R=E[3];return{point:new u.pointGeometry((E[0]/R+1)/2*this.transform.width+Ln,(-E[1]/R+1)/2*this.transform.height+Ln),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(x)/R*.5,1.5),signedDistanceFromCamera:R,occluded:y&&E[2]>R||C}}isOffscreen(r,c,a,f){return a<Ln||r>=this.screenRightBoundary||f<Ln||c>this.screenBottomBoundary}isInsideGrid(r,c,a,f){return a>=0&&r<this.gridRightBoundary&&f>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=u.identity([]);return u.translate(r,r,[-100,-100,0]),r}}function wi(p,r,c){const a=r.createTileMatrix(p,p.worldSize,c.toUnwrapped());return u.multiply(new Float32Array(16),p.projMatrix,a)}function Ys(p,r,c){if(r.projection.name===c.projection.name)return p.projMatrix;const a=c.clone();return a.setProjection(r.projection),wi(a,r.getProjection(),p)}function Ki(p,r,c){return r.name===c.projection.name?p.projMatrix:wi(c,r,p)}class si{constructor(r,c,a,f){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):f&&a?1:0,this.placed=a}isHidden(){return 0===this.opacity&&!this.placed}}class so{constructor(r,c,a,f,d,y=!1){this.text=new si(r?r.text:null,c,a,d),this.icon=new si(r?r.icon:null,c,f,d),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ui{constructor(r,c,a,f=!1){this.text=r,this.icon=c,this.skipFade=a,this.clipped=f}}class Bi{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Ri{constructor(r,c,a,f,d){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=a,this.bucketIndex=f,this.tileID=d}}class Hr{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:a=>a.collisionGroupID===c}}return this.collisionGroups[r]}}function jr(p,r,c,a,f){const{horizontalAlign:d,verticalAlign:y}=u.getAnchorAlignment(p),x=-(d-.5)*r,E=-(y-.5)*c,C=u.evaluateVariableOffset(p,a);return new u.pointGeometry(x+C[0]*f,E+C[1]*f)}function ia(p,r,c,a,f){const d=new u.pointGeometry(p,r);return c&&d._rotate(a?f:-f),d}class Yi{constructor(r,c,a,f,d){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new ls(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Hr(a),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,a,f){const d=a.getBucket(c),y=a.latestFeatureIndex;if(!d||!y||c.id!==d.layerIds[0])return;const x=d.layers[0].layout,E=a.collisionBoxArray,C=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),R=a.tileSize/u.EXTENT,U=a.tileID.toUnwrapped();this.transform.setProjection(d.projection);const Y=(oe=a.tileID,ce=d.getProjection(),de=this.transform,ce.name===this.projection?de.calculateProjMatrix(oe.toUnwrapped()):wi(de,ce,oe));var oe,ce,de;const me="map"===x.get("text-pitch-alignment"),te="map"===x.get("text-rotation-alignment");c.compileFilter();const be=c.dynamicFilter(),ye=c.dynamicFilterNeedsFeature(),De=this.transform.calculatePixelsToTileUnitsMatrix(a),Re=Ks(Y,a.tileID.canonical,me,te,this.transform,d.getProjection(),De);let Ae=null;if(me){const Ze=as(Y,a.tileID.canonical,me,te,this.transform,d.getProjection(),De);Ae=u.multiply([],this.transform.labelPlaneMatrix,Ze)}let Be=null;be&&a.latestFeatureIndex&&(Be={unwrappedTileID:U,dynamicFilter:be,dynamicFilterNeedsFeature:ye,featureIndex:a.latestFeatureIndex}),this.retainedQueryData[d.bucketInstanceId]=new Ri(d.bucketInstanceId,y,d.sourceLayerIndex,d.index,a.tileID);const He={bucket:d,layout:x,posMatrix:Y,textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:Be,scale:C,textPixelRatio:R,holdingForFade:a.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(d.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(f)for(const Ze of d.sortKeyRanges){const{sortKey:Je,symbolInstanceStart:Ht,symbolInstanceEnd:We}=Ze;r.push({sortKey:Je,symbolInstanceStart:Ht,symbolInstanceEnd:We,parameters:He})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:He})}attemptAnchorPlacement(r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de,me,te,be){const{textOffset0:ye,textOffset1:De,crossTileID:Re}=Y,Ae=[ye,De],Be=jr(r,a,f,Ae,d),He=this.collisionIndex.placeCollisionBox(ce,d,c,ia(Be.x,Be.y,y,x,this.transform.angle),U,E,C,R.predicate);if(me){const Ze=ce.getSymbolInstanceIconSize(be,this.transform.zoom,Y.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ce,Ze,me,ia(Be.x,Be.y,y,x,this.transform.angle),U,E,C,R.predicate).box.length)return}if(He.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[Re]&&this.prevPlacement.placements[Re]&&this.prevPlacement.placements[Re].text&&(Ze=this.prevPlacement.variableOffsets[Re].anchor),this.variableOffsets[Re]={textOffset:Ae,width:a,height:f,anchor:r,textScale:d,prevAnchor:Ze},this.markUsedJustification(ce,r,Y,de),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,de,Y),this.placedOrientations[Re]=de),{shift:Be,placedGlyphBoxes:He}}}placeLayerBucketPart(r,c,a,f){const{bucket:d,layout:y,posMatrix:x,textLabelPlaneMatrix:E,labelToScreenMatrix:C,clippingData:R,textPixelRatio:U,holdingForFade:Y,collisionBoxArray:oe,partiallyEvaluatedTextSize:ce,partiallyEvaluatedIconSize:de,collisionGroup:me}=r.parameters,te=y.get("text-optional"),be=y.get("icon-optional"),ye=y.get("text-allow-overlap"),De=y.get("icon-allow-overlap"),Re="map"===y.get("text-rotation-alignment"),Ae="map"===y.get("text-pitch-alignment"),Be="none"!==y.get("icon-text-fit"),He="viewport-y"===y.get("symbol-z-order");this.transform.setProjection(d.projection);let Ze=ye&&(De||!d.hasIconData()||be),Je=De&&(ye||!d.hasTextData()||te);!d.collisionArrays&&oe&&d.deserializeCollisionBoxes(oe),a&&f&&d.updateCollisionDebugBuffers(this.transform.zoom,oe);const Ht=(We,Dt,ut)=>{const{crossTileID:kt,numVerticalGlyphVertices:Ke}=We;if(R){const Wi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ci=null;if(R.dynamicFilterNeedsFeature){const Zr=this.retainedQueryData[d.bucketInstanceId];Ci=R.featureIndex.loadFeature({featureIndex:We.featureIndex,bucketIndex:Zr.bucketIndex,sourceLayerIndex:Zr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(Wi,Ci,this.retainedQueryData[d.bucketInstanceId].tileID.canonical,new u.pointGeometry(We.tileAnchorX,We.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[kt]=new ui(!1,!1,!1,!0),void(c[kt]=!0)}if(c[kt])return;if(Y)return void(this.placements[kt]=new ui(!1,!1,!1));let Ge=!1,tt=!1,It=!0,zt=!1,Mn=!1,_r=null,wn={box:null,offscreen:null,occluded:null},pn={box:null,offscreen:null,occluded:null},kn=null,Mr=null,Nn=null,Qr=0,fi=0,pi=0;ut.textFeatureIndex?Qr=ut.textFeatureIndex:We.useRuntimeCollisionCircles&&(Qr=We.featureIndex),ut.verticalTextFeatureIndex&&(fi=ut.verticalTextFeatureIndex);const Di=Wi=>{Wi.tileID=this.retainedQueryData[d.bucketInstanceId].tileID;const Ci=this.transform.elevation;(Ci||Wi.elevation)&&(Wi.elevation=Ci?Ci.getAtTileOffset(Wi.tileID,Wi.tileAnchorX,Wi.tileAnchorY):0)},Oo=ut.textBox;if(Oo){Di(Oo);const Wi=Zr=>{let co=u.WritingMode.horizontal;if(d.allowVerticalPlacement&&!Zr&&this.prevPlacement){const ps=this.prevPlacement.placedOrientations[kt];ps&&(this.placedOrientations[kt]=ps,co=ps,this.markUsedOrientation(d,co,We))}return co},Ci=(Zr,co)=>{if(d.allowVerticalPlacement&&Ke>0&&ut.verticalTextBox){for(const ps of d.writingModes)if(ps===u.WritingMode.vertical?(wn=co(),pn=wn):wn=Zr(),wn&&wn.box&&wn.box.length)break}else wn=Zr()};if(y.get("text-variable-anchor")){let Zr=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt]){const yi=this.prevPlacement.variableOffsets[kt];Zr.indexOf(yi.anchor)>0&&(Zr=Zr.filter(ms=>ms!==yi.anchor),Zr.unshift(yi.anchor))}const co=(yi,ms,gs)=>{const xl=d.getSymbolInstanceTextSize(ce,We,this.transform.zoom,Dt),qs=(yi.x2-yi.x1)*xl+2*yi.padding,pa=(yi.y2-yi.y1)*xl+2*yi.padding,Ma=Be&&!De?ms:null;Ma&&Di(Ma);let wl={box:[],offscreen:!1,occluded:!1};const bl=ye?2*Zr.length:Zr.length;for(let al=0;al<bl;++al){const zc=this.attemptAnchorPlacement(Zr[al%Zr.length],yi,qs,pa,xl,Re,Ae,U,x,me,al>=Zr.length,We,Dt,d,gs,Ma,ce,de);if(zc&&(wl=zc.placedGlyphBoxes,wl&&wl.box&&wl.box.length)){Ge=!0,_r=zc.shift;break}}return wl};Ci(()=>co(Oo,ut.iconBox,u.WritingMode.horizontal),()=>{const yi=ut.verticalTextBox;return yi&&Di(yi),d.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&Ke>0&&yi?co(yi,ut.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),wn&&(Ge=wn.box,It=wn.offscreen,zt=wn.occluded);const ps=Wi(wn&&wn.box);if(!Ge&&this.prevPlacement){const yi=this.prevPlacement.variableOffsets[kt];yi&&(this.variableOffsets[kt]=yi,this.markUsedJustification(d,yi.anchor,We,ps))}}else{const Zr=(co,ps)=>{const yi=d.getSymbolInstanceTextSize(ce,We,this.transform.zoom,Dt),ms=this.collisionIndex.placeCollisionBox(d,yi,co,new u.pointGeometry(0,0),ye,U,x,me.predicate);return ms&&ms.box&&ms.box.length&&(this.markUsedOrientation(d,ps,We),this.placedOrientations[kt]=ps),ms};Ci(()=>Zr(Oo,u.WritingMode.horizontal),()=>{const co=ut.verticalTextBox;return d.allowVerticalPlacement&&Ke>0&&co?(Di(co),Zr(co,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Wi(wn&&wn.box&&wn.box.length)}}if(kn=wn,Ge=kn&&kn.box&&kn.box.length>0,It=kn&&kn.offscreen,zt=kn&&kn.occluded,We.useRuntimeCollisionCircles){const Wi=d.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex>=0?We.centerJustifiedTextSymbolIndex:We.verticalPlacedTextSymbolIndex),Ci=u.evaluateSizeForFeature(d.textSizeData,ce,Wi),Zr=y.get("text-padding");Mr=this.collisionIndex.placeCollisionCircles(d,ye,Wi,d.lineVertexArray,d.glyphOffsetArray,Ci,x,E,C,a,Ae,me.predicate,We.collisionCircleDiameter*Ci/u.ONE_EM,Zr,this.retainedQueryData[d.bucketInstanceId].tileID),Ge=ye||Mr.circles.length>0&&!Mr.collisionDetected,It=It&&Mr.offscreen,zt=Mr.occluded}if(ut.iconFeatureIndex&&(pi=ut.iconFeatureIndex),ut.iconBox){const Wi=Ci=>{Di(Ci);const Zr=Be&&_r?ia(_r.x,_r.y,Re,Ae,this.transform.angle):new u.pointGeometry(0,0),co=d.getSymbolInstanceIconSize(de,this.transform.zoom,We.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(d,co,Ci,Zr,De,U,x,me.predicate)};pn&&pn.box&&pn.box.length&&ut.verticalIconBox?(Nn=Wi(ut.verticalIconBox),tt=Nn.box.length>0):(Nn=Wi(ut.iconBox),tt=Nn.box.length>0),It=It&&Nn.offscreen,Mn=Nn.occluded}const Ls=te||0===We.numHorizontalGlyphVertices&&0===Ke,sl=be||0===We.numIconVertices;if(Ls||sl?sl?Ls||(tt=tt&&Ge):Ge=tt&&Ge:tt=Ge=tt&&Ge,Ge&&kn&&kn.box&&this.collisionIndex.insertCollisionBox(kn.box,y.get("text-ignore-placement"),d.bucketInstanceId,pn&&pn.box&&fi?fi:Qr,me.ID),tt&&Nn&&this.collisionIndex.insertCollisionBox(Nn.box,y.get("icon-ignore-placement"),d.bucketInstanceId,pi,me.ID),Mr&&(Ge&&this.collisionIndex.insertCollisionCircles(Mr.circles,y.get("text-ignore-placement"),d.bucketInstanceId,Qr,me.ID),a)){const Wi=d.bucketInstanceId;let Ci=this.collisionCircleArrays[Wi];void 0===Ci&&(Ci=this.collisionCircleArrays[Wi]=new Bi);for(let Zr=0;Zr<Mr.circles.length;Zr+=4)Ci.circles.push(Mr.circles[Zr+0]),Ci.circles.push(Mr.circles[Zr+1]),Ci.circles.push(Mr.circles[Zr+2]),Ci.circles.push(Mr.collisionDetected?1:0)}const jl="globe"!==d.projection.name;Ze=Ze&&(jl||!zt),Je=Je&&(jl||!Mn),this.placements[kt]=new ui(Ge||Ze,tt||Je,It||d.justReloaded),c[kt]=!0};if(He){const We=d.getSortedSymbolIndexes(this.transform.angle);for(let Dt=We.length-1;Dt>=0;--Dt){const ut=We[Dt];Ht(d.symbolInstances.get(ut),ut,d.collisionArrays[ut])}}else for(let We=r.symbolInstanceStart;We<r.symbolInstanceEnd;We++)Ht(d.symbolInstances.get(We),We,d.collisionArrays[We]);if(a&&d.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[d.bucketInstanceId];u.invert(We.invProjMatrix,x),We.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(r,c,a,f){const{leftJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:E,crossTileID:C}=a,R=u.getAnchorJustification(c),U=f===u.WritingMode.vertical?E:"left"===R?d:"center"===R?y:"right"===R?x:-1;d>=0&&(r.text.placedSymbolArray.get(d).crossTileID=U>=0&&d!==U?0:C),y>=0&&(r.text.placedSymbolArray.get(y).crossTileID=U>=0&&y!==U?0:C),x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:C),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=U>=0&&E!==U?0:C)}markUsedOrientation(r,c,a){const f=c===u.WritingMode.horizontal||c===u.WritingMode.horizontalOnly?c:0,d=c===u.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C}=a,R=r.text.placedSymbolArray;y>=0&&(R.get(y).placedOrientation=f),x>=0&&(R.get(x).placedOrientation=f),E>=0&&(R.get(E).placedOrientation=f),C>=0&&(R.get(C).placedOrientation=d)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let a=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const f=c?c.symbolFadeChange(r):1,d=c?c.opacities:{},y=c?c.variableOffsets:{},x=c?c.placedOrientations:{};for(const E in this.placements){const C=this.placements[E],R=d[E];R?(this.opacities[E]=new so(R,f,C.text,C.icon,null,C.clipped),a=a||C.text!==R.text.placed||C.icon!==R.icon.placed):(this.opacities[E]=new so(null,f,C.text,C.icon,C.skipFade,C.clipped),a=a||C.text||C.icon)}for(const E in d){const C=d[E];if(!this.opacities[E]){const R=new so(C,f,!1,!1);R.isHidden()||(this.opacities[E]=R,a=a||C.text.placed||C.icon.placed)}}for(const E in y)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=y[E]);for(const E in x)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=x[E]);a?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c){const a={};for(const f of c){const d=f.getBucket(r);d&&f.latestFeatureIndex&&r.id===d.layerIds[0]&&this.updateBucketOpacities(d,a,f.collisionBoxArray)}}updateBucketOpacities(r,c,a){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const f=r.layers[0].layout,d=!!r.layers[0].dynamicFilter(),y=new so(null,0,!1,!1,!0),x=f.get("text-allow-overlap"),E=f.get("icon-allow-overlap"),C=f.get("text-variable-anchor"),R="map"===f.get("text-rotation-alignment"),U="map"===f.get("text-pitch-alignment"),Y="none"!==f.get("icon-text-fit"),oe=new so(null,0,x&&(E||!r.hasIconData()||f.get("icon-optional")),E&&(x||!r.hasTextData()||f.get("text-optional")),!0);!r.collisionArrays&&a&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(a);const ce=(me,te,be)=>{for(let ye=0;ye<te/4;ye++)me.opacityVertexArray.emplaceBack(be)};let de=0;for(let me=0;me<r.symbolInstances.length;me++){const te=r.symbolInstances.get(me),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:ye,crossTileID:De,numIconVertices:Re}=te;let Ae=this.opacities[De];c[De]?Ae=y:Ae||(Ae=oe,this.opacities[De]=Ae),c[De]=!0;const Be=be>0||ye>0,He=Re>0,Ze=this.placedOrientations[De],Je=Ze===u.WritingMode.vertical,Ht=Ze===u.WritingMode.horizontal||Ze===u.WritingMode.horizontalOnly;if(!Be&&!He||Ae.isHidden()||de++,Be){const We=Ts(Ae.text);ce(r.text,be,Je?Ko:We),ce(r.text,ye,Ht?Ko:We);const Dt=Ae.text.isHidden(),{leftJustifiedTextSymbolIndex:ut,centerJustifiedTextSymbolIndex:kt,rightJustifiedTextSymbolIndex:Ke,verticalPlacedTextSymbolIndex:Ge}=te,tt=r.text.placedSymbolArray,It=Dt||Je?1:0;ut>=0&&(tt.get(ut).hidden=It),kt>=0&&(tt.get(kt).hidden=It),Ke>=0&&(tt.get(Ke).hidden=It),Ge>=0&&(tt.get(Ge).hidden=Dt||Ht?1:0);const zt=this.variableOffsets[De];zt&&this.markUsedJustification(r,zt.anchor,te,Ze);const Mn=this.placedOrientations[De];Mn&&(this.markUsedJustification(r,"left",te,Mn),this.markUsedOrientation(r,Mn,te))}if(He){const We=Ts(Ae.icon),{placedIconSymbolIndex:Dt,verticalPlacedIconSymbolIndex:ut}=te,kt=r.icon.placedSymbolArray,Ke=Ae.icon.isHidden()?1:0;Dt>=0&&(ce(r.icon,Re,Je?Ko:We),kt.get(Dt).hidden=Ke),ut>=0&&(ce(r.icon,te.numVerticalIconVertices,Ht?Ko:We),kt.get(ut).hidden=Ke)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const We=r.collisionArrays[me];if(We){let Dt=new u.pointGeometry(0,0),ut=!0;if(We.textBox||We.verticalTextBox){if(C){const Ke=this.variableOffsets[De];Ke?(Dt=jr(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textScale),R&&Dt._rotate(U?this.transform.angle:-this.transform.angle)):ut=!1}d&&(ut=!Ae.clipped),We.textBox&&ao(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!ut||Je,Dt.x,Dt.y),We.verticalTextBox&&ao(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!ut||Ht,Dt.x,Dt.y)}const kt=ut&&Boolean(!Ht&&We.verticalIconBox);We.iconBox&&ao(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,kt,Y?Dt.x:0,Y?Dt.y:0),We.verticalIconBox&&ao(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,!kt,Y?Dt.x:0,Y?Dt.y:0)}}}if(r.fullyClipped=0===de,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=me.invProjMatrix,r.placementViewportMatrix=me.viewportMatrix,r.collisionCircleArray=me.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const a=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*a>r}setStale(){this.stale=!0}}function ao(p,r,c,a,f){p.emplaceBack(r?1:0,c?1:0,a||0,f||0),p.emplaceBack(r?1:0,c?1:0,a||0,f||0),p.emplaceBack(r?1:0,c?1:0,a||0,f||0),p.emplaceBack(r?1:0,c?1:0,a||0,f||0)}const Ns=Math.pow(2,25),Js=Math.pow(2,24),ti=Math.pow(2,17),Ni=Math.pow(2,16),xa=Math.pow(2,9),ki=Math.pow(2,8),Vr=Math.pow(2,1);function Ts(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Ns+r*Js+c*ti+r*Ni+c*xa+r*ki+c*Vr+r}const Ko=0;class So{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,c,a,f,d){const y=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(y,f,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((x,E)=>x.sortKey-E.sortKey));this._currentPartIndex<y.length;){const x=y[this._currentPartIndex];if(c.placeLayerBucketPart(x,this._seenCrossTileIDs,a,0===x.symbolInstanceStart),this._currentPartIndex++,d())return!0}return!1}}class Ji{constructor(r,c,a,f,d,y,x,E){this.placement=new Yi(r,d,y,x,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(r,c,a){const f=u.exported.now(),d=()=>{const y=u.exported.now()-f;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=c[r[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if("symbol"===y.type&&(!y.minzoom||y.minzoom<=x)&&(!y.maxzoom||y.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new So(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Yo=512/u.EXTENT/2;class Fa{constructor(r,c,a){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(let f=0;f<c.length;f++){const d=c.get(f),y=d.key;this.indexedSymbolInstances[y]||(this.indexedSymbolInstances[y]=[]),this.indexedSymbolInstances[y].push({crossTileID:d.crossTileID,coord:this.getScaledCoordinates(d,r)})}}getScaledCoordinates(r,c){const a=Yo/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*u.EXTENT+r.tileAnchorX)*a),y:Math.floor((c.canonical.y*u.EXTENT+r.tileAnchorY)*a)}}findMatches(r,c,a){const f=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let d=0;d<r.length;d++){const y=r.get(d);if(y.crossTileID)continue;const x=this.indexedSymbolInstances[y.key];if(!x)continue;const E=this.getScaledCoordinates(y,c);for(const C of x)if(Math.abs(C.coord.x-E.x)<=f&&Math.abs(C.coord.y-E.y)<=f&&!a[C.crossTileID]){a[C.crossTileID]=!0,y.crossTileID=C.crossTileID;break}}}}class No{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Mo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(0!==c)for(const a in this.indexes){const f=this.indexes[a],d={};for(const y in f){const x=f[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),d[x.tileID.key]=x}this.indexes[a]=d}this.lng=r}addBucket(r,c,a){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let d=0;d<c.symbolInstances.length;d++)c.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const f=this.usedCrossTileIDs[r.overscaledZ];for(const d in this.indexes){const y=this.indexes[d];if(Number(d)>r.overscaledZ)for(const x in y){const E=y[x];E.tileID.isChildOf(r)&&E.findMatches(c.symbolInstances,r,f)}else{const x=y[r.scaledTo(Number(d)).key];x&&x.findMatches(c.symbolInstances,r,f)}}for(let d=0;d<c.symbolInstances.length;d++){const y=c.symbolInstances.get(d);y.crossTileID||(y.crossTileID=a.generate(),f[y.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Fa(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const a in c.indexedSymbolInstances)for(const f of c.indexedSymbolInstances[a])delete this.usedCrossTileIDs[r][f.crossTileID]}removeStaleBuckets(r){let c=!1;for(const a in this.indexes){const f=this.indexes[a];for(const d in f)r[f[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,f[d]),delete f[d],c=!0)}return c}}class za{constructor(){this.layerIndexes={},this.crossTileIDs=new No,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,a,f){let d=this.layerIndexes[r.id];void 0===d&&(d=this.layerIndexes[r.id]=new Mo);let y=!1;const x={};"globe"!==f.name&&d.handleWrapJump(a);for(const E of c){const C=E.getBucket(r);C&&r.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(E.tileID,C,this.crossTileIDs)&&(y=!0),x[C.bucketInstanceId]=!0)}return d.removeStaleBuckets(x)&&(y=!0),y}pruneUnusedLayers(r){const c={};r.forEach(a=>{c[a]=!0});for(const a in this.layerIndexes)c[a]||delete this.layerIndexes[a]}}const Ds=(p,r)=>u.emitValidationErrors(p,r&&r.filter(c=>"source.canvas"!==c.identifier)),cs=u.pick(Sn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Uo=u.pick(Sn,["setCenter","setZoom","setBearing","setPitch"]),oa={version:8,layers:[],sources:{}},Us={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class lo extends u.Evented{constructor(r,c={}){super(),this.map=r,this.dispatcher=new Wt(an(),this),this.imageManager=new sn,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(r._requestManager,c.localFontFamily?u.LocalGlyphMode.all:c.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new za,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const a=this;this._rtlTextPluginCallback=lo.registerForPluginStateChange(f=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(d,y)=>{if(u.triggerPluginCompletionEvent(d),y&&y.every(x=>x))for(const x in a._sourceCaches){const E=a._sourceCaches[x],C=E.getSource().type;"vector"!==C&&"geojson"!==C||E.reload()}})}),this.on("data",f=>{if("source"!==f.dataType||"metadata"!==f.sourceDataType)return;const d=this.getSource(f.sourceId);if(d&&d.vectorLayerIds)for(const y in this._layers){const x=this._layers[y];x.source===d.id&&this._validateLayer(x)}})}loadURL(r,c={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const a="boolean"==typeof c.validate?c.validate:!u.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,c.accessToken);const f=this.map._requestManager.transformRequest(r,u.ResourceType.Style);this._request=u.getJSON(f,(d,y)=>{this._request=null,d?this.fire(new u.ErrorEvent(d)):y&&this._load(y,a)})}loadJSON(r,c={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(r,!1!==c.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(oa,!1)}_updateLayerCount(r,c){const a=c?1:-1;r.is3D()&&(this._num3DLayers+=a),"circle"===r.type&&(this._numCircleLayers+=a),"symbol"===r.type&&(this._numSymbolLayers+=a)}_load(r,c){if(c&&Ds(this,u.validateStyle(r)))return;this._loaded=!0,this.stylesheet=u.clone$1(r),this._updateMapProjection();for(const f in r.sources)this.addSource(f,r.sources[f],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const a=xr(this.stylesheet.layers);this._order=a.map(f=>f.id),this._layers={},this._serializedLayers={};for(let f of a)f=u.createStyleLayer(f),f.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=f,this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Yt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(c,a,f){let d,y,x;const E=u.exported.devicePixelRatio>1?"@2x":"";let C=u.getJSON(a.transformRequest(a.normalizeSpriteURL(c,E,".json"),u.ResourceType.SpriteJSON),(Y,oe)=>{C=null,x||(x=Y,d=oe,U())}),R=u.getImage(a.transformRequest(a.normalizeSpriteURL(c,E,".png"),u.ResourceType.SpriteImage),(Y,oe)=>{R=null,x||(x=Y,y=oe,U())});function U(){if(x)f(x);else if(d&&y){const Y=u.exported.getImageData(y),oe={};for(const ce in d){const{width:de,height:me,x:te,y:be,sdf:ye,pixelRatio:De,stretchX:Re,stretchY:Ae,content:Be}=d[ce],He=new u.RGBAImage({width:de,height:me});u.RGBAImage.copy(Y,He,{x:te,y:be},{x:0,y:0},{width:de,height:me}),oe[ce]={data:He,pixelRatio:De,sdf:ye,stretchX:Re,stretchY:Ae,content:Be}}f(null,oe)}}return{cancel(){C&&(C.cancel(),C=null),R&&(R.cancel(),R=null)}}}(r,this.map._requestManager,(c,a)=>{if(this._spriteRequest=null,c)this.fire(new u.ErrorEvent(c));else if(a)for(const f in a)this.imageManager.addImage(f,a[f]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(r){const c=this.getSource(r.source);if(!c)return;const a=r.sourceLayer;a&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(a))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const c=[];for(const a of r){const f=this._layers[a];"custom"!==f.type&&c.push(f.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&("function"==typeof r.isLayerDraped?r.isLayerDraped():Us[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const c=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(f.length||d.length)&&this._updateWorkerLayers(f,d);for(const y in this._updatedSources){const x=this._updatedSources[y];"reload"===x?this._reloadSource(y):"clear"===x&&this._clearSource(y)}this._updateTilesForChangedImages();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const a={};for(const f in this._sourceCaches){const d=this._sourceCaches[f];a[f]=d.used,d.used=!1}for(const f of this._order){const d=this._layers[f];if(d.recalculate(r,this._availableImages),!d.isHidden(r.zoom)){const x=this._getLayerSourceCache(d);x&&(x.used=!0)}const y=this.map.painter;if(y){const x=d.getProgramIds();if(!x)continue;const E=d.getProgramConfiguration(r.zoom);for(const C of x)y.useProgram(C,E)}}for(const f in a){const d=this._sourceCaches[f];a[f]!==d.used&&d.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Ds(this,u.validateStyle(r)))return!1;(r=u.clone$1(r)).layers=xr(r.layers);const c=function(f,d){if(!f)return[{command:Sn.setStyle,args:[d]}];let y=[];try{if(!Ie(f.version,d.version))return[{command:Sn.setStyle,args:[d]}];Ie(f.center,d.center)||y.push({command:Sn.setCenter,args:[d.center]}),Ie(f.zoom,d.zoom)||y.push({command:Sn.setZoom,args:[d.zoom]}),Ie(f.bearing,d.bearing)||y.push({command:Sn.setBearing,args:[d.bearing]}),Ie(f.pitch,d.pitch)||y.push({command:Sn.setPitch,args:[d.pitch]}),Ie(f.sprite,d.sprite)||y.push({command:Sn.setSprite,args:[d.sprite]}),Ie(f.glyphs,d.glyphs)||y.push({command:Sn.setGlyphs,args:[d.glyphs]}),Ie(f.transition,d.transition)||y.push({command:Sn.setTransition,args:[d.transition]}),Ie(f.light,d.light)||y.push({command:Sn.setLight,args:[d.light]}),Ie(f.fog,d.fog)||y.push({command:Sn.setFog,args:[d.fog]}),Ie(f.projection,d.projection)||y.push({command:Sn.setProjection,args:[d.projection]});const x={},E=[];!function(U,Y,oe,ce){let de;for(de in Y=Y||{},U=U||{})U.hasOwnProperty(de)&&(Y.hasOwnProperty(de)||kr(de,oe,ce));for(de in Y)Y.hasOwnProperty(de)&&(U.hasOwnProperty(de)?Ie(U[de],Y[de])||("geojson"===U[de].type&&"geojson"===Y[de].type&&yo(U,Y,de)?oe.push({command:Sn.setGeoJSONSourceData,args:[de,Y[de].data]}):fo(de,Y,oe,ce)):Cr(de,Y,oe))}(f.sources,d.sources,E,x);const C=[];f.layers&&f.layers.forEach(U=>{U.source&&x[U.source]?y.push({command:Sn.removeLayer,args:[U.id]}):C.push(U)});let R=f.terrain;R&&x[R.source]&&(y.push({command:Sn.setTerrain,args:[void 0]}),R=void 0),y=y.concat(E),Ie(R,d.terrain)||y.push({command:Sn.setTerrain,args:[d.terrain]}),function(U,Y,oe){Y=Y||[];const ce=(U=U||[]).map(io),de=Y.map(io),me=U.reduce(Wn,{}),te=Y.reduce(Wn,{}),be=ce.slice(),ye=Object.create(null);let De,Re,Ae,Be,He,Ze,Je;for(De=0,Re=0;De<ce.length;De++)Ae=ce[De],te.hasOwnProperty(Ae)?Re++:(oe.push({command:Sn.removeLayer,args:[Ae]}),be.splice(be.indexOf(Ae,Re),1));for(De=0,Re=0;De<de.length;De++)Ae=de[de.length-1-De],be[be.length-1-De]!==Ae&&(me.hasOwnProperty(Ae)?(oe.push({command:Sn.removeLayer,args:[Ae]}),be.splice(be.lastIndexOf(Ae,be.length-Re),1)):Re++,Ze=be[be.length-De],oe.push({command:Sn.addLayer,args:[te[Ae],Ze]}),be.splice(be.length-De,0,Ae),ye[Ae]=!0);for(De=0;De<de.length;De++)if(Ae=de[De],Be=me[Ae],He=te[Ae],!ye[Ae]&&!Ie(Be,He))if(Ie(Be.source,He.source)&&Ie(Be["source-layer"],He["source-layer"])&&Ie(Be.type,He.type)){for(Je in ht(Be.layout,He.layout,oe,Ae,null,Sn.setLayoutProperty),ht(Be.paint,He.paint,oe,Ae,null,Sn.setPaintProperty),Ie(Be.filter,He.filter)||oe.push({command:Sn.setFilter,args:[Ae,He.filter]}),Ie(Be.minzoom,He.minzoom)&&Ie(Be.maxzoom,He.maxzoom)||oe.push({command:Sn.setLayerZoomRange,args:[Ae,He.minzoom,He.maxzoom]}),Be)Be.hasOwnProperty(Je)&&"layout"!==Je&&"paint"!==Je&&"filter"!==Je&&"metadata"!==Je&&"minzoom"!==Je&&"maxzoom"!==Je&&(0===Je.indexOf("paint.")?ht(Be[Je],He[Je],oe,Ae,Je.slice(6),Sn.setPaintProperty):Ie(Be[Je],He[Je])||oe.push({command:Sn.setLayerProperty,args:[Ae,Je,He[Je]]}));for(Je in He)He.hasOwnProperty(Je)&&!Be.hasOwnProperty(Je)&&"layout"!==Je&&"paint"!==Je&&"filter"!==Je&&"metadata"!==Je&&"minzoom"!==Je&&"maxzoom"!==Je&&(0===Je.indexOf("paint.")?ht(Be[Je],He[Je],oe,Ae,Je.slice(6),Sn.setPaintProperty):Ie(Be[Je],He[Je])||oe.push({command:Sn.setLayerProperty,args:[Ae,Je,He[Je]]}))}else oe.push({command:Sn.removeLayer,args:[Ae]}),Ze=be[be.lastIndexOf(Ae)+1],oe.push({command:Sn.addLayer,args:[He,Ze]})}(C,d.layers,y)}catch(x){console.warn("Unable to compute style diff:",x),y=[{command:Sn.setStyle,args:[d]}]}return y}(this.serialize(),r).filter(f=>!(f.command in Uo));if(0===c.length)return!1;const a=c.filter(f=>!(f.command in cs));if(a.length>0)throw new Error(`Unimplemented: ${a.map(f=>f.command).join(", ")}.`);return c.forEach(f=>{"setTransition"!==f.command&&"setProjection"!==f.command&&this[f.command].apply(this,f.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,c){return this.getImage(r)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,c),this._afterImageUpdated(r),this)}updateImage(r,c){this.imageManager.updateImage(r,c)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,c,a={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(u.validateSource,`sources.${r}`,c,null,a))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const f=q(r,c,this.dispatcher,this);f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:f.serialize(),sourceId:r}));const d=y=>{const x=(y?"symbol:":"other:")+r,E=this._sourceCaches[x]=new u.SourceCache(x,f,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[r]=E,E.style=this,E.onAdd(this.map)};d(!1),"vector"!==c.type&&"geojson"!==c.type||d(!0),f.onAdd&&f.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const c=this.getSource(r);if(!c)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new u.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new u.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const a=this._getSourceCaches(r);for(const f of a)delete this._sourceCaches[f.id],delete this._updatedSources[f.id],f.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getSource(r).setData(c),this._changed=!0}getSource(r){const c=this._getSourceCache(r);return c&&c.getSource()}_getSources(){const r=[];for(const c in this._otherSourceCaches){const a=this._getSourceCache(c);a&&r.push(a.getSource())}return r}addLayer(r,c,a={}){this._checkLoaded();const f=r.id;if(this.getLayer(f))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${f}" already exists on this map`)));let d;if("custom"===r.type){if(Ds(this,u.validateCustomStyleLayer(r)))return;d=u.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(f,r.source),r=u.clone$1(r),r=u.extend(r,{source:f})),this._validate(u.validateLayer,`layers.${f}`,r,{arrayIndex:-1},a))return;d=u.createStyleLayer(r),this._validateLayer(d),d.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0)}const y=c?this._order.indexOf(c):this._order.length;if(c&&-1===y)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(y,0,f),this._layerOrderChanged=!0,this._layers[f]=d;const x=this._getLayerSourceCache(d);if(this._removedLayers[f]&&d.source&&x&&"custom"!==d.type){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",x.pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,c){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===c)return;const a=this._order.indexOf(r);this._order.splice(a,1);const f=c?this._order.indexOf(c):this._order.length;c&&-1===f?this.fire(new u.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(f,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const c=this._layers[r];if(!c)return void this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const a=this._order.indexOf(r);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=c,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,a){this._checkLoaded();const f=this.getLayer(r);f?f.minzoom===c&&f.maxzoom===a||(null!=c&&(f.minzoom=c),null!=a&&(f.maxzoom=a),this._updateLayer(f)):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,c,a={}){this._checkLoaded();const f=this.getLayer(r);if(f){if(!Ie(f.filter,c))return null==c?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(u.validateFilter,`layers.${f.id}.filter`,c,{layerType:f.type},a)||(f.filter=u.clone$1(c),this._updateLayer(f)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const c=this.getLayer(r);return c&&u.clone$1(c.filter)}setLayoutProperty(r,c,a,f={}){this._checkLoaded();const d=this.getLayer(r);d?Ie(d.getLayoutProperty(c),a)||(d.setLayoutProperty(c,a,f),this._updateLayer(d)):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,c){const a=this.getLayer(r);if(a)return a.getLayoutProperty(c);this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,c,a,f={}){this._checkLoaded();const d=this.getLayer(r);d?Ie(d.getPaintProperty(c),a)||(d.setPaintProperty(c,a,f)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,c){const a=this.getLayer(r);return a&&a.getPaintProperty(c)}setFeatureState(r,c){this._checkLoaded();const a=r.source,f=r.sourceLayer,d=this.getSource(a);if(!d)return void this.fire(new u.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const y=d.type;if("geojson"===y&&f)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===y&&!f)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const x=this._getSourceCaches(a);for(const E of x)E.setFeatureState(f,r.id,c)}removeFeatureState(r,c){this._checkLoaded();const a=r.source,f=this.getSource(a);if(!f)return void this.fire(new u.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const d=f.type,y="vector"===d?r.sourceLayer:void 0;if("vector"===d&&!y)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const x=this._getSourceCaches(a);for(const E of x)E.removeFeatureState(y,r.id,c)}getFeatureState(r){this._checkLoaded();const c=r.source,a=r.sourceLayer,f=this.getSource(c);if(f){if("vector"!==f.type||a)return void 0===r.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(a,r.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const c in this._sourceCaches){const a=this._sourceCaches[c].getSource();r[a.id]||(r[a.id]=a.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(r){this._updatedLayers[r.id]=!0;const c=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[r.source]="reload",c.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=y=>"fill-extrusion"===this._layers[y].type,a={},f=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(c(x)){a[x]=y;for(const E of r){const C=E[x];if(C)for(const R of C)f.push(R)}}}f.sort((y,x)=>x.intersectionZ-y.intersectionZ);const d=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(c(x))for(let E=f.length-1;E>=0;E--){const C=f[E].feature;if(a[C.layer.id]<y)break;d.push(C),f.pop()}else for(const E of r){const C=E[x];if(C)for(const R of C)d.push(R.feature)}}return d}queryRenderedFeatures(r,c,a){c&&c.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const f={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of c.layers){const C=this._layers[E];if(!C)return this.fire(new u.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];f[C.source]=!0}}const d=[];c.availableImages=this._availableImages;const y=c&&c.layers?c.layers.some(E=>{const C=this.getLayer(E);return C&&C.is3D()}):this.has3DLayers(),x=Rn.createFromScreenPoints(r,a);for(const E in this._sourceCaches){const C=this._sourceCaches[E].getSource().id;c.layers&&!f[C]||d.push(pe(this._sourceCaches[E],this._layers,this._serializedLayers,x,c,a,y,!!this.map._showQueryGeometry))}return this.placement&&d.push(function(E,C,R,U,Y,oe,ce){const de={},me=oe.queryRenderedSymbols(U),te=[];for(const be of Object.keys(me).map(Number))te.push(ce[be]);te.sort(ft);for(const be of te){const ye=be.featureIndex.lookupSymbolFeatures(me[be.bucketInstanceId],C,be.bucketIndex,be.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,E);for(const De in ye){const Re=de[De]=de[De]||[],Ae=ye[De];Ae.sort((Be,He)=>{const Ze=be.featureSortOrder;if(Ze){const Je=Ze.indexOf(Be.featureIndex);return Ze.indexOf(He.featureIndex)-Je}return He.featureIndex-Be.featureIndex});for(const Be of Ae)Re.push(Be)}}for(const be in de)de[be].forEach(ye=>{const De=ye.feature,Re=R(E[be]).getFeatureState(De.layer["source-layer"],De.id);De.source=De.layer.source,De.layer["source-layer"]&&(De.sourceLayer=De.layer["source-layer"]),De.state=Re});return de}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),x.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(r,c){c&&c.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const a=this._getSourceCaches(r);let f=[];for(const d of a)f=f.concat(Ue(d,c));return f}addSourceType(r,c,a){return lo.getSourceType(r)?a(new Error(`A source type called "${r}" already exists.`)):(lo.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(r,c={}){this._checkLoaded();const a=this.light.getLight();let f=!1;for(const y in r)if(!Ie(r[y],a[y])){f=!0;break}if(!f)return;const d=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,c),this.light.updateTransitions(d)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,c=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof r.source){const a="terrain-dem-src";this.addSource(a,r.source),r=u.clone$1(r),r=u.extend(r,{source:a})}if(this._validate(u.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(r,c);else{const a=this.terrain,f=a.get();for(const d of Object.keys(u.spec.terrain))!r.hasOwnProperty(d)&&u.spec.terrain[d].default&&(r[d]=u.spec.terrain[d].default);for(const d in r)if(!Ie(r[d],f[d])){a.set(r),this.stylesheet.terrain=r;const y=this._setTransitionParameters({duration:0});a.updateTransitions(y);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new At(r,this.map.transform);this.stylesheet.fog=r;const a=this._setTransitionParameters({duration:0});c.updateTransitions(a)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,a=c.get();0===Object.keys(r).length&&c.set(r);for(const f in r)if(!Ie(r[f],a[f])){c.set(r),this.stylesheet.fog=r;const d=this._setTransitionParameters({duration:0});c.updateTransitions(d);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:u.exported.now(),transition:u.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(a=>this.isLayerDraped(this._layers[a])),c=this._order.filter(a=>!this.isLayerDraped(this._layers[a]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const a=this.terrain=new rr(r,c);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const f=this._setTransitionParameters({duration:0});a.updateTransitions(f)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"symbol"===c.type&&this._updateLayer(c)}}_validate(r,c,a,f,d={}){return(!d||!1!==d.validate)&&Ds(this,r.call(u.validateStyle,u.extend({key:c,style:this.serialize(),value:a,styleSpec:u.spec},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const c=this._getSourceCaches(r);for(const a of c)a.clearTiles()}_reloadSource(r){const c=this._getSourceCaches(r);for(const a of c)a.resume(),a.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const c in this._sourceCaches)this._sourceCaches[c].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,a,f,d=!1){let y=!1,x=!1;const E={};for(const C of this._order){const R=this._layers[C];if("symbol"!==R.type)continue;if(!E[R.source]){const Y=this._getLayerSourceCache(R);if(!Y)continue;E[R.source]=Y.getRenderableIds(!0).map(oe=>Y.getTileByID(oe)).sort((oe,ce)=>ce.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ce.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(R,E[R.source],r.center.lng,r.projection);y=y||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),d=d||this._layerOrderChanged||0===a,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),r.zoom))&&(this.pauseablePlacement=new Ji(r,this._order,d,c,a,f,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),x=!0),y&&this.pauseablePlacement.placement.setStale()),x||y)for(const C of this._order){const R=this._layers[C];"symbol"===R.type&&this.placement.updateLayerOpacities(R,E[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,c,a){this.imageManager.getImages(c.icons,a),this._updateTilesForChangedImages();const f=d=>{d&&d.setDependencies(c.tileID.key,c.type,c.icons)};f(this._otherSourceCaches[c.source]),f(this._symbolSourceCaches[c.source])}getGlyphs(r,c,a){this.glyphManager.getGlyphs(c.stacks,a)}getResource(r,c,a){return u.makeRequest(c,a)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this._getSourceCaches(r);return 0===c.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):c.every(a=>a.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}lo.getSourceType=function(p){return ie[p]},lo.setSourceType=function(p,r){ie[p]=r},lo.registerForPluginStateChange=u.registerForPluginStateChange;var sa="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ba="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Cs="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",aa="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",vo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let la={},Io={};const js=[];us(sa,js),us(Cs,js),us(aa,js),us(vo,js),la=gr("",Cs),Io=gr(vo,aa);const Na=gr("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ca=sa,po="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var wa={background:gr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:gr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:gr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:gr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:gr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:gr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:gr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:gr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:gr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:gr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:gr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:gr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:gr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:gr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:gr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:gr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:gr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:gr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:gr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:gr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:gr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ba),skyboxGradient:gr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ba),skyboxCapture:gr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:gr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function us(p,r){const c=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let a of c)if(a=a.trim(),"#"===a[0]&&a.includes("if")&&!a.includes("endif")){a=a.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=a.split(" ");for(const d of f)r.includes(d)||r.push(d)}}function gr(p,r){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),f={},d=[...js];return us(p,d),us(r,d),{fragmentSource:p=p.replace(c,(y,x,E,C,R)=>(f[R]=!0,"define"===x?`\n#ifndef HAS_UNIFORM_u_${R}\nvarying ${E} ${C} ${R};\n#else\nuniform ${E} ${C} u_${R};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${R}\n    ${E} ${C} ${R} = u_${R};\n#endif\n`)),vertexSource:r=r.replace(c,(y,x,E,C,R)=>{const U="float"===C?"vec2":"vec4",Y=R.match(/color/)?"color":U;return f[R]?"define"===x?`\n#ifndef HAS_UNIFORM_u_${R}\nuniform lowp float u_${R}_t;\nattribute ${E} ${U} a_${R};\nvarying ${E} ${C} ${R};\n#else\nuniform ${E} ${C} u_${R};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${R}\n    ${R} = a_${R};\n#else\n    ${E} ${C} ${R} = u_${R};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${R}\n    ${R} = unpack_mix_${Y}(a_${R}, u_${R}_t);\n#else\n    ${E} ${C} ${R} = u_${R};\n#endif\n`:"define"===x?`\n#ifndef HAS_UNIFORM_u_${R}\nuniform lowp float u_${R}_t;\nattribute ${E} ${U} a_${R};\n#else\nuniform ${E} ${C} u_${R};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${R}\n    ${E} ${C} ${R} = a_${R};\n#else\n    ${E} ${C} ${R} = u_${R};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${R}\n    ${E} ${C} ${R} = unpack_mix_${Y}(a_${R}, u_${R}_t);\n#else\n    ${E} ${C} ${R} = u_${R};\n#endif\n`}),staticAttributes:a,usedDefines:d}}class ba{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,a,f,d,y,x){this.context=r;let E=this.boundPaintVertexBuffers.length!==f.length;for(let R=0;!E&&R<f.length;R++)this.boundPaintVertexBuffers[R]!==f[R]&&(E=!0);let C=this.boundDynamicVertexBuffers.length!==x.length;for(let R=0;!C&&R<x.length;R++)this.boundDynamicVertexBuffers[R]!==x[R]&&(C=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==a||E||C||this.boundIndexBuffer!==d||this.boundVertexOffset!==y)this.freshBind(c,a,f,d,y,x);else{r.bindVertexArrayOES.set(this.vao);for(const R of x)R&&R.bind();d&&d.dynamicDraw&&d.bind()}}freshBind(r,c,a,f,d,y){let x;const E=r.numAttributes,C=this.context,R=C.gl;if(C.extVertexArrayObject)this.vao&&this.destroy(),this.vao=C.extVertexArrayObject.createVertexArrayOES(),C.bindVertexArrayOES.set(this.vao),x=0,this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=f,this.boundVertexOffset=d,this.boundDynamicVertexBuffers=y;else{x=C.currentNumAttributes||0;for(let U=E;U<x;U++)R.disableVertexAttribArray(U)}c.enableAttributes(R,r),c.bind(),c.setVertexAttribPointers(R,r,d);for(const U of a)U.enableAttributes(R,r),U.bind(),U.setVertexAttribPointers(R,r,d);for(const U of y)U&&(U.enableAttributes(R,r),U.bind(),U.setVertexAttribPointers(R,r,d));f&&f.bind(),C.currentNumAttributes=E}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Jo(p,r){const c=Math.pow(2,r.canonical.z),a=r.canonical.y;return[new u.MercatorCoordinate(0,a/c).toLngLat().lat,new u.MercatorCoordinate(0,(a+1)/c).toLngLat().lat]}function hs(p,r,c,a,f,d,y){const x=p.context,E=x.gl,C=c.fbo;if(!C)return;p.prepareDrawTile();const R=p.useProgram("hillshade");x.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get());const U=((de,me,te,be)=>{const ye=te.paint.get("hillshade-shadow-color"),De=te.paint.get("hillshade-highlight-color"),Re=te.paint.get("hillshade-accent-color");let Ae=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===te.paint.get("hillshade-illumination-anchor")&&(Ae-=de.transform.angle);const Be=!de.options.moving;return{u_matrix:be||de.transform.calculateProjMatrix(me.tileID.toUnwrapped(),Be),u_image:0,u_latrange:Jo(0,me.tileID),u_light:[te.paint.get("hillshade-exaggeration"),Ae],u_shadow:ye,u_highlight:De,u_accent:Re}})(p,c,a,p.terrain?r.projMatrix:null);p.prepareDrawProgram(x,R,r.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:oe,tileBoundsSegments:ce}=p.getTileBoundsBuffers(c);R.draw(x,E.TRIANGLES,f,d,y,u.CullFaceMode.disabled,U,a.id,Y,oe,ce)}function Qo(p,r,c){if(!r.needsDEMTextureUpload)return;const a=p.context,f=a.gl;a.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(c.stride);const d=c.getPixels();r.demTexture?r.demTexture.update(d,{premultiply:!1}):r.demTexture=new u.Texture(a,d,f.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Zi(p,r,c,a,f,d){const y=p.context,x=y.gl;if(!r.dem)return;const E=r.dem;if(y.activeTexture.set(x.TEXTURE1),Qo(p,r,E),!r.demTexture)return;r.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const C=E.dim;y.activeTexture.set(x.TEXTURE0);let R=r.fbo;if(!R){const ce=new u.Texture(y,{width:C,height:C,data:null},x.RGBA);ce.bind(x.LINEAR,x.CLAMP_TO_EDGE),R=r.fbo=y.createFramebuffer(C,C,!0),R.colorAttachment.set(ce.texture)}y.bindFramebuffer.set(R.framebuffer),y.viewport.set([0,0,C,C]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:Y,tileBoundsSegments:oe}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(y,x.TRIANGLES,a,f,d,u.CullFaceMode.disabled,((ce,de)=>{const me=de.stride,te=u.create();return u.ortho(te,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(te,te,[0,-u.EXTENT,0]),{u_matrix:te,u_image:1,u_dimension:[me,me],u_zoom:ce.overscaledZ,u_unpack:de.unpackVector}})(r.tileID,E),c.id,U,Y,oe),r.needsHillshadePrepare=!1}const Ao=p=>({u_matrix:new u.UniformMatrix4f(p),u_image0:new u.Uniform1i(p),u_skirt_height:new u.Uniform1f(p)}),xo=(p,r)=>({u_matrix:p,u_image0:0,u_skirt_height:r}),Qi=(p,r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(a),u_merc_matrix:c,u_zoom_transition:f,u_merc_center:d,u_image0:0,u_frustum_tl:y,u_frustum_tr:x,u_frustum_br:E,u_frustum_bl:C,u_globe_pos:R,u_globe_radius:U,u_viewport:Y,u_grid_matrix:ce?Float32Array.from(ce):new Float32Array(9),u_skirt_height:oe});function Vs(p,r){return null!=p&&null!=r&&!(!p.hasData()||!r.hasData())&&null!=p.demTexture&&null!=r.demTexture&&p.tileID.key!==r.tileID.key}const Ss=new class{constructor(){this.operations={}}newMorphing(p,r,c,a,f){if(p in this.operations){const d=this.operations[p];d.to.tileID.key!==c.tileID.key&&(d.queued=c)}else this.operations[p]={startTime:a,phase:0,duration:f,from:r,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const c=this.operations[r];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},hi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ua(p){return 6*Math.pow(1.5,22-p)}function Ms(p,r){const c=1<<p.z;return!r&&(0===p.x||p.x===c-1)||0===p.y||p.y===c-1}const Qn=p=>({u_matrix:p});function $s(p,r,c,a,f){if(f>0){const d=u.exported.now(),y=(d-p.timeAdded)/f,x=r?(d-r.timeAdded)/f:-1,E=c.getSource(),C=a.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),R=!r||Math.abs(r.tileID.overscaledZ-C)>Math.abs(p.tileID.overscaledZ-C),U=R&&p.refreshedUponExpiration?1:u.clamp(R?y:1-x,0,1);return p.refreshedUponExpiration&&y>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Ua extends u.SourceCache{constructor(r){const c={type:"raster-dem",maxzoom:r.transform.maxZoom},a=new Wt(an(),null),f=q("mock-dem",c,a,r.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class jo extends u.SourceCache{constructor(r){const c=q("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Wt(an(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,a){if(r.freezeTileCoverage)return;this.transform=r;const f=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((d,y)=>{if(d[y.key]="",!this._tiles[y.key]){const x=new u.Tile(y,this._source.tileSize*y.overscaleFactor(),r.tileZoom);x.state="loaded",this._tiles[y.key]=x}return d},{});for(const d in this._tiles)d in f||(this.freeFBO(d),this._tiles[d].unloadVectorData(),delete this._tiles[d])}freeFBO(r){const c=this.proxyCachedFBO[r];if(void 0!==c){const a=Object.values(c);this.renderCachePool.push(...a),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Wr extends u.OverscaledTileID{constructor(r,c,a){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=a}}class ha extends u.Elevation{constructor(r,c){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[a,f,d]=function(E){const C=new u.StructArrayLayout2i4,R=new u.StructArrayLayout3ui6,U=131;C.reserve(17161),R.reserve(33800);const Y=u.EXTENT/128,oe=u.EXTENT+Y/2,ce=oe+Y;for(let me=-Y;me<ce;me+=Y)for(let te=-Y;te<ce;te+=Y){const be=te<0||te>oe||me<0||me>oe?24575:0,ye=u.clamp(Math.round(te),0,u.EXTENT),De=u.clamp(Math.round(me),0,u.EXTENT);C.emplaceBack(ye+be,De)}const de=(me,te)=>{const be=te*U+me;R.emplaceBack(be+1,be,be+U),R.emplaceBack(be+U,be+U+1,be+1)};for(let me=1;me<129;me++)for(let te=1;te<129;te++)de(te,me);return[0,129].forEach(me=>{for(let te=0;te<130;te++)de(te,me),de(me,te)}),[C,R,32768]}(),y=r.context;this.gridBuffer=y.createVertexBuffer(a,u.posAttributes.members),this.gridIndexBuffer=y.createIndexBuffer(f),this.gridSegments=u.SegmentVector.simpleSegment(0,0,a.length,f.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,a.length,d),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jo(c.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,u.EXTENT,0,u.EXTENT,0,1);const x=y.gl;this._overlapStencilMode=new u.StencilMode({func:x.GEQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ua(c.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,a){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const f=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(f.get("source")),this._exaggeration=f.get("exaggeration");const d=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const y=this.getScaledDemTileSize();this.sourceCache.update(c,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,d(),this._initializing=!0),d(),c.updateElevation(!0,a),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,a=this.painter.transform;this._initializing&&(this._initializing=0===a._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(a.center),-1),this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=c.getIds().map(E=>{const C=c.getTileByID(E).tileID;return C.projMatrix=a.calculateProjMatrix(C.toUnwrapped()),C});(function(E,C){const R=C.transform.pointCoordinate(C.transform.getCameraPoint()),U=new u.pointGeometry(R.x,R.y);E.sort((Y,oe)=>{if(oe.overscaledZ-Y.overscaledZ)return oe.overscaledZ-Y.overscaledZ;const ce=new u.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),de=new u.pointGeometry(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),me=U.mult(1<<Y.canonical.z);return me.x-=.5,me.y-=.5,me.distSqr(ce)-me.distSqr(de)})})(f,this.painter),this._previousZoom=a.zoom;const d=this.proxyToSource||{};this.proxyToSource={},f.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const y=this._style._sourceCaches;for(const E in y){const C=y[E];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,r[E],d),C.usedForTerrain))continue;const R=r[E];C.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[c.id]=f.map(E=>new Wr(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(d),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const x={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const C=this.terrainTileForTile[E.key];if(!C)continue;const R=C.tileID.key;R in x||(this._visibleDemTiles.push(C),x[R]=R)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const a=this._findTileCoveringTileID(c,this.sourceCache);a&&(this.terrainTileForTile[c.key]=a)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const a in this.terrainTileForTile){const f=this.terrainTileForTile[a],d=f.dem;!d||f.demTexture&&!f.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),Qo(this.painter,f,d))}}_prepareDemTileUniforms(r,c,a,f){if(!c||null==c.demTexture)return!1;const d=r.tileID.canonical,y=Math.pow(2,c.tileID.canonical.z-d.z),x=f||"";return a[`u_dem_tl${x}`]=[d.x*y%1,d.y*y%1],a[`u_dem_scale${x}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,c=r.gl;if(!this._emptyDepthBufferTexture){const a=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(r,a,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const c=this._visibleDemTiles.reduce((a,f)=>{if(!f.dem)return a;const d=f.dem.tree.minimums[0];return d>0&&r++,a+d},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const a=this._getLoadedAreaMinimum(),f=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(a,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let d=this._emptyDEMTexture;return d?d.update(f,{premultiply:!1}):d=this._emptyDEMTexture=new u.Texture(r,f,c.RGBA,{premultiply:!1}),d}setupElevationDraw(r,c,a){const f=this.painter.context,d=f.gl,y=(x=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(x),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var x;y.u_dem_size=this.sourceCache.getSource().tileSize,y.u_exaggeration=this.exaggeration();let E=null,C=null,R=1;if(a&&a.morphing&&this._useVertexMorphing){const U=a.morphing.srcDemTile,Y=a.morphing.dstDemTile;R=a.morphing.phase,U&&Y&&(this._prepareDemTileUniforms(r,U,y,"_prev")&&(C=U),this._prepareDemTileUniforms(r,Y,y)&&(E=Y))}if(C&&E?(f.activeTexture.set(d.TEXTURE2),E.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),f.activeTexture.set(d.TEXTURE4),C.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),y.u_dem_lerp=R):(E=this.terrainTileForTile[r.tileID.key],f.activeTexture.set(d.TEXTURE2),(this._prepareDemTileUniforms(r,E,y)?E.demTexture:this.emptyDEMTexture).bind(d.NEAREST,d.CLAMP_TO_EDGE)),f.activeTexture.set(d.TEXTURE3),a&&a.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE),this._depthFBO&&(y.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE),y.u_depth_size_inv=[1,1]),a&&a.useMeterToDem&&E){const U=(1<<E.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=U}if(a&&a.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=a.labelPlaneMatrixInv),c.setTerrainUniformValues(f,y),"globe"===this.painter.transform.projection.name){const U=this.globeUniformValues(this.painter.transform,r.tileID.canonical,a&&a.useDenormalizedUpVectorScale);c.setGlobeUniformValues(f,U)}}globeUniformValues(r,c,a){const f=r.projection;return{u_tile_tl_up:f.upVector(c,0,0),u_tile_tr_up:f.upVector(c,u.EXTENT,0),u_tile_br_up:f.upVector(c,u.EXTENT,u.EXTENT),u_tile_bl_up:f.upVector(c,0,u.EXTENT),u_tile_up_scale:a?u.globeMetersToEcef(1):f.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,a=this.painter.context;0!==r.length&&(a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,d,y,x,E){if("globe"===f.transform.projection.name)!function(C,R,U,Y,oe){const ce=C.context,de=ce.gl;let me,te;const be=C.options.showTerrainWireframe?2:0,ye=C.transform,De=u.globeUseCustomAntiAliasing(C,ce,ye),Re=(kt,Ke)=>{if(te===kt)return;const Ge=[hi[kt],"PROJECTION_GLOBE_VIEW"];De&&Ge.push("CUSTOM_ANTIALIASING"),Ke&&Ge.push(hi[be]),me=C.useProgram("globeRaster",null,Ge),te=kt},Ae=C.colorModeForRenderPass(),Be=new u.DepthMode(de.LEQUAL,u.DepthMode.ReadWrite,C.depthRangeFor3D);Ss.update(oe);const He=u.calculateGlobeMercatorMatrix(ye),Ze=[u.mercatorXfromLng(ye.center.lng),u.mercatorYfromLat(ye.center.lat)],Je=be?[!1,!0]:[!1],Ht=C.globeSharedBuffers,We=[ye.width*u.exported.devicePixelRatio,ye.height*u.exported.devicePixelRatio],Dt=Float32Array.from(ye.globeMatrix),ut={useDenormalizedUpVectorScale:!0};if(Je.forEach(kt=>{const Ke=C.transform,Ge=ua(Ke.zoom)*R.exaggeration();te=-1;const tt=kt?de.LINES:de.TRIANGLES;for(const It of Y){const zt=U.getTile(It),Mn=u.StencilMode.disabled,_r=R.prevTerrainTileForTile[It.key],wn=R.terrainTileForTile[It.key];Vs(_r,wn)&&Ss.newMorphing(It.key,_r,wn,oe,250),ce.activeTexture.set(de.TEXTURE0),zt.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);const pn=Ss.getMorphValuesForProxy(It.key),kn=pn?1:0;pn&&u.extend$1(ut,{morphing:{srcDemTile:pn.from,dstDemTile:pn.to,phase:u.easeCubicInOut(pn.phase)}});const Mr=u.tileCornersToBounds(It.canonical),Nn=u.getLatitudinalLod(Mr.getCenter().lat),Qr=u.getGridMatrix(It.canonical,Mr,Nn,Ke.worldSize/Ke._pixelsPerMercatorPixel),fi=u.globeNormalizeECEF(u.globeTileBounds(It.canonical)),pi=Qi(Ke.projMatrix,Dt,He,fi,u.globeToMercatorTransition(Ke.zoom),Ze,Ke.frustumCorners.TL,Ke.frustumCorners.TR,Ke.frustumCorners.BR,Ke.frustumCorners.BL,Ke.globeCenterInViewSpace,Ke.globeRadius,We,Ge,Qr);if(Re(kn,kt),R.setupElevationDraw(zt,me,ut),C.prepareDrawProgram(ce,me,It.toUnwrapped()),Ht){const[Di,Oo,Ls]=kt?Ht.getWirefameBuffers(C.context,Nn):Ht.getGridBuffers(Nn,0!==Ge);me.draw(ce,tt,Be,Mn,Ae,u.CullFaceMode.backCCW,pi,"globe_raster",Di,Oo,Ls)}}}),Ht){const kt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];De&&kt.push("CUSTOM_ANTIALIASING"),me=C.useProgram("globeRaster",null,kt);for(const Ke of Y){const{x:Ge,y:tt,z:It}=Ke.canonical,zt=0===tt,Mn=tt===(1<<It)-1,[_r,wn,pn,kn]=Ht.getPoleBuffers(It);if(kn&&(zt||Mn)){const Mr=U.getTile(Ke);ce.activeTexture.set(de.TEXTURE0),Mr.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);let Nn=u.globePoleMatrixForTile(It,Ge,ye);const Qr=u.globeNormalizeECEF(u.globeTileBounds(Ke.canonical)),fi=(pi,Di)=>pi.draw(ce,de.TRIANGLES,Be,u.StencilMode.disabled,Ae,u.CullFaceMode.disabled,Qi(ye.projMatrix,Nn,Nn,Qr,0,Ze,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,We,0),"globe_pole_raster",Di,pn,kn);R.setupElevationDraw(Mr,me,ut),C.prepareDrawProgram(ce,me,Ke.toUnwrapped()),zt&&fi(me,_r),Mn&&(Nn=u.scale(u.create(),Nn,[1,-1,1]),fi(me,wn))}}}}(f,d,y,x,E);else{const C=f.context,R=C.gl;let U,Y;const oe=f.options.showTerrainWireframe?2:0,ce=(ye,De)=>{if(Y===ye)return;const Re=[hi[ye]];De&&Re.push(hi[oe]),U=f.useProgram("terrainRaster",null,Re),Y=ye},de=f.colorModeForRenderPass(),me=new u.DepthMode(R.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D);Ss.update(E);const te=f.transform,be=ua(te.zoom)*d.exaggeration();(oe?[!1,!0]:[!1]).forEach(ye=>{Y=-1;const De=ye?R.LINES:R.TRIANGLES,[Re,Ae]=ye?d.getWirefameBuffer():[d.gridIndexBuffer,d.gridSegments];for(const Be of x){const He=y.getTile(Be),Ze=u.StencilMode.disabled,Je=d.prevTerrainTileForTile[Be.key],Ht=d.terrainTileForTile[Be.key];Vs(Je,Ht)&&Ss.newMorphing(Be.key,Je,Ht,E,250),C.activeTexture.set(R.TEXTURE0),He.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const We=Ss.getMorphValuesForProxy(Be.key),Dt=We?1:0;let ut;We&&(ut={morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:u.easeCubicInOut(We.phase)}});const kt=xo(Be.projMatrix,Ms(Be.canonical,te.renderWorldCopies)?be/10:be);ce(Dt,ye),d.setupElevationDraw(He,U,ut),f.prepareDrawProgram(C,U,Be.toUnwrapped()),U.draw(C,De,me,Ze,de,u.CullFaceMode.backCCW,kt,"terrain_raster",d.gridBuffer,Re,Ae)}})}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const c=this.painter,a=this.painter.context,f=this.proxySourceCache,d=this.proxiedCoords[f.id],y=this._drapedRenderBatches.shift(),x=[],E=c.style.order;let C=0;for(const R of d){const U=f.getTileByID(R.proxyTileKey),Y=f.proxyCachedFBO[R.key]?f.proxyCachedFBO[R.key][r]:void 0,oe=void 0!==Y?f.renderCache[Y]:this.pool[C++],ce=void 0!==Y;if(U.texture=oe.tex,ce&&!oe.dirty){x.push(U.tileID);continue}let de;a.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(a.clear({color:u.Color.transparent,stencil:0}),oe.dirty=!1);for(let me=y.start;me<=y.end;++me){const te=c.style._layers[E[me]];if(te.isHidden(c.transform.zoom))continue;const be=c.style._getLayerSourceCache(te),ye=be?this.proxyToSource[R.key][be.id]:[R];if(!ye)continue;const De=ye;a.viewport.set([0,0,oe.fb.width,oe.fb.height]),de!==(be?be.id:null)&&(this._setupStencil(oe,ye,te,be),de=be?be.id:null),c.renderLayer(c,be,te,De)}this.renderedToTile?(oe.dirty=!0,x.push(U.tileID)):ce||--C,5===C&&(C=0,this.renderToBackBuffer(x))}return this.renderToBackBuffer(x),this.renderingToTexture=!1,a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]),y.end+1}postRender(){}renderCacheEfficiency(r){const c=r.order.length;if(0===c)return{efficiency:100};let a,f=0,d=0,y=!1;for(let x=0;x<c;++x){const E=r._layers[r.order[x]];this._style.isLayerDraped(E)?(y&&++f,++d):y||(y=!0,a=E.id)}return 0===d?{efficiency:100}:{efficiency:100*(1-f/d),firstUndrapedLayer:a}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,c,a){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(d=>d.dem).map(d=>{const y=d.tileID,x=1<<y.overscaledZ,{x:E,y:C}=y.canonical,R=E/x,U=(E+1)/x,Y=C/x,oe=(C+1)/x;return{minx:R,miny:Y,maxx:U,maxy:oe,t:d.dem.tree.raycastRoot(R,Y,U,oe,r,c,a),tile:d}});f.sort((d,y)=>(null!==d.t?d.t:Number.MAX_VALUE)-(null!==y.t?y.t:Number.MAX_VALUE));for(const d of f){if(null==d.t)return null;const y=d.tile.dem.tree.raycast(d.minx,d.miny,d.maxx,d.maxy,r,c,a);if(null!=y)return y}return null}_createFBO(){const r=this.painter.context,c=r.gl,a=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const f=new u.Texture(r,{width:a[0],height:a[1],data:null},c.RGBA);f.bind(c.LINEAR,c.CLAMP_TO_EDGE);const d=r.createFramebuffer(a[0],a[1],!1);return d.colorAttachment.set(f.texture),d.depthAttachment=new Rt(r,d.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,a[0],a[1]),this._stencilRef=0,d.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):d.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:d,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._layers[r],a=c.isHidden(this.painter.transform.zoom);return"custom"===c.type?!a&&c.shouldRedrape():!a&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const a of this._style._getSources())if(a instanceof H){r=!0;break}if(!r)return;const c={};for(let a=0;a<this._style.order.length;++a){const f=this._style._layers[this._style.order[a]],d=this._style._getLayerSourceCache(f);if(d&&!c[d.id]&&!f.isHidden(this.painter.transform.zoom)&&"line"===f.type&&f.widthExpression()instanceof u.ZoomDependentExpression){c[d.id]=!0;for(const y of this.proxyCoords){const x=this.proxyToSource[y.key][d.id];if(x)for(const E of x)this._clearRenderCacheForTile(d.id,E)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof K){r=!0;break}if(!r)return;const c={};for(let a=0;a<this._style.order.length;++a){const f=this._style._layers[this._style.order[a]],d=this._style._getLayerSourceCache(f);if(!d||c[d.id]||f.isHidden(this.painter.transform.zoom)||"raster"!==f.type)continue;const y=f.paint.get("raster-fade-duration");for(const x of this.proxyCoords){const E=this.proxyToSource[x.key][d.id];if(E)for(const C of E){const R=$s(d.getTile(C),d.findLoadedParent(C,0),d,this.painter.transform,y);(1!==R.opacity||0!==R.mix)&&this._clearRenderCacheForTile(d.id,C)}}}}_setupDrapedRenderBatches(){const r=this._style.order,c=r.length;if(0===c)return;const a=[];let f,d=0,y=this._style._layers[r[d]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++d<c;)y=this._style._layers[r[d]];for(;d<c;++d){const x=this._style._layers[r[d]];x.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(x)?void 0===f&&(f=d):void 0!==f&&(a.push({start:f,end:d-1}),f=void 0))}void 0!==f&&a.push({start:f,end:d-1}),this._drapedRenderBatches=a}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const y=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let x=0;x<y.length;++x){const E=Object.values(y[x]);c.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();const a=this.proxyCoords,f=this._tilesDirty;for(let y=a.length-1;y>=0;y--){const x=a[y];if(c.getTileByID(x.key),void 0!==c.proxyCachedFBO[x.key]){const E=r[x.key],C=this.proxyToSource[x.key];let R=0;for(const U in C){const Y=C[U],oe=E[U];if(!oe||oe.length!==Y.length||Y.some((ce,de)=>ce!==oe[de]||f[U]&&f[U].hasOwnProperty(ce.key))){R=-1;break}++R}for(const U in c.proxyCachedFBO[x.key])c.renderCache[c.proxyCachedFBO[x.key][U]].dirty=R<0||R!==Object.values(E).length}}const d=[...this._drapedRenderBatches];d.sort((y,x)=>x.end-x.start-(y.end-y.start));for(const y of d)for(const x of a){if(c.proxyCachedFBO[x.key])continue;let E=c.renderCachePool.pop();void 0===E&&c.renderCache.length<50&&(E=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==E&&(c.proxyCachedFBO[x.key]={},c.proxyCachedFBO[x.key][y.start]=E,c.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,a,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const d=this.painter.context,y=d.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let x;if(a.isTileClipped())x=c.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);x=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+x>255&&(d.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=x,this._overlapStencilMode.ref=this._stencilRef,a.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(r,c){const a=this.painter,f=this.painter.context,d=f.gl;a._tileClippingMaskIDs={},f.setColorMode(u.ColorMode.disabled),f.setDepthMode(u.DepthMode.disabled);const y=a.useProgram("clippingMask");for(const x of r){const E=a._tileClippingMaskIDs[x.key]=--c;y.draw(f,d.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:d.ALWAYS,mask:0},E,255,d.KEEP,d.KEEP,d.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Qn(x.projMatrix),"$clipping",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const a=[r.x,r.y,1,1];u.transformMat4$1(a,a,c.pixelMatrixInverse),u.scale$1(a,a,1/a[3]),a[0]/=c.worldSize,a[1]/=c.worldSize;const f=c._camera.position,d=u.mercatorZfromAltitude(1,c.center.lat),y=[f[0],f[1],f[2]/d,0],x=u.subtract([],a.slice(0,3),y);u.normalize(x,x);const E=this.raycast(y,x,this._exaggeration);return null!==E&&E?(u.scaleAndAdd(y,y,x,E),y[3]=y[2],y[2]*=d,y):null}drawDepth(){const r=this.painter,c=r.context,a=this.proxySourceCache,f=Math.ceil(r.width),d=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===f&&this._depthFBO.height===d||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const y=c.gl,x=c.createFramebuffer(f,d,!0);c.activeTexture.set(y.TEXTURE0);const E=new u.Texture(c,{width:f,height:d,data:null},y.RGBA);E.bind(y.NEAREST,y.CLAMP_TO_EDGE),x.colorAttachment.set(E.texture);const C=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,f,d);x.depthAttachment.set(C),this._depthFBO=x,this._depthTexture=E}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,f,d]),function(y,x,E,C){if("globe"===y.transform.projection.name)return;const R=y.context,U=R.gl;R.clear({depth:1});const Y=y.useProgram("terrainDepth"),oe=new u.DepthMode(U.LESS,u.DepthMode.ReadWrite,y.depthRangeFor3D);for(const ce of C){const de=E.getTile(ce),me=xo(ce.projMatrix,0);x.setupElevationDraw(de,Y),Y.draw(R,U.TRIANGLES,oe,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,me,"terrain_depth",x.gridBuffer,x.gridIndexBuffer,x.gridNoSkirtSegments)}}(r,this,a,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,c,a){if(r.getSource()instanceof se)return this._setupProxiedCoordsForImageSource(r,c,a);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const f=this.proxiedCoords[r.id]=[],d=this.proxyCoords;for(let x=0;x<d.length;x++){const E=d[x],C=this._findTileCoveringTileID(E,r);if(C){const R=this._createProxiedId(E,C,a[E.key]&&a[E.key][r.id]);f.push(R),this.proxyToSource[E.key][r.id]=[R]}}let y=!1;for(let x=0;x<c.length;x++){const E=r.getTile(c[x]);if(!E||!E.hasData())continue;const C=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(C&&C.tileID.canonical.z!==E.tileID.canonical.z){const R=this.proxyToSource[C.tileID.key][r.id],U=this._createProxiedId(C.tileID,E,a[C.tileID.key]&&a[C.tileID.key][r.id]);R?R.splice(R.length-1,0,U):this.proxyToSource[C.tileID.key][r.id]=[U],f.push(U),y=!0}}this._sourceTilesOverlap[r.id]=y}_setupProxiedCoordsForImageSource(r,c,a){if(!r.getSource().loaded())return;const f=this.proxiedCoords[r.id]=[],d=this.proxyCoords,y=r.getSource(),x=new u.pointGeometry(y.tileID.x,y.tileID.y)._div(1<<y.tileID.z),E=y.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((R,U)=>(R.min.x=Math.min(R.min.x,U.x-x.x),R.min.y=Math.min(R.min.y,U.y-x.y),R.max.x=Math.max(R.max.x,U.x-x.x),R.max.y=Math.max(R.max.y,U.y-x.y),R),{min:new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),C=(R,U)=>{const Y=R.wrap+R.canonical.x/(1<<R.canonical.z),oe=R.canonical.y/(1<<R.canonical.z),ce=u.EXTENT/(1<<R.canonical.z),de=U.wrap+U.canonical.x/(1<<U.canonical.z),me=U.canonical.y/(1<<U.canonical.z);return Y+ce<de+E.min.x||Y>de+E.max.x||oe+ce<me+E.min.y||oe>me+E.max.y};for(let R=0;R<d.length;R++){const U=d[R];for(let Y=0;Y<c.length;Y++){const oe=r.getTile(c[Y]);if(!oe||!oe.hasData()||C(U,oe.tileID))continue;const ce=this._createProxiedId(U,oe,a[U.key]&&a[U.key][r.id]),de=this.proxyToSource[U.key][r.id];de?de.push(ce):this.proxyToSource[U.key][r.id]=[ce],f.push(ce)}}}_createProxiedId(r,c,a){let f=this.orthoMatrix;if(a){const d=a.find(y=>y.key===c.tileID.key);if(d)return d}if(c.tileID.key!==r.key){const d=r.canonical.z-c.tileID.canonical.z;let y,x,E;f=u.create();const C=c.tileID.wrap-r.wrap<<r.overscaledZ;d>0?(y=u.EXTENT>>d,x=y*((c.tileID.canonical.x<<d)-r.canonical.x+C),E=y*((c.tileID.canonical.y<<d)-r.canonical.y)):(y=u.EXTENT<<-d,x=u.EXTENT*(c.tileID.canonical.x-(r.canonical.x+C<<-d)),E=u.EXTENT*(c.tileID.canonical.y-(r.canonical.y<<-d))),u.ortho(f,0,y,0,y,0,1),u.translate(f,f,[x,E,0])}return new Wr(c.tileID,r.key,f)}_findTileCoveringTileID(r,c){let a=c.getTile(r);if(a&&a.hasData())return a;const f=this._findCoveringTileCache[c.id],d=f[r.key];if(a=d?c.getTileByID(d):null,a&&a.hasData()||null===d)return a;let y=a?a.tileID:r,x=y.overscaledZ;const E=c.getSource().minzoom,C=[];if(!d){const U=c.getSource().maxzoom;if(r.canonical.z>=U){const Y=r.canonical.z-U;c.getSource().reparseOverscaled?(x=Math.max(r.canonical.z+2,c.transform.tileZoom),y=new u.OverscaledTileID(x,r.wrap,U,r.canonical.x>>Y,r.canonical.y>>Y)):0!==Y&&(x=U,y=new u.OverscaledTileID(x,r.wrap,U,r.canonical.x>>Y,r.canonical.y>>Y))}y.key!==r.key&&(C.push(y.key),a=c.getTile(y))}const R=U=>{C.forEach(Y=>{f[Y]=U}),C.length=0};for(x-=1;x>=E&&(!a||!a.hasData());x--){a&&R(a.tileID.key);const U=y.calculateScaledKey(x);if(a=c.getTileByID(U),a&&a.hasData())break;const Y=f[U];if(null===Y)break;void 0===Y?C.push(U):a=c.getTileByID(Y)}return R(a?a.tileID.key:null),a&&a.hasData()?a:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let a=this._tilesDirty[r];a||(a=this._tilesDirty[r]={}),a[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(c){let a=0;const f=new u.StructArrayLayout2ui4,d=131;for(let y=1;y<129;y++){for(let x=1;x<129;x++)a=y*d+x,f.emplaceBack(a,a+1),f.emplaceBack(a,a+d),f.emplaceBack(a+1,a+d),128===y&&f.emplaceBack(a+d,a+d+1);f.emplaceBack(a+1,a+1+d)}return f}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class es{static cacheKey(r,c,a,f){let d=`${c}${f?f.cacheKey:""}`;for(const y of a)r.usedDefines.includes(y)&&(d+=`/${y}`);return d}constructor(r,c,a,f,d,y){const x=r.gl;this.program=x.createProgram();const E=function(te){const be=[];for(let ye=0;ye<te.length;ye++){if(null===te[ye])continue;const De=te[ye].split(" ");be.push(De.pop())}return be}(a.staticAttributes),C=f?f.getBinderAttributes():[],R=E.concat(C);let U=f?f.defines():[];U=U.concat(y.map(te=>`#define ${te}`));const Y=r.isWebGL2?"#version 300 es\n":"",oe=Y+U.concat(r.extStandardDerivatives&&0===Y.length?"#extension GL_OES_standard_derivatives : enable\n".concat(po):po,po,ca,Na.fragmentSource,Io.fragmentSource,a.fragmentSource).join("\n"),ce=Y+U.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ca,Na.vertexSource,Io.vertexSource,la.vertexSource,a.vertexSource).join("\n"),de=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(de,oe),x.compileShader(de),x.attachShader(this.program,de);const me=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())this.failedToCreate=!0;else{x.shaderSource(me,ce),x.compileShader(me),x.attachShader(this.program,me),this.attributes={},this.numAttributes=R.length;for(let te=0;te<this.numAttributes;te++)R[te]&&(x.bindAttribLocation(this.program,te,R[te]),this.attributes[R[te]]=te);x.linkProgram(this.program),x.deleteShader(me),x.deleteShader(de),this.fixedUniforms=d(r),this.binderUniforms=f?f.getUniforms(r):[],y.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(te=r),u_dem_prev:new u.Uniform1i(te),u_dem_unpack:new u.Uniform4f(te),u_dem_tl:new u.Uniform2f(te),u_dem_scale:new u.Uniform1f(te),u_dem_tl_prev:new u.Uniform2f(te),u_dem_scale_prev:new u.Uniform1f(te),u_dem_size:new u.Uniform1f(te),u_dem_lerp:new u.Uniform1f(te),u_exaggeration:new u.Uniform1f(te),u_depth:new u.Uniform1i(te),u_depth_size_inv:new u.Uniform2f(te),u_meter_to_dem:new u.Uniform1f(te),u_label_plane_matrix_inv:new u.UniformMatrix4f(te)}),y.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new u.Uniform3f(te),u_tile_tr_up:new u.Uniform3f(te),u_tile_br_up:new u.Uniform3f(te),u_tile_bl_up:new u.Uniform3f(te),u_tile_up_scale:new u.Uniform1f(te)}))(r)),y.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new u.UniformMatrix4f(te),u_fog_range:new u.Uniform2f(te),u_fog_color:new u.Uniform4f(te),u_fog_horizon_blend:new u.Uniform1f(te),u_fog_temporal_offset:new u.Uniform1f(te),u_frustum_tl:new u.Uniform3f(te),u_frustum_tr:new u.Uniform3f(te),u_frustum_br:new u.Uniform3f(te),u_frustum_bl:new u.Uniform3f(te),u_globe_pos:new u.Uniform3f(te),u_globe_radius:new u.Uniform1f(te),u_globe_transition:new u.Uniform1f(te),u_is_globe:new u.Uniform1i(te),u_viewport:new u.Uniform2f(te)}))(r))}var te}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const a=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in c)a[f]&&a[f].set(this.program,f,c[f])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const a=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in c)a[f]&&a[f].set(this.program,f,c[f])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const a=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in c)a[f].set(this.program,f,c[f])}}draw(r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de){const me=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(a),r.setStencilMode(f),r.setColorMode(d),r.setCullFace(y);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,x[be]);ce&&ce.setUniforms(this.program,r,this.binderUniforms,Y,{zoom:oe});const te={[me.LINES]:2,[me.TRIANGLES]:3,[me.LINE_STRIP]:1}[c];for(const be of U.get()){const ye=be.vaos||(be.vaos={});(ye[E]||(ye[E]=new ba)).bind(r,this,C,ce?ce.getPaintVertexBuffers():[],R,be.vertexOffset,de||[]),me.drawElements(c,be.primitiveLength*te,me.UNSIGNED_SHORT,be.primitiveOffset*te*2)}}}function Qa(p,r){const c=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,p.transform.tileZoom)/c,f=a*(r.tileID.canonical.x+r.tileID.wrap*c),d=a*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/qt(r,1,p.transform.tileZoom),u_pixel_coord_upper:[f>>16,d>>16],u_pixel_coord_lower:[65535&f,65535&d]}}const Is=u.create(),Gs=(p,r,c,a,f,d,y,x,E,C,R)=>{const U=r.style.light,Y=U.properties.get("position"),oe=[Y.x,Y.y,Y.z],ce=u.create$1();"viewport"===U.properties.get("anchor")&&(u.fromRotation(ce,-r.transform.angle),u.transformMat3(oe,oe,ce));const de=U.properties.get("color"),me=r.transform,te={u_matrix:p,u_lightpos:oe,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+c,u_opacity:a,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Is,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:f,u_edge_radius:d};return"globe"===me.projection.name&&(te.u_tile_id=[y.canonical.x,y.canonical.y,1<<y.canonical.z],te.u_zoom_transition=E,te.u_inv_rot_matrix=R,te.u_merc_center=C,te.u_up_dir=me.projection.upVector(new u.CanonicalTileID(0,0,0),C[0]*u.EXTENT,C[1]*u.EXTENT),te.u_height_lift=x),te},wo=(p,r,c,a,f,d,y,x,E,C,R,U)=>{const Y=Gs(p,r,c,a,f,d,y,E,C,R,U),oe={u_height_factor:-Math.pow(2,y.overscaledZ)/x.tileSize/8};return u.extend(Y,Qa(r,x),oe)},tr=p=>({u_matrix:p}),Qs=(p,r,c)=>u.extend(tr(p),Qa(r,c)),As=(p,r)=>({u_matrix:p,u_world:r}),ea=(p,r,c,a)=>u.extend(Qs(p,r,c),{u_world:a}),bi=u.create(),Ea=(p,r,c,a,f,d)=>{const y=p.transform,x="globe"===y.projection.name;let E;if("map"===d.paint.get("circle-pitch-alignment"))if(x){const R=u.globePixelsToTileUnits(y.zoom,r.canonical)*y._pixelsPerMercatorPixel;E=Float32Array.from([R,0,0,R])}else E=y.calculatePixelsToTileUnitsMatrix(c);else E=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:p.translatePosMatrix(r.projMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:bi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(x){C.u_inv_rot_matrix=a,C.u_merc_center=f,C.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],C.u_zoom_transition=u.globeToMercatorTransition(y.zoom);const R=f[0]*u.EXTENT,U=f[1]*u.EXTENT;C.u_up_dir=y.projection.upVector(new u.CanonicalTileID(0,0,0),R,U)}return C},Po=p=>{const r=[];return"map"===p.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},da=(p,r,c,a)=>{const f=u.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(a),u_extrude_scale:[r.pixelsToGLUnits[0]/f,r.pixelsToGLUnits[1]/f]}},Ta=(p,r,c=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:c}),Ft=u.create(),ar=(p,r,c,a,f,d,y)=>{const x=p.transform,E="globe"===x.projection.name,C=E?u.globePixelsToTileUnits(x.zoom,r.canonical)*x._pixelsPerMercatorPixel:qt(c,1,d),R={u_matrix:r.projMatrix,u_extrude_scale:C,u_intensity:y,u_inv_rot_matrix:Ft,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){R.u_inv_rot_matrix=a,R.u_merc_center=f,R.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],R.u_zoom_transition=u.globeToMercatorTransition(x.zoom);const U=f[0]*u.EXTENT,Y=f[1]*u.EXTENT;R.u_up_dir=x.projection.upVector(new u.CanonicalTileID(0,0,0),U,Y)}return R},ta=(p,r,c,a,f,d,y)=>{const x=p.transform,E=x.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:dl(p,r,c,a),u_pixels_to_tile_units:E,u_device_pixel_ratio:d,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:Ps(c)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$i(r,p.transform),u_alpha_discard_threshold:0,u_trim_offset:y}},el=(p,r,c,a,f)=>{const d=p.transform;return{u_matrix:dl(p,r,c,a),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:f,u_image:0,u_tile_units_to_pixels:$i(r,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function $i(p,r){return 1/qt(p,1,r.tileZoom)}function dl(p,r,c,a){return p.translatePosMatrix(a||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Ps(p){const r=p.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const bo=(p,r,c,a,f,d)=>{return{u_matrix:p,u_tl_parent:r,u_scale_parent:c,u_fade_t:a.mix,u_opacity:a.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(x=f.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=f.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Vo(f.paint.get("raster-hue-rotate")),u_perspective_transform:d};var y,x};function Vo(p){p*=Math.PI/180;const r=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const $o=u.create(),ds=(p,r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de)=>{const me=f.transform,te={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:me.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:me.width/me.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:y,u_coord_matrix:x,u_is_text:+E,u_pitch_with_map:+a,u_texsize:C,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$o,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$o,u_up_vector:[0,-1,0]};return"globe"===de.name&&(te.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],te.u_zoom_transition=U,te.u_inv_rot_matrix=oe,te.u_merc_center=Y,te.u_camera_forward=me._camera.forward(),te.u_ecef_origin=u.globeECEFOrigin(me.globeMatrix,R.toUnwrapped()),te.u_tile_matrix=Float32Array.from(me.globeMatrix),te.u_up_vector=ce),te},kl=(p,r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de,me)=>u.extend(ds(p,r,c,a,f,d,y,x,E,C,U,Y,oe,ce,de,me),{u_gamma_scale:a?f.transform.cameraToCenterDistance*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+R}),Da=(p,r,c,a,f,d,y,x,E,C,R,U,Y,oe,ce,de)=>u.extend(kl(p,r,c,a,f,d,y,x,!0,E,!0,R,U,Y,oe,ce,de),{u_texsize_icon:C,u_texture_icon:1}),Gi=(p,r,c)=>({u_matrix:p,u_opacity:r,u_color:c}),Ro=(p,r,c,a,f)=>u.extend(function(d,y,x){const E=y.imageManager.getPattern(d.toString()),{width:C,height:R}=y.imageManager.getPixelSize(),U=Math.pow(2,x.tileID.overscaledZ),Y=x.tileSize*Math.pow(2,y.transform.tileZoom)/U,oe=Y*(x.tileID.canonical.x+x.tileID.wrap*U),ce=Y*x.tileID.canonical.y;return{u_image:0,u_pattern_tl:E.tl,u_pattern_br:E.br,u_texsize:[C,R],u_pattern_size:E.displaySize,u_tile_units_to_pixels:1/qt(x,1,y.transform.tileZoom),u_pixel_coord_upper:[oe>>16,ce>>16],u_pixel_coord_lower:[65535&oe,65535&ce]}}(a,c,f),{u_matrix:p,u_opacity:r}),fl={fillExtrusion:p=>({u_matrix:new u.UniformMatrix4f(p),u_lightpos:new u.Uniform3f(p),u_lightintensity:new u.Uniform1f(p),u_lightcolor:new u.Uniform3f(p),u_vertical_gradient:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p),u_edge_radius:new u.Uniform1f(p),u_ao:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_up_dir:new u.Uniform3f(p),u_height_lift:new u.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_lightpos:new u.Uniform3f(p),u_lightintensity:new u.Uniform1f(p),u_lightcolor:new u.Uniform3f(p),u_vertical_gradient:new u.Uniform1f(p),u_height_factor:new u.Uniform1f(p),u_edge_radius:new u.Uniform1f(p),u_ao:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_up_dir:new u.Uniform3f(p),u_height_lift:new u.Uniform1f(p),u_image:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p)}),fill:p=>({u_matrix:new u.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_image:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p)}),fillOutline:p=>({u_matrix:new u.UniformMatrix4f(p),u_world:new u.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_world:new u.Uniform2f(p),u_image:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new u.Uniform1f(p),u_extrude_scale:new u.UniformMatrix2f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_up_dir:new u.Uniform3f(p)}),collisionBox:p=>({u_matrix:new u.UniformMatrix4f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_extrude_scale:new u.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new u.UniformMatrix4f(p),u_inv_matrix:new u.UniformMatrix4f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_viewport_size:new u.Uniform2f(p)}),debug:p=>({u_color:new u.UniformColor(p),u_matrix:new u.UniformMatrix4f(p),u_overlay:new u.Uniform1i(p),u_overlay_scale:new u.Uniform1f(p)}),clippingMask:p=>({u_matrix:new u.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new u.Uniform1f(p),u_intensity:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_up_dir:new u.Uniform3f(p)}),heatmapTexture:p=>({u_image:new u.Uniform1i(p),u_color_ramp:new u.Uniform1i(p),u_opacity:new u.Uniform1f(p)}),hillshade:p=>({u_matrix:new u.UniformMatrix4f(p),u_image:new u.Uniform1i(p),u_latrange:new u.Uniform2f(p),u_light:new u.Uniform2f(p),u_shadow:new u.UniformColor(p),u_highlight:new u.UniformColor(p),u_accent:new u.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new u.UniformMatrix4f(p),u_image:new u.Uniform1i(p),u_dimension:new u.Uniform2f(p),u_zoom:new u.Uniform1f(p),u_unpack:new u.Uniform4f(p)}),line:p=>({u_matrix:new u.UniformMatrix4f(p),u_pixels_to_tile_units:new u.UniformMatrix2f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_units_to_pixels:new u.Uniform2f(p),u_dash_image:new u.Uniform1i(p),u_gradient_image:new u.Uniform1i(p),u_image_height:new u.Uniform1f(p),u_texsize:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p),u_alpha_discard_threshold:new u.Uniform1f(p),u_trim_offset:new u.Uniform2f(p)}),linePattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_texsize:new u.Uniform2f(p),u_pixels_to_tile_units:new u.UniformMatrix2f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_image:new u.Uniform1i(p),u_units_to_pixels:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p),u_alpha_discard_threshold:new u.Uniform1f(p)}),raster:p=>({u_matrix:new u.UniformMatrix4f(p),u_tl_parent:new u.Uniform2f(p),u_scale_parent:new u.Uniform1f(p),u_fade_t:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p),u_image0:new u.Uniform1i(p),u_image1:new u.Uniform1i(p),u_brightness_low:new u.Uniform1f(p),u_brightness_high:new u.Uniform1f(p),u_saturation_factor:new u.Uniform1f(p),u_contrast_factor:new u.Uniform1f(p),u_spin_weights:new u.Uniform3f(p),u_perspective_transform:new u.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new u.Uniform1i(p),u_is_size_feature_constant:new u.Uniform1i(p),u_size_t:new u.Uniform1f(p),u_size:new u.Uniform1f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_rotate_symbol:new u.Uniform1i(p),u_aspect_ratio:new u.Uniform1f(p),u_fade_change:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_label_plane_matrix:new u.UniformMatrix4f(p),u_coord_matrix:new u.UniformMatrix4f(p),u_is_text:new u.Uniform1i(p),u_pitch_with_map:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_camera_forward:new u.Uniform3f(p),u_tile_matrix:new u.UniformMatrix4f(p),u_up_vector:new u.Uniform3f(p),u_ecef_origin:new u.Uniform3f(p),u_texture:new u.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new u.Uniform1i(p),u_is_size_feature_constant:new u.Uniform1i(p),u_size_t:new u.Uniform1f(p),u_size:new u.Uniform1f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_rotate_symbol:new u.Uniform1i(p),u_aspect_ratio:new u.Uniform1f(p),u_fade_change:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_label_plane_matrix:new u.UniformMatrix4f(p),u_coord_matrix:new u.UniformMatrix4f(p),u_is_text:new u.Uniform1i(p),u_pitch_with_map:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_texture:new u.Uniform1i(p),u_gamma_scale:new u.Uniform1f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_camera_forward:new u.Uniform3f(p),u_tile_matrix:new u.UniformMatrix4f(p),u_up_vector:new u.Uniform3f(p),u_ecef_origin:new u.Uniform3f(p),u_is_halo:new u.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new u.Uniform1i(p),u_is_size_feature_constant:new u.Uniform1i(p),u_size_t:new u.Uniform1f(p),u_size:new u.Uniform1f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_rotate_symbol:new u.Uniform1i(p),u_aspect_ratio:new u.Uniform1f(p),u_fade_change:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_label_plane_matrix:new u.UniformMatrix4f(p),u_coord_matrix:new u.UniformMatrix4f(p),u_is_text:new u.Uniform1i(p),u_pitch_with_map:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_texsize_icon:new u.Uniform2f(p),u_texture:new u.Uniform1i(p),u_texture_icon:new u.Uniform1i(p),u_gamma_scale:new u.Uniform1f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_is_halo:new u.Uniform1i(p)}),background:p=>({u_matrix:new u.UniformMatrix4f(p),u_opacity:new u.Uniform1f(p),u_color:new u.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_opacity:new u.Uniform1f(p),u_image:new u.Uniform1i(p),u_pattern_tl:new u.Uniform2f(p),u_pattern_br:new u.Uniform2f(p),u_texsize:new u.Uniform2f(p),u_pattern_size:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p)}),terrainRaster:Ao,terrainDepth:Ao,skybox:p=>({u_matrix:new u.UniformMatrix4f(p),u_sun_direction:new u.Uniform3f(p),u_cubemap:new u.Uniform1i(p),u_opacity:new u.Uniform1f(p),u_temporal_offset:new u.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new u.UniformMatrix4f(p),u_color_ramp:new u.Uniform1i(p),u_center_direction:new u.Uniform3f(p),u_radius:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p),u_temporal_offset:new u.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new u.UniformMatrix3f(p),u_sun_direction:new u.Uniform3f(p),u_sun_intensity:new u.Uniform1f(p),u_color_tint_r:new u.Uniform4f(p),u_color_tint_m:new u.Uniform4f(p),u_luminance:new u.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new u.UniformMatrix4f(p),u_globe_matrix:new u.UniformMatrix4f(p),u_normalize_matrix:new u.UniformMatrix4f(p),u_merc_matrix:new u.UniformMatrix4f(p),u_zoom_transition:new u.Uniform1f(p),u_merc_center:new u.Uniform2f(p),u_image0:new u.Uniform1i(p),u_grid_matrix:new u.UniformMatrix3f(p),u_skirt_height:new u.Uniform1f(p),u_frustum_tl:new u.Uniform3f(p),u_frustum_tr:new u.Uniform3f(p),u_frustum_br:new u.Uniform3f(p),u_frustum_bl:new u.Uniform3f(p),u_globe_pos:new u.Uniform3f(p),u_globe_radius:new u.Uniform1f(p),u_viewport:new u.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new u.Uniform3f(p),u_frustum_tr:new u.Uniform3f(p),u_frustum_br:new u.Uniform3f(p),u_frustum_bl:new u.Uniform3f(p),u_horizon:new u.Uniform1f(p),u_transition:new u.Uniform1f(p),u_fadeout_range:new u.Uniform1f(p),u_color:new u.Uniform4f(p),u_high_color:new u.Uniform4f(p),u_space_color:new u.Uniform4f(p),u_star_intensity:new u.Uniform1f(p),u_star_density:new u.Uniform1f(p),u_star_size:new u.Uniform1f(p),u_temporal_offset:new u.Uniform1f(p),u_horizon_angle:new u.Uniform1f(p),u_rotation_matrix:new u.UniformMatrix4f(p)})};let Go;function Q(p,r,c,a,f,d,y){const x=p.context,E=x.gl,C=p.transform,R=p.useProgram("collisionBox"),U=[];let Y=0,oe=0;for(let De=0;De<a.length;De++){const Re=a[De],Ae=r.getTile(Re),Be=Ae.getBucket(c);if(!Be)continue;const He=Ys(Re,Be,C);let Ze=He;0===f[0]&&0===f[1]||(Ze=p.translatePosMatrix(He,Ae,f,d));const Je=y?Be.textCollisionBox:Be.iconCollisionBox,Ht=Be.collisionCircleArray;if(Ht.length>0){const We=u.create(),Dt=Ze;u.mul(We,Be.placementInvProjMatrix,C.glCoordMatrix),u.mul(We,We,Be.placementViewportMatrix),U.push({circleArray:Ht,circleOffset:oe,transform:Dt,invTransform:We,projection:Be.getProjection()}),Y+=Ht.length/4,oe=Y}Je&&(p.terrain&&p.terrain.setupElevationDraw(Ae,R),R.draw(x,E.LINES,u.DepthMode.disabled,u.StencilMode.disabled,p.colorModeForRenderPass(),u.CullFaceMode.disabled,da(Ze,C,Ae,Be.getProjection()),c.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,null,C.zoom,null,[Je.collisionVertexBuffer,Je.collisionVertexBufferExt]))}if(!y||!U.length)return;const ce=p.useProgram("collisionCircle"),de=new u.StructArrayLayout2f1f2i16;de.resize(4*Y),de._trim();let me=0;for(const De of U)for(let Re=0;Re<De.circleArray.length/4;Re++){const Ae=4*Re,Be=De.circleArray[Ae+0],He=De.circleArray[Ae+1],Ze=De.circleArray[Ae+2],Je=De.circleArray[Ae+3];de.emplace(me++,Be,He,Ze,Je,0),de.emplace(me++,Be,He,Ze,Je,1),de.emplace(me++,Be,He,Ze,Je,2),de.emplace(me++,Be,He,Ze,Je,3)}(!Go||Go.length<2*Y)&&(Go=function(De){const Re=2*De,Ae=new u.StructArrayLayout3ui6;Ae.resize(Re),Ae._trim();for(let Be=0;Be<Re;Be++){const He=6*Be;Ae.uint16[He+0]=4*Be+0,Ae.uint16[He+1]=4*Be+1,Ae.uint16[He+2]=4*Be+2,Ae.uint16[He+3]=4*Be+2,Ae.uint16[He+4]=4*Be+3,Ae.uint16[He+5]=4*Be+0}return Ae}(Y));const te=x.createIndexBuffer(Go,!0),be=x.createVertexBuffer(de,u.collisionCircleLayout.members,!0);for(const De of U){const Re={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(ye=C).getCameraToCenterDistance(De.projection),u_viewport_size:[ye.width,ye.height]};ce.draw(x,E.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,p.colorModeForRenderPass(),u.CullFaceMode.disabled,Re,c.id,be,te,u.SegmentVector.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,C.zoom)}var ye;be.destroy(),te.destroy()}const M=u.create();function A({width:p,height:r,anchor:c,textOffset:a,textScale:f},d){const{horizontalAlign:y,verticalAlign:x}=u.getAnchorAlignment(c),E=-(y-.5)*p,C=-(x-.5)*r,R=u.evaluateVariableOffset(c,a);return new u.pointGeometry((E/f+R[0])*d,(C/f+R[1])*d)}function j(p,r,c,a,f,d,y,x,E,C,R){const U=p.text.placedSymbolArray,Y=p.text.dynamicLayoutVertexArray,oe=p.icon.dynamicLayoutVertexArray,ce={},de=p.getProjection(),me=Ki(x,de,d),te=d.elevation,be=de.upVectorScale(x.canonical,d.center.lat,d.worldSize).metersToTile;Y.clear();for(let ye=0;ye<U.length;ye++){const De=U.get(ye),{tileAnchorX:Re,tileAnchorY:Ae,numGlyphs:Be}=De,Ze=De.hidden||!De.crossTileID||p.allowVerticalPlacement&&!De.placedOrientation?null:a[De.crossTileID];if(Ze){let Je=0,Ht=0,We=0;if(te){const Mn=te?te.getAtTileOffset(x,Re,Ae):0,[_r,wn,pn]=de.upVector(x.canonical,Re,Ae);Je=Mn*_r*be,Ht=Mn*wn*be,We=Mn*pn*be}let[Dt,ut,kt,Ke]=Zt(De.projectedAnchorX+Je,De.projectedAnchorY+Ht,De.projectedAnchorZ+We,c?me:y);const Ge=Fn(d.getCameraToCenterDistance(de),Ke);let tt=f.evaluateSizeForFeature(p.textSizeData,C,De)*Ge/u.ONE_EM;c&&(tt*=p.tilePixelRatio/E);const It=A(Ze,tt);c?(({x:Dt,y:ut,z:kt}=de.projectTilePoint(Re+It.x,Ae+It.y,x.canonical)),[Dt,ut,kt]=Zt(Dt+Je,ut+Ht,kt+We,y)):(r&&It._rotate(-d.angle),Dt+=It.x,ut+=It.y,kt=0);const zt=p.allowVerticalPlacement&&De.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let Mn=0;Mn<Be;Mn++)u.addDynamicAttributes(Y,Dt,ut,kt,zt);R&&De.associatedIconIndex>=0&&(ce[De.associatedIconIndex]={x:Dt,y:ut,z:kt,angle:zt})}else br(Be,Y)}if(R){oe.clear();const ye=p.icon.placedSymbolArray;for(let De=0;De<ye.length;De++){const Re=ye.get(De),{numGlyphs:Ae}=Re,Be=ce[De];if(Re.hidden||!Be)br(Ae,oe);else{const{x:He,y:Ze,z:Je,angle:Ht}=Be;for(let We=0;We<Ae;We++)u.addDynamicAttributes(oe,He,Ze,Je,Ht)}}p.icon.dynamicLayoutVertexBuffer.updateData(oe)}p.text.dynamicLayoutVertexBuffer.updateData(Y)}function ne(p,r,c){return c.iconsInText&&r?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function ge(p,r,c,a,f,d,y,x,E,C,R,U){const Y=p.context,oe=Y.gl,ce=p.transform,de="map"===x,me="map"===E,te=de&&"point"!==c.layout.get("symbol-placement"),be=de&&!me&&!te,ye=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let De=!1;const Re=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),Ae=[u.mercatorXfromLng(ce.center.lng),u.mercatorYfromLat(ce.center.lat)],Be=c.layout.get("text-variable-anchor"),He="globe"===ce.projection.name,Ze=[],Je=[0,-1,0];let Ht=Je;!He&&!ce.mercatorFromTransition||de||(Ht=function(We){const Dt=We._camera.getWorldToCamera(We.worldSize,1),ut=u.multiply([],Dt,We.globeMatrix);u.invert(ut,ut);const kt=[0,0,0],Ke=[0,1,0,0];return u.transformMat4$1(Ke,Ke,ut),kt[0]=Ke[0],kt[1]=Ke[1],kt[2]=Ke[2],u.normalize(kt,kt),kt}(ce));for(const We of a){const Dt=r.getTile(We),ut=Dt.getBucket(c);if(!ut||"mercator"===ut.projection.name&&He)continue;const kt=f?ut.text:ut.icon;if(!kt||ut.fullyClipped||!kt.segments.get().length)continue;const Ke=kt.programConfigurations.get(c.id),Ge=f||ut.sdfIcons,tt=f?ut.textSizeData:ut.iconSizeData,It=me||0!==ce.pitch,zt=u.evaluateSizeForZoom(tt,ce.zoom);let Mn,_r,wn,pn,kn=[0,0],Mr=null;if(f)_r=Dt.glyphAtlasTexture,wn=oe.LINEAR,Mn=Dt.glyphAtlasTexture.size,ut.iconsInText&&(kn=Dt.imageAtlasTexture.size,Mr=Dt.imageAtlasTexture,pn=It||p.options.rotating||p.options.zooming||"composite"===tt.kind||"camera"===tt.kind?oe.LINEAR:oe.NEAREST);else{const pa=1!==c.layout.get("icon-size").constantOr(0)||ut.iconsNeedLinear;_r=Dt.imageAtlasTexture,wn=Ge||p.options.rotating||p.options.zooming||pa||It?oe.LINEAR:oe.NEAREST,Mn=Dt.imageAtlasTexture.size}const Nn="globe"===ut.projection.name,Qr=Nn?Ht:Je,fi=Nn?u.globeToMercatorTransition(ce.zoom):0,pi=Ki(We,ut.getProjection(),ce),Di=ce.calculatePixelsToTileUnitsMatrix(Dt),Oo=Gr(pi,Dt.tileID.canonical,me,de,ce,ut.getProjection(),Di),Ls=p.terrain&&me&&te?u.invert(u.create(),Oo):M,sl=as(pi,Dt.tileID.canonical,me,de,ce,ut.getProjection(),Di),jl=Be&&ut.hasTextData(),Wi="none"!==c.layout.get("icon-text-fit")&&jl&&ut.hasIconData();if(te){const pa=ce.elevation,Ma=pa?pa.getAtTileOffsetFunc(We,ce.center.lat,ce.worldSize,ut.getProjection()):null,wl=Ks(pi,Dt.tileID.canonical,me,de,ce,ut.getProjection(),Di);Zn(ut,pi,p,f,wl,sl,me,C,Ma,We)}const Ci=te||f&&Be||Wi,Zr=p.translatePosMatrix(pi,Dt,d,y),co=Ci?M:Oo,ps=p.translatePosMatrix(sl,Dt,d,y,!0),yi=ut.getProjection().createInversionMatrix(ce,We.canonical),ms=[];p.terrainRenderModeElevated()&&me&&ms.push("PITCH_WITH_MAP_TERRAIN"),Nn&&ms.push("PROJECTION_GLOBE_VIEW"),Ci&&ms.push("PROJECTED_POS_ON_VIEWPORT");const gs=Ge&&0!==c.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1);let xl;xl=Ge?ut.iconsInText?Da(tt.kind,zt,be,me,p,Zr,co,ps,Mn,kn,We,fi,Ae,yi,Qr,ut.getProjection()):kl(tt.kind,zt,be,me,p,Zr,co,ps,f,Mn,!0,We,fi,Ae,yi,Qr,ut.getProjection()):ds(tt.kind,zt,be,me,p,Zr,co,ps,f,Mn,We,fi,Ae,yi,Qr,ut.getProjection());const qs={program:p.useProgram(ne(Ge,f,ut),Ke,ms),buffers:kt,uniformValues:xl,atlasTexture:_r,atlasTextureIcon:Mr,atlasInterpolation:wn,atlasInterpolationIcon:pn,isSDF:Ge,hasHalo:gs,tile:Dt,labelPlaneMatrixInv:Ls};if(ye&&ut.canOverlap){De=!0;const pa=kt.segments.get();for(const Ma of pa)Ze.push({segments:new u.SegmentVector([Ma]),sortKey:Ma.sortKey,state:qs})}else Ze.push({segments:kt.segments,sortKey:0,state:qs})}De&&Ze.sort((We,Dt)=>We.sortKey-Dt.sortKey);for(const We of Ze){const Dt=We.state;if(p.terrain&&p.terrain.setupElevationDraw(Dt.tile,Dt.program,{useDepthForOcclusion:!He,labelPlaneMatrixInv:Dt.labelPlaneMatrixInv}),Y.activeTexture.set(oe.TEXTURE0),Dt.atlasTexture.bind(Dt.atlasInterpolation,oe.CLAMP_TO_EDGE),Dt.atlasTextureIcon&&(Y.activeTexture.set(oe.TEXTURE1),Dt.atlasTextureIcon&&Dt.atlasTextureIcon.bind(Dt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),Dt.isSDF){const ut=Dt.uniformValues;Dt.hasHalo&&(ut.u_is_halo=1,Oe(Dt.buffers,We.segments,c,p,Dt.program,Re,R,U,ut)),ut.u_is_halo=0}Oe(Dt.buffers,We.segments,c,p,Dt.program,Re,R,U,Dt.uniformValues)}}function Oe(p,r,c,a,f,d,y,x,E){const C=a.context,R=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];f.draw(C,C.gl.TRIANGLES,d,y,x,u.CullFaceMode.disabled,E,c.id,p.layoutVertexBuffer,p.indexBuffer,r,c.paint,a.transform.zoom,p.programConfigurations.get(c.id),R)}function ze(p,r,c,a,f,d,y){const x=p.context.gl,E=c.paint.get("fill-pattern"),C=E&&E.constantOr(1);let R,U,Y,oe,ce;y?(U=C&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=x.LINES):(U=C?"fillPattern":"fill",R=x.TRIANGLES);for(const de of a){const me=r.getTile(de);if(C&&!me.patternsLoaded())continue;const te=me.getBucket(c);if(!te)continue;p.prepareDrawTile();const be=te.programConfigurations.get(c.id),ye=p.useProgram(U,be);C&&(p.context.activeTexture.set(x.TEXTURE0),me.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),be.updatePaintBuffers());const De=E.constantOr(null);if(De&&me.imageAtlas){const Ae=me.imageAtlas.patternPositions[De.toString()];Ae&&be.setConstantPatternPositions(Ae)}const Re=p.translatePosMatrix(de.projMatrix,me,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(y){oe=te.indexBuffer2,ce=te.segments2;const Ae=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[x.drawingBufferWidth,x.drawingBufferHeight];Y="fillOutlinePattern"===U&&C?ea(Re,p,me,Ae):As(Re,Ae)}else oe=te.indexBuffer,ce=te.segments,Y=C?Qs(Re,p,me):tr(Re);p.prepareDrawProgram(p.context,ye,de.toUnwrapped()),ye.draw(p.context,R,f,p.stencilModeForClipping(de),d,u.CullFaceMode.disabled,Y,c.id,te.layoutVertexBuffer,oe,ce,c.paint,p.transform.zoom,be)}}function Qe(p,r,c,a,f,d,y){const x=p.context,E=x.gl,C=p.transform,R=c.paint.get("fill-extrusion-pattern"),U=R.constantOr(1),Y=c.paint.get("fill-extrusion-opacity"),oe=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],ce=c.layout.get("fill-extrusion-edge-radius"),de="globe"===C.projection.name?u.fillExtrusionHeightLift():0,me="globe"===C.projection.name,te=me?u.globeToMercatorTransition(C.zoom):0,be=[u.mercatorXfromLng(C.center.lng),u.mercatorYfromLat(C.center.lat)],ye=[];me&&ye.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&ye.push("FAUX_AO");for(const De of a){const Re=r.getTile(De),Ae=Re.getBucket(c);if(!Ae||Ae.projection.name!==C.projection.name)continue;const Be=Ae.programConfigurations.get(c.id),He=p.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Be,ye);if(p.terrain){const kt=p.terrain;if(p.style.terrainSetForDrapingOnly())kt.setupElevationDraw(Re,He,{useMeterToDem:!0});else{if(!Ae.enableTerrain)continue;if(kt.setupElevationDraw(Re,He,{useMeterToDem:!0}),Et(x,r,De,Ae,c,kt),!Ae.centroidVertexBuffer){const Ke=He.attributes.a_centroid_pos;void 0!==Ke&&E.vertexAttrib2f(Ke,0,0)}}}U&&(p.context.activeTexture.set(E.TEXTURE0),Re.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Be.updatePaintBuffers());const Ze=R.constantOr(null);if(Ze&&Re.imageAtlas){const kt=Re.imageAtlas.patternPositions[Ze.toString()];kt&&Be.setConstantPatternPositions(kt)}const Je=p.translatePosMatrix(De.projMatrix,Re,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ht=C.projection.createInversionMatrix(C,De.canonical),We=c.paint.get("fill-extrusion-vertical-gradient"),Dt=U?wo(Je,p,We,Y,oe,ce,De,Re,de,te,be,Ht):Gs(Je,p,We,Y,oe,ce,De,de,te,be,Ht);p.prepareDrawProgram(x,He,De.toUnwrapped());const ut=[];p.terrain&&ut.push(Ae.centroidVertexBuffer),me&&ut.push(Ae.layoutVertexExtBuffer),He.draw(x,x.gl.TRIANGLES,f,d,y,u.CullFaceMode.backCCW,Dt,c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,c.paint,p.transform.zoom,Be,ut)}}function Et(p,r,c,a,f,d){const y=[te=>{let be=te.canonical.x-1,ye=te.wrap;return be<0&&(be=(1<<te.canonical.z)-1,ye--),new u.OverscaledTileID(te.overscaledZ,ye,te.canonical.z,be,te.canonical.y)},te=>{let be=te.canonical.x+1,ye=te.wrap;return be===1<<te.canonical.z&&(be=0,ye++),new u.OverscaledTileID(te.overscaledZ,ye,te.canonical.z,be,te.canonical.y)},te=>new u.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,(0===te.canonical.y?1<<te.canonical.z:te.canonical.y)-1),te=>new u.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,te.canonical.y===(1<<te.canonical.z)-1?0:te.canonical.y+1)],x=te=>{const be=r.getSource().minzoom,ye=Re=>{const Ae=r.getTileByID(Re);if(Ae&&Ae.hasData())return Ae.getBucket(f)},De=[0,-1,1];for(const Re of De){if(te.overscaledZ+Re<be)continue;const Ae=ye(te.calculateScaledKey(te.overscaledZ+Re));if(Ae)return Ae}},E=[0,0,0],C=(te,be)=>(E[0]=Math.min(te.min.y,be.min.y),E[1]=Math.max(te.max.y,be.max.y),E[2]=u.EXTENT-be.min.x>te.max.x?be.min.x-u.EXTENT:te.max.x,E),R=(te,be)=>(E[0]=Math.min(te.min.x,be.min.x),E[1]=Math.max(te.max.x,be.max.x),E[2]=u.EXTENT-be.min.y>te.max.y?be.min.y-u.EXTENT:te.max.y,E),U=[(te,be)=>C(te,be),(te,be)=>C(be,te),(te,be)=>R(te,be),(te,be)=>R(be,te)],Y=new u.pointGeometry(0,0);let oe,ce,de;const me=(te,be,ye,De,Re)=>{const Ae=[[De?ye:te,De?te:ye,0],[De?ye:be,De?be:ye,0]],Be=Re<0?u.EXTENT+Re:Re,He=[De?Be:(te+be)/2,De?(te+be)/2:Be,0];return 0===ye&&Re<0||0!==ye&&Re>0?d.getForTilePoints(de,[He],!0,ce):Ae.push(He),d.getForTilePoints(c,Ae,!0,oe),Math.max(Ae[0][2],Ae[1][2],He[2])/d.exaggeration()};for(let te=0;te<4;te++){const be=(te<2?1:5)-te,ye=a.borders[te];if(0===ye.length)continue;const De=de=y[te](c),Re=x(De);if(!(Re&&Re instanceof u.FillExtrusionBucket&&Re.enableTerrain)||a.borderDoneWithNeighborZ[te]===Re.canonical.z&&Re.borderDoneWithNeighborZ[be]===a.canonical.z||(ce=d.findDEMTileFor(De),!ce||!ce.dem))continue;if(!oe){const Ze=d.findDEMTileFor(c);if(!Ze||!Ze.dem)return;oe=Ze}const Ae=Re.borders[be];let Be=0;const He=Re.borderDoneWithNeighborZ[be]!==a.canonical.z;if(a.canonical.z===Re.canonical.z){for(let Ze=0;Ze<ye.length;Ze++){const Je=a.featuresOnBorder[ye[Ze]],Ht=Je.borders[te];let We;for(;Be<Ae.length&&(We=Re.featuresOnBorder[Ae[Be]],!(We.borders[be][1]>Ht[0]+3));)He&&Re.encodeCentroid(void 0,We,!1),Be++;if(We&&Be<Ae.length){const Dt=Be;let ut=0;for(;!(We.borders[be][0]>Ht[1]-3)&&(ut++,++Be!==Ae.length);)We=Re.featuresOnBorder[Ae[Be]];if(We=Re.featuresOnBorder[Ae[Dt]],Je.intersectsCount()>1||We.intersectsCount()>1||1!==ut){1!==ut&&(Be=Dt),a.encodeCentroid(void 0,Je,!1),He&&Re.encodeCentroid(void 0,We,!1);continue}const kt=U[te](Je,We),Ke=te%2?u.EXTENT-1:0;Y.x=me(kt[0],Math.min(u.EXTENT-1,kt[1]),Ke,te<2,kt[2]),Y.y=0,a.encodeCentroid(Y,Je,!1),He&&Re.encodeCentroid(Y,We,!1)}else a.encodeCentroid(void 0,Je,!1)}a.borderDoneWithNeighborZ[te]=Re.canonical.z,a.needsCentroidUpdate=!0,He&&(Re.borderDoneWithNeighborZ[be]=a.canonical.z,Re.needsCentroidUpdate=!0)}else{for(const Ze of ye)a.encodeCentroid(void 0,a.featuresOnBorder[Ze],!1);if(He){for(const Ze of Ae)Re.encodeCentroid(void 0,Re.featuresOnBorder[Ze],!1);Re.borderDoneWithNeighborZ[be]=a.canonical.z,Re.needsCentroidUpdate=!0}a.borderDoneWithNeighborZ[te]=Re.canonical.z,a.needsCentroidUpdate=!0}}(a.needsCentroidUpdate||!a.centroidVertexBuffer&&0!==a.centroidVertexArray.length)&&a.uploadCentroid(p)}const mn=new u.Color(1,0,0,1),gn=new u.Color(0,1,0,1),ur=new u.Color(0,0,1,1),hr=new u.Color(1,0,1,1),Vn=new u.Color(0,1,1,1);function Xn(p,r,c){const a=p.context,f=p.transform,d=a.gl,y="globe"===f.projection.name,x=y?["PROJECTION_GLOBE_VIEW"]:null;let E=c.projMatrix;if(y&&u.globeToMercatorTransition(f.zoom)>0){const Je=u.transitionTileAABBinECEF(c.canonical,f),Ht=u.globeDenormalizeECEF(Je);E=u.multiply(new Float32Array(16),f.globeMatrix,Ht),u.multiply(E,f.projMatrix,E)}const C=p.useProgram("debug",null,x),R=r.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(R,C);const U=u.DepthMode.disabled,Y=u.StencilMode.disabled,oe=p.colorModeForRenderPass();a.activeTexture.set(d.TEXTURE0),p.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),y?R._makeGlobeTileDebugBuffers(p.context,f):R._makeDebugTileBoundsBuffers(p.context,f.projection);const de=R._tileDebugBuffer||p.debugBuffer,me=R._tileDebugIndexBuffer||p.debugIndexBuffer,te=R._tileDebugSegments||p.debugSegments;C.draw(a,d.LINE_STRIP,U,Y,oe,u.CullFaceMode.disabled,Ta(E,u.Color.red),"$debug",de,me,te,null,null,null,[R._globeTileDebugBorderBuffer]);const be=R.latestRawTileData,ye=Math.floor((be&&be.byteLength||0)/1024),De=r.getTile(c).tileSize,Re=512/Math.min(De,512)*(c.overscaledZ/f.zoom)*.5;let Ae=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ae+=` => ${c.overscaledZ}`),Ae+=` ${ye}kb`,function(Je,Ht){Je.initDebugOverlayCanvas();const We=Je.debugOverlayCanvas,Dt=Je.context.gl,ut=Je.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,We.width,We.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(Ht,5,5),ut.strokeText(Ht,5,5),Je.debugOverlayTexture.update(We),Je.debugOverlayTexture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE)}(p,Ae);const Be=R._tileDebugTextBuffer||p.debugBuffer,He=R._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ze=R._tileDebugTextSegments||p.debugSegments;C.draw(a,d.TRIANGLES,U,Y,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,Ta(E,u.Color.transparent,Re),"$debug",Be,He,Ze,null,null,null,[R._globeTileDebugTextBuffer])}function pr(p,r,c,a){Jr(p,0,r+c/2,p.transform.width,c,a)}function Br(p,r,c,a){Jr(p,r-c/2,0,c,p.transform.height,a)}function Jr(p,r,c,a,f,d){const y=p.context,x=y.gl;x.enable(x.SCISSOR_TEST),x.scissor(r*u.exported.devicePixelRatio,c*u.exported.devicePixelRatio,a*u.exported.devicePixelRatio,f*u.exported.devicePixelRatio),y.clear({color:d}),x.disable(x.SCISSOR_TEST)}const Pr=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:qr}=Pr;function Sr(p,r,c,a){p.emplaceBack(r,c,a)}class Ei{constructor(r){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,Sr(this.vertexArray,-1,-1,1),Sr(this.vertexArray,1,-1,1),Sr(this.vertexArray,-1,1,1),Sr(this.vertexArray,1,1,1),Sr(this.vertexArray,-1,-1,-1),Sr(this.vertexArray,1,-1,-1),Sr(this.vertexArray,-1,1,-1),Sr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,qr),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function Bn(p,r,c,a,f,d){const y=p.gl,x=r.paint.get("sky-atmosphere-color"),E=r.paint.get("sky-atmosphere-halo-color"),C=r.paint.get("sky-atmosphere-sun-intensity"),R={u_matrix_3f:u.fromMat4(u.create$1(),a),u_sun_direction:f,u_sun_intensity:C,u_color_tint_r:[(ce=x).r,ce.g,ce.b,ce.a],u_color_tint_m:[(de=E).r,de.g,de.b,de.a],u_luminance:5e-5};var ce,de;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+d,r.skyboxTexture,0),c.draw(p,y.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,R,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Ho=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fs{constructor(r){const c=new u.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const a=new u.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,Ho.members),this.indexBuffer=r.createIndexBuffer(a),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const F={symbol:function(p,r,c,a,f){if("translucent"!==p.renderPass)return;const d=u.StencilMode.disabled,y=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(x,E,C,R,U,Y,oe){const ce=E.transform,de="map"===U,me="map"===Y;for(const te of x){const be=R.getTile(te),ye=be.getBucket(C);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const De=u.evaluateSizeForZoom(ye.textSizeData,ce.zoom),Re=Ki(te,ye.getProjection(),ce),Ae=ce.calculatePixelsToTileUnitsMatrix(be),Be=Gr(Re,be.tileID.canonical,me,de,ce,ye.getProjection(),Ae),He="none"!==C.layout.get("icon-text-fit")&&ye.hasIconData();if(De){const Ze=Math.pow(2,ce.zoom-be.tileID.overscaledZ);j(ye,de,me,oe,u.symbolSize,ce,Be,te,Ze,De,He)}}}(a,p,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),f),0!==c.paint.get("icon-opacity").constantOr(1)&&ge(p,r,c,a,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),d,y),0!==c.paint.get("text-opacity").constantOr(1)&&ge(p,r,c,a,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),d,y),r.map.showCollisionBoxes&&(Q(p,r,c,a,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Q(p,r,c,a,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,c,a){if("translucent"!==p.renderPass)return;const f=c.paint.get("circle-opacity"),d=c.paint.get("circle-stroke-width"),y=c.paint.get("circle-stroke-opacity"),x=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===f.constantOr(1)&&(0===d.constantOr(1)||0===y.constantOr(1)))return;const E=p.context,C=E.gl,R=p.transform,U=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),Y=u.StencilMode.disabled,oe=p.colorModeForRenderPass(),ce="globe"===R.projection.name,de=[u.mercatorXfromLng(R.center.lng),u.mercatorYfromLat(R.center.lat)],me=[];for(let be=0;be<a.length;be++){const ye=a[be],De=r.getTile(ye),Re=De.getBucket(c);if(!Re||Re.projection.name!==R.projection.name)continue;const Ae=Re.programConfigurations.get(c.id),Be=Po(c);ce&&Be.push("PROJECTION_GLOBE_VIEW");const He=p.useProgram("circle",Ae,Be),Ze=Re.layoutVertexBuffer,Je=Re.globeExtVertexBuffer,Ht=Re.indexBuffer,We=R.projection.createInversionMatrix(R,ye.canonical),Dt={programConfiguration:Ae,program:He,layoutVertexBuffer:Ze,globeExtVertexBuffer:Je,indexBuffer:Ht,uniformValues:Ea(p,ye,De,We,de,c),tile:De};if(x){const ut=Re.segments.get();for(const kt of ut)me.push({segments:new u.SegmentVector([kt]),sortKey:kt.sortKey,state:Dt})}else me.push({segments:Re.segments,sortKey:0,state:Dt})}x&&me.sort((be,ye)=>be.sortKey-ye.sortKey);const te={useDepthForOcclusion:!ce};for(const be of me){const{programConfiguration:ye,program:De,layoutVertexBuffer:Re,globeExtVertexBuffer:Ae,indexBuffer:Be,uniformValues:He,tile:Ze}=be.state,Je=be.segments;p.terrain&&p.terrain.setupElevationDraw(Ze,De,te),p.prepareDrawProgram(E,De,Ze.tileID.toUnwrapped()),De.draw(E,C.TRIANGLES,U,Y,oe,u.CullFaceMode.disabled,He,c.id,Re,Be,Je,c.paint,R.zoom,ye,[Ae])}},heatmap:function(p,r,c,a){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const f=p.context,d=f.gl,y=u.StencilMode.disabled,x=new u.ColorMode([d.ONE,d.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(oe,ce,de,me){const te=oe.gl,be=ce.width*me,ye=ce.height*me;oe.activeTexture.set(te.TEXTURE1),oe.viewport.set([0,0,be,ye]);let De=de.heatmapFbo;if(!De||De&&(De.width!==be||De.height!==ye)){De&&De.destroy();const Re=te.createTexture();te.bindTexture(te.TEXTURE_2D,Re),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),De=de.heatmapFbo=oe.createFramebuffer(be,ye,!1),function(Ae,Be,He,Ze,Je,Ht){const We=Ae.gl;We.texImage2D(We.TEXTURE_2D,0,Ae.isWebGL2&&Ae.extRenderToTextureHalfFloat?We.RGBA16F:We.RGBA,Je,Ht,0,We.RGBA,Ae.extRenderToTextureHalfFloat?Ae.isWebGL2?We.HALF_FLOAT:Ae.extTextureHalfFloat.HALF_FLOAT_OES:We.UNSIGNED_BYTE,null),Ze.colorAttachment.set(He)}(oe,0,Re,De,be,ye)}else te.bindTexture(te.TEXTURE_2D,De.colorAttachment.get()),oe.bindFramebuffer.set(De.framebuffer)})(f,p,c,"globe"===p.transform.projection.name?.5:.25),f.clear({color:u.Color.transparent});const E=p.transform,C="globe"===E.projection.name,R=C?["PROJECTION_GLOBE_VIEW"]:null,U=C?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,Y=[u.mercatorXfromLng(E.center.lng),u.mercatorYfromLat(E.center.lat)];for(let oe=0;oe<a.length;oe++){const ce=a[oe];if(r.hasRenderableParent(ce))continue;const de=r.getTile(ce),me=de.getBucket(c);if(!me||me.projection.name!==E.projection.name)continue;const te=me.programConfigurations.get(c.id),be=p.useProgram("heatmap",te,R),{zoom:ye}=p.transform;p.terrain&&p.terrain.setupElevationDraw(de,be),p.prepareDrawProgram(f,be,ce.toUnwrapped());const De=E.projection.createInversionMatrix(E,ce.canonical);be.draw(f,d.TRIANGLES,u.DepthMode.disabled,y,x,U,ar(p,ce,de,De,Y,ye,c.paint.get("heatmap-intensity")),c.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,c.paint,p.transform.zoom,te,C?[me.globeExtVertexBuffer]:null)}f.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(f,d){const y=f.context,x=y.gl,E=d.heatmapFbo;if(!E)return;y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,E.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1);let C=d.colorRampTexture;C||(C=d.colorRampTexture=new u.Texture(y,d.colorRamp,x.RGBA)),C.bind(x.LINEAR,x.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(y,x.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:d.paint.get("heatmap-opacity")},d.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,d.paint,f.transform.zoom)}(p,c))},line:function(p,r,c,a){if("translucent"!==p.renderPass)return;const f=c.paint.get("line-opacity"),d=c.paint.get("line-width");if(0===f.constantOr(1)||0===d.constantOr(1))return;const y=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),x=p.colorModeForRenderPass(),E=p.terrain&&p.terrain.renderingToTexture?1:u.exported.devicePixelRatio,C=c.paint.get("line-dasharray"),R=C.constantOr(1),U=c.layout.get("line-cap"),Y=c.paint.get("line-pattern"),oe=Y.constantOr(1),ce=c.paint.get("line-gradient"),de=oe?"linePattern":"line",me=p.context,te=me.gl,be=(De=>{const Re=[];Ps(De)&&Re.push("RENDER_LINE_DASH"),De.paint.get("line-gradient")&&Re.push("RENDER_LINE_GRADIENT");const Ae=De.paint.get("line-trim-offset");0===Ae[0]&&0===Ae[1]||Re.push("RENDER_LINE_TRIM_OFFSET");const Be=De.paint.get("line-pattern").constantOr(1),He=1!==De.paint.get("line-opacity").constantOr(1);return!Be&&He&&Re.push("RENDER_LINE_ALPHA_DISCARD"),Re})(c);let ye=be.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ye=!1);for(const De of a){const Re=r.getTile(De);if(oe&&!Re.patternsLoaded())continue;const Ae=Re.getBucket(c);if(!Ae)continue;p.prepareDrawTile();const Be=Ae.programConfigurations.get(c.id),He=p.useProgram(de,Be,be),Ze=Y.constantOr(null);if(Ze&&Re.imageAtlas){const Ge=Re.imageAtlas.patternPositions[Ze.toString()];Ge&&Be.setConstantPatternPositions(Ge)}const Je=C.constantOr(null),Ht=U.constantOr(null);if(!oe&&Je&&Ht&&Re.lineAtlas){const Ge=Re.lineAtlas.getDash(Je,Ht);Ge&&Be.setConstantPatternPositions(Ge)}let[We,Dt]=c.paint.get("line-trim-offset");("round"===Ht||"square"===Ht)&&We!==Dt&&(0===We&&(We-=1),1===Dt&&(Dt+=1));const ut=p.terrain?De.projMatrix:null,kt=oe?el(p,Re,c,ut,E):ta(p,Re,c,ut,Ae.lineClipsArray.length,E,[We,Dt]);if(ce){const Ge=Ae.gradients[c.id];let tt=Ge.texture;if(c.gradientVersion!==Ge.version){let It=256;if(c.stepInterpolant){const zt=r.getSource().maxzoom,Mn=De.canonical.z===zt?Math.ceil(1<<p.transform.maxZoom-De.canonical.z):1;It=u.clamp(u.nextPowerOfTwo(Ae.maxLineLength/u.EXTENT*1024*Mn),256,me.maxTextureSize)}Ge.gradient=u.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:It,image:Ge.gradient||void 0,clips:Ae.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new u.Texture(me,Ge.gradient,te.RGBA),Ge.version=c.gradientVersion,tt=Ge.texture}me.activeTexture.set(te.TEXTURE1),tt.bind(c.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}R&&(me.activeTexture.set(te.TEXTURE0),Re.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Be.updatePaintBuffers()),oe&&(me.activeTexture.set(te.TEXTURE0),Re.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Be.updatePaintBuffers()),p.prepareDrawProgram(me,He,De.toUnwrapped());const Ke=Ge=>{He.draw(me,te.TRIANGLES,y,Ge,x,u.CullFaceMode.disabled,kt,c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,c.paint,p.transform.zoom,Be,[Ae.layoutVertexBuffer2])};if(ye){const Ge=p.stencilModeForClipping(De).ref;0===Ge&&p.terrain&&me.clear({stencil:0});const tt={func:te.EQUAL,mask:255};kt.u_alpha_discard_threshold=.8,Ke(new u.StencilMode(tt,Ge,255,te.KEEP,te.KEEP,te.INVERT)),kt.u_alpha_discard_threshold=0,Ke(new u.StencilMode(tt,Ge,255,te.KEEP,te.KEEP,te.KEEP))}else Ke(p.stencilModeForClipping(De))}ye&&(p.resetStencilClippingMasks(),p.terrain&&me.clear({stencil:0}))},fill:function(p,r,c,a){const f=c.paint.get("fill-color"),d=c.paint.get("fill-opacity");if(0===d.constantOr(1))return;const y=p.colorModeForRenderPass(),x=c.paint.get("fill-pattern"),E=p.opaquePassEnabledForLayer()&&!x.constantOr(1)&&1===f.constantOr(u.Color.transparent).a&&1===d.constantOr(0)?"opaque":"translucent";if(p.renderPass===E){const C=p.depthModeForSublayer(1,"opaque"===p.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);ze(p,r,c,a,C,y,!1)}if("translucent"===p.renderPass&&c.paint.get("fill-antialias")){const C=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);ze(p,r,c,a,C,y,!0)}},"fill-extrusion":function(p,r,c,a){const f=c.paint.get("fill-extrusion-opacity");if(0!==f&&"translucent"===p.renderPass){const d=new u.DepthMode(p.context.gl.LEQUAL,u.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==f||c.paint.get("fill-extrusion-pattern").constantOr(1))Qe(p,r,c,a,d,u.StencilMode.disabled,u.ColorMode.disabled),Qe(p,r,c,a,d,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const y=p.colorModeForRenderPass();Qe(p,r,c,a,d,u.StencilMode.disabled,y)}}},hillshade:function(p,r,c,a){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const f=p.context,d=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),y=p.colorModeForRenderPass(),x=p.terrain&&p.terrain.renderingToTexture,[E,C]="translucent"!==p.renderPass||x?[{},a]:p.stencilConfigForOverlap(a);for(const R of C){const U=r.getTile(R);if(U.needsHillshadePrepare&&"offscreen"===p.renderPass)Zi(p,U,c,d,u.StencilMode.disabled,y);else if("translucent"===p.renderPass){const Y=x&&p.terrain?p.terrain.stencilModeForRTTOverlap(R):E[R.overscaledZ];hs(p,R,U,c,d,Y,y)}}f.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,c,a,f,d){if("translucent"!==p.renderPass||0===c.paint.get("raster-opacity")||!a.length)return;const y=p.context,x=y.gl,E=r.getSource(),C=p.useProgram("raster"),R=p.colorModeForRenderPass(),U=p.terrain&&p.terrain.renderingToTexture,[Y,oe]=E instanceof se||U?[{},a]:p.stencilConfigForOverlap(a),ce=oe[oe.length-1].overscaledZ,de=!p.options.moving;for(const me of oe){const te=U?u.DepthMode.disabled:p.depthModeForSublayer(me.overscaledZ-ce,1===c.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,x.LESS),be=me.toUnwrapped(),ye=r.getTile(me);if(U&&(!ye||!ye.hasData()))continue;const De=U?me.projMatrix:p.transform.calculateProjMatrix(be,de),Re=p.terrain&&U?p.terrain.stencilModeForRTTOverlap(me):Y[me.overscaledZ],Ae=d?0:c.paint.get("raster-fade-duration");ye.registerFadeDuration(Ae);const Be=r.findLoadedParent(me,0),He=$s(ye,Be,r,p.transform,Ae);let Ze,Je;p.terrain&&p.terrain.prepareDrawTile();const Ht="nearest"===c.paint.get("raster-resampling")?x.NEAREST:x.LINEAR;y.activeTexture.set(x.TEXTURE0),ye.texture.bind(Ht,x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE1),Be?(Be.texture.bind(Ht,x.CLAMP_TO_EDGE),Ze=Math.pow(2,Be.tileID.overscaledZ-ye.tileID.overscaledZ),Je=[ye.tileID.canonical.x*Ze%1,ye.tileID.canonical.y*Ze%1]):ye.texture.bind(Ht,x.CLAMP_TO_EDGE);const We=bo(De,Je||[0,0],Ze||1,He,c,E instanceof se?E.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(y,C,be),E instanceof se)E.boundsBuffer&&E.boundsSegments&&C.draw(y,x.TRIANGLES,te,u.StencilMode.disabled,R,u.CullFaceMode.disabled,We,c.id,E.boundsBuffer,p.quadTriangleIndexBuffer,E.boundsSegments);else{const{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:ut,tileBoundsSegments:kt}=p.getTileBoundsBuffers(ye);C.draw(y,x.TRIANGLES,te,Re,R,u.CullFaceMode.disabled,We,c.id,Dt,ut,kt)}}p.resetStencilClippingMasks()},background:function(p,r,c,a){const f=c.paint.get("background-color"),d=c.paint.get("background-opacity");if(0===d)return;const y=p.context,x=y.gl,E=p.transform,C=E.tileSize,R=c.paint.get("background-pattern");if(p.isPatternMissing(R))return;const U=!R&&1===f.a&&1===d&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==U)return;const Y=u.StencilMode.disabled,oe=p.depthModeForSublayer(0,"opaque"===U?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),ce=p.colorModeForRenderPass(),de=p.useProgram(R?"backgroundPattern":"background");let me,te=a;te||(me=p.getBackgroundTiles(),te=Object.values(me).map(be=>be.tileID)),R&&(y.activeTexture.set(x.TEXTURE0),p.imageManager.bind(p.context));for(const be of te){const ye=be.toUnwrapped(),De=a?be.projMatrix:p.transform.calculateProjMatrix(ye);p.prepareDrawTile();const Re=r?r.getTile(be):me?me[be.key]:new u.Tile(be,C,E.zoom,p),Ae=R?Ro(De,d,p,R,{tileID:be,tileSize:C}):Gi(De,d,f);p.prepareDrawProgram(y,de,ye);const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:He,tileBoundsSegments:Ze}=p.getTileBoundsBuffers(Re);de.draw(y,x.TRIANGLES,oe,Y,ce,u.CullFaceMode.disabled,Ae,c.id,Be,He,Ze)}},sky:function(p,r,c){const a=p.transform,f="mercator"===a.projection.name||"globe"===a.projection.name?1:u.smoothstep(7,8,a.zoom),d=c.paint.get("sky-opacity")*f;if(0===d)return;const y=p.context,x=c.paint.get("sky-type"),E=new u.DepthMode(y.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),C=p.frameCounter/1e3%1;"atmosphere"===x?"offscreen"===p.renderPass?c.needsSkyboxCapture(p)&&(function(R,U,Y,oe){const ce=R.context,de=ce.gl;let me=U.skyboxFbo;if(!me){me=U.skyboxFbo=ce.createFramebuffer(32,32,!1),U.skyboxGeometry=new Ei(ce),U.skyboxTexture=ce.gl.createTexture(),de.bindTexture(de.TEXTURE_CUBE_MAP,U.skyboxTexture),de.texParameteri(de.TEXTURE_CUBE_MAP,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_CUBE_MAP,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_CUBE_MAP,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_CUBE_MAP,de.TEXTURE_MAG_FILTER,de.LINEAR);for(let De=0;De<6;++De)de.texImage2D(de.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,de.RGBA,32,32,0,de.RGBA,de.UNSIGNED_BYTE,null)}ce.bindFramebuffer.set(me.framebuffer),ce.viewport.set([0,0,32,32]);const te=U.getCenter(R,!0),be=R.useProgram("skyboxCapture"),ye=new Float64Array(16);u.identity(ye),u.rotateY(ye,ye,.5*-Math.PI),Bn(ce,U,be,ye,te,0),u.identity(ye),u.rotateY(ye,ye,.5*Math.PI),Bn(ce,U,be,ye,te,1),u.identity(ye),u.rotateX(ye,ye,.5*-Math.PI),Bn(ce,U,be,ye,te,2),u.identity(ye),u.rotateX(ye,ye,.5*Math.PI),Bn(ce,U,be,ye,te,3),u.identity(ye),Bn(ce,U,be,ye,te,4),u.identity(ye),u.rotateY(ye,ye,Math.PI),Bn(ce,U,be,ye,te,5),ce.viewport.set([0,0,R.width,R.height])}(p,c),c.markSkyboxValid(p)):"sky"===p.renderPass&&function(R,U,Y,oe,ce){const de=R.context,me=de.gl,te=R.transform,be=R.useProgram("skybox");de.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_CUBE_MAP,U.skyboxTexture);const ye={u_matrix:te.skyboxMatrix,u_sun_direction:U.getCenter(R,!1),u_cubemap:0,u_opacity:oe,u_temporal_offset:ce};R.prepareDrawProgram(de,be),be.draw(de,me.TRIANGLES,Y,u.StencilMode.disabled,R.colorModeForRenderPass(),u.CullFaceMode.backCW,ye,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,c,E,d,C):"gradient"===x&&"sky"===p.renderPass&&function(R,U,Y,oe,ce){const de=R.context,me=de.gl,te=R.transform,be=R.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Ei(de)),de.activeTexture.set(me.TEXTURE0);let ye=U.colorRampTexture;ye||(ye=U.colorRampTexture=new u.Texture(de,U.colorRamp,me.RGBA)),ye.bind(me.LINEAR,me.CLAMP_TO_EDGE);const De=(Re=te.skyboxMatrix,Ae=U.getCenter(R,!1),Be=U.paint.get("sky-gradient-radius"),He=oe,Ze=ce,{u_matrix:Re,u_color_ramp:0,u_center_direction:Ae,u_radius:u.degToRad(Be),u_opacity:He,u_temporal_offset:Ze});var Re,Ae,Be,He,Ze;R.prepareDrawProgram(de,be),be.draw(de,me.TRIANGLES,Y,u.StencilMode.disabled,R.colorModeForRenderPass(),u.CullFaceMode.backCW,De,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,c,E,d,C)},debug:function(p,r,c){for(let a=0;a<c.length;a++)Xn(p,r,c[a])},custom:function(p,r,c,a){const f=p.context,d=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||"offscreen"===p.renderPass)&&c.isLayerDraped()){if("offscreen"===p.renderPass){const y=d.prerender;if(y){if(p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),"globe"===p.transform.projection.name){const x=p.transform.pointMerc;y.call(d,f.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(p.transform.zoom),[x.x,x.y],p.transform.pixelsPerMeterRatio)}else y.call(d,f.gl,p.transform.customLayerMatrix());f.setDirty(),p.setBaseState()}}else if("translucent"===p.renderPass){if(p.terrain&&p.terrain.renderingToTexture){const x=d.renderToTile;if(x){const E=a[0].canonical,C=new u.MercatorCoordinate(E.x+a[0].wrap*(1<<E.z),E.y,E.z);f.setDepthMode(u.DepthMode.disabled),f.setStencilMode(u.StencilMode.disabled),f.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),x.call(d,f.gl,C),f.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),f.setStencilMode(u.StencilMode.disabled);const y="3d"===d.renderingMode?new u.DepthMode(p.context.gl.LEQUAL,u.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,u.DepthMode.ReadOnly);if(f.setDepthMode(y),"globe"===p.transform.projection.name){const x=p.transform.pointMerc;d.render(f.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(p.transform.zoom),[x.x,x.y],p.transform.pixelsPerMeterRatio)}else d.render(f.gl,p.transform.customLayerMatrix());f.setDirty(),p.setBaseState(),f.bindFramebuffer.set(null)}}else u.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class X{constructor(r,c,a=!1){this.context=new he(r,a),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new za,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,c){const a=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(a||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ha(this,r));const f=this._terrain;this.transform.elevation=a?f:null,f.update(r,this.transform,c)}_updateFog(r){const c=r.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[a,f]=c.getFovAdjustedRange(this.transform._fov);if(a>f)return void(this.transform.fogCullDistSq=null);const d=a+.78*(f-a);this.transform.fogCullDistSq=d*d}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,c){if(this.width=r*u.exported.devicePixelRatio,this.height=c*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const a of this.style.order)this.style._layers[a].resize()}setup(){const r=this.context,c=new u.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(u.EXTENT,0),c.emplaceBack(0,u.EXTENT),c.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(c,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const a=new u.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(u.EXTENT,0),a.emplaceBack(0,u.EXTENT),a.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=r.createVertexBuffer(a,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const f=new u.StructArrayLayout2i4;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(f,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const d=new u.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(u.EXTENT,0,u.EXTENT,0),d.emplaceBack(0,u.EXTENT,0,u.EXTENT),d.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(d,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const y=new u.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(y);const x=new u.StructArrayLayout1ui2;for(const C of[0,1,3,2,0])x.emplaceBack(C);this.debugIndexBuffer=r.createIndexBuffer(x),this.emptyTexture=new u.Texture(r,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=u.create();const E=this.context.gl;this.stencilClearMode=new u.StencilMode({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new fs(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,c=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,c.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,Qn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,a){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!a||0===a.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let x=!1;for(const E of a)if(void 0===this._tileClippingMaskIDs[E.key]){x=!0;break}if(!x)return}this.currentStencilSource=c.id;const f=this.context,d=f.gl;this.nextStencilID+a.length>256&&this.clearStencil(),f.setColorMode(u.ColorMode.disabled),f.setDepthMode(u.DepthMode.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of a){const E=c.getTile(x),C=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:U,tileBoundsSegments:Y}=this.getTileBoundsBuffers(E);y.draw(f,d.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:d.ALWAYS,mask:0},C,255,d.KEEP,d.KEEP,d.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Qn(x.projMatrix),"$clipping",R,U,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new u.StencilMode({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new u.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,a=r.sort((y,x)=>x.overscaledZ-y.overscaledZ),f=a[a.length-1].overscaledZ,d=a[0].overscaledZ-f+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const y={};for(let x=0;x<d;x++)y[x+f]=new u.StencilMode({func:c.GEQUAL,mask:255},x+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=d,[y,a]}return[{[f]:u.StencilMode.disabled},a]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([r.CONSTANT_COLOR,r.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(r,c,a){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new u.DepthMode(a||this.context.gl.LEQUAL,c,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,c){this.style=r,this.options=c,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const a=this.style.order,f=this.style._sourceCaches;for(const E in f){const C=f[E];C.used&&C.prepare(this.context)}const d={},y={},x={};for(const E in f){const C=f[E];d[E]=C.getVisibleCoordinates(),y[E]=d[E].slice().reverse(),x[E]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<a.length;E++)if(this.style._layers[a[E]].is3D()){this.opaquePassCutoff=E;break}if(this.terrain&&(this.terrain.updateTileBinding(x),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),u.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const E of a){const C=this.style._layers[E],R=r._getLayerSourceCache(C);if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const U=R?y[R.id]:void 0;("custom"===C.type||C.isSky()||U&&U.length)&&this.renderLayer(this,R,C,U)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[a[this.currentLayer]],C=r._getLayerSourceCache(E);if(E.isSky())continue;const R=C?y[C.id]:void 0;this._renderTileClippingMasks(E,C,R),this.renderLayer(this,C,E,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(E,C){const R=E.context,U=R.gl,Y=E.transform,oe=new u.DepthMode(U.LEQUAL,u.DepthMode.ReadOnly,[0,1]),ce=E.useProgram("globeAtmosphere",null,"globe"===Y.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),de=u.globeToMercatorTransition(Y.zoom),me=C.properties.get("color").toArray01(),te=C.properties.get("high-color").toArray01(),be=C.properties.get("space-color").toArray01PremultipliedAlpha(),ye=u.identity$1([]);u.rotateY$1(ye,ye,-u.degToRad(Y._center.lng)),u.rotateX$1(ye,ye,u.degToRad(Y._center.lat)),u.rotateZ$1(ye,ye,Y.angle),u.rotateX$1(ye,ye,-Y._pitch);const De=u.fromQuat(new Float32Array(16),ye),Re=u.mapValue(C.properties.get("star-intensity"),0,1,0,.25),Be=u.mapValue(C.properties.get("horizon-blend"),0,1,5e-4,.25),He=u.globeUseCustomAntiAliasing(E,R,Y)&&5e-4===Be?Y.worldSize/(2*Math.PI*1.025)-1:Y.globeRadius,Ze=E.frameCounter/1e3%1,Je=u.length(Y.globeCenterInViewSpace),Ht=Math.sqrt(Math.pow(Je,2)-Math.pow(He,2)),We=Math.acos(Ht/Je),Dt={u_frustum_tl:Y.frustumCorners.TL,u_frustum_tr:Y.frustumCorners.TR,u_frustum_br:Y.frustumCorners.BR,u_frustum_bl:Y.frustumCorners.BL,u_horizon:Y.frustumCorners.horizon,u_transition:de,u_fadeout_range:Be,u_color:me,u_high_color:te,u_space_color:be,u_star_intensity:Re,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ze,u_horizon_angle:We,u_rotation_matrix:De};E.prepareDrawProgram(R,ce);const ut=E.atmosphereBuffer;ut&&ce.draw(R,U.TRIANGLES,oe,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,Dt,"skybox",ut.vertexBuffer,ut.indexBuffer,ut.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const E=this.style._layers[a[this.currentLayer]],C=r._getLayerSourceCache(E);E.isSky()&&this.renderLayer(this,C,E,C?y[C.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;){const E=this.style._layers[a[this.currentLayer]],C=r._getLayerSourceCache(E);if(E.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(E)){if(E.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=C?("symbol"===E.type?x:y)[C.id]:void 0;this._renderTileClippingMasks(E,C,C?d[C.id]:void 0),this.renderLayer(this,C,E,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let E=null;u.values(this.style._layers).forEach(C=>{const R=r._getLayerSourceCache(C);R&&!C.isHidden(this.transform.zoom)&&(!E||E.getSource().maxzoom<R.getSource().maxzoom)&&(E=R)}),E&&this.options.showTileBoundaries&&F.debug(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const C=E.transform.padding;pr(E,E.transform.height-(C.top||0),3,mn),pr(E,C.bottom||0,3,gn),Br(E,C.left||0,3,ur),Br(E,E.transform.width-(C.right||0),3,hr);const R=E.transform.centerPoint;var U,Y,oe,ce;Jr(U=E,(Y=R.x)-1,(oe=E.transform.height-R.y)-10,2,20,ce=Vn),Jr(U,Y-10,oe-1,20,2,ce)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,c,a,f){a.isHidden(this.transform.zoom)||("background"===a.type||"sky"===a.type||"custom"===a.type||f&&f.length)&&(this.id=a.id,this.gpuTimingStart(a),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(a.type)||r.terrain&&"custom"===a.type)&&F[a.type](r,c,a,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let a=this.gpuTimers[r.id];a||(a=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),a.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),r.beginQueryEXT(r.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const a in r){const f=r[a],d=this.context.extTimerQuery,y=d.getQueryObjectEXT(f.query,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(f.query),c[a]=y}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let a=0;for(const f of r)a+=c.getQueryObjectEXT(f,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(f);return a}translatePosMatrix(r,c,a,f,d){if(!a[0]&&!a[1])return r;const y=d?"map"===f?this.transform.angle:0:"viewport"===f?-this.transform.angle:0;if(y){const C=Math.sin(y),R=Math.cos(y);a=[a[0]*R-a[1]*C,a[0]*C+a[1]*R]}const x=[d?a[0]:qt(c,a[0],this.transform.zoom),d?a[1]:qt(c,a[1],this.transform.zoom),0],E=new Float32Array(16);return u.translate(E,r,x),E}saveTileTexture(r){const c=this._tileTextures[r.size[0]];c?c.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}isPatternMissing(r){return null===r||void 0!==r&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&0===this.terrain.exaggeration(),a=this.style&&this.style.fog,f=[];return this.terrainRenderModeElevated()&&f.push("TERRAIN"),"globe"===this.transform.projection.name&&f.push("GLOBE"),c&&f.push("ZERO_EXAGGERATION"),a&&!r&&0!==a.getOpacity(this.transform.pitch)&&f.push("FOG"),r&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}useProgram(r,c,a){this.cache=this.cache||{};const f=a||[],d=this.currentGlobalDefines().concat(f),y=es.cacheKey(wa[r],r,d,c);return this.cache[y]||(this.cache[y]=new es(this.context,r,wa[r],c,fl[r],d)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,c,a){if(this.terrain&&this.terrain.renderingToTexture)return;const f=this.style.fog;if(f){const d=f.getOpacity(this.transform.pitch),y=((x,E,C,R,U,Y,oe,ce,de,me,te)=>{const be=x.transform,ye=E.properties.get("color").toArray01();ye[3]=R;const De=x.frameCounter/1e3%1;return{u_fog_matrix:C?be.calculateFogTileMatrix(C):x.identityMat,u_fog_range:E.getFovAdjustedRange(be._fov),u_fog_color:ye,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:De,u_frustum_tl:U,u_frustum_tr:Y,u_frustum_br:oe,u_frustum_bl:ce,u_globe_pos:de,u_globe_radius:me,u_viewport:te,u_globe_transition:u.globeToMercatorTransition(be.zoom),u_is_globe:+("globe"===be.projection.name)}})(this,f,a,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);c.setFogUniformValues(r,y)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},a=this.transform.coveringTiles({tileSize:512});for(const f of a)c[f.key]=r[f.key]||new u.Tile(f,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class N{constructor(r=0,c=0,a=0,f=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(a)||a<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=a,this.right=f}interpolate(r,c,a){return null!=c.top&&null!=r.top&&(this.top=u.number(r.top,c.top,a)),null!=c.bottom&&null!=r.bottom&&(this.bottom=u.number(r.bottom,c.bottom,a)),null!=c.left&&null!=r.left&&(this.left=u.number(r.left,c.left,a)),null!=c.right&&null!=r.right&&(this.right=u.number(r.right,c.right,a)),this}getCenter(r,c){const a=u.clamp((this.left+r-this.right)/2,0,r),f=u.clamp((this.top+c-this.bottom)/2,0,c);return new u.pointGeometry(a,f)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new N(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ae(p,r){const c=u.getColumn(p,3);u.fromQuat(p,r),u.setColumn(p,3,c)}function Se(p,r){const c=u.identity$1([]);return u.rotateZ$1(c,c,-r),u.rotateX$1(c,c,-p),c}function ot(p,r){const c=[p[0],p[1],0],a=[r[0],r[1],0];if(u.length(c)>=1e-15){const y=u.normalize([],c);u.scale$2(a,y,u.dot(a,y)),r[0]=a[0],r[1]=a[1]}const f=u.cross([],r,p);if(u.len(f)<1e-15)return null;const d=Math.atan2(-f[1],f[0]);return Se(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),d)}class I{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof u.MercatorCoordinate?r:new u.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=u.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const a=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(r)):0,f=this.position,d=u.MercatorCoordinate.fromLngLat(r,a),y=[d.x-f.x,d.y-f.y,d.z-f.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ot(y,c)}setPitchBearing(r,c){this.orientation=Se(u.degToRad(r),u.degToRad(-c))}}class k{constructor(r,c){this._transform=u.identity([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new u.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=u.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&u.setColumn(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||u.identity$1([]),r&&ae(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=Se(r,c),ae(this._transform,this._orientation)}forward(){const r=u.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=u.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=u.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const a=new Float64Array(16);return u.invert(a,this.getWorldToCamera(r,c)),a}getWorldToCameraPosition(r,c,a){const f=this.position;u.scale$2(f,f,-r);const d=new Float64Array(16);return u.fromScaling(d,[a,a,a]),u.translate(d,d,f),d[10]*=c,d}getWorldToCamera(r,c){const a=new Float64Array(16),f=new Float64Array(4),d=this.position;return u.conjugate(f,this._orientation),u.scale$2(d,d,-r),u.fromQuat(a,f),u.translate(a,a,d),a[1]*=-1,a[5]*=-1,a[9]*=-1,a[13]*=-1,a[8]*=c,a[9]*=c,a[10]*=c,a[11]*=c,a}getCameraToClipPerspective(r,c,a,f){const d=new Float64Array(16);return u.perspective(d,r,c,a,f),d}getDistanceToElevation(r,c=!1){const a=0===r?0:u.mercatorZfromAltitude(r,c?u.latFromMercatorY(this.position[1]):this.position[1]),f=this.forward();return(a-this.position[2])/f[2]}clone(){return new k([...this.position],[...this.orientation])}}function G(p,r){const c=$e(p.projection,p.zoom,p.width,p.height),a=function(d,y,x,E,C){const R=new u.LngLat(x.lng-180*Gt,x.lat),U=new u.LngLat(x.lng+180*Gt,x.lat),Y=d.project(R.lng,R.lat),oe=d.project(U.lng,U.lat),ce=-Math.atan2(oe.y-Y.y,oe.x-Y.x),de=u.MercatorCoordinate.fromLngLat(x);de.y=u.clamp(de.y,-.999975,.999975);const me=de.toLngLat(),te=d.project(me.lng,me.lat),be=u.MercatorCoordinate.fromLngLat(me);be.x+=Gt;const ye=be.toLngLat(),De=d.project(ye.lng,ye.lat),Re=nr(De.x-te.x,De.y-te.y,ce),Ae=u.MercatorCoordinate.fromLngLat(me);Ae.y+=Gt;const Be=Ae.toLngLat(),He=d.project(Be.lng,Be.lat),Ze=nr(He.x-te.x,He.y-te.y,ce),Je=Math.abs(Re.x)/Math.abs(Ze.y),Ht=u.identity([]);u.rotateZ(Ht,Ht,-ce*(1-(C?0:E)));const We=u.identity([]);return u.scale(We,We,[1,1-(1-Je)*E,1]),We[4]=-Ze.x/Ze.y*E,u.rotateZ(We,We,ce),u.multiply(We,Ht,We),We}(p.projection,0,p.center,c,r),f=_e(p);return u.scale(a,a,[f,f,1]),a}function _e(p){const r=p.projection,c=$e(p.projection,p.zoom,p.width,p.height),a=An(r,p.center),f=An(r,u.LngLat.convert(r.center));return Math.pow(2,a*c+(1-c)*f)}function $e(p,r,c,a,f=1/0){const d=p.range;if(!d)return 0;const y=Math.min(f,Math.max(c,a)),x=Math.log(y/1024)/Math.LN2;return u.smoothstep(d[0]+x,d[1]+x,r)}const Gt=1/4e4;function An(p,r){const c=u.clamp(r.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),a=new u.LngLat(r.lng-180*Gt,c),f=new u.LngLat(r.lng+180*Gt,c),d=p.project(a.lng,c),y=p.project(f.lng,c),x=u.MercatorCoordinate.fromLngLat(a),E=u.MercatorCoordinate.fromLngLat(f),C=y.x-d.x,R=y.y-d.y,U=E.x-x.x,Y=E.y-x.y,oe=Math.sqrt((U*U+Y*Y)/(C*C+R*R));return Math.log(oe)/Math.LN2}function nr(p,r,c){const a=Math.cos(c),f=Math.sin(c);return{x:p*a-r*f,y:p*f+r*a}}class mt{constructor(r,c,a,f,d,y,x){this.tileSize=512,this._renderWorldCopies=void 0===d||d,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=a??0,this._maxPitch=f??60,this.setProjection(y),this.setMaxBounds(x),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new N,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new k,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new mt(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,c=!1){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||a)&&this._updateCameraOnTerrain(),(r||a)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const a=!Ie(c,this.getProjection());return a&&this._calcMatrices(),this.mercatorFromTransition=!1,a}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=u.getProjection({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;var a,f,d,y,x,E,C,R,U,Y;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(a=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a),f=this.rotationMatrix,y=this.angle,x=(d=this.rotationMatrix)[0],E=d[1],C=d[2],R=d[3],U=Math.sin(y),Y=Math.cos(y),f[0]=x*Y+C*U,f[1]=E*Y+R*U,f[2]=x*-U+C*Y,f[3]=E*-U+R*Y)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=u.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=u.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],a=this.horizonLineFromTop();let f=0,d=0;for(let y=0;y<c.length;y++){const x=new u.pointGeometry(c[y][0]*this.width,a+c[y][1]*(this.height-a)),E=r.pointCoordinate(x);if(!E)continue;const C=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);f+=E[3]*C,d+=C}return 0===d?NaN:f/d}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),a=this.pixelsPerMeter/this.worldSize*c,f=this._mercatorZfromZoom(r),d=this._mercatorZfromZoom(this._maxZoom),y=Math.max(f-a,d);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let a;a=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const f=u.length(u.sub([],this._camera.position,a));return u.clamp(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!u.exactEquals(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const a=[r.position.x,r.position.y,r.position.z];u.exactEquals$1(a,this._camera.position)||(this._setCameraPosition(a),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new I;return c.position=new u.MercatorCoordinate(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!u.length$1(r))return!1;u.normalize$1(r,r);const c=u.transformQuat([],[0,0,-1],r),a=u.transformQuat([],[0,-1,0],r);if(a[2]<0)return!1;const f=ot(c,a);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,a=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;r[2]=u.clamp(r[2],f/a,f/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,a){this._unmodified=!1,this._edgeInsets.interpolate(r,c,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new u.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const a=this.pointCoordinate(new u.pointGeometry(0,0)),f=this.pointCoordinate(new u.pointGeometry(this.width,0)),d=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),y=this.pointCoordinate(new u.pointGeometry(0,this.height)),x=Math.floor(Math.min(a.x,f.x,d.x,y.x)),E=Math.floor(Math.max(a.x,f.x,d.x,y.x)),C=1;for(let R=x-C;R<=E+C;R++)0!==R&&c.push(new u.UnwrappedTileID(R,r))}return c}coveringTiles(r){let c=this.coveringZoomLevel(r);const a=c,f=this.elevation&&!r.isTerrainDEM,d="mercator"===this.projection.name;if(void 0!==r.minzoom&&c<r.minzoom)return[];void 0!==r.maxzoom&&c>r.maxzoom&&(c=r.maxzoom);const y=this.locationCoordinate(this.center),x=this.center.lat,E=1<<c,C=[E*y.x,E*y.y,0],R="globe"===this.projection.name,U=!R,Y=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,U),oe=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ce=E*u.mercatorZfromAltitude(1,this.center.lat),de=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),me=[E*oe.x,E*oe.y,de*(U?1:ce)],te=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),be=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ye=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,De=r.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?_e(this):1,Ae=Ke=>{const tt=new u.MercatorCoordinate(Ke.x+25e-6,Ke.y,Ke.z),It=new u.MercatorCoordinate(Ke.x,Ke.y+25e-6,Ke.z),zt=Ke.toLngLat(),Mn=tt.toLngLat(),_r=It.toLngLat(),wn=this.locationCoordinate(zt),pn=this.locationCoordinate(Mn),kn=this.locationCoordinate(_r),Mr=Math.hypot(pn.x-wn.x,pn.y-wn.y),Nn=Math.hypot(kn.x-wn.x,kn.y-wn.y);return Math.sqrt(Mr*Nn)*Re/25e-6},Be=Ke=>{const Ge=ye,tt=De;return{aabb:u.tileAABB(this,E,0,0,0,Ke,tt,Ge,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:Ge,wrap:Ke,fullyVisible:!1}},He=[];let Ze=[];const Je=c,Ht=r.reparseOverscaled?a:c,We=Ke=>Ke*Ke,Dt=We((de-this._centerAltitude)*ce),ut=Ke=>{if(!this._elevation||!Ke.tileID||!d)return;const Ge=this._elevation.getMinMaxForTile(Ke.tileID),tt=Ke.aabb;Ge?(tt.min[2]=Ge.min,tt.max[2]=Ge.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(Ke.shouldSplit=kt(Ke),Ke.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},kt=Ke=>{if(Ke.zoom<be)return!0;if(Ke.zoom===Je)return!1;if(null!=Ke.shouldSplit)return Ke.shouldSplit;const Ge=Ke.aabb.distanceX(me),tt=Ke.aabb.distanceY(me);let It=Dt,zt=1;if(R){It=We(Ke.aabb.distanceZ(me));const wn=Math.pow(2,Ke.zoom),pn=u.latFromMercatorY((Ke.y+1)/wn),kn=u.latFromMercatorY(Ke.y/wn),Mr=Math.min(Math.max(x,pn),kn),Nn=u.circumferenceAtLatitude(Mr)/u.circumferenceAtLatitude(x);if(zt=Mr===x?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Nn/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&Ke.zoom===Je-1&&Nn>=.9)return!0}else if(f&&(It=We(Ke.aabb.distanceZ(me)*ce)),this.projection.isReprojectedInTileSpace&&a<=5){const wn=Math.pow(2,Ke.zoom),pn=Ae(new u.MercatorCoordinate((Ke.x+.5)/wn,(Ke.y+.5)/wn));zt=pn>.85?1:pn}const Mn=Ge*Ge+tt*tt+It;return Mn<We((1<<Je-Ke.zoom)*te*zt*((wn,pn)=>{if(pn*We(.707)<wn)return 1;const kn=Math.sqrt(pn/wn);return kn/(1.4144271570014144+(Math.pow(1.1,kn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,Dt),Mn))};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)He.push(Be(-Ke)),He.push(Be(Ke));for(He.push(Be(0));He.length>0;){const Ke=He.pop(),Ge=Ke.x,tt=Ke.y;let It=Ke.fullyVisible;if(!It){const zt=Ke.aabb.intersects(Y);if(0===zt)continue;It=2===zt}if(Ke.zoom!==Je&&kt(Ke))for(let zt=0;zt<4;zt++){const Mn=(Ge<<1)+zt%2,_r=(tt<<1)+(zt>>1),wn={aabb:d?Ke.aabb.quadrant(zt):u.tileAABB(this,E,Ke.zoom+1,Mn,_r,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:Mn,y:_r,wrap:Ke.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};f&&!R&&(wn.tileID=new u.OverscaledTileID(Ke.zoom+1===Je?Ht:Ke.zoom+1,Ke.wrap,Ke.zoom+1,Mn,_r),ut(wn)),He.push(wn)}else{const zt=Ke.zoom===Je?Ht:Ke.zoom;if(r.minzoom&&r.minzoom>zt)continue;const Mn=C[0]-(.5+Ge+(Ke.wrap<<Ke.zoom))*(1<<c-Ke.zoom),_r=C[1]-.5-tt,wn=Ke.tileID?Ke.tileID:new u.OverscaledTileID(zt,Ke.wrap,Ke.zoom,Ge,tt);Ze.push({tileID:wn,distanceSq:Mn*Mn+_r*_r})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,Ge=this.horizonLineFromTop();Ze=Ze.filter(tt=>{const It=[0,0,0,1],zt=[u.EXTENT,u.EXTENT,0,1],Mn=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());u.transformMat4$1(It,It,Mn),u.transformMat4$1(zt,zt,Mn);const _r=u.getAABBPointSquareDist(It,zt);if(0===_r)return!0;let wn=!1;const pn=this._elevation;if(pn&&_r>Ke&&0!==Ge){const kn=this.calculateProjMatrix(tt.tileID.toUnwrapped());let Mr;r.isTerrainDEM||(Mr=pn.getMinMaxForTile(tt.tileID)),Mr||(Mr={min:De,max:ye});const Nn=u.furthestTileCorner(this.rotation),Qr=[Nn[0]*u.EXTENT,Nn[1]*u.EXTENT,Mr.max];u.transformMat4(Qr,Qr,kn),wn=(1-Qr[1])*this.height*.5<Ge}return _r<Ke||wn})}return Ze.sort((Ke,Ge)=>Ke.distanceSq-Ge.distanceSq).map(Ke=>Ke.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=u.clamp(r.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),a=this.projection.project(r.lng,c);return new u.pointGeometry(a.x*this.worldSize,a.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/u.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let a,f;const d=this.centerPoint;if("globe"===this.projection.name){const x=this.worldSize;a=(c.x-d.x)/x,f=(c.y-d.y)/x}else{const x=this.pointCoordinate(c),E=this.pointCoordinate(d);a=x.x-E.x,f=x.y-E.y}const y=this.locationCoordinate(r);this.setLocation(new u.MercatorCoordinate(y.x-a,y.y-f))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,c){const a=c?u.mercatorZfromAltitude(c,r.lat):void 0,f=this.projection.project(r.lng,r.lat);return new u.MercatorCoordinate(f.x,f.y,a)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const a=c??this._centerAltitude,f=[r.x,r.y,0,1],d=[r.x,r.y,1,1];u.transformMat4$1(f,f,this.pixelMatrixInverse),u.transformMat4$1(d,d,this.pixelMatrixInverse);const y=d[3];u.scale$1(f,f,1/f[3]),u.scale$1(d,d,1/y);const x=f[2],E=d[2];return{p0:f,p1:d,t:x===E?0:(a-x)/(E-x)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],a=[r.x,r.y,1,1];return u.transformMat4$1(c,c,this.pixelMatrixInverse),u.transformMat4$1(a,a,this.pixelMatrixInverse),u.scale$1(c,c,1/c[3]),u.scale$1(a,a,1/a[3]),c[2]=u.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,a[2]=u.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,u.scale$1(c,c,1/this.worldSize),u.scale$1(a,a,1/this.worldSize),new u.Ray([c[0],c[1],c[2]],u.normalize([],u.sub([],a,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:a,t:f}=r,d=u.mercatorZfromAltitude(c[2],this._center.lat),y=u.mercatorZfromAltitude(a[2],this._center.lat);return new u.MercatorCoordinate(u.number(c[0],a[0],f)/this.worldSize,u.number(c[1],a[1],f)/this.worldSize,u.number(d,y,f))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let c=this.projection.pointCoordinate3D(this,r.x,r.y);if(c)return new u.MercatorCoordinate(c[0],c[1],c[2]);let a=0,f=this.horizonLineFromTop();if(r.y>f)return this.pointCoordinate(r);const d=.02*f,y=r.clone();for(let x=0;x<10&&f-a>d;x++){y.y=u.number(a,f,.66);const E=this.projection.pointCoordinate3D(this,y.x,y.y);E?(f=y.y,c=E):a=y.y}return c?new u.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,c){const a=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,f=[r.x*this.worldSize,r.y*this.worldSize,a+r.toAltitude(),1];return u.transformMat4$1(f,f,this.pixelMatrix),f[3]>0?new u.pointGeometry(f[0]/f[3],f[1]/f[3]):new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,a=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,d=this.pointLocation3D(new u.pointGeometry(c,r)),y=this.pointLocation3D(new u.pointGeometry(f,r)),x=this.pointLocation3D(new u.pointGeometry(f,a)),E=this.pointLocation3D(new u.pointGeometry(c,a));let C=Math.min(d.lng,y.lng,x.lng,E.lng),R=Math.max(d.lng,y.lng,x.lng,E.lng),U=Math.min(d.lat,y.lat,x.lat,E.lat),Y=Math.max(d.lat,y.lat,x.lat,E.lat);const oe=Math.pow(2,-this.zoom)/16*270,ce="globe"===this.projection.name?1:4,de=(me,te,be,ye,De)=>{const Re=(me+be)/2,Ae=(te+ye)/2,Be=new u.pointGeometry(Re,Ae),{lng:He,lat:Ze}=this.pointLocation3D(Be),Je=Math.max(0,C-He,U-Ze,He-R,Ze-Y);C=Math.min(C,He),R=Math.max(R,He),U=Math.min(U,Ze),Y=Math.max(Y,Ze),(De<ce||Je>oe)&&(de(me,te,Re,Ae,De+1),de(Re,Ae,be,ye,De+1))};if(de(c,r,f,r,1),de(f,r,f,a,1),de(f,a,c,a,1),de(c,a,c,r,1),"globe"===this.projection.name){const[me,te]=u.polesInViewport(this);me?(Y=90,R=180,C=-180):te&&(U=-90,R=180,C=-180)}return new u.LngLatBounds(new u.LngLat(C,U),new u.LngLat(R,Y))}_getBoundsRectangular(r,c){const{top:a,left:f}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=new u.pointGeometry(f,a),E=new u.pointGeometry(y,a),C=new u.pointGeometry(y,d),R=new u.pointGeometry(f,d);let U=this.pointCoordinate(x,r),Y=this.pointCoordinate(E,r);const oe=this.pointCoordinate(C,c),ce=this.pointCoordinate(R,c),de=(me,te)=>(te.y-me.y)/(te.x-me.x);return U.y>1&&Y.y>=0?U=new u.MercatorCoordinate((1-ce.y)/de(ce,U)+ce.x,1):U.y<0&&Y.y<=1&&(U=new u.MercatorCoordinate(-ce.y/de(ce,U)+ce.x,0)),Y.y>1&&U.y>=0?Y=new u.MercatorCoordinate((1-oe.y)/de(oe,Y)+oe.x,1):Y.y<0&&U.y<=1&&(Y=new u.MercatorCoordinate(-oe.y/de(oe,Y)+oe.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(oe))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((a,f)=>{if(f.dem){const d=f.dem.tree;a.min=Math.min(a.min,d.minimums[0]),a.max=Math.max(a.max,d.maximums[0])}return a},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,a=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,a):a}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,a=this._distanceTileDataCache;if(a[c])return a[c];const f=r.canonical,d=1/this.height,y=this.cameraWorldSize,x=y/this.zoomScale(f.z),E=(f.x+Math.pow(2,f.z)*r.wrap)*x,C=f.y*x,R=this.point;R.x*=y/this.worldSize,R.y*=y/this.worldSize;const U=this.angle,Y=Math.sin(-U),oe=-Math.cos(-U);return a[c]={bearing:[Y,oe],center:[(R.x-E)*d,(R.y-C)*d],scale:x/u.EXTENT*d},a[c]}calculateFogTileMatrix(r){const c=r.key,a=this._fogTileMatrixCache;if(a[c])return a[c];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return u.multiply(f,this.worldToFogMatrix,f),a[c]=new Float32Array(f),a[c]}calculateProjMatrix(r,c=!1){const a=r.key,f=c?this._alignedProjMatrixCache:this._projMatrixCache;if(f[a])return f[a];const d=this.calculatePosMatrix(r,this.worldSize);return u.multiply(d,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,d),f[a]=new Float32Array(d),f[a]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,a=this._pixelsToTileUnitsCache;if(a[c])return a[c];const f=function(d,y){const{scale:x}=d.tileTransform,E=x*u.EXTENT/(d.tileSize*Math.pow(2,y.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return C=new Float32Array(4),Y=(R=y.inverseAdjustmentMatrix)[1],oe=R[2],ce=R[3],me=(U=[E,E])[1],C[0]=R[0]*(de=U[0]),C[1]=Y*de,C[2]=oe*me,C[3]=ce*me,C;var C,R,U,Y,oe,ce,de,me}(r,this);return a[c]=f,a[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const r=1/this.worldSize,c=u.fromScaling([],[r,r,r]);return u.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const c=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(c),f=this._camera.forward(),d=u.mercatorZfromAltitude(1,this._center.lat);a[2]/=d,f[2]/=d,u.normalize(f,f);const y=r.raycast(a,f,r.exaggeration());if(y){const x=u.scaleAndAdd([],a,f,y),E=new u.MercatorCoordinate(x[0],x[1],u.mercatorZfromAltitude(x[2],u.latFromMercatorY(x[1]))),C=(E.z+u.length([E.x-a[0],E.y-a[1],E.z-a[2]*d]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,a=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),d=c.getAtPointOrZero(new u.MercatorCoordinate(...f)),y=this.pixelsPerMeter/this.worldSize*d,x=this._minimumHeightOverTerrain(),E=f[2]-y;if(E<=x)if(E<0||r){const C=this.locationCoordinate(this._center,this._centerAltitude),R=[f[0],f[1],C.z-f[2]],U=u.length(R);R[2]-=(x-E)/this._pixelsPerMercatorPixel;const Y=u.length(R);if(0===Y)return;u.scale$2(R,R,U/Y*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],C.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const Y=this.center;return Y.lat=u.clamp(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(Y.lng=u.clamp(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const c=this._unmodified,{x:a,y:f}=this.point;let d=0,y=a,x=f;const E=this.width/2,C=this.height/2,R=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(f-C<R&&(x=R+C),f+C>U&&(x=U-C),U-R<this.height&&(d=Math.max(d,this.height/(U-R)),x=(U+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,oe=this.worldMaxX*this.scale,ce=this.worldSize/2-(Y+oe)/2;y=(a+ce+this.worldSize)%this.worldSize-ce,y-E<Y&&(y=Y+E),y+E>oe&&(y=oe-E),oe-Y<this.width&&(d=Math.max(d,this.width/(oe-Y)),y=(oe+Y)/2)}y===a&&x===f||(this.center=this.unproject(new u.pointGeometry(y,x))),d&&(this.zoom+=this.scaleZoom(d)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=u.mercatorZfromAltitude(1,this.center.lat)/u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE));const a=$e(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const f="meters"===this.projection.zAxisUnit?c:1,d=this._camera.getWorldToCamera(this.worldSize,f),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-r.x/this.width,y[9]=2*r.y/this.height;let x=u.mul([],y,d);if(this.projection.isReprojectedInTileSpace){const Ae=this.locationCoordinate(this.center),Be=u.identity([]);u.translate(Be,Be,[Ae.x*this.worldSize,Ae.y*this.worldSize,0]),u.multiply(Be,Be,G(this)),u.translate(Be,Be,[-Ae.x*this.worldSize,-Ae.y*this.worldSize,0]),u.multiply(x,x,Be),this.inverseAdjustmentMatrix=function(He){const Ze=G(He,!0);return Ne([],[Ze[0],Ze[1],Ze[4],Ze[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],x,[this.worldSize,this.worldSize,this.worldSize/f,1]),this.projMatrix=x,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const E=u.invert([],y);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);u.identity(C),u.scale(C,C,[1,-1,1]),u.rotateX(C,C,this._pitch),u.rotateZ(C,C,this.angle);const R=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-r.x/this.width,R[9]=2*(r.y+U)/this.height,this.skyboxMatrix=u.multiply(C,R,C);const Y=this.point,oe=Y.x,ce=Y.y,de=this.width%2/2,me=this.height%2/2,te=Math.cos(this.angle),be=Math.sin(this.angle),ye=oe-Math.round(oe)+te*de+be*me,De=ce-Math.round(ce)+te*me+be*de,Re=new Float64Array(x);if(u.translate(Re,Re,[ye>.5?ye-1:ye,De>.5?De-1:De,0]),this.alignedProjMatrix=Re,x=u.create(),u.scale(x,x,[this.width/2,-this.height/2,1]),u.translate(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=u.create(),u.scale(x,x,[1,-1,1]),u.translate(x,x,[-1,-1,0]),u.scale(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},x=u.invert(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=x,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const Ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(Ae,Ae,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=x;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,a=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,d=[r,r,c];u.scale$2(d,d,f),u.scale$2(a,a,-1),u.multiply$2(a,a,d);const y=u.create();u.translate(y,y,a),u.scale(y,y,d),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,f)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,a=this._camera.forward(),f=this.point,d=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-a[0]*d,f.y/this.worldSize-a[1]*d,r/this.worldSize*this._centerAltitude-a[2]*d]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),a=this._camera.position[2],f=r[2];let d=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(d=Math.min((c-a)/f,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,r,d),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:a,bearing:f}=this._camera.getPitchBearing(),d=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),x=Math.max((r[2]-d)/Math.cos(a),y),E=this._zoomFromMercatorZ(x);u.scaleAndAdd(r,r,c,x),this._pitch=u.clamp(a,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(f,-Math.PI,Math.PI),this._setZoom(u.clamp(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,a=u.GLOBE_ZOOM_THRESHOLD_MAX,f=0,d=1/0;for(;a-c>1e-6&&a>c;){const y=c+.5*(a-c),x=this.tileSize*Math.pow(2,y),E=this.getCameraToCenterDistance(this.projection,y,x),C=this.scaleZoom(E/(r*this.tileSize)),R=Math.abs(y-C);R<d&&(d=R,f=y),y<C?c=y:a=y}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const a=Math.min(r.x,c.x),f=Math.max(r.x,c.x),d=Math.min(r.y,c.y),y=Math.max(r.y,c.y);if(d<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const x=[new u.pointGeometry(a,d),new u.pointGeometry(f,y),new u.pointGeometry(a,y),new u.pointGeometry(f,d)],E=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(const R of x){const U=this.pointRayIntersection(R);if(U.t<0)return!0;const Y=this.rayIntersectionCoordinate(U);if(Y.x<E||Y.y<0||Y.x>C||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.pointGeometry(0,0),new u.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,c){const a=u.length(u.sub([],this._camera.position,r)),f=this._zoomFromMercatorZ(a)+c;return a-this._mercatorZfromZoom(f)}getCameraPoint(){if("globe"===this.projection.name){const r=function([c,a,f],d){const y=[c,a,f,1];u.transformMat4$1(y,y,d);const x=y[3]=Math.max(y[3],1e-6);return y[0]/=x,y[1]/=x,y[2]/=x,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,r))}}getCameraToCenterDistance(r,c=this.zoom,a=this.worldSize){const f=$e(r,c,this.width,this.height,1024),d=r.pixelSpaceConversion(this.center.lat,a,f);return.5/Math.tan(.5*this._fov)*this.height*d}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&u.multiply(r,r,this.globeMatrix),r}}function ai(p,r){let c=!1,a=null;const f=()=>{a=null,c&&(p(),a=setTimeout(f,r),c=!1)};return()=>(c=!0,a||f(),a)}class ko{constructor(r){this._hashName=r&&encodeURIComponent(r),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ai(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,u.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=Ti(r);if(this._hashName){const a=this._hashName;let f=!1;const d=u.window.location.hash.slice(1).split("&").map(y=>{const x=y.split("=")[0];return x===a?(f=!0,`${x}=${c}`):y}).filter(y=>y);return f||d.push(`${a}=${c}`),`#${d.join("&")}`}return`#${c}`}_getCurrentHash(){const r=u.window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(c=a)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(a=>isNaN(a))){const a=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:a,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,r)}}function Ti(p,r){const c=p.getCenter(),a=Math.round(100*p.getZoom())/100,f=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,f),y=Math.round(c.lng*d)/d,x=Math.round(c.lat*d)/d,E=p.getBearing(),C=p.getPitch();let R=r?`/${y}/${x}/${a}`:`${a}/${x}/${y}`;return(E||C)&&(R+="/"+Math.round(10*E)/10),C&&(R+=`/${Math.round(C)}`),R}const Hi={linearity:.3,easing:u.bezier(0,0,.3,1)},Ui=u.extend({deceleration:2500,maxSpeed:1400},Hi),Hs=u.extend({deceleration:20,maxSpeed:1400},Hi),Wo=u.extend({deceleration:1e3,maxSpeed:360},Hi),ec=u.extend({deceleration:1e3,maxSpeed:90},Hi);class Ca{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=u.exported.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)c.zoom+=d.zoomDelta||0,c.bearing+=d.bearingDelta||0,c.pitch+=d.pitchDelta||0,d.panDelta&&c.pan._add(d.panDelta),d.around&&(c.around=d.around),d.pinchAround&&(c.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(c.pan.mag()){const d=tc(c.pan.mag(),a,u.extend({},Ui,r||{}));f.offset=c.pan.mult(d.amount/c.pan.mag()),f.center=this._map.transform.center,Sa(f,d)}if(c.zoom){const d=tc(c.zoom,a,Hs);f.zoom=this._map.transform.zoom+d.amount,Sa(f,d)}if(c.bearing){const d=tc(c.bearing,a,Wo);f.bearing=this._map.transform.bearing+u.clamp(d.amount,-179,179),Sa(f,d)}if(c.pitch){const d=tc(c.pitch,a,ec);f.pitch=this._map.transform.pitch+d.amount,Sa(f,d)}if(f.zoom||f.bearing){const d=void 0===c.pinchAround?c.around:c.pinchAround;f.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function Sa(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function tc(p,r,c){const{maxSpeed:a,linearity:f,deceleration:d}=c,y=u.clamp(p*f/(r/1e3),-a,a),x=Math.abs(y)/(d*f);return{easing:c.easing,duration:1e3*x,amount:y*(x/2)}}class eo extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,a,f={}){const d=st(c.getCanvasContainer(),a),y=c.unproject(d);super(r,u.extend({point:d,lngLat:y,originalEvent:a},f)),this._defaultPrevented=!1,this.target=c}}class ja extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,a){const f="touchend"===r?a.changedTouches:a.touches,d=Pn(c.getCanvasContainer(),f),y=d.map(E=>c.unproject(E)),x=d.reduce((E,C,R,U)=>E.add(C.div(U.length)),new u.pointGeometry(0,0));super(r,{points:d,point:x,lngLats:y,lngLat:c.unproject(x),originalEvent:a}),this._defaultPrevented=!1}}class pl extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,a){super(r,{originalEvent:a}),this._defaultPrevented=!1}}class Pu{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new pl(r.type,this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new eo(r.type,this._map,r))}mouseup(r){this._map.fire(new eo(r.type,this._map,r))}preclick(r){const c=u.extend({},r);c.type="preclick",this._map.fire(new eo(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new eo(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new eo(r.type,this._map,r))}mouseover(r){this._map.fire(new eo(r.type,this._map,r))}mouseout(r){this._map.fire(new eo(r.type,this._map,r))}touchstart(r){return this._firePreventable(new ja(r.type,this._map,r))}touchmove(r){this._map.fire(new ja(r.type,this._map,r))}touchend(r){this._map.fire(new ja(r.type,this._map,r))}touchcancel(r){this._map.fire(new ja(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ll{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new eo(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new eo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new eo(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pc{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&0===r.button&&(Kt(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const a=c,f=this._startPos,d=this._lastPos;if(!f||!d||d.equals(a)||!this._box&&a.dist(f)<this._clickTolerance)return;this._lastPos=a,this._box||(this._box=xt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(f.x,a.x),x=Math.max(f.x,a.x),E=Math.min(f.y,a.y),C=Math.max(f.y,a.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=x-y+"px",this._box.style.height=C-E+"px")})}mouseupWindow(r,c){if(!this._active)return;const a=this._startPos,f=c;if(a&&0===r.button){if(this.reset(),Gn(),a.x!==f.x||a.y!==f.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:d=>d.fitScreenCoordinates(a,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ln(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new u.Event(r,{originalEvent:c}))}}function Rc(p,r){const c={};for(let a=0;a<p.length;a++)c[p[a].identifier]=r[a];return c}class fa{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),a.length===this.numTouches&&(this.centroid=function(f){const d=new u.pointGeometry(0,0);for(const y of f)d._add(y);return d.div(f.length)}(c),this.touches=Rc(a,c)))}touchmove(r,c,a){if(this.aborted||!this.centroid)return;const f=Rc(a,c);for(const d in this.touches){const x=f[d];(!x||x.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(r,c,a){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===a.length){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Ol{constructor(r){this.singleTap=new fa(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,a){this.singleTap.touchstart(r,c,a)}touchmove(r,c,a){this.singleTap.touchmove(r,c,a)}touchend(r,c,a){const f=this.singleTap.touchend(r,c,a);if(f){const d=r.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(f)<30;if(d&&y||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Fl{constructor(){this._zoomIn=new Ol({numTouches:1,numTaps:2}),this._zoomOut=new Ol({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,a){this._zoomIn.touchstart(r,c,a),this._zoomOut.touchstart(r,c,a)}touchmove(r,c,a){this._zoomIn.touchmove(r,c,a),this._zoomOut.touchmove(r,c,a)}touchend(r,c,a){const f=this._zoomIn.touchend(r,c,a),d=this._zoomOut.touchend(r,c,a);return f?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(f)},{originalEvent:r})}):d?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(d)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ml={0:1,2:2};class nc{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const a=Or(r);this._correctButton(r,a)&&(this._lastPoint=c,this._eventButton=a)}mousemoveWindow(r,c){const a=this._lastPoint;if(a)if(r.preventDefault(),null!=this._eventButton&&function(f,d){const y=ml[d];return void 0===f.buttons||(f.buttons&y)!==y}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(a,c)}mouseupWindow(r){this._lastPoint&&Or(r)===this._eventButton&&(this._moved&&Gn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kc extends nc{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return 0===c&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class gl extends nc{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const a=.8*(c.x-r.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(r){r.preventDefault()}}class nu extends nc{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const a=-.5*(c.y-r.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(r){r.preventDefault()}}class _l{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0)}touchstart(r,c,a){return this._calculateTransform(r,c,a)}touchmove(r,c,a){if(this._active&&!(a.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===a.length&&!u.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,a)}}touchend(r,c,a){this._calculateTransform(r,c,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,a){a.length>0&&(this._active=!0);const f=Rc(a,c),d=new u.pointGeometry(0,0),y=new u.pointGeometry(0,0);let x=0;for(const C in f){const R=f[C],U=this._touches[C];U&&(d._add(R),y._add(R.sub(U)),x++,f[C]=R)}if(this._touches=f,x<this._minTouches||!y.mag())return;const E=y.div(x);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(x),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class rc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,a){return{}}touchstart(r,c,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,a){const f=this._firstTwoTouches;if(!f)return;r.preventDefault();const[d,y]=f,x=zl(a,c,d),E=zl(a,c,y);if(!x||!E)return;const C=this._aroundCenter?null:x.add(E).div(2);return this._move([x,E],C,r)}touchend(r,c,a){if(!this._firstTwoTouches)return;const[f,d]=this._firstTwoTouches,y=zl(a,c,f),x=zl(a,c,d);y&&x||(this._active&&Gn(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zl(p,r,c){for(let a=0;a<p.length;a++)if(p[a].identifier===c)return r[a]}function ts(p,r){return Math.log(p/r)/Math.LN2}class Ru extends rc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const a=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ts(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ts(this._distance,a),pinchAround:c}}}function Va(p,r){return 180*p.angleWith(r)/Math.PI}class tl extends rc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const a=this._vector;if(this._vector=r[0].sub(r[1]),a&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Va(this._vector,a),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,a=this._startVector;if(!a)return!1;const f=Va(r,a);return Math.abs(f)<c}}function Lc(p){return Math.abs(p.y)>Math.abs(p.x)}class Lo extends rc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Lc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,a){const f=this._lastPoints;if(!f)return;const d=r[0].sub(f[0]),y=r[1].sub(f[1]);return this._map._cooperativeGestures&&!u.isFullscreen()&&a.touches.length<3||(this._valid=this.gestureBeginsVertically(d,y,a.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(d.y+y.y)/2*-.5})}gestureBeginsVertically(r,c,a){if(void 0!==this._valid)return this._valid;const f=r.mag()>=2,d=c.mag()>=2;if(!f&&!d)return;if(!f||!d)return null==this._firstMove&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=r.y>0==c.y>0;return Lc(r)&&Lc(c)&&y}}const hh={panStep:100,bearingStep:15,pitchStep:10};class Bl{constructor(){const r=hh;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,a=0,f=0,d=0,y=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?a=-1:(r.preventDefault(),d=-1);break;case 39:r.shiftKey?a=1:(r.preventDefault(),d=1);break;case 38:r.shiftKey?f=1:(r.preventDefault(),y=-1);break;case 40:r.shiftKey?f=-1:(r.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,f=0),{cameraAnimation:x=>{const E=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:dh,zoom:c?Math.round(E)+c*(r.shiftKey?2:1):E,bearing:x.getBearing()+a*this._bearingStep,pitch:x.getPitch()+f*this._pitchStep,offset:[-d*this._panStep,-y*this._panStep],center:x.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function dh(p){return p*(2-p)}const ic=4.000244140625;class na{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||u.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const a=u.exported.now(),f=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,0!==c&&c%ic==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(f*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=st(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const E="wheel"===this._type&&Math.abs(this._delta)>ic?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&0!==C&&(C=1/C);const R=c(),U=Math.pow(2,R),Y="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(Y*C))),"wheel"===this._type&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const a="number"==typeof this._targetZoom?this._targetZoom:c(),f=this._startZoom,d=this._easing;let y,x=!1;if("wheel"===this._type&&f&&d){const E=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),C=d(E);y=u.number(f,a,C),E<1?this._frameId||(this._frameId=!0):x=!0}else y=a,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:y-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=u.ease;if(this._prevEase){const a=this._prevEase,f=(u.exported.now()-a.start)/a.duration,d=a.easing(f+.01)-a.easing(f),y=.27/Math.sqrt(d*d+1e-4)*.01,x=Math.sqrt(.0729-y*y);c=u.bezier(y,x,.25,1)}return this._prevEase={start:u.exported.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Rs{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(r.shiftKey?-1:1),around:a.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(){this._tap=new Ol({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,a){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=c[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(r,c,a))}touchmove(r,c,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const f=c[0],d=f.y-this._swipePoint.y;return this._swipePoint=f,r.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(r,c,a)}touchend(r,c,a){this._tapTime?this._swipePoint&&0===a.length&&this.reset():this._tap.touchend(r,c,a)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nl{constructor(r,c,a){this._el=r,this._mousePan=c,this._touchPan=a}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fn{constructor(r,c,a){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ks{constructor(r,c,a,f){this._el=r,this._touchZoom=c,this._touchRotate=a,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const rl=p=>p.zoom||p.drag||p.pitch||p.rotate;class vl extends u.Event{}class $a{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const a=u.sub([],c,r);this.radius=u.length(a[2]<0?u.div([],a,this.constants):[a[0],a[1],0])}projectRay(r){u.div(r,r,this.constants),u.normalize(r,r),u.mul$1(r,r,this.constants);const c=u.scale$2([],r,this.radius);if(c[2]>0){const a=u.scale$2([],[0,0,1],u.dot(c,[0,0,1])),f=u.scale$2([],u.normalize([],[c[0],c[1],0]),this.radius),d=u.add([],c,u.scale$2([],u.sub([],u.add([],f,a),c),2));c[0]=d[0],c[1]=d[1]}return c}}function ru(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class iu{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ca(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $a,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),u.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[f,d,y]of this._listeners)f.addEventListener(d,f===u.window.document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[r,c,a]of this._listeners)r.removeEventListener(c,r===u.window.document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(r){const c=this._map,a=c.getCanvasContainer();this._add("mapEvent",new Pu(c,r));const f=c.boxZoom=new Pc(c,r);this._add("boxZoom",f);const d=new Fl,y=new yl;c.doubleClickZoom=new Rs(y,d),this._add("tapZoom",d),this._add("clickZoom",y);const x=new qo;this._add("tapDragZoom",x);const E=c.touchPitch=new Lo(c);this._add("touchPitch",E);const C=new gl(r),R=new nu(r);c.dragRotate=new fn(r,C,R),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const U=new kc(r),Y=new _l(c,r);c.dragPan=new nl(a,U,Y),this._add("mousePan",U),this._add("touchPan",Y,["touchZoom","touchRotate"]);const oe=new tl,ce=new Ru;c.touchZoomRotate=new ks(a,ce,oe,x),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ll(c));const de=c.scrollZoom=new na(c,this);this._add("scrollZoom",de,["mousePan"]);const me=c.keyboard=new Bl;this._add("keyboard",me);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[te]&&c[te].enable(r[te])}_add(r,c,a){this._handlers.push({handlerName:r,handler:c,allowed:a}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,a){for(const f in r)if(f!==a&&(!c||c.indexOf(f)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const a of r)this._el.contains(a.target)&&c.push(a);return c}handleEvent(r,c){this._updatingCamera=!0;const a="renderFrame"===r.type,f=a?void 0:r,d={needsRenderFrame:!1},y={},x={},E=r.touches?this._getMapTouches(r.touches):void 0,C=E?Pn(this._el,E):a?void 0:st(this._el,r);for(const{handlerName:Y,handler:oe,allowed:ce}of this._handlers){if(!oe.isEnabled())continue;let de;this._blockedByActive(x,ce,Y)?oe.reset():oe[c||r.type]&&(de=oe[c||r.type](r,C,E),this.mergeHandlerResult(d,y,de,Y,f),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||oe.isActive())&&(x[Y]=oe)}const R={};for(const Y in this._previousActiveHandlers)x[Y]||(R[Y]=f);this._previousActiveHandlers=x,(Object.keys(R).length||ru(d))&&(this._changes.push([d,y,R]),this._triggerRenderFrame()),(Object.keys(x).length||ru(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=d;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(r,c,a,f,d){if(!a)return;u.extend(r,a);const y={handlerName:f,originalEvent:a.originalEvent||d};void 0!==a.zoomDelta&&(c.zoom=y),void 0!==a.panDelta&&(c.drag=y),void 0!==a.pitchDelta&&(c.pitch=y),void 0!==a.bearingDelta&&(c.rotate=y)}_applyChanges(){const r={},c={},a={};for(const[f,d,y]of this._changes)f.panDelta&&(r.panDelta=(r.panDelta||new u.pointGeometry(0,0))._add(f.panDelta)),f.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+f.pitchDelta),void 0!==f.around&&(r.around=f.around),void 0!==f.aroundCoord&&(r.aroundCoord=f.aroundCoord),void 0!==f.pinchAround&&(r.pinchAround=f.pinchAround),f.noInertia&&(r.noInertia=f.noInertia),u.extend(c,d),u.extend(a,y);this._updateMapTransform(r,c,a),this._changes=[]}_updateMapTransform(r,c,a){const f=this._map,d=f.transform,y=be=>[be.x,be.y,be.z];if((be=>{const ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!ru(r)){const be=d.zoom;d.cameraElevationReference="sea",d.recenterOnTerrain(),d.cameraElevationReference="ground",be!==d.zoom&&this._map._update(!0)}if(d._isCameraConstrained&&f._stop(!0),!ru(r))return void this._fireEvents(c,a,!0);let{panDelta:x,zoomDelta:E,bearingDelta:C,pitchDelta:R,around:U,aroundCoord:Y,pinchAround:oe}=r;d._isCameraConstrained&&(E>0&&(E=0),d._isCameraConstrained=!1),void 0!==oe&&(U=oe),(E||(be=>c.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=y(d.pointCoordinate3D(U)),this._trackingEllipsoid.setup(d._camera.position,this._dragOrigin)),d.cameraElevationReference="sea",f._stop(!0),U=U||f.transform.centerPoint,C&&(d.bearing+=C),R&&(d.pitch+=R),d._updateCameraState();const ce=[0,0,0];if(x)if("mercator"===d.projection.name){const be=this._trackingEllipsoid.projectRay(d.screenPointToMercatorRay(U).dir),ye=this._trackingEllipsoid.projectRay(d.screenPointToMercatorRay(U.sub(x)).dir);ce[0]=ye[0]-be[0],ce[1]=ye[1]-be[1]}else{const be=d.pointCoordinate(U);if("globe"===d.projection.name){x=x.rotate(-d.angle);const ye=d._pixelsPerMercatorPixel/d.worldSize;ce[0]=-x.x*u.mercatorScale(u.latFromMercatorY(be.y))*ye,ce[1]=-x.y*u.mercatorScale(d.center.lat)*ye}else{const ye=d.pointCoordinate(U.sub(x));be&&ye&&(ce[0]=ye.x-be.x,ce[1]=ye.y-be.y)}}const de=d.zoom,me=[0,0,0];if(E){const be=y(Y||d.pointCoordinate3D(U)),ye={dir:u.normalize([],u.sub([],be,d._camera.position))};if(ye.dir[2]<0){const De=d.zoomDeltaToMovement(be,E);u.scale$2(me,ye.dir,De)}}const te=u.add(ce,ce,me);d._translateCameraConstrained(te),E&&Math.abs(d.zoom-de)>1e-4&&d.recenterOnTerrain(),d.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,a,!0)}_fireEvents(r,c,a){const f=rl(this._eventsInProgress),d=rl(r),y={};for(const R in r){const{originalEvent:U}=r[R];this._eventsInProgress[R]||(y[`${R}start`]=U),this._eventsInProgress[R]=r[R]}!f&&d&&this._fireEvent("movestart",d.originalEvent);for(const R in y)this._fireEvent(R,y[R]);d&&this._fireEvent("move",d.originalEvent);for(const R in r){const{originalEvent:U}=r[R];this._fireEvent(R,U)}const x={};let E;for(const R in this._eventsInProgress){const{handlerName:U,originalEvent:Y}=this._eventsInProgress[R];this._handlersById[U].isActive()||(delete this._eventsInProgress[R],E=c[U]||Y,x[`${R}end`]=E)}for(const R in x)this._fireEvent(R,x[R]);const C=rl(this._eventsInProgress);if(a&&(f||d)&&!C){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=Y=>0!==Y&&-this._bearingSnap<Y&&Y<this._bearingSnap;R?(U(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:E})):(this._map.fire(new u.Event("moveend",{originalEvent:E})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new u.Event(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new vl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const di="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ou extends u.Evented{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,a){return r=u.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,u.extend({offset:r},c),a)}panTo(r,c,a){return this.easeTo(u.extend({center:r},c),a)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,a){return this.easeTo(u.extend({zoom:r},c),a)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,a){return this.easeTo(u.extend({bearing:r},c),a)}resetNorth(r,c){return this.rotateTo(0,u.extend({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=u.LngLatBounds.convert(r);const a=c&&c.bearing||0,f=c&&c.pitch||0,d=r.getNorthWest(),y=r.getSouthEast();return this._cameraForBounds(this.transform,d,y,a,f,c)}_extendCameraOptions(r){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=u.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const a=r.padding;r.padding={top:a,bottom:a,right:a,left:a}}return r.padding=u.extend(c,r.padding),r}_minimumAABBFrustumDistance(r,c){const a=c.max[0]-c.min[0],f=c.max[1]-c.min[1];return a/f>r.aspect?a/(2*Math.tan(.5*r.fovX)*r.aspect):f/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,a,f,d,y){const x=r.clone(),E=this._extendCameraOptions(y);x.bearing=f,x.pitch=d;const C=u.LngLat.convert(c),R=u.LngLat.convert(a),U=.5*(C.lat+R.lat),Y=.5*(C.lng+R.lng),oe=u.latLngToECEF(U,Y),ce=u.normalize([],oe),de=u.normalize([],u.cross([],ce,[0,1,0])),me=u.cross([],de,ce),te=[de[0],de[1],de[2],0,me[0],me[1],me[2],0,ce[0],ce[1],ce[2],0,0,0,0,1],be=[oe,u.latLngToECEF(C.lat,C.lng),u.latLngToECEF(R.lat,C.lng),u.latLngToECEF(R.lat,R.lng),u.latLngToECEF(C.lat,R.lng),u.latLngToECEF(U,C.lng),u.latLngToECEF(U,R.lng),u.latLngToECEF(C.lat,Y),u.latLngToECEF(R.lat,Y)];let ye=u.Aabb.fromPoints(be.map(It=>[u.dot(de,It),u.dot(me,It),u.dot(ce,It)]));const De=u.transformMat4([],ye.center,te);0===u.squaredLength(De)&&u.set(De,0,0,1),u.normalize(De,De),u.scale$2(De,De,u.GLOBE_RADIUS),x.center=u.ecefToLatLng(De);const Re=x.getWorldToCameraMatrix(),Ae=u.invert(new Float64Array(16),Re);ye=u.Aabb.applyTransform(ye,u.multiply([],Re,te)),u.transformMat4(De,De,Re);const Be=.5*(ye.max[2]-ye.min[2]),He=this._minimumAABBFrustumDistance(x,ye),Ze=u.scale$2([],[0,0,1],Be),Je=u.add(Ze,De,Ze),Ht=He+(0===x.pitch?0:u.distance(De,Je)),We=x.globeCenterInViewSpace,Dt=u.sub([],De,[We[0],We[1],We[2]]);u.normalize(Dt,Dt),u.scale$2(Dt,Dt,Ht);const ut=u.add([],De,Dt);u.transformMat4(ut,ut,Ae);const kt=u.earthRadius/u.GLOBE_RADIUS,Ke=u.length(ut),Ge=u.mercatorZfromAltitude(Math.max(Ke*kt-u.earthRadius,Number.EPSILON),0),tt=Math.min(x.zoomFromMercatorZAdjusted(Ge),E.maxZoom);return tt>.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(x.setProjection({name:"mercator"}),x.zoom=tt,this._cameraForBounds(x,c,a,f,d,y)):{center:x.center,zoom:tt,bearing:f,pitch:d}}queryTerrainElevation(r,c){const a=this.transform.elevation;return a?(c=u.extend({},{exaggerated:!0},c),a.getAtPoint(u.MercatorCoordinate.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,a,f,d,y){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,c,a,f,d,y);const x=r.clone(),E=this._extendCameraOptions(y),C=x.padding;x.bearing=f,x.pitch=d;const R=u.LngLat.convert(c),U=u.LngLat.convert(a),Y=new u.LngLat(R.lng,U.lat),oe=new u.LngLat(U.lng,R.lat),ce=x.project(R),de=x.project(U),me=this.queryTerrainElevation(R),te=this.queryTerrainElevation(U),be=this.queryTerrainElevation(Y),ye=this.queryTerrainElevation(oe),De=[[ce.x,ce.y,Math.min(me||0,te||0,be||0,ye||0)],[de.x,de.y,Math.max(me||0,te||0,be||0,ye||0)]];let Re=u.Aabb.fromPoints(De);const Ae=x.getWorldToCameraMatrix(),Be=u.invert(new Float64Array(16),Ae);Re=u.Aabb.applyTransform(Re,Ae);const He=u.sub([],Re.max,Re.min),Ze=C.left||0,Je=C.right||0,Ht=C.bottom||0,We=C.top||0,{left:Dt,right:ut,top:kt,bottom:Ke}=E.padding,Ge=.5*(Ze+Je),tt=.5*(We+Ht),It=Math.min(x.scaleZoom(x.scale*Math.min((x.width-(Ze+Je+Dt+ut))/He[0],(x.height-(Ht+We+Ke+kt))/He[1])),E.maxZoom),zt=x.scale/x.zoomScale(It);Re=new u.Aabb([Re.min[0]-(Dt+Ge)*zt,Re.min[1]-(Ke+tt)*zt,Re.min[2]],[Re.max[0]+(ut+Ge)*zt,Re.max[1]+(kt+tt)*zt,Re.max[2]]);const Mn=.5*He[2],_r=this._minimumAABBFrustumDistance(x,Re),wn=[0,0,1,0];u.transformMat4$1(wn,wn,Ae),u.normalize$2(wn,wn);const pn=u.scale$2([],wn,_r+Mn),kn=u.add([],Re.center,pn),Mr=("number"==typeof E.offset.x&&"number"==typeof E.offset.y?new u.pointGeometry(E.offset.x,E.offset.y):u.pointGeometry.convert(E.offset)).rotate(-u.degToRad(f));Re.center[0]-=Mr.x*zt,Re.center[1]+=Mr.y*zt,u.transformMat4(Re.center,Re.center,Be),u.transformMat4(kn,kn,Be);const Nn=[Re.center[0],Re.center[1],kn[2]*x.pixelsPerMeter];u.scale$2(Nn,Nn,1/x.worldSize);const Qr=u.lngFromMercatorX(Nn[0]),fi=u.latFromMercatorY(Nn[1]),pi=Math.min(x._zoomFromMercatorZ(Nn[2]),E.maxZoom),Di=new u.LngLat(Qr,fi);return x.mercatorFromTransition&&pi<.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(x.setProjection({name:"globe"}),x.zoom=pi,this._cameraForBounds(x,c,a,f,d,y)):{center:Di,zoom:pi,bearing:f,pitch:d}}fitBounds(r,c,a){const f=this.cameraForBounds(r,c);return this._fitInternal(f,c,a)}fitScreenCoordinates(r,c,a,f,d){const y=u.pointGeometry.convert(r),x=u.pointGeometry.convert(c),E=new u.pointGeometry(Math.min(y.x,x.x),Math.min(y.y,x.y)),C=new u.pointGeometry(Math.max(y.x,x.x),Math.max(y.y,x.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(y,x))return this;const R=this.transform.pointLocation3D(E),U=this.transform.pointLocation3D(C),Y=this.transform.pointLocation3D(new u.pointGeometry(E.x,C.y)),oe=this.transform.pointLocation3D(new u.pointGeometry(C.x,E.y)),ce=[Math.min(R.lng,U.lng,Y.lng,oe.lng),Math.min(R.lat,U.lat,Y.lat,oe.lat)],de=[Math.max(R.lng,U.lng,Y.lng,oe.lng),Math.max(R.lat,U.lat,Y.lat,oe.lat)],me=f&&f.pitch?f.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,ce,de,a,me,f);return this._fitInternal(te,f,d)}_fitInternal(r,c,a){return r?(delete(c=u.extend(r,c)).padding,c.linear?this.easeTo(c,a):this.flyTo(c,a)):this}jumpTo(r,c){this.stop();const a=r.preloadOnly?this.transform.clone():this.transform;let f=!1,d=!1,y=!1;return"zoom"in r&&a.zoom!==+r.zoom&&(f=!0,a.zoom=+r.zoom),void 0!==r.center&&(a.center=u.LngLat.convert(r.center)),"bearing"in r&&a.bearing!==+r.bearing&&(d=!0,a.bearing=+r.bearing),"pitch"in r&&a.pitch!==+r.pitch&&(y=!0,a.pitch=+r.pitch),null==r.padding||a.isPaddingEqual(r.padding)||(a.padding=r.padding),r.preloadOnly?(this._preloadTiles(a),this):(this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),f&&this.fire(new u.Event("zoomstart",c)).fire(new u.Event("zoom",c)).fire(new u.Event("zoomend",c)),d&&this.fire(new u.Event("rotatestart",c)).fire(new u.Event("rotate",c)).fire(new u.Event("rotateend",c)),y&&this.fire(new u.Event("pitchstart",c)).fire(new u.Event("pitch",c)).fire(new u.Event("pitchend",c)),this.fire(new u.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(di),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const a=this.transform;if(!a.projection.supportsFreeCamera)return u.warnOnce(di),this;this.stop();const f=a.zoom,d=a.pitch,y=a.bearing;a.setFreeCameraOptions(r);const x=f!==a.zoom,E=d!==a.pitch,C=y!==a.bearing;return this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),x&&this.fire(new u.Event("zoomstart",c)).fire(new u.Event("zoom",c)).fire(new u.Event("zoomend",c)),C&&this.fire(new u.Event("rotatestart",c)).fire(new u.Event("rotate",c)).fire(new u.Event("rotateend",c)),E&&this.fire(new u.Event("pitchstart",c)).fire(new u.Event("pitch",c)).fire(new u.Event("pitchend",c)),this.fire(new u.Event("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),(!1===(r=u.extend({offset:[0,0],duration:500,easing:u.ease},r)).animate||!r.essential&&u.exported.prefersReducedMotion)&&(r.duration=0);const a=this.transform,f=this.getZoom(),d=this.getBearing(),y=this.getPitch(),x=this.getPadding(),E="zoom"in r?+r.zoom:f,C="bearing"in r?this._normalizeBearing(r.bearing,d):d,R="pitch"in r?+r.pitch:y,U="padding"in r?r.padding:a.padding,Y=u.pointGeometry.convert(r.offset);let oe,ce,de;if("globe"===a.projection.name){const Ze=u.MercatorCoordinate.fromLngLat(a.center),Je=Y.rotate(-a.angle);Ze.x+=Je.x/a.worldSize,Ze.y+=Je.y/a.worldSize;const Ht=Ze.toLngLat(),We=u.LngLat.convert(r.center||Ht);this._normalizeCenter(We),oe=a.centerPoint.add(Je),ce=new u.pointGeometry(Ze.x,Ze.y).mult(a.worldSize),de=new u.pointGeometry(u.mercatorXfromLng(We.lng),u.mercatorYfromLat(We.lat)).mult(a.worldSize).sub(ce)}else{oe=a.centerPoint.add(Y);const Ze=a.pointLocation(oe),Je=u.LngLat.convert(r.center||Ze);this._normalizeCenter(Je),ce=a.project(Ze),de=a.project(Je).sub(ce)}const me=a.zoomScale(E-f);let te,be;r.around&&(te=u.LngLat.convert(r.around),be=a.locationPoint(te));const ye=this._zooming||E!==f,De=this._rotating||d!==C,Re=this._pitching||R!==y,Ae=!a.isPaddingEqual(U),Be=Ze=>Je=>{if(ye&&(Ze.zoom=u.number(f,E,Je)),De&&(Ze.bearing=u.number(d,C,Je)),Re&&(Ze.pitch=u.number(y,R,Je)),Ae&&(Ze.interpolatePadding(x,U,Je),oe=Ze.centerPoint.add(Y)),te)Ze.setLocationAtPoint(te,be);else{const Ht=Ze.zoomScale(Ze.zoom-f),We=E>f?Math.min(2,me):Math.max(.5,me),Dt=Math.pow(We,1-Je),ut=Ze.unproject(ce.add(de.mult(Je*Dt)).mult(Ht));Ze.setLocationAtPoint(Ze.renderWorldCopies?ut.wrap():ut,oe)}return r.preloadOnly||this._fireMoveEvents(c),Ze};if(r.preloadOnly){const Ze=this._emulate(Be,r.duration,a);return this._preloadTiles(Ze),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=De,this._pitching=Re,this._padding=Ae,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,He),this._ease(Be(a),Ze=>{a.recenterOnTerrain(),this._afterEase(c,Ze)},r),this}_prepareEase(r,c,a={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||a.moving||this.fire(new u.Event("movestart",r)),this._zooming&&!a.zooming&&this.fire(new u.Event("zoomstart",r)),this._rotating&&!a.rotating&&this.fire(new u.Event("rotatestart",r)),this._pitching&&!a.pitching&&this.fire(new u.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new u.Event("move",r)),this._zooming&&this.fire(new u.Event("zoom",r)),this._rotating&&this.fire(new u.Event("rotate",r)),this._pitching&&this.fire(new u.Event("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const a=this._zooming,f=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new u.Event("zoomend",r)),f&&this.fire(new u.Event("rotateend",r)),d&&this.fire(new u.Event("pitchend",r)),this.fire(new u.Event("moveend",r))}flyTo(r,c){if(!r.essential&&u.exported.prefersReducedMotion){const It=u.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(It,c)}this.stop(),r=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},r);const a=this.transform,f=this.getZoom(),d=this.getBearing(),y=this.getPitch(),x=this.getPadding(),E="zoom"in r?u.clamp(+r.zoom,a.minZoom,a.maxZoom):f,C="bearing"in r?this._normalizeBearing(r.bearing,d):d,R="pitch"in r?+r.pitch:y,U="padding"in r?r.padding:a.padding,Y=a.zoomScale(E-f),oe=u.pointGeometry.convert(r.offset);let ce=a.centerPoint.add(oe);const de=a.pointLocation(ce),me=u.LngLat.convert(r.center||de);this._normalizeCenter(me);const te=a.project(de),be=a.project(me).sub(te);let ye=r.curve;const De=Math.max(a.width,a.height),Re=De/Y,Ae=be.mag();if("minZoom"in r){const It=u.clamp(Math.min(r.minZoom,f,E),a.minZoom,a.maxZoom),zt=De/a.zoomScale(It-f);ye=Math.sqrt(zt/Ae*2)}const Be=ye*ye;function He(It){const zt=(Re*Re-De*De+(It?-1:1)*Be*Be*Ae*Ae)/(2*(It?Re:De)*Be*Ae);return Math.log(Math.sqrt(zt*zt+1)-zt)}function Ze(It){return(Math.exp(It)-Math.exp(-It))/2}function Je(It){return(Math.exp(It)+Math.exp(-It))/2}const Ht=He(0);let We=function(It){return Je(Ht)/Je(Ht+ye*It)},Dt=function(It){return De*((Je(Ht)*(Ze(zt=Ht+ye*It)/Je(zt))-Ze(Ht))/Be)/Ae;var zt},ut=(He(1)-Ht)/ye;if(Math.abs(Ae)<1e-6||!isFinite(ut)){if(Math.abs(De-Re)<1e-6)return this.easeTo(r,c);const It=Re<De?-1:1;ut=Math.abs(Math.log(Re/De))/ye,Dt=function(){return 0},We=function(zt){return Math.exp(It*ye*zt)}}r.duration="duration"in r?+r.duration:1e3*ut/("screenSpeed"in r?+r.screenSpeed/ye:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const kt=d!==C,Ke=R!==y,Ge=!a.isPaddingEqual(U),tt=It=>zt=>{const Mn=zt*ut,_r=1/We(Mn);It.zoom=1===zt?E:f+It.scaleZoom(_r),kt&&(It.bearing=u.number(d,C,zt)),Ke&&(It.pitch=u.number(y,R,zt)),Ge&&(It.interpolatePadding(x,U,zt),ce=It.centerPoint.add(oe));const wn=1===zt?me:It.unproject(te.add(be.mult(Dt(Mn))).mult(_r));return It.setLocationAtPoint(It.renderWorldCopies?wn.wrap():wn,ce),It._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),It};if(r.preloadOnly){const It=this._emulate(tt,r.duration,a);return this._preloadTiles(It),this}return this._zooming=!0,this._rotating=kt,this._pitching=Ke,this._padding=Ge,this._prepareEase(c,!1),this._ease(tt(a),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const a=this._onEaseEnd;this._onEaseEnd=void 0,a.call(this,c)}if(!r){const a=this.handlers;a&&a.stop(!1)}return this}_ease(r,c,a){!1===a.animate||0===a.duration?(r(1),c()):(this._easeStart=u.exported.now(),this._easeOptions=a,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=u.wrap(r,-180,180);const a=Math.abs(r-c);return Math.abs(r-360-c)<a&&(r-=360),Math.abs(r+360-c)<a&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const a=r.lng-c.center.lng;r.lng+=a>180?-360:a<-180?360:0}_emulate(r,c,a){const f=Math.ceil(15*c/1e3),d=[],y=r(a.clone());for(let x=0;x<=f;x++){const E=y(x/f);d.push(E.clone())}return d}}class ku{constructor(r={}){this.options=r,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact;return this._map=r,this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xt("button","mapboxgl-ctrl-attrib-button",this._container),xt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,c){const a=this._map._getUIString(`AttributionControl.${c}`);r.setAttribute("aria-label",a),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",a)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(r){const a=c.reduce((f,d,y)=>(d.value&&(f+=`${d.key}=${d.value}${y<c.length-1?"&":""}`),f),"?");r.href=`${u.config.FEEDBACK_URL}/${a}#${Ti(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const c=this._map.style._sourceCaches;for(const f in c){const d=c[f];if(d.used){const y=d.getSource();y.attribution&&r.indexOf(y.attribution)<0&&r.push(y.attribution)}}r.sort((f,d)=>f.length-d.length),r=r.filter((f,d)=>{for(let y=d+1;y<r.length;y++)if(r[y].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const a=r.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,r.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Lu{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=xt("div","mapboxgl-ctrl");const c=xt("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const c in r){const a=r[c].getSource();if(a.hasOwnProperty("mapbox_logo")&&!a.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Oc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,a=c?this._queue.concat(c):this._queue;for(const f of a)if(f.id===r)return void(f.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const a of c)if(!a.cancelled&&(a.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fc(p,r,c){if(p=new u.LngLat(p.lng,p.lat),r){const a=new u.LngLat(p.lng-360,p.lat),f=new u.LngLat(p.lng+360,p.lat),d=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),y=c.locationPoint(p).distSqr(r),x=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint(a).distSqr(r)<y&&(x||Math.abs(a.lng-c.center.lng)<d)?p=a:c.locationPoint(f).distSqr(r)<y&&(x||Math.abs(f.lng-c.center.lng)<d)&&(p=f)}for(;Math.abs(p.lng-c.center.lng)>180;){const a=c.locationPoint(p);if(a.x>=0&&a.y>=0&&a.x<=c.width&&a.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ou extends u.Evented{constructor(r,c){if(super(),(r instanceof u.window.HTMLElement||c)&&(r=u.extend({element:r},c)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=u.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=xt("div");const f=41,d=27,y=nt("svg",{display:"block",height:f*this._scale+"px",width:d*this._scale+"px",viewBox:`0 0 ${d} ${f}`},this._element),x=nt("radialGradient",{id:"shadowGradient"},nt("defs",{},y));nt("stop",{offset:"10%","stop-opacity":.4},x),nt("stop",{offset:"100%","stop-opacity":.05},x),nt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},y),nt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},y),nt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},y),nt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},y),this._offset=u.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()});const a=this._element.classList;for(const f in oc)a.remove(`mapboxgl-marker-anchor-${f}`);a.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=u.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,a=r.charCode||r.keyCode;"Space"!==c&&"Enter"!==c&&32!==a&&13!==a||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,a=this._element;this._popup&&(c===a||a.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const a=r.unproject(c),f=r.getFreeCameraOptions();if(!f.position)return!1;const d=f.position.toLngLat();return d.distanceTo(a)<.9*d.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const a=r.unproject(c);let f;r._showingGlobe()&&u.isLngLatBehindGlobe(r.transform,this._lngLat)?f=0:(f=1-r._queryFogOpacity(a),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${oc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const r=this._pos,c=this._map,a=this.getPitchAlignment();if(!c||!r||"map"!==a)return"";if(!c._showingGlobe()){const E=c.getPitch();return E?`rotateX(${E}deg)`:""}const f=u.radToDeg(u.globeTiltAtLngLat(c.transform,this._lngLat)),d=r.sub(u.globeCenterToScreenPoint(c.transform)),y=Math.abs(d.x)+Math.abs(d.y);if(0===y)return"";const x=f/y;return`rotateX(${-d.y*x}deg) rotateY(${d.x*x}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let a=0;const f=this.getRotationAlignment();if("map"===f)if(c._showingGlobe()){const d=c.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),y=c.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(d);a=u.radToDeg(Math.atan2(y.y,y.x))-90}else a=-c.getBearing();else if("horizon"===f){const d=u.smoothstep(4,6,c.getZoom()),y=u.globeCenterToScreenPoint(c.transform);y.y+=d*c.transform.height;const x=r.sub(y),E=u.radToDeg(Math.atan2(x.y,x.x));a=(E>90?E-270:E+90)*(1-d)}return a+=this._rotation,a?`rotateZ(${a}deg)`:""}_update(r){u.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Fc(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===r?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=u.pointGeometry.convert(r),this._update(),this}_onMove(r){const c=this._map;if(!c)return;const a=this._pointerdownPos,f=this._positionDelta;if(a&&f){if(!this._isDragging){const d=this._clickTolerance||c._clickTolerance;if(r.point.dist(a)<d)return;this._isDragging=!0}this._pos=r.point.sub(f),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,a=this._pos;c&&a&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(a),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const sc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nl(p=new u.pointGeometry(0,0),r="bottom"){if("number"==typeof p){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new u.pointGeometry(0,p);case"top-left":return new u.pointGeometry(c,c);case"top-right":return new u.pointGeometry(-c,c);case"bottom":return new u.pointGeometry(0,-p);case"bottom-left":return new u.pointGeometry(c,-c);case"bottom-right":return new u.pointGeometry(-c,-c);case"left":return new u.pointGeometry(p,0);case"right":return new u.pointGeometry(-p,0)}return new u.pointGeometry(0,0)}return p instanceof u.pointGeometry||Array.isArray(p)?u.pointGeometry.convert(p):u.pointGeometry.convert(p[r]||[0,0])}class Eo{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=u.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,a){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+a}}const ac={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ul={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},su={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ws{constructor(r,c,a=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new gl({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,a&&(this.mousePitch=new nu({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),Kt()}move(r,c){const a=this.map,f=this.mouseRotate.mousemoveWindow(r,c),d=f&&f.bearingDelta;if(d&&a.setBearing(a.getBearing()+d),this.mousePitch){const y=this.mousePitch.mousemoveWindow(r,c),x=y&&y.pitchDelta;x&&a.setPitch(a.getPitch()+x)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ln(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(u.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),st(this.element,r)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,st(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Pn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},au={maxWidth:100,unit:"metric"};function lc(p,r,c){const a=ol(r),f=a/r,d={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[c];this._map._requestDomTask(()=>{this._container.style.width=p*f+"px",this._container.innerHTML=`${a}&nbsp;${d}`})}function ol(p){const r=Math.pow(10,`${Math.floor(p)}`.length-1);let c=p/r;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(a){const f=Math.pow(10,Math.ceil(-Math.log(a)/Math.LN10));return Math.round(a*f)/f}(c),r*c}const cc={version:u.version,supported:Xt,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends ou{constructor(p){if(u.LivePerformanceUtils.mark(u.PerformanceMarkers.create),null!=(p=u.extend({},Ul,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(p.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mt(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._useWebGL2=p.useWebGL2,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Oc,this._domRenderTaskQueue=new Oc,this._controls=[],this._markers=[],this._popups=[],this._mapId=u.uniqueId(),this._locale=u.extend({},ac,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Eo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new u.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=u.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new iu(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new ko("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,u.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new ku({customAttribution:p.customAttribution})),this._logoControl=new Lu,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new u.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new u.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const a=this._controlPositions[r];return-1!==r.indexOf("bottom")?a.insertBefore(c,a.firstChild):a.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new u.Event("movestart",p)).fire(new u.Event("move",p)),this.fire(new u.Event("resize",p)),r&&this.fire(new u.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(u.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return"auto"===p?u.window.navigator.language:Array.isArray(p)?0===p.length?void 0:p.map(r=>"auto"===r?u.window.navigator.language:r):p}setLanguage(p){const r=this._parseLanguage(p);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,r=p.projection.name;let c;"globe"===r&&p.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),c=!0):"mercator"===r&&p.zoom<u.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;if(r="globe"===p.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(p){return this.transform.locationPoint3D(u.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(u.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,r,c){if("mouseenter"===p||"mouseover"===p){let a=!1;const f=y=>{const x=r.filter(C=>this.getLayer(C)),E=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];E.length?a||(a=!0,c.call(this,new eo(p,this,y.originalEvent,{features:E}))):a=!1},d=()=>{a=!1};return{layers:new Set(r),listener:c,delegates:{mousemove:f,mouseout:d}}}if("mouseleave"===p||"mouseout"===p){let a=!1;const f=y=>{const x=r.filter(E=>this.getLayer(E));(x.length?this.queryRenderedFeatures(y.point,{layers:x}):[]).length?a=!0:a&&(a=!1,c.call(this,new eo(p,this,y.originalEvent)))},d=y=>{a&&(a=!1,c.call(this,new eo(p,this,y.originalEvent)))};return{layers:new Set(r),listener:c,delegates:{mousemove:f,mouseout:d}}}{const a=f=>{const d=r.filter(x=>this.getLayer(x)),y=d.length?this.queryRenderedFeatures(f.point,{layers:d}):[];y.length&&(f.features=y,c.call(this,f),delete f.features)};return{layers:new Set(r),listener:c,delegates:{[p]:a}}}}on(p,r,c){if(void 0===c)return super.on(p,r);Array.isArray(r)||(r=[r]);const a=this._createDelegatedListener(p,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(a);for(const f in a.delegates)this.on(f,a.delegates[f]);return this}once(p,r,c){if(void 0===c)return super.once(p,r);Array.isArray(r)||(r=[r]);const a=this._createDelegatedListener(p,r,c);for(const f in a.delegates)this.once(f,a.delegates[f]);return this}off(p,r,c){if(void 0===c)return super.off(p,r);r=new Set(Array.isArray(r)?r:[r]);const a=(d,y)=>{if(d.size!==y.size)return!1;for(const x of d)if(!y.has(x))return!1;return!0},f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(d=>{for(let y=0;y<d.length;y++){const x=d[y];if(x.listener===c&&a(x.layers,r)){for(const E in x.delegates)this.off(E,x.delegates[E]);return d.splice(y,1),this}}})(f),this}queryRenderedFeatures(p,r){return this.style?(void 0!==r||void 0===p||p instanceof u.pointGeometry||Array.isArray(p)||(r=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(p,r){return this.style.querySourceFeatures(p,r)}setStyle(p,r){return!1!==(r=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new lo(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,r){if("string"==typeof p){const c=this._requestManager.normalizeStyleURL(p),a=this._requestManager.transformRequest(c,u.ResourceType.Style);u.getJSON(a,(f,d)=>{f?this.fire(new u.ErrorEvent(f)):d&&this._updateDiff(d,r)})}else"object"==typeof p&&this._updateDiff(p,r)}_updateDiff(p,r){try{this.style.setState(p)&&this._update(!0)}catch(c){u.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(p,r){return this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const r in p){const c=p[r]._tiles;for(const a in c){const f=c[a];if("loaded"!==f.state&&"errored"!==f.state)return!1}}return!0}addSourceType(p,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,r,{pixelRatio:c=1,sdf:a=!1,stretchX:f,stretchY:d,content:y}={}){if(this._lazyInitEmptyStyle(),r instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&r instanceof u.window.ImageBitmap){const{width:x,height:E,data:C}=u.exported.getImageData(r);this.style.addImage(p,{data:new u.RGBAImage({width:x,height:E},C),pixelRatio:c,stretchX:f,stretchY:d,content:y,sdf:a,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:x,height:E}=r,C=r;this.style.addImage(p,{data:new u.RGBAImage({width:x,height:E},new Uint8Array(C.data)),pixelRatio:c,stretchX:f,stretchY:d,content:y,sdf:a,version:0,userImage:C}),C.onAdd&&C.onAdd(this,p)}}updateImage(p,r){const c=this.style.getImage(p);if(!c)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=r instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&r instanceof u.window.ImageBitmap?u.exported.getImageData(r):r,{width:f,height:d}=a;void 0!==f&&void 0!==d?f===c.data.width&&d===c.data.height?(c.data.replace(a.data,!(r instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&r instanceof u.window.ImageBitmap)),this.style.updateImage(p,c)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${f}, ${d})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){u.getImage(this._requestManager.transformRequest(p,u.ResourceType.Image),(c,a)=>{r(c,a instanceof u.window.HTMLImageElement?u.exported.getImageData(a):a)})}listImages(){return this.style.listImages()}addLayer(p,r){return this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)}moveLayer(p,r){return this.style.moveLayer(p,r),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,r,c){return this.style.setLayerZoomRange(p,r,c),this._update(!0)}setFilter(p,r,c={}){return this.style.setFilter(p,r,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,r,c,a={}){return this.style.setPaintProperty(p,r,c,a),this._update(!0)}getPaintProperty(p,r){return this.style.getPaintProperty(p,r)}setLayoutProperty(p,r,c,a={}){return this.style.setLayoutProperty(p,r,c,a),this._update(!0)}getLayoutProperty(p,r){return this.style.getLayoutProperty(p,r)}setLight(p,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(p),this.transform):0}setFeatureState(p,r){return this.style.setFeatureState(p,r),this._update()}removeFeatureState(p,r){return this.style.removeFeatureState(p,r),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,a,f,d=this._container;for(;d&&(!a||!f);){const y=u.window.getComputedStyle(d).transform;y&&"none"!==y&&(c=y.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(a=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(f=c[3])),d=d.parentElement}this._containerWidth=a?Math.abs(p/a):p,this._containerHeight=f?Math.abs(r/f):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=xt("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=xt("div","mapboxgl-canvas-container",p);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=xt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=xt("div","mapboxgl-control-container",p),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{a[f]=xt("div",`mapboxgl-ctrl-${f}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const c=u.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);-1!==r&&this._markers.splice(r,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const r=this._popups.indexOf(p);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const p=u.extend({},Xt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",p),c=r||this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);c?(this._useWebGL2&&!r&&u.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),u.storeAuthState(c,!0),this.painter=new X(c,this.transform,!!r),this.on("data",a=>{"source"===a.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(c)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;const c=this.painter.context.extTimerQuery,a=u.exported.now();if(this.listens("gpu-timing-frame")&&(r=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],u.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],u.window.performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const f=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,E=this.transform.pitch,C=u.exported.now(),R=new u.EvaluationParameters(x,{now:C,fadeDuration:f,pitch:E,transition:this.style.getTransition()});this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let d=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),d=this._updateAverageElevation(a),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):d=this._updateAverageElevation(a),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,f,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const x=u.exported.now()-a;c.endQueryEXT(c.TIME_ELAPSED_EXT,r),setTimeout(()=>{const E=c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(r),this.fire(new u.Event("gpu-timing-frame",{cpuTime:x,gpuTime:E})),u.window.performance.mark("frame-gpu",{startTime:a,detail:{gpuTime:E}})},50)}if(this.listens("gpu-timing-layer")){const x=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(x);this.fire(new u.Event("gpu-timing-layer",{layerTimes:E}))},50)}if(this.listens("gpu-timing-deferred-render")){const x=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const E=this.painter.queryGpuTimeDeferredRender(x);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:E}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(y||this._repaint)this.triggerRepaint();else{const x=!this.isMoving()&&this.loaded();if(x&&(d=this._updateAverageElevation(a,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),x&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const E=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:E})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,u.LivePerformanceUtils.mark(u.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&u.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const r of this._markers)p&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!p||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(p,r=!1){const c=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const a=this.transform.averageElevation;let f=this.transform.sampleAverageElevation(),d=!1;this.transform.elevation&&(d=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(f)?f=0:this._averageElevationLastSampledAt=p;const y=Math.abs(a-f);if(y>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(f),c(f);this._averageElevation.easeTo(f,p,300)}else if(y>1e-4)return this._averageElevation.jumpTo(f),c(f)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===u.AUTH_ERR_MSG||401===p.status)){const r=this.painter.context.gl;u.storeAuthState(r,!1),this._logoControl instanceof Lu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,a=c.createFramebuffer();function f(d){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d,0);const y=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,y),y}return c.bindFramebuffer(c.FRAMEBUFFER,a),this._canvasPixelComparison(f(p),r.canvasCopies.map(f),r.timeStamps)}_canvasPixelComparison(p,r,c){let a=c[1]-c[0];const f=p.length/4;for(let d=0;d<r.length;d++){const y=r[d];let x=0;for(let E=0;E<y.length;E+=4)y[E]===p[E]&&y[E+1]===p[E+1]&&y[E+2]===p[E+2]&&y[E+3]===p[E+3]&&(x+=1);a+=(c[d+2]-c[d+1])*(1-x/f)}return a}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1),u.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=u.exported.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(p){const r=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(r,(c,a)=>c._preloadTiles(p,a),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){"hidden"===u.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,r){u.setCacheLimits(p,r)}get version(){return u.version}},NavigationControl:class{constructor(p){this.options=u.extend({},su,p),this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),xt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),xt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=xt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),c=r===p.getMaxZoom(),a=r===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ws(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const c=xt("button",p,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(p,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends u.Evented{constructor(p){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},il,p),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ai(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(c=>r("denied"!==c.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),c=p.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",p)),this._finish()}}_updateCamera(p){const r=new u.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,a=this._map.getBearing(),f=u.extend({bearing:a},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),f,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new u.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=u.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=xt("button","mapboxgl-ctrl-geolocate",this._container),xt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xt("div","mapboxgl-user-location"),this._dotElement.appendChild(xt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ou({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ku,ScaleControl:class{constructor(p){this.options=u.extend({},au,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=lc.bind(this)),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,a=r._containerWidth/2-p/2,f=r.unproject([a,c]),d=r.unproject([a+p,c]),y=f.distanceTo(d);if("imperial"===this.options.unit){const x=3.2808*y;x>5280?this._setScale(p,x/5280,"mile"):this._setScale(p,x,"foot")}else"nautical"===this.options.unit?this._setScale(p,y/1852,"nautical-mile"):y>=1e3?this._setScale(p,y/1e3,"kilometer"):this._setScale(p,y,"meter")}_setScale(p,r,c){const a=ol(r),f=a/r;this._map._requestDomTask(()=>{this._container.style.width=p*f+"px",this._container.innerHTML="nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:c}).format(a):`${a}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof u.window.HTMLElement?this._container=p.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=xt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xt("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(p){super(),this.options=u.extend(Object.create(sc),p),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=u.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(u.window.document.createTextNode(p))}setHTML(p){const r=u.window.document.createDocumentFragment(),c=u.window.document.createElement("body");let a;for(c.innerHTML=p;a=c.firstChild,a;)r.appendChild(a);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=xt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const c=this._closeButton=xt("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,a=this._pos;if(!r||!c||!a)return"bottom";const f=c.offsetWidth,d=c.offsetHeight,y=a.x<f/2,x=a.x>r.transform.width-f/2;if(a.y+p<d)return y?"top-left":x?"top-right":"top";if(a.y>r.transform.height-d){if(y)return"bottom-left";if(x)return"bottom-right"}return y?"left":x?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let a=this._container;if(a||(a=this._container=xt("div","mapboxgl-popup",r.getContainer()),this._tip=xt("div","mapboxgl-popup-tip",a),a.appendChild(c)),this.options.maxWidth&&a.style.maxWidth!==this.options.maxWidth&&(a.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fc(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const f=this._pos=this._trackPointer&&p?p:r.project(this._lngLat),d=Nl(this.options.offset),y=this._anchor=this._getAnchor(d.y),x=Nl(this.options.offset,y),E=f.add(x).round();r._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${oc[y]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&r._showingGlobe()){const f=u.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(sd);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Ou,Style:lo,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:I,Evented:u.Evented,config:u.config,prewarm:function(){an().acquire(en)},clearPrewarmedResources:function(){const p=dn;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(en),dn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(p){u.config.ACCESS_TOKEN=p},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(p){u.config.API_URL=p},get workerCount(){return hn.workerCount},set workerCount(p){hn.workerCount=p},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){u.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){u.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return cc}),W}()},9751:(Yn,ct,we)=>{"use strict";we.d(ct,{y:()=>wt});var W=we(930),ee=we(727),Ve=we(8822),u=we(9635),Ie=we(2416),Xt=we(576),St=we(2806);let wt=(()=>{class Ct{constructor(Kt){Kt&&(this._subscribe=Kt)}lift(Kt){const ln=new Ct;return ln.source=this,ln.operator=Kt,ln}subscribe(Kt,ln,jt){const Gn=function yt(Ct){return Ct&&Ct instanceof W.Lv||function nt(Ct){return Ct&&(0,Xt.m)(Ct.next)&&(0,Xt.m)(Ct.error)&&(0,Xt.m)(Ct.complete)}(Ct)&&(0,ee.Nn)(Ct)}(Kt)?Kt:new W.Hp(Kt,ln,jt);return(0,St.x)(()=>{const{operator:st,source:Pn}=this;Gn.add(st?st.call(Gn,Pn):Pn?this._subscribe(Gn):this._trySubscribe(Gn))}),Gn}_trySubscribe(Kt){try{return this._subscribe(Kt)}catch(ln){Kt.error(ln)}}forEach(Kt,ln){return new(ln=xt(ln))((jt,Gn)=>{const st=new W.Hp({next:Pn=>{try{Kt(Pn)}catch(Or){Gn(Or),st.unsubscribe()}},error:Gn,complete:jt});this.subscribe(st)})}_subscribe(Kt){var ln;return null===(ln=this.source)||void 0===ln?void 0:ln.subscribe(Kt)}[Ve.L](){return this}pipe(...Kt){return(0,u.U)(Kt)(this)}toPromise(Kt){return new(Kt=xt(Kt))((ln,jt)=>{let Gn;this.subscribe(st=>Gn=st,st=>jt(st),()=>ln(Gn))})}}return Ct.create=jn=>new Ct(jn),Ct})();function xt(Ct){var jn;return null!==(jn=Ct??Ie.v.Promise)&&void 0!==jn?jn:Promise}},7579:(Yn,ct,we)=>{"use strict";we.d(ct,{x:()=>St});var W=we(9751),ee=we(727);const u=(0,we(3888).d)(xt=>function(){xt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ie=we(8737),Xt=we(2806);let St=(()=>{class xt extends W.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(yt){const Ct=new wt(this,this);return Ct.operator=yt,Ct}_throwIfClosed(){if(this.closed)throw new u}next(yt){(0,Xt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Ct of this.currentObservers)Ct.next(yt)}})}error(yt){(0,Xt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=yt;const{observers:Ct}=this;for(;Ct.length;)Ct.shift().error(yt)}})}complete(){(0,Xt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:yt}=this;for(;yt.length;)yt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var yt;return(null===(yt=this.observers)||void 0===yt?void 0:yt.length)>0}_trySubscribe(yt){return this._throwIfClosed(),super._trySubscribe(yt)}_subscribe(yt){return this._throwIfClosed(),this._checkFinalizedStatuses(yt),this._innerSubscribe(yt)}_innerSubscribe(yt){const{hasError:Ct,isStopped:jn,observers:Kt}=this;return Ct||jn?ee.Lc:(this.currentObservers=null,Kt.push(yt),new ee.w0(()=>{this.currentObservers=null,(0,Ie.P)(Kt,yt)}))}_checkFinalizedStatuses(yt){const{hasError:Ct,thrownError:jn,isStopped:Kt}=this;Ct?yt.error(jn):Kt&&yt.complete()}asObservable(){const yt=new W.y;return yt.source=this,yt}}return xt.create=(nt,yt)=>new wt(nt,yt),xt})();class wt extends St{constructor(nt,yt){super(),this.destination=nt,this.source=yt}next(nt){var yt,Ct;null===(Ct=null===(yt=this.destination)||void 0===yt?void 0:yt.next)||void 0===Ct||Ct.call(yt,nt)}error(nt){var yt,Ct;null===(Ct=null===(yt=this.destination)||void 0===yt?void 0:yt.error)||void 0===Ct||Ct.call(yt,nt)}complete(){var nt,yt;null===(yt=null===(nt=this.destination)||void 0===nt?void 0:nt.complete)||void 0===yt||yt.call(nt)}_subscribe(nt){var yt,Ct;return null!==(Ct=null===(yt=this.source)||void 0===yt?void 0:yt.subscribe(nt))&&void 0!==Ct?Ct:ee.Lc}}},930:(Yn,ct,we)=>{"use strict";we.d(ct,{Hp:()=>jt,Lv:()=>Ct});var W=we(576),ee=we(727),Ve=we(2416),u=we(7849),Ie=we(5032);const Xt=xt("C",void 0,void 0);function xt(Ye,Ne,pt){return{kind:Ye,value:Ne,error:pt}}var nt=we(3410),yt=we(2806);class Ct extends ee.w0{constructor(Ne){super(),this.isStopped=!1,Ne?(this.destination=Ne,(0,ee.Nn)(Ne)&&Ne.add(this)):this.destination=Or}static create(Ne,pt,sn){return new jt(Ne,pt,sn)}next(Ne){this.isStopped?Pn(function wt(Ye){return xt("N",Ye,void 0)}(Ne),this):this._next(Ne)}error(Ne){this.isStopped?Pn(function St(Ye){return xt("E",void 0,Ye)}(Ne),this):(this.isStopped=!0,this._error(Ne))}complete(){this.isStopped?Pn(Xt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ne){this.destination.next(Ne)}_error(Ne){try{this.destination.error(Ne)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const jn=Function.prototype.bind;function Kt(Ye,Ne){return jn.call(Ye,Ne)}class ln{constructor(Ne){this.partialObserver=Ne}next(Ne){const{partialObserver:pt}=this;if(pt.next)try{pt.next(Ne)}catch(sn){Gn(sn)}}error(Ne){const{partialObserver:pt}=this;if(pt.error)try{pt.error(Ne)}catch(sn){Gn(sn)}else Gn(Ne)}complete(){const{partialObserver:Ne}=this;if(Ne.complete)try{Ne.complete()}catch(pt){Gn(pt)}}}class jt extends Ct{constructor(Ne,pt,sn){let _n;if(super(),(0,W.m)(Ne)||!Ne)_n={next:Ne??void 0,error:pt??void 0,complete:sn??void 0};else{let nn;this&&Ve.v.useDeprecatedNextContext?(nn=Object.create(Ne),nn.unsubscribe=()=>this.unsubscribe(),_n={next:Ne.next&&Kt(Ne.next,nn),error:Ne.error&&Kt(Ne.error,nn),complete:Ne.complete&&Kt(Ne.complete,nn)}):_n=Ne}this.destination=new ln(_n)}}function Gn(Ye){Ve.v.useDeprecatedSynchronousErrorHandling?(0,yt.O)(Ye):(0,u.h)(Ye)}function Pn(Ye,Ne){const{onStoppedNotification:pt}=Ve.v;pt&&nt.z.setTimeout(()=>pt(Ye,Ne))}const Or={closed:!0,next:Ie.Z,error:function st(Ye){throw Ye},complete:Ie.Z}},727:(Yn,ct,we)=>{"use strict";we.d(ct,{Lc:()=>Xt,w0:()=>Ie,Nn:()=>St});var W=we(576);const Ve=(0,we(3888).d)(xt=>function(yt){xt(this),this.message=yt?`${yt.length} errors occurred during unsubscription:\n${yt.map((Ct,jn)=>`${jn+1}) ${Ct.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=yt});var u=we(8737);class Ie{constructor(nt){this.initialTeardown=nt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let nt;if(!this.closed){this.closed=!0;const{_parentage:yt}=this;if(yt)if(this._parentage=null,Array.isArray(yt))for(const Kt of yt)Kt.remove(this);else yt.remove(this);const{initialTeardown:Ct}=this;if((0,W.m)(Ct))try{Ct()}catch(Kt){nt=Kt instanceof Ve?Kt.errors:[Kt]}const{_finalizers:jn}=this;if(jn){this._finalizers=null;for(const Kt of jn)try{wt(Kt)}catch(ln){nt=nt??[],ln instanceof Ve?nt=[...nt,...ln.errors]:nt.push(ln)}}if(nt)throw new Ve(nt)}}add(nt){var yt;if(nt&&nt!==this)if(this.closed)wt(nt);else{if(nt instanceof Ie){if(nt.closed||nt._hasParent(this))return;nt._addParent(this)}(this._finalizers=null!==(yt=this._finalizers)&&void 0!==yt?yt:[]).push(nt)}}_hasParent(nt){const{_parentage:yt}=this;return yt===nt||Array.isArray(yt)&&yt.includes(nt)}_addParent(nt){const{_parentage:yt}=this;this._parentage=Array.isArray(yt)?(yt.push(nt),yt):yt?[yt,nt]:nt}_removeParent(nt){const{_parentage:yt}=this;yt===nt?this._parentage=null:Array.isArray(yt)&&(0,u.P)(yt,nt)}remove(nt){const{_finalizers:yt}=this;yt&&(0,u.P)(yt,nt),nt instanceof Ie&&nt._removeParent(this)}}Ie.EMPTY=(()=>{const xt=new Ie;return xt.closed=!0,xt})();const Xt=Ie.EMPTY;function St(xt){return xt instanceof Ie||xt&&"closed"in xt&&(0,W.m)(xt.remove)&&(0,W.m)(xt.add)&&(0,W.m)(xt.unsubscribe)}function wt(xt){(0,W.m)(xt)?xt():xt.unsubscribe()}},2416:(Yn,ct,we)=>{"use strict";we.d(ct,{v:()=>W});const W={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},7272:(Yn,ct,we)=>{"use strict";we.d(ct,{z:()=>Ie});var W=we(8189),Ve=we(3269),u=we(2076);function Ie(...Xt){return function ee(){return(0,W.J)(1)}()((0,u.D)(Xt,(0,Ve.yG)(Xt)))}},515:(Yn,ct,we)=>{"use strict";we.d(ct,{E:()=>ee});const ee=new(we(9751).y)(Ie=>Ie.complete())},2076:(Yn,ct,we)=>{"use strict";we.d(ct,{D:()=>sn});var W=we(8421),ee=we(9672),Ve=we(4482),u=we(5403);function Ie(_n,nn=0){return(0,Ve.e)((Yt,Bt)=>{Yt.subscribe((0,u.x)(Bt,un=>(0,ee.f)(Bt,_n,()=>Bt.next(un),nn),()=>(0,ee.f)(Bt,_n,()=>Bt.complete(),nn),un=>(0,ee.f)(Bt,_n,()=>Bt.error(un),nn)))})}function Xt(_n,nn=0){return(0,Ve.e)((Yt,Bt)=>{Bt.add(_n.schedule(()=>Yt.subscribe(Bt),nn))})}var xt=we(9751),yt=we(2202),Ct=we(576);function Kt(_n,nn){if(!_n)throw new Error("Iterable cannot be null");return new xt.y(Yt=>{(0,ee.f)(Yt,nn,()=>{const Bt=_n[Symbol.asyncIterator]();(0,ee.f)(Yt,nn,()=>{Bt.next().then(un=>{un.done?Yt.complete():Yt.next(un.value)})},0,!0)})})}var ln=we(3670),jt=we(8239),Gn=we(1144),st=we(6495),Pn=we(2206),Or=we(4532),Ye=we(3260);function sn(_n,nn){return nn?function pt(_n,nn){if(null!=_n){if((0,ln.c)(_n))return function St(_n,nn){return(0,W.Xf)(_n).pipe(Xt(nn),Ie(nn))}(_n,nn);if((0,Gn.z)(_n))return function nt(_n,nn){return new xt.y(Yt=>{let Bt=0;return nn.schedule(function(){Bt===_n.length?Yt.complete():(Yt.next(_n[Bt++]),Yt.closed||this.schedule())})})}(_n,nn);if((0,jt.t)(_n))return function wt(_n,nn){return(0,W.Xf)(_n).pipe(Xt(nn),Ie(nn))}(_n,nn);if((0,Pn.D)(_n))return Kt(_n,nn);if((0,st.T)(_n))return function jn(_n,nn){return new xt.y(Yt=>{let Bt;return(0,ee.f)(Yt,nn,()=>{Bt=_n[yt.h](),(0,ee.f)(Yt,nn,()=>{let un,rr;try{({value:un,done:rr}=Bt.next())}catch(Vt){return void Yt.error(Vt)}rr?Yt.complete():Yt.next(un)},0,!0)}),()=>(0,Ct.m)(Bt?.return)&&Bt.return()})}(_n,nn);if((0,Ye.L)(_n))return function Ne(_n,nn){return Kt((0,Ye.Q)(_n),nn)}(_n,nn)}throw(0,Or.z)(_n)}(_n,nn):(0,W.Xf)(_n)}},8421:(Yn,ct,we)=>{"use strict";we.d(ct,{Xf:()=>jn});var W=we(655),ee=we(1144),Ve=we(8239),u=we(9751),Ie=we(3670),Xt=we(2206),St=we(4532),wt=we(6495),xt=we(3260),nt=we(576),yt=we(7849),Ct=we(8822);function jn(Ye){if(Ye instanceof u.y)return Ye;if(null!=Ye){if((0,Ie.c)(Ye))return function Kt(Ye){return new u.y(Ne=>{const pt=Ye[Ct.L]();if((0,nt.m)(pt.subscribe))return pt.subscribe(Ne);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Ye);if((0,ee.z)(Ye))return function ln(Ye){return new u.y(Ne=>{for(let pt=0;pt<Ye.length&&!Ne.closed;pt++)Ne.next(Ye[pt]);Ne.complete()})}(Ye);if((0,Ve.t)(Ye))return function jt(Ye){return new u.y(Ne=>{Ye.then(pt=>{Ne.closed||(Ne.next(pt),Ne.complete())},pt=>Ne.error(pt)).then(null,yt.h)})}(Ye);if((0,Xt.D)(Ye))return st(Ye);if((0,wt.T)(Ye))return function Gn(Ye){return new u.y(Ne=>{for(const pt of Ye)if(Ne.next(pt),Ne.closed)return;Ne.complete()})}(Ye);if((0,xt.L)(Ye))return function Pn(Ye){return st((0,xt.Q)(Ye))}(Ye)}throw(0,St.z)(Ye)}function st(Ye){return new u.y(Ne=>{(function Or(Ye,Ne){var pt,sn,_n,nn;return(0,W.mG)(this,void 0,void 0,function*(){try{for(pt=(0,W.KL)(Ye);!(sn=yield pt.next()).done;)if(Ne.next(sn.value),Ne.closed)return}catch(Yt){_n={error:Yt}}finally{try{sn&&!sn.done&&(nn=pt.return)&&(yield nn.call(pt))}finally{if(_n)throw _n.error}}Ne.complete()})})(Ye,Ne).catch(pt=>Ne.error(pt))})}},6451:(Yn,ct,we)=>{"use strict";we.d(ct,{T:()=>Xt});var W=we(8189),ee=we(8421),Ve=we(515),u=we(3269),Ie=we(2076);function Xt(...St){const wt=(0,u.yG)(St),xt=(0,u._6)(St,1/0),nt=St;return nt.length?1===nt.length?(0,ee.Xf)(nt[0]):(0,W.J)(xt)((0,Ie.D)(nt,wt)):Ve.E}},9646:(Yn,ct,we)=>{"use strict";we.d(ct,{of:()=>Ve});var W=we(3269),ee=we(2076);function Ve(...u){const Ie=(0,W.yG)(u);return(0,ee.D)(u,Ie)}},5403:(Yn,ct,we)=>{"use strict";we.d(ct,{x:()=>ee});var W=we(930);function ee(u,Ie,Xt,St,wt){return new Ve(u,Ie,Xt,St,wt)}class Ve extends W.Lv{constructor(Ie,Xt,St,wt,xt,nt){super(Ie),this.onFinalize=xt,this.shouldUnsubscribe=nt,this._next=Xt?function(yt){try{Xt(yt)}catch(Ct){Ie.error(Ct)}}:super._next,this._error=wt?function(yt){try{wt(yt)}catch(Ct){Ie.error(Ct)}finally{this.unsubscribe()}}:super._error,this._complete=St?function(){try{St()}catch(yt){Ie.error(yt)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Ie;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Xt}=this;super.unsubscribe(),!Xt&&(null===(Ie=this.onFinalize)||void 0===Ie||Ie.call(this))}}}},262:(Yn,ct,we)=>{"use strict";we.d(ct,{K:()=>u});var W=we(8421),ee=we(5403),Ve=we(4482);function u(Ie){return(0,Ve.e)((Xt,St)=>{let nt,wt=null,xt=!1;wt=Xt.subscribe((0,ee.x)(St,void 0,void 0,yt=>{nt=(0,W.Xf)(Ie(yt,u(Ie)(Xt))),wt?(wt.unsubscribe(),wt=null,nt.subscribe(St)):xt=!0})),xt&&(wt.unsubscribe(),wt=null,nt.subscribe(St))})}},4351:(Yn,ct,we)=>{"use strict";we.d(ct,{b:()=>Ve});var W=we(5577),ee=we(576);function Ve(u,Ie){return(0,ee.m)(Ie)?(0,W.z)(u,Ie,1):(0,W.z)(u,1)}},9300:(Yn,ct,we)=>{"use strict";we.d(ct,{h:()=>Ve});var W=we(4482),ee=we(5403);function Ve(u,Ie){return(0,W.e)((Xt,St)=>{let wt=0;Xt.subscribe((0,ee.x)(St,xt=>u.call(Ie,xt,wt++)&&St.next(xt)))})}},4004:(Yn,ct,we)=>{"use strict";we.d(ct,{U:()=>Ve});var W=we(4482),ee=we(5403);function Ve(u,Ie){return(0,W.e)((Xt,St)=>{let wt=0;Xt.subscribe((0,ee.x)(St,xt=>{St.next(u.call(Ie,xt,wt++))}))})}},8189:(Yn,ct,we)=>{"use strict";we.d(ct,{J:()=>Ve});var W=we(5577),ee=we(4671);function Ve(u=1/0){return(0,W.z)(ee.y,u)}},5577:(Yn,ct,we)=>{"use strict";we.d(ct,{z:()=>wt});var W=we(4004),ee=we(8421),Ve=we(4482),u=we(9672),Ie=we(5403),St=we(576);function wt(xt,nt,yt=1/0){return(0,St.m)(nt)?wt((Ct,jn)=>(0,W.U)((Kt,ln)=>nt(Ct,Kt,jn,ln))((0,ee.Xf)(xt(Ct,jn))),yt):("number"==typeof nt&&(yt=nt),(0,Ve.e)((Ct,jn)=>function Xt(xt,nt,yt,Ct,jn,Kt,ln,jt){const Gn=[];let st=0,Pn=0,Or=!1;const Ye=()=>{Or&&!Gn.length&&!st&&nt.complete()},Ne=sn=>st<Ct?pt(sn):Gn.push(sn),pt=sn=>{Kt&&nt.next(sn),st++;let _n=!1;(0,ee.Xf)(yt(sn,Pn++)).subscribe((0,Ie.x)(nt,nn=>{jn?.(nn),Kt?Ne(nn):nt.next(nn)},()=>{_n=!0},void 0,()=>{if(_n)try{for(st--;Gn.length&&st<Ct;){const nn=Gn.shift();ln?(0,u.f)(nt,ln,()=>pt(nn)):pt(nn)}Ye()}catch(nn){nt.error(nn)}}))};return xt.subscribe((0,Ie.x)(nt,Ne,()=>{Or=!0,Ye()})),()=>{jt?.()}}(Ct,jn,xt,yt)))}},8675:(Yn,ct,we)=>{"use strict";we.d(ct,{O:()=>u});var W=we(7272),ee=we(3269),Ve=we(4482);function u(...Ie){const Xt=(0,ee.yG)(Ie);return(0,Ve.e)((St,wt)=>{(Xt?(0,W.z)(Ie,St,Xt):(0,W.z)(Ie,St)).subscribe(wt)})}},3900:(Yn,ct,we)=>{"use strict";we.d(ct,{w:()=>u});var W=we(8421),ee=we(4482),Ve=we(5403);function u(Ie,Xt){return(0,ee.e)((St,wt)=>{let xt=null,nt=0,yt=!1;const Ct=()=>yt&&!xt&&wt.complete();St.subscribe((0,Ve.x)(wt,jn=>{xt?.unsubscribe();let Kt=0;const ln=nt++;(0,W.Xf)(Ie(jn,ln)).subscribe(xt=(0,Ve.x)(wt,jt=>wt.next(Xt?Xt(jn,jt,ln,Kt++):jt),()=>{xt=null,Ct()}))},()=>{yt=!0,Ct()}))})}},5698:(Yn,ct,we)=>{"use strict";we.d(ct,{q:()=>u});var W=we(515),ee=we(4482),Ve=we(5403);function u(Ie){return Ie<=0?()=>W.E:(0,ee.e)((Xt,St)=>{let wt=0;Xt.subscribe((0,Ve.x)(St,xt=>{++wt<=Ie&&(St.next(xt),Ie<=wt&&St.complete())}))})}},8505:(Yn,ct,we)=>{"use strict";we.d(ct,{b:()=>Ie});var W=we(576),ee=we(4482),Ve=we(5403),u=we(4671);function Ie(Xt,St,wt){const xt=(0,W.m)(Xt)||St||wt?{next:Xt,error:St,complete:wt}:Xt;return xt?(0,ee.e)((nt,yt)=>{var Ct;null===(Ct=xt.subscribe)||void 0===Ct||Ct.call(xt);let jn=!0;nt.subscribe((0,Ve.x)(yt,Kt=>{var ln;null===(ln=xt.next)||void 0===ln||ln.call(xt,Kt),yt.next(Kt)},()=>{var Kt;jn=!1,null===(Kt=xt.complete)||void 0===Kt||Kt.call(xt),yt.complete()},Kt=>{var ln;jn=!1,null===(ln=xt.error)||void 0===ln||ln.call(xt,Kt),yt.error(Kt)},()=>{var Kt,ln;jn&&(null===(Kt=xt.unsubscribe)||void 0===Kt||Kt.call(xt)),null===(ln=xt.finalize)||void 0===ln||ln.call(xt)}))}):u.y}},3410:(Yn,ct,we)=>{"use strict";we.d(ct,{z:()=>W});const W={setTimeout(ee,Ve,...u){const{delegate:Ie}=W;return Ie?.setTimeout?Ie.setTimeout(ee,Ve,...u):setTimeout(ee,Ve,...u)},clearTimeout(ee){const{delegate:Ve}=W;return(Ve?.clearTimeout||clearTimeout)(ee)},delegate:void 0}},2202:(Yn,ct,we)=>{"use strict";we.d(ct,{h:()=>ee});const ee=function W(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(Yn,ct,we)=>{"use strict";we.d(ct,{L:()=>W});const W="function"==typeof Symbol&&Symbol.observable||"@@observable"},3269:(Yn,ct,we)=>{"use strict";we.d(ct,{_6:()=>Xt,jO:()=>u,yG:()=>Ie});var W=we(576),ee=we(3532);function Ve(St){return St[St.length-1]}function u(St){return(0,W.m)(Ve(St))?St.pop():void 0}function Ie(St){return(0,ee.K)(Ve(St))?St.pop():void 0}function Xt(St,wt){return"number"==typeof Ve(St)?St.pop():wt}},4742:(Yn,ct,we)=>{"use strict";we.d(ct,{D:()=>Ie});const{isArray:W}=Array,{getPrototypeOf:ee,prototype:Ve,keys:u}=Object;function Ie(St){if(1===St.length){const wt=St[0];if(W(wt))return{args:wt,keys:null};if(function Xt(St){return St&&"object"==typeof St&&ee(St)===Ve}(wt)){const xt=u(wt);return{args:xt.map(nt=>wt[nt]),keys:xt}}}return{args:St,keys:null}}},8737:(Yn,ct,we)=>{"use strict";function W(ee,Ve){if(ee){const u=ee.indexOf(Ve);0<=u&&ee.splice(u,1)}}we.d(ct,{P:()=>W})},3888:(Yn,ct,we)=>{"use strict";function W(ee){const u=ee(Ie=>{Error.call(Ie),Ie.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}we.d(ct,{d:()=>W})},1810:(Yn,ct,we)=>{"use strict";function W(ee,Ve){return ee.reduce((u,Ie,Xt)=>(u[Ie]=Ve[Xt],u),{})}we.d(ct,{n:()=>W})},2806:(Yn,ct,we)=>{"use strict";we.d(ct,{O:()=>u,x:()=>Ve});var W=we(2416);let ee=null;function Ve(Ie){if(W.v.useDeprecatedSynchronousErrorHandling){const Xt=!ee;if(Xt&&(ee={errorThrown:!1,error:null}),Ie(),Xt){const{errorThrown:St,error:wt}=ee;if(ee=null,St)throw wt}}else Ie()}function u(Ie){W.v.useDeprecatedSynchronousErrorHandling&&ee&&(ee.errorThrown=!0,ee.error=Ie)}},9672:(Yn,ct,we)=>{"use strict";function W(ee,Ve,u,Ie=0,Xt=!1){const St=Ve.schedule(function(){u(),Xt?ee.add(this.schedule(null,Ie)):this.unsubscribe()},Ie);if(ee.add(St),!Xt)return St}we.d(ct,{f:()=>W})},4671:(Yn,ct,we)=>{"use strict";function W(ee){return ee}we.d(ct,{y:()=>W})},1144:(Yn,ct,we)=>{"use strict";we.d(ct,{z:()=>W});const W=ee=>ee&&"number"==typeof ee.length&&"function"!=typeof ee},2206:(Yn,ct,we)=>{"use strict";we.d(ct,{D:()=>ee});var W=we(576);function ee(Ve){return Symbol.asyncIterator&&(0,W.m)(Ve?.[Symbol.asyncIterator])}},576:(Yn,ct,we)=>{"use strict";function W(ee){return"function"==typeof ee}we.d(ct,{m:()=>W})},3670:(Yn,ct,we)=>{"use strict";we.d(ct,{c:()=>Ve});var W=we(8822),ee=we(576);function Ve(u){return(0,ee.m)(u[W.L])}},6495:(Yn,ct,we)=>{"use strict";we.d(ct,{T:()=>Ve});var W=we(2202),ee=we(576);function Ve(u){return(0,ee.m)(u?.[W.h])}},8239:(Yn,ct,we)=>{"use strict";we.d(ct,{t:()=>ee});var W=we(576);function ee(Ve){return(0,W.m)(Ve?.then)}},3260:(Yn,ct,we)=>{"use strict";we.d(ct,{L:()=>u,Q:()=>Ve});var W=we(655),ee=we(576);function Ve(Ie){return(0,W.FC)(this,arguments,function*(){const St=Ie.getReader();try{for(;;){const{value:wt,done:xt}=yield(0,W.qq)(St.read());if(xt)return yield(0,W.qq)(void 0);yield yield(0,W.qq)(wt)}}finally{St.releaseLock()}})}function u(Ie){return(0,ee.m)(Ie?.getReader)}},3532:(Yn,ct,we)=>{"use strict";we.d(ct,{K:()=>ee});var W=we(576);function ee(Ve){return Ve&&(0,W.m)(Ve.schedule)}},4482:(Yn,ct,we)=>{"use strict";we.d(ct,{A:()=>ee,e:()=>Ve});var W=we(576);function ee(u){return(0,W.m)(u?.lift)}function Ve(u){return Ie=>{if(ee(Ie))return Ie.lift(function(Xt){try{return u(Xt,this)}catch(St){this.error(St)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(Yn,ct,we)=>{"use strict";we.d(ct,{Z:()=>u});var W=we(4004);const{isArray:ee}=Array;function u(Ie){return(0,W.U)(Xt=>function Ve(Ie,Xt){return ee(Xt)?Ie(...Xt):Ie(Xt)}(Ie,Xt))}},5032:(Yn,ct,we)=>{"use strict";function W(){}we.d(ct,{Z:()=>W})},9635:(Yn,ct,we)=>{"use strict";we.d(ct,{U:()=>Ve,z:()=>ee});var W=we(4671);function ee(...u){return Ve(u)}function Ve(u){return 0===u.length?W.y:1===u.length?u[0]:function(Xt){return u.reduce((St,wt)=>wt(St),Xt)}}},7849:(Yn,ct,we)=>{"use strict";we.d(ct,{h:()=>Ve});var W=we(2416),ee=we(3410);function Ve(u){ee.z.setTimeout(()=>{const{onUnhandledError:Ie}=W.v;if(!Ie)throw u;Ie(u)})}},4532:(Yn,ct,we)=>{"use strict";function W(ee){return new TypeError(`You provided ${null!==ee&&"object"==typeof ee?"an invalid object":`'${ee}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}we.d(ct,{z:()=>W})},5226:function(Yn){Yn.exports=function(){"use strict";var ct={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const W=I=>{const k={};for(const G in I)k[I[G]]="swal2-"+I[G];return k},ee=W(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),Ve=W(["success","warning","info","question","error"]),u="SweetAlert2:",Xt=I=>I.charAt(0).toUpperCase()+I.slice(1),St=I=>{console.warn(`${u} ${"object"==typeof I?I.join(" "):I}`)},wt=I=>{console.error(`${u} ${I}`)},xt=[],yt=(I,k)=>{(I=>{xt.includes(I)||(xt.push(I),St(I))})(`"${I}" is deprecated and will be removed in the next major release. Please use "${k}" instead.`)},Ct=I=>"function"==typeof I?I():I,jn=I=>I&&"function"==typeof I.toPromise,Kt=I=>jn(I)?I.toPromise():Promise.resolve(I),ln=I=>I&&Promise.resolve(I)===I,jt=()=>document.body.querySelector(`.${ee.container}`),Gn=I=>{const k=jt();return k?k.querySelector(I):null},st=I=>Gn(`.${I}`),Pn=()=>st(ee.popup),Or=()=>st(ee.icon),Ne=()=>st(ee.title),pt=()=>st(ee["html-container"]),sn=()=>st(ee.image),_n=()=>st(ee["progress-steps"]),nn=()=>st(ee["validation-message"]),Yt=()=>Gn(`.${ee.actions} .${ee.confirm}`),Bt=()=>Gn(`.${ee.actions} .${ee.cancel}`),un=()=>Gn(`.${ee.actions} .${ee.deny}`),Vt=()=>Gn(`.${ee.loader}`),at=()=>st(ee.actions),rt=()=>st(ee.footer),Mt=()=>st(ee["timer-progress-bar"]),At=()=>st(ee.close),qt=()=>{const I=Array.from(Pn().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((G,_e)=>{const $e=parseInt(G.getAttribute("tabindex")),Gt=parseInt(_e.getAttribute("tabindex"));return $e>Gt?1:$e<Gt?-1:0}),k=Array.from(Pn().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter(G=>"-1"!==G.getAttribute("tabindex"));return(I=>{const k=[];for(let G=0;G<I.length;G++)-1===k.indexOf(I[G])&&k.push(I[G]);return k})(I.concat(k)).filter(G=>Fr(G))},Rn=()=>Qt(document.body,ee.shown)&&!Qt(document.body,ee["toast-shown"])&&!Qt(document.body,ee["no-backdrop"]),fr=()=>Pn()&&Qt(Pn(),ee.toast),bn={previousBodyPadding:null},yn=(I,k)=>{if(I.textContent="",k){const _e=(new DOMParser).parseFromString(k,"text/html");Array.from(_e.querySelector("head").childNodes).forEach($e=>{I.appendChild($e)}),Array.from(_e.querySelector("body").childNodes).forEach($e=>{$e instanceof HTMLVideoElement||$e instanceof HTMLAudioElement?I.appendChild($e.cloneNode(!0)):I.appendChild($e)})}},Qt=(I,k)=>{if(!k)return!1;const G=k.split(/\s+/);for(let _e=0;_e<G.length;_e++)if(!I.classList.contains(G[_e]))return!1;return!0},ir=(I,k,G)=>{if(((I,k)=>{Array.from(I.classList).forEach(G=>{!Object.values(ee).includes(G)&&!Object.values(Ve).includes(G)&&!Object.values(k.showClass).includes(G)&&I.classList.remove(G)})})(I,k),k.customClass&&k.customClass[G]){if("string"!=typeof k.customClass[G]&&!k.customClass[G].forEach)return void St(`Invalid type of customClass.${G}! Expected string or iterable object, got "${typeof k.customClass[G]}"`);Dn(I,k.customClass[G])}},Xr=(I,k)=>{if(!k)return null;switch(k){case"select":case"textarea":case"file":return I.querySelector(`.${ee.popup} > .${ee[k]}`);case"checkbox":return I.querySelector(`.${ee.popup} > .${ee.checkbox} input`);case"radio":return I.querySelector(`.${ee.popup} > .${ee.radio} input:checked`)||I.querySelector(`.${ee.popup} > .${ee.radio} input:first-child`);case"range":return I.querySelector(`.${ee.popup} > .${ee.range} input`);default:return I.querySelector(`.${ee.popup} > .${ee.input}`)}},Tn=I=>{if(I.focus(),"file"!==I.type){const k=I.value;I.value="",I.value=k}},ni=(I,k,G)=>{!I||!k||("string"==typeof k&&(k=k.split(/\s+/).filter(Boolean)),k.forEach(_e=>{Array.isArray(I)?I.forEach($e=>{G?$e.classList.add(_e):$e.classList.remove(_e)}):G?I.classList.add(_e):I.classList.remove(_e)}))},Dn=(I,k)=>{ni(I,k,!0)},ei=(I,k)=>{ni(I,k,!1)},ri=(I,k)=>{const G=Array.from(I.children);for(let _e=0;_e<G.length;_e++){const $e=G[_e];if($e instanceof HTMLElement&&Qt($e,k))return $e}},qi=(I,k,G)=>{G===`${parseInt(G)}`&&(G=parseInt(G)),G||0===parseInt(G)?I.style[k]="number"==typeof G?`${G}px`:G:I.style.removeProperty(k)},vn=function(I){I.style.display=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex"},sr=I=>{I.style.display="none"},vi=(I,k,G,_e)=>{const $e=I.querySelector(k);$e&&($e.style[G]=_e)},Kr=function(I,k){k?vn(I,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flex"):sr(I)},Fr=I=>!(!I||!(I.offsetWidth||I.offsetHeight||I.getClientRects().length)),Ii=I=>I.scrollHeight>I.clientHeight,In=I=>{const k=window.getComputedStyle(I),G=parseFloat(k.getPropertyValue("animation-duration")||"0"),_e=parseFloat(k.getPropertyValue("transition-duration")||"0");return G>0||_e>0},to=function(I){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const G=Mt();Fr(G)&&(k&&(G.style.transition="none",G.style.width="100%"),setTimeout(()=>{G.style.transition=`width ${I/1e3}s linear`,G.style.width="0%"},10))},gt={},yr=I=>new Promise(k=>{if(!I)return k();const G=window.scrollX,_e=window.scrollY;gt.restoreFocusTimeout=setTimeout(()=>{gt.previousActiveElement instanceof HTMLElement?(gt.previousActiveElement.focus(),gt.previousActiveElement=null):document.body&&document.body.focus(),k()},100),window.scrollTo(G,_e)}),Ai=()=>typeof window>"u"||typeof document>"u",no=`\n <div aria-labelledby="${ee.title}" aria-describedby="${ee["html-container"]}" class="${ee.popup}" tabindex="-1">\n   <button type="button" class="${ee.close}"></button>\n   <ul class="${ee["progress-steps"]}"></ul>\n   <div class="${ee.icon}"></div>\n   <img class="${ee.image}" />\n   <h2 class="${ee.title}" id="${ee.title}"></h2>\n   <div class="${ee["html-container"]}" id="${ee["html-container"]}"></div>\n   <input class="${ee.input}" />\n   <input type="file" class="${ee.file}" />\n   <div class="${ee.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${ee.select}"></select>\n   <div class="${ee.radio}"></div>\n   <label for="${ee.checkbox}" class="${ee.checkbox}">\n     <input type="checkbox" />\n     <span class="${ee.label}"></span>\n   </label>\n   <textarea class="${ee.textarea}"></textarea>\n   <div class="${ee["validation-message"]}" id="${ee["validation-message"]}"></div>\n   <div class="${ee.actions}">\n     <div class="${ee.loader}"></div>\n     <button type="button" class="${ee.confirm}"></button>\n     <button type="button" class="${ee.deny}"></button>\n     <button type="button" class="${ee.cancel}"></button>\n   </div>\n   <div class="${ee.footer}"></div>\n   <div class="${ee["timer-progress-bar-container"]}">\n     <div class="${ee["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),Pi=()=>{gt.currentInstance.resetValidationMessage()},Vi=I=>{const k=(()=>{const I=jt();return!!I&&(I.remove(),ei([document.documentElement,document.body],[ee["no-backdrop"],ee["toast-shown"],ee["has-column"]]),!0)})();if(Ai())return void wt("SweetAlert2 requires document to initialize");const G=document.createElement("div");G.className=ee.container,k&&Dn(G,ee["no-transition"]),yn(G,no);const _e=(I=>"string"==typeof I?document.querySelector(I):I)(I.target);_e.appendChild(G),(I=>{const k=Pn();k.setAttribute("role",I.toast?"alert":"dialog"),k.setAttribute("aria-live",I.toast?"polite":"assertive"),I.toast||k.setAttribute("aria-modal","true")})(I),(I=>{"rtl"===window.getComputedStyle(I).direction&&Dn(jt(),ee.rtl)})(_e),(()=>{const I=Pn(),k=ri(I,ee.input),G=ri(I,ee.file),_e=I.querySelector(`.${ee.range} input`),$e=I.querySelector(`.${ee.range} output`),Gt=ri(I,ee.select),An=I.querySelector(`.${ee.checkbox} input`),nr=ri(I,ee.textarea);k.oninput=Pi,G.onchange=Pi,Gt.onchange=Pi,An.onchange=Pi,nr.oninput=Pi,_e.oninput=()=>{Pi(),$e.value=_e.value},_e.onchange=()=>{Pi(),$e.value=_e.value}})()},ii=(I,k)=>{I instanceof HTMLElement?k.appendChild(I):"object"==typeof I?Hn(I,k):I&&yn(k,I)},Hn=(I,k)=>{I.jquery?_t(k,I):yn(k,I.toString())},_t=(I,k)=>{if(I.textContent="",0 in k)for(let G=0;G in k;G++)I.appendChild(k[G].cloneNode(!0));else I.appendChild(k.cloneNode(!0))},Fe=(()=>{if(Ai())return!1;const I=document.createElement("div"),k={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const G in k)if(Object.prototype.hasOwnProperty.call(k,G)&&typeof I.style[G]<"u")return k[G];return!1})(),$t=(I,k)=>{const G=at(),_e=Vt();k.showConfirmButton||k.showDenyButton||k.showCancelButton?vn(G):sr(G),ir(G,k,"actions"),function Rt(I,k,G){const _e=Yt(),$e=un(),Gt=Bt();he(_e,"confirm",G),he($e,"deny",G),he(Gt,"cancel",G),function On(I,k,G,_e){_e.buttonsStyling?(Dn([I,k,G],ee.styled),_e.confirmButtonColor&&(I.style.backgroundColor=_e.confirmButtonColor,Dn(I,ee["default-outline"])),_e.denyButtonColor&&(k.style.backgroundColor=_e.denyButtonColor,Dn(k,ee["default-outline"])),_e.cancelButtonColor&&(G.style.backgroundColor=_e.cancelButtonColor,Dn(G,ee["default-outline"]))):ei([I,k,G],ee.styled)}(_e,$e,Gt,G),G.reverseButtons&&(G.toast?(I.insertBefore(Gt,_e),I.insertBefore($e,_e)):(I.insertBefore(Gt,k),I.insertBefore($e,k),I.insertBefore(_e,k)))}(G,_e,k),yn(_e,k.loaderHtml),ir(_e,k,"loader")};function he(I,k,G){Kr(I,G[`show${Xt(k)}Button`],"inline-block"),yn(I,G[`${k}ButtonText`]),I.setAttribute("aria-label",G[`${k}ButtonAriaLabel`]),I.className=ee[k],ir(I,G,`${k}Button`),Dn(I,G[`${k}ButtonClass`])}const K=(I,k)=>{const G=jt();G&&(function fe(I,k){"string"==typeof k?I.style.background=k:k||Dn([document.documentElement,document.body],ee["no-backdrop"])}(G,k.backdrop),function Ee(I,k){k in ee?Dn(I,ee[k]):(St('The "position" parameter is not valid, defaulting to "center"'),Dn(I,ee.center))}(G,k.position),function se(I,k){if(k&&"string"==typeof k){const G=`grow-${k}`;G in ee&&Dn(I,ee[G])}}(G,k.grow),ir(G,k,"container"))};const ie=["input","file","range","select","radio","checkbox","textarea"],re=I=>{if(!an[I.input])return void wt(`Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "${I.input}"`);const k=hn(I.input),G=an[I.input](k,I);vn(k),I.inputAutoFocus&&setTimeout(()=>{Tn(G)})},Ue=(I,k)=>{const G=Xr(Pn(),I);if(G){(I=>{for(let k=0;k<I.attributes.length;k++){const G=I.attributes[k].name;["type","value","style"].includes(G)||I.removeAttribute(G)}})(G);for(const _e in k)G.setAttribute(_e,k[_e])}},ft=I=>{const k=hn(I.input);"object"==typeof I.customClass&&Dn(k,I.customClass.input)},dt=(I,k)=>{(!I.placeholder||k.inputPlaceholder)&&(I.placeholder=k.inputPlaceholder)},en=(I,k,G)=>{if(G.inputLabel){I.id=ee.input;const _e=document.createElement("label"),$e=ee["input-label"];_e.setAttribute("for",I.id),_e.className=$e,"object"==typeof G.customClass&&Dn(_e,G.customClass.inputLabel),_e.innerText=G.inputLabel,k.insertAdjacentElement("beforebegin",_e)}},hn=I=>ri(Pn(),ee[I]||ee.input),dn=(I,k)=>{["string","number"].includes(typeof k)?I.value=`${k}`:ln(k)||St(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof k}"`)},an={};an.text=an.email=an.password=an.number=an.tel=an.url=(I,k)=>(dn(I,k.inputValue),en(I,I,k),dt(I,k),I.type=k.input,I),an.file=(I,k)=>(en(I,I,k),dt(I,k),I),an.range=(I,k)=>{const G=I.querySelector("input"),_e=I.querySelector("output");return dn(G,k.inputValue),G.type=k.input,dn(_e,k.inputValue),en(G,I,k),I},an.select=(I,k)=>{if(I.textContent="",k.inputPlaceholder){const G=document.createElement("option");yn(G,k.inputPlaceholder),G.value="",G.disabled=!0,G.selected=!0,I.appendChild(G)}return en(I,I,k),I},an.radio=I=>(I.textContent="",I),an.checkbox=(I,k)=>{const G=Xr(Pn(),"checkbox");G.value="1",G.id=ee.checkbox,G.checked=Boolean(k.inputValue);const _e=I.querySelector("span");return yn(_e,k.inputPlaceholder),G},an.textarea=(I,k)=>{dn(I,k.inputValue),dt(I,k),en(I,I,k);return setTimeout(()=>{if("MutationObserver"in window){const _e=parseInt(window.getComputedStyle(Pn()).width);new MutationObserver(()=>{const Gt=I.offsetWidth+(_e=>parseInt(window.getComputedStyle(_e).marginLeft)+parseInt(window.getComputedStyle(_e).marginRight))(I);Pn().style.width=Gt>_e?`${Gt}px`:null}).observe(I,{attributes:!0,attributeFilter:["style"]})}}),I};const or=(I,k)=>{const G=pt();ir(G,k,"htmlContainer"),k.html?(ii(k.html,G),vn(G,"block")):k.text?(G.textContent=k.text,vn(G,"block")):sr(G),((I,k)=>{const G=Pn(),_e=ct.innerParams.get(I),$e=!_e||k.input!==_e.input;ie.forEach(Gt=>{const An=ri(G,ee[Gt]);Ue(Gt,k.inputAttributes),An.className=ee[Gt],$e&&sr(An)}),k.input&&($e&&re(k),ft(k))})(I,k)},Cr=(I,k)=>{for(const G in Ve)k.icon!==G&&ei(I,Ve[G]);Dn(I,Ve[k.icon]),io(I,k),kr(),ir(I,k,"icon")},kr=()=>{const I=Pn(),k=window.getComputedStyle(I).getPropertyValue("background-color"),G=I.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let _e=0;_e<G.length;_e++)G[_e].style.backgroundColor=k},ht=(I,k)=>{let _e,G=I.innerHTML;k.iconHtml?_e=Wn(k.iconHtml):"success"===k.icon?(_e='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',G=G.replace(/ style=".*?"/g,"")):_e="error"===k.icon?'\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':Wn({question:"?",warning:"!",info:"i"}[k.icon]),G.trim()!==_e.trim()&&yn(I,_e)},io=(I,k)=>{if(k.iconColor){I.style.color=k.iconColor,I.style.borderColor=k.iconColor;for(const G of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])vi(I,G,"backgroundColor",k.iconColor);vi(I,".swal2-success-ring","borderColor",k.iconColor)}},Wn=I=>`<div class="${ee["icon-content"]}">${I}</div>`,oi=(I,k)=>{I.className=`${ee.popup} ${Fr(I)?k.showClass.popup:""}`,k.toast?(Dn([document.documentElement,document.body],ee["toast-shown"]),Dn(I,ee.toast)):Dn(I,ee.modal),ir(I,k,"popup"),"string"==typeof k.customClass&&Dn(I,k.customClass),k.icon&&Dn(I,ee[`icon-${k.icon}`])},Ks=I=>{const k=document.createElement("li");return Dn(k,ee["progress-step"]),yn(k,I),k},as=I=>{const k=document.createElement("li");return Dn(k,ee["progress-step-line"]),I.progressStepsDistance&&qi(k,"width",I.progressStepsDistance),k},Fn=(I,k)=>{((I,k)=>{const G=jt(),_e=Pn();k.toast?(qi(G,"width",k.width),_e.style.width="100%",_e.insertBefore(Vt(),Or())):qi(_e,"width",k.width),qi(_e,"padding",k.padding),k.color&&(_e.style.color=k.color),k.background&&(_e.style.background=k.background),sr(nn()),oi(_e,k)})(0,k),K(0,k),((I,k)=>{const G=_n();k.progressSteps&&0!==k.progressSteps.length?(vn(G),G.textContent="",k.currentProgressStep>=k.progressSteps.length&&St("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),k.progressSteps.forEach((_e,$e)=>{const Gt=Ks(_e);if(G.appendChild(Gt),$e===k.currentProgressStep&&Dn(Gt,ee["active-progress-step"]),$e!==k.progressSteps.length-1){const An=as(k);G.appendChild(An)}})):sr(G)})(0,k),((I,k)=>{const G=ct.innerParams.get(I),_e=Or();G&&k.icon===G.icon?(ht(_e,k),Cr(_e,k)):k.icon||k.iconHtml?k.icon&&-1===Object.keys(Ve).indexOf(k.icon)?(wt(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${k.icon}"`),sr(_e)):(vn(_e),ht(_e,k),Cr(_e,k),Dn(_e,k.showClass.icon)):sr(_e)})(I,k),((I,k)=>{const G=sn();k.imageUrl?(vn(G,""),G.setAttribute("src",k.imageUrl),G.setAttribute("alt",k.imageAlt),qi(G,"width",k.imageWidth),qi(G,"height",k.imageHeight),G.className=ee.image,ir(G,k,"image")):sr(G)})(0,k),((I,k)=>{const G=Ne();Kr(G,k.title||k.titleText,"block"),k.title&&ii(k.title,G),k.titleText&&(G.innerText=k.titleText),ir(G,k,"title")})(0,k),((I,k)=>{const G=At();yn(G,k.closeButtonHtml),ir(G,k,"closeButton"),Kr(G,k.showCloseButton),G.setAttribute("aria-label",k.closeButtonAriaLabel)})(0,k),or(I,k),$t(0,k),((I,k)=>{const G=rt();Kr(G,k.footer),k.footer&&ii(k.footer,G),ir(G,k,"footer")})(0,k),"function"==typeof k.didRender&&k.didRender(Pn())};function Lt(){const I=ct.innerParams.get(this);if(!I)return;const k=ct.domCache.get(this);sr(k.loader),fr()?I.icon&&vn(Or()):Zn(k),ei([k.popup,k.actions],ee.loading),k.popup.removeAttribute("aria-busy"),k.popup.removeAttribute("data-loading"),k.confirmButton.disabled=!1,k.denyButton.disabled=!1,k.cancelButton.disabled=!1}const Zn=I=>{const k=I.popup.getElementsByClassName(I.loader.getAttribute("data-button-to-replace"));k.length?vn(k[0],"inline-block"):!Fr(Yt())&&!Fr(un())&&!Fr(Bt())&&sr(I.actions)};const oo=()=>Yt()&&Yt().click(),Jn=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),br=I=>{I.keydownTarget&&I.keydownHandlerAdded&&(I.keydownTarget.removeEventListener("keydown",I.keydownHandler,{capture:I.keydownListenerCapture}),I.keydownHandlerAdded=!1)},Ln=(I,k)=>{const G=qt();if(G.length)return(I+=k)===G.length?I=0:-1===I&&(I=G.length-1),void G[I].focus();Pn().focus()},ls=["ArrowRight","ArrowDown"],wi=["ArrowLeft","ArrowUp"],Ys=(I,k,G)=>{const _e=ct.innerParams.get(I);_e&&(k.isComposing||229===k.keyCode||(_e.stopKeydownPropagation&&k.stopPropagation(),"Enter"===k.key?Ki(I,k,_e):"Tab"===k.key?si(k):[...ls,...wi].includes(k.key)?so(k.key):"Escape"===k.key&&ui(k,_e,G)))},Ki=(I,k,G)=>{if(Ct(G.allowEnterKey)&&k.target&&I.getInput()&&k.target instanceof HTMLElement&&k.target.outerHTML===I.getInput().outerHTML){if(["textarea","file"].includes(G.input))return;oo(),k.preventDefault()}},si=I=>{const k=I.target,G=qt();let _e=-1;for(let $e=0;$e<G.length;$e++)if(k===G[$e]){_e=$e;break}Ln(_e,I.shiftKey?-1:1),I.stopPropagation(),I.preventDefault()},so=I=>{const k=Yt(),G=un(),_e=Bt();if(document.activeElement instanceof HTMLElement&&![k,G,_e].includes(document.activeElement))return;const Gt=ls.includes(I)?"nextElementSibling":"previousElementSibling";let An=document.activeElement;for(let nr=0;nr<at().children.length;nr++){if(An=An[Gt],!An)return;if(An instanceof HTMLButtonElement&&Fr(An))break}An instanceof HTMLButtonElement&&An.focus()},ui=(I,k,G)=>{Ct(k.allowEscapeKey)&&(I.preventDefault(),G(Jn.esc))};var Bi={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Hr=()=>{Array.from(document.body.children).forEach(k=>{k.hasAttribute("data-previous-aria-hidden")?(k.setAttribute("aria-hidden",k.getAttribute("data-previous-aria-hidden")),k.removeAttribute("data-previous-aria-hidden")):k.removeAttribute("aria-hidden")})},ia=()=>{const I=navigator.userAgent,k=!!I.match(/iPad/i)||!!I.match(/iPhone/i),G=!!I.match(/WebKit/i);k&&G&&!I.match(/CriOS/i)&&Pn().scrollHeight>window.innerHeight-44&&(jt().style.paddingBottom="44px")},Yi=()=>{const I=jt();let k;I.ontouchstart=G=>{k=ao(G)},I.ontouchmove=G=>{k&&(G.preventDefault(),G.stopPropagation())}},ao=I=>{const k=I.target,G=jt();return!Ns(I)&&!Js(I)&&(k===G||!Ii(G)&&k instanceof HTMLElement&&"INPUT"!==k.tagName&&"TEXTAREA"!==k.tagName&&!(Ii(pt())&&pt().contains(k)))},Ns=I=>I.touches&&I.touches.length&&"stylus"===I.touches[0].touchType,Js=I=>I.touches&&I.touches.length>1,ti=()=>{if(Qt(document.body,ee.iosfix)){const I=parseInt(document.body.style.top,10);ei(document.body,ee.iosfix),document.body.style.top="",document.body.scrollTop=-1*I}},Ni=()=>{null===bn.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(bn.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${bn.previousBodyPadding+(()=>{const I=document.createElement("div");I.className=ee["scrollbar-measure"],document.body.appendChild(I);const k=I.getBoundingClientRect().width-I.clientWidth;return document.body.removeChild(I),k})()}px`)},xa=()=>{null!==bn.previousBodyPadding&&(document.body.style.paddingRight=`${bn.previousBodyPadding}px`,bn.previousBodyPadding=null)};function ki(I,k,G,_e){fr()?za(I,_e):(yr(G).then(()=>za(I,_e)),br(gt)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(k.setAttribute("style","display:none !important"),k.removeAttribute("class"),k.innerHTML=""):k.remove(),Rn()&&(xa(),ti(),Hr()),function Vr(){ei([document.documentElement,document.body],[ee.shown,ee["height-auto"],ee["no-backdrop"],ee["toast-shown"]])}()}function Ts(I){I=Fa(I);const k=Bi.swalPromiseResolve.get(this),G=So(this);this.isAwaitingPromise()?I.isDismissed||(Yo(this),k(I)):G&&k(I)}const So=I=>{const k=Pn();if(!k)return!1;const G=ct.innerParams.get(I);if(!G||Qt(k,G.hideClass.popup))return!1;ei(k,G.showClass.popup),Dn(k,G.hideClass.popup);const _e=jt();return ei(_e,G.showClass.backdrop),Dn(_e,G.hideClass.backdrop),No(I,k,G),!0};const Yo=I=>{I.isAwaitingPromise()&&(ct.awaitingPromise.delete(I),ct.innerParams.get(I)||I._destroy())},Fa=I=>typeof I>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},I),No=(I,k,G)=>{const _e=jt(),$e=Fe&&In(k);"function"==typeof G.willClose&&G.willClose(k),$e?Mo(I,k,_e,G.returnFocus,G.didClose):ki(I,_e,G.returnFocus,G.didClose)},Mo=(I,k,G,_e,$e)=>{gt.swalCloseEventFinishedCallback=ki.bind(null,I,G,_e,$e),k.addEventListener(Fe,function(Gt){Gt.target===k&&(gt.swalCloseEventFinishedCallback(),delete gt.swalCloseEventFinishedCallback)})},za=(I,k)=>{setTimeout(()=>{"function"==typeof k&&k.bind(I.params)(),I._destroy()})};function Ds(I,k,G){const _e=ct.domCache.get(I);k.forEach($e=>{_e[$e].disabled=G})}function cs(I,k){if(I)if("radio"===I.type){const _e=I.parentNode.parentNode.querySelectorAll("input");for(let $e=0;$e<_e.length;$e++)_e[$e].disabled=k}else I.disabled=k}const Cs={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},aa=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],vo={},la=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Io=I=>Object.prototype.hasOwnProperty.call(Cs,I),js=I=>-1!==aa.indexOf(I),Na=I=>vo[I],ca=I=>{Io(I)||St(`Unknown parameter "${I}"`)},po=I=>{la.includes(I)&&St(`The parameter "${I}" is incompatible with toasts`)},wa=I=>{Na(I)&&yt(I,Na(I))};const ba=I=>{const k={};return Object.keys(I).forEach(G=>{js(G)?k[G]=I[G]:St(`Invalid parameter to update: ${G}`)}),k};const hs=I=>{Qo(I),delete I.params,delete gt.keydownHandler,delete gt.keydownTarget,delete gt.currentInstance},Qo=I=>{I.isAwaitingPromise()?(Zi(ct,I),ct.awaitingPromise.set(I,!0)):(Zi(Bi,I),Zi(ct,I))},Zi=(I,k)=>{for(const G in I)I[G].delete(k)};var Ao=Object.freeze({__proto__:null,_destroy:function Jo(){const I=ct.domCache.get(this),k=ct.innerParams.get(this);k?(I.popup&&gt.swalCloseEventFinishedCallback&&(gt.swalCloseEventFinishedCallback(),delete gt.swalCloseEventFinishedCallback),"function"==typeof k.didDestroy&&k.didDestroy(),hs(this)):Qo(this)},close:Ts,closeModal:Ts,closePopup:Ts,closeToast:Ts,disableButtons:function oa(){Ds(this,["confirmButton","denyButton","cancelButton"],!0)},disableInput:function lo(){cs(this.getInput(),!0)},disableLoading:Lt,enableButtons:function Uo(){Ds(this,["confirmButton","denyButton","cancelButton"],!1)},enableInput:function Us(){cs(this.getInput(),!1)},getInput:function Nr(I){const k=ct.innerParams.get(I||this),G=ct.domCache.get(I||this);return G?Xr(G.popup,k.input):null},handleAwaitingPromise:Yo,hideLoading:Lt,isAwaitingPromise:function Ko(){return!!ct.awaitingPromise.get(this)},rejectPromise:function Ji(I){const k=Bi.swalPromiseReject.get(this);Yo(this),k&&k(I)},resetValidationMessage:function Ba(){const I=ct.domCache.get(this);I.validationMessage&&sr(I.validationMessage);const k=this.getInput();k&&(k.removeAttribute("aria-invalid"),k.removeAttribute("aria-describedby"),ei(k,ee.inputerror))},showValidationMessage:function sa(I){const k=ct.domCache.get(this),G=ct.innerParams.get(this);yn(k.validationMessage,I),k.validationMessage.className=ee["validation-message"],G.customClass&&G.customClass.validationMessage&&Dn(k.validationMessage,G.customClass.validationMessage),vn(k.validationMessage);const _e=this.getInput();_e&&(_e.setAttribute("aria-invalid",!0),_e.setAttribute("aria-describedby",ee["validation-message"]),Tn(_e),Dn(_e,ee.inputerror))},update:function gr(I){const k=Pn(),G=ct.innerParams.get(this);if(!k||Qt(k,G.hideClass.popup))return void St("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const _e=ba(I),$e=Object.assign({},G,_e);Fn(this,$e),ct.innerParams.set(this,$e),Object.defineProperties(this,{params:{value:Object.assign({},this.params,I),writable:!1,enumerable:!0}})}});const xo=I=>{let k=Pn();k||new ot,k=Pn();const G=Vt();fr()?sr(Or()):Qi(k,I),vn(G),k.setAttribute("data-loading","true"),k.setAttribute("aria-busy","true"),k.focus()},Qi=(I,k)=>{const G=at(),_e=Vt();!k&&Fr(Yt())&&(k=Yt()),vn(G),k&&(sr(k),_e.setAttribute("data-button-to-replace",k.className)),_e.parentNode.insertBefore(_e,k),Dn([I,G],ee.loading)},hi=I=>I.checked?1:0,ua=I=>I.checked?I.value:null,Ms=I=>I.files.length?null!==I.getAttribute("multiple")?I.files:I.files[0]:null,Qn=(I,k)=>{const G=Pn(),_e=$e=>{Ua[k.input](G,jo($e),k)};jn(k.inputOptions)||ln(k.inputOptions)?(xo(Yt()),Kt(k.inputOptions).then($e=>{I.hideLoading(),_e($e)})):"object"==typeof k.inputOptions?_e(k.inputOptions):wt("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof k.inputOptions)},$s=(I,k)=>{const G=I.getInput();sr(G),Kt(k.inputValue).then(_e=>{G.value="number"===k.input?`${parseFloat(_e)||0}`:`${_e}`,vn(G),G.focus(),I.hideLoading()}).catch(_e=>{wt(`Error in inputValue promise: ${_e}`),G.value="",vn(G),G.focus(),I.hideLoading()})},Ua={select:(I,k,G)=>{const _e=ri(I,ee.select),$e=(Gt,An,nr)=>{const mt=document.createElement("option");mt.value=nr,yn(mt,An),mt.selected=Wr(nr,G.inputValue),Gt.appendChild(mt)};k.forEach(Gt=>{const An=Gt[0],nr=Gt[1];if(Array.isArray(nr)){const mt=document.createElement("optgroup");mt.label=An,mt.disabled=!1,_e.appendChild(mt),nr.forEach(ai=>$e(mt,ai[1],ai[0]))}else $e(_e,nr,An)}),_e.focus()},radio:(I,k,G)=>{const _e=ri(I,ee.radio);k.forEach(Gt=>{const An=Gt[0],nr=Gt[1],mt=document.createElement("input"),ai=document.createElement("label");mt.type="radio",mt.name=ee.radio,mt.value=An,Wr(An,G.inputValue)&&(mt.checked=!0);const ko=document.createElement("span");yn(ko,nr),ko.className=ee.label,ai.appendChild(mt),ai.appendChild(ko),_e.appendChild(ai)});const $e=_e.querySelectorAll("input");$e.length&&$e[0].focus()}},jo=I=>{const k=[];return typeof Map<"u"&&I instanceof Map?I.forEach((G,_e)=>{let $e=G;"object"==typeof $e&&($e=jo($e)),k.push([_e,$e])}):Object.keys(I).forEach(G=>{let _e=I[G];"object"==typeof _e&&(_e=jo(_e)),k.push([G,_e])}),k},Wr=(I,k)=>k&&k.toString()===I.toString(),Is=(I,k)=>{const G=ct.innerParams.get(I);if(!G.input)return void wt(`The "input" parameter is needed to be set when using returnInputValueOn${Xt(k)}`);const _e=((I,k)=>{const G=I.getInput();if(!G)return null;switch(k.input){case"checkbox":return hi(G);case"radio":return ua(G);case"file":return Ms(G);default:return k.inputAutoTrim?G.value.trim():G.value}})(I,G);G.inputValidator?Gs(I,_e,k):I.getInput().checkValidity()?"deny"===k?wo(I,_e):As(I,_e):(I.enableButtons(),I.showValidationMessage(G.validationMessage))},Gs=(I,k,G)=>{const _e=ct.innerParams.get(I);I.disableInput(),Promise.resolve().then(()=>Kt(_e.inputValidator(k,_e.validationMessage))).then(Gt=>{I.enableButtons(),I.enableInput(),Gt?I.showValidationMessage(Gt):"deny"===G?wo(I,k):As(I,k)})},wo=(I,k)=>{const G=ct.innerParams.get(I||void 0);G.showLoaderOnDeny&&xo(un()),G.preDeny?(ct.awaitingPromise.set(I||void 0,!0),Promise.resolve().then(()=>Kt(G.preDeny(k,G.validationMessage))).then($e=>{!1===$e?(I.hideLoading(),Yo(I)):I.close({isDenied:!0,value:typeof $e>"u"?k:$e})}).catch($e=>Qs(I||void 0,$e))):I.close({isDenied:!0,value:k})},tr=(I,k)=>{I.close({isConfirmed:!0,value:k})},Qs=(I,k)=>{I.rejectPromise(k)},As=(I,k)=>{const G=ct.innerParams.get(I||void 0);G.showLoaderOnConfirm&&xo(),G.preConfirm?(I.resetValidationMessage(),ct.awaitingPromise.set(I||void 0,!0),Promise.resolve().then(()=>Kt(G.preConfirm(k,G.validationMessage))).then($e=>{Fr(nn())||!1===$e?(I.hideLoading(),Yo(I)):tr(I,typeof $e>"u"?k:$e)}).catch($e=>Qs(I||void 0,$e))):tr(I,k)},bi=(I,k,G)=>{k.popup.onclick=()=>{const _e=ct.innerParams.get(I);_e&&(Ea(_e)||_e.timer||_e.input)||G(Jn.close)}},Ea=I=>I.showConfirmButton||I.showDenyButton||I.showCancelButton||I.showCloseButton;let Po=!1;const da=I=>{I.popup.onmousedown=()=>{I.container.onmouseup=function(k){I.container.onmouseup=void 0,k.target===I.container&&(Po=!0)}}},Ta=I=>{I.container.onmousedown=()=>{I.popup.onmouseup=function(k){I.popup.onmouseup=void 0,(k.target===I.popup||I.popup.contains(k.target))&&(Po=!0)}}},Ft=(I,k,G)=>{k.container.onclick=_e=>{const $e=ct.innerParams.get(I);Po?Po=!1:_e.target===k.container&&Ct($e.allowOutsideClick)&&G(Jn.backdrop)}},ta=I=>I instanceof Element||(I=>"object"==typeof I&&I.jquery)(I);const bo=()=>{if(gt.timeout)return(()=>{const I=Mt(),k=parseInt(window.getComputedStyle(I).width);I.style.removeProperty("transition"),I.style.width="100%";const G=parseInt(window.getComputedStyle(I).width);I.style.width=k/G*100+"%"})(),gt.timeout.stop()},Vo=()=>{if(gt.timeout){const I=gt.timeout.start();return to(I),I}};let Da=!1;const Gi={};const fl=I=>{for(let k=I.target;k&&k!==document;k=k.parentNode)for(const G in Gi){const _e=k.getAttribute(G);if(_e)return void Gi[G].fire({template:_e})}};var Go=Object.freeze({__proto__:null,argsToParams:I=>{const k={};return"object"!=typeof I[0]||ta(I[0])?["title","html","icon"].forEach((G,_e)=>{const $e=I[_e];"string"==typeof $e||ta($e)?k[G]=$e:void 0!==$e&&wt(`Unexpected type of ${G}! Expected "string" or "Element", got ${typeof $e}`)}):Object.assign(k,I[0]),k},bindClickHandler:function Ro(){Gi[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,Da||(document.body.addEventListener("click",fl),Da=!0)},clickCancel:()=>Bt()&&Bt().click(),clickConfirm:oo,clickDeny:()=>un()&&un().click(),enableLoading:xo,fire:function $i(){for(var k=arguments.length,G=new Array(k),_e=0;_e<k;_e++)G[_e]=arguments[_e];return new this(...G)},getActions:at,getCancelButton:Bt,getCloseButton:At,getConfirmButton:Yt,getContainer:jt,getDenyButton:un,getFocusableElements:qt,getFooter:rt,getHtmlContainer:pt,getIcon:Or,getIconContent:()=>st(ee["icon-content"]),getImage:sn,getInputLabel:()=>st(ee["input-label"]),getLoader:Vt,getPopup:Pn,getProgressSteps:_n,getTimerLeft:()=>gt.timeout&&gt.timeout.getTimerLeft(),getTimerProgressBar:Mt,getTitle:Ne,getValidationMessage:nn,increaseTimer:I=>{if(gt.timeout){const k=gt.timeout.increase(I);return to(k,!0),k}},isDeprecatedParameter:Na,isLoading:()=>Pn().hasAttribute("data-loading"),isTimerRunning:()=>gt.timeout&&gt.timeout.isRunning(),isUpdatableParameter:js,isValidParameter:Io,isVisible:()=>Fr(Pn()),mixin:function dl(I){return class k extends(this){_main(_e,$e){return super._main(_e,Object.assign({},I,$e))}}},resumeTimer:Vo,showLoading:xo,stopTimer:bo,toggleTimer:()=>{const I=gt.timeout;return I&&(I.running?bo():Vo())}});class Q{constructor(k,G){this.callback=k,this.remaining=G,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(k){const G=this.running;return G&&this.stop(),this.remaining+=k,G&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const M=["swal-title","swal-html","swal-footer"],j=I=>{const k={};return Array.from(I.querySelectorAll("swal-param")).forEach(_e=>{gn(_e,["name","value"]);const $e=_e.getAttribute("name"),Gt=_e.getAttribute("value");k[$e]="boolean"==typeof Cs[$e]?"false"!==Gt:"object"==typeof Cs[$e]?JSON.parse(Gt):Gt}),k},ne=I=>{const k={};return Array.from(I.querySelectorAll("swal-function-param")).forEach(_e=>{const $e=_e.getAttribute("name"),Gt=_e.getAttribute("value");k[$e]=new Function(`return ${Gt}`)()}),k},ge=I=>{const k={};return Array.from(I.querySelectorAll("swal-button")).forEach(_e=>{gn(_e,["type","color","aria-label"]);const $e=_e.getAttribute("type");k[`${$e}ButtonText`]=_e.innerHTML,k[`show${Xt($e)}Button`]=!0,_e.hasAttribute("color")&&(k[`${$e}ButtonColor`]=_e.getAttribute("color")),_e.hasAttribute("aria-label")&&(k[`${$e}ButtonAriaLabel`]=_e.getAttribute("aria-label"))}),k},Oe=I=>{const k={},G=I.querySelector("swal-image");return G&&(gn(G,["src","width","height","alt"]),G.hasAttribute("src")&&(k.imageUrl=G.getAttribute("src")),G.hasAttribute("width")&&(k.imageWidth=G.getAttribute("width")),G.hasAttribute("height")&&(k.imageHeight=G.getAttribute("height")),G.hasAttribute("alt")&&(k.imageAlt=G.getAttribute("alt"))),k},ze=I=>{const k={},G=I.querySelector("swal-icon");return G&&(gn(G,["type","color"]),G.hasAttribute("type")&&(k.icon=G.getAttribute("type")),G.hasAttribute("color")&&(k.iconColor=G.getAttribute("color")),k.iconHtml=G.innerHTML),k},Qe=I=>{const k={},G=I.querySelector("swal-input");G&&(gn(G,["type","label","placeholder","value"]),k.input=G.getAttribute("type")||"text",G.hasAttribute("label")&&(k.inputLabel=G.getAttribute("label")),G.hasAttribute("placeholder")&&(k.inputPlaceholder=G.getAttribute("placeholder")),G.hasAttribute("value")&&(k.inputValue=G.getAttribute("value")));const _e=Array.from(I.querySelectorAll("swal-input-option"));return _e.length&&(k.inputOptions={},_e.forEach($e=>{gn($e,["value"]);const Gt=$e.getAttribute("value");k.inputOptions[Gt]=$e.innerHTML})),k},Et=(I,k)=>{const G={};for(const _e in k){const $e=k[_e],Gt=I.querySelector($e);Gt&&(gn(Gt,[]),G[$e.replace(/^swal-/,"")]=Gt.innerHTML.trim())}return G},mn=I=>{const k=M.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(I.children).forEach(G=>{const _e=G.tagName.toLowerCase();k.includes(_e)||St(`Unrecognized element <${_e}>`)})},gn=(I,k)=>{Array.from(I.attributes).forEach(G=>{-1===k.indexOf(G.name)&&St([`Unrecognized attribute "${G.name}" on <${I.tagName.toLowerCase()}>.`,k.length?`Allowed attributes are: ${k.join(", ")}`:"To set the value, use HTML within the element."])})},hr=I=>{const k=jt(),G=Pn();"function"==typeof I.willOpen&&I.willOpen(G);const $e=window.getComputedStyle(document.body).overflowY;Br(k,G,I),setTimeout(()=>{Xn(k,G)},10),Rn()&&(pr(k,I.scrollbarPadding,$e),Array.from(document.body.children).forEach(k=>{k===jt()||k.contains(jt())||(k.hasAttribute("aria-hidden")&&k.setAttribute("data-previous-aria-hidden",k.getAttribute("aria-hidden")),k.setAttribute("aria-hidden","true"))})),!fr()&&!gt.previousActiveElement&&(gt.previousActiveElement=document.activeElement),"function"==typeof I.didOpen&&setTimeout(()=>I.didOpen(G)),ei(k,ee["no-transition"])},Vn=I=>{const k=Pn();if(I.target!==k)return;const G=jt();k.removeEventListener(Fe,Vn),G.style.overflowY="auto"},Xn=(I,k)=>{Fe&&In(k)?(I.style.overflowY="hidden",k.addEventListener(Fe,Vn)):I.style.overflowY="auto"},pr=(I,k,G)=>{(()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!Qt(document.body,ee.iosfix)){const k=document.body.scrollTop;document.body.style.top=-1*k+"px",Dn(document.body,ee.iosfix),Yi(),ia()}})(),k&&"hidden"!==G&&Ni(),setTimeout(()=>{I.scrollTop=0})},Br=(I,k,G)=>{Dn(I,G.showClass.backdrop),k.style.setProperty("opacity","0","important"),vn(k,"grid"),setTimeout(()=>{Dn(k,G.showClass.popup),k.style.removeProperty("opacity")},10),Dn([document.documentElement,document.body],ee.shown),G.heightAuto&&G.backdrop&&!G.toast&&Dn([document.documentElement,document.body],ee["height-auto"])};var Jr={email:(I,k)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(I)?Promise.resolve():Promise.resolve(k||"Invalid email address"),url:(I,k)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(I)?Promise.resolve():Promise.resolve(k||"Invalid URL")};function Sr(I){(function Pr(I){I.inputValidator||Object.keys(Jr).forEach(k=>{I.input===k&&(I.inputValidator=Jr[k])})})(I),I.showLoaderOnConfirm&&!I.preConfirm&&St("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function qr(I){(!I.target||"string"==typeof I.target&&!document.querySelector(I.target)||"string"!=typeof I.target&&!I.target.appendChild)&&(St('Target parameter is not valid, defaulting to "body"'),I.target="body")}(I),"string"==typeof I.title&&(I.title=I.title.split("\n").join("<br />")),Vi(I)}let Ei;class Bn{constructor(){if(typeof window>"u")return;Ei=this;for(var k=arguments.length,G=new Array(k),_e=0;_e<k;_e++)G[_e]=arguments[_e];const $e=Object.freeze(this.constructor.argsToParams(G));Object.defineProperties(this,{params:{value:$e,writable:!1,enumerable:!0,configurable:!0}});const Gt=Ei._main(Ei.params);ct.promise.set(this,Gt)}_main(k){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(I=>{!1===I.backdrop&&I.allowOutsideClick&&St('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const k in I)ca(k),I.toast&&po(k),wa(k)})(Object.assign({},G,k)),gt.currentInstance&&(gt.currentInstance._destroy(),Rn()&&Hr()),gt.currentInstance=Ei;const _e=fs(k,G);Sr(_e),Object.freeze(_e),gt.timeout&&(gt.timeout.stop(),delete gt.timeout),clearTimeout(gt.restoreFocusTimeout);const $e=F(Ei);return Fn(Ei,_e),ct.innerParams.set(Ei,_e),Ho(Ei,$e,_e)}then(k){return ct.promise.get(this).then(k)}finally(k){return ct.promise.get(this).finally(k)}}const Ho=(I,k,G)=>new Promise((_e,$e)=>{const Gt=An=>{I.close({isDismissed:!0,dismiss:An})};Bi.swalPromiseResolve.set(I,_e),Bi.swalPromiseReject.set(I,$e),k.confirmButton.onclick=()=>{(I=>{const k=ct.innerParams.get(I);I.disableButtons(),k.input?Is(I,"confirm"):As(I,!0)})(I)},k.denyButton.onclick=()=>{(I=>{const k=ct.innerParams.get(I);I.disableButtons(),k.returnInputValueOnDeny?Is(I,"deny"):wo(I,!1)})(I)},k.cancelButton.onclick=()=>{((I,k)=>{I.disableButtons(),k(Jn.cancel)})(I,Gt)},k.closeButton.onclick=()=>{Gt(Jn.close)},((I,k,G)=>{ct.innerParams.get(I).toast?bi(I,k,G):(da(k),Ta(k),Ft(I,k,G))})(I,k,Gt),((I,k,G,_e)=>{br(k),G.toast||(k.keydownHandler=$e=>Ys(I,$e,_e),k.keydownTarget=G.keydownListenerCapture?window:Pn(),k.keydownListenerCapture=G.keydownListenerCapture,k.keydownTarget.addEventListener("keydown",k.keydownHandler,{capture:k.keydownListenerCapture}),k.keydownHandlerAdded=!0)})(I,gt,G,Gt),((I,k)=>{"select"===k.input||"radio"===k.input?Qn(I,k):["text","email","number","tel","textarea"].includes(k.input)&&(jn(k.inputValue)||ln(k.inputValue))&&(xo(Yt()),$s(I,k))})(I,G),hr(G),X(gt,G,Gt),N(k,G),setTimeout(()=>{k.container.scrollTop=0})}),fs=(I,k)=>{const G=(I=>{const k="string"==typeof I.template?document.querySelector(I.template):I.template;if(!k)return{};const G=k.content;return mn(G),Object.assign(j(G),ne(G),ge(G),Oe(G),ze(G),Qe(G),Et(G,M))})(I),_e=Object.assign({},Cs,k,G,I);return _e.showClass=Object.assign({},Cs.showClass,_e.showClass),_e.hideClass=Object.assign({},Cs.hideClass,_e.hideClass),_e},F=I=>{const k={popup:Pn(),container:jt(),actions:at(),confirmButton:Yt(),denyButton:un(),cancelButton:Bt(),loader:Vt(),closeButton:At(),validationMessage:nn(),progressSteps:_n()};return ct.domCache.set(I,k),k},X=(I,k,G)=>{const _e=Mt();sr(_e),k.timer&&(I.timeout=new Q(()=>{G("timer"),delete I.timeout},k.timer),k.timerProgressBar&&(vn(_e),ir(_e,k,"timerProgressBar"),setTimeout(()=>{I.timeout&&I.timeout.running&&to(k.timer)})))},N=(I,k)=>{if(!k.toast){if(!Ct(k.allowEnterKey))return void Se();ae(I,k)||Ln(-1,1)}},ae=(I,k)=>k.focusDeny&&Fr(I.denyButton)?(I.denyButton.focus(),!0):k.focusCancel&&Fr(I.cancelButton)?(I.cancelButton.focus(),!0):!(!k.focusConfirm||!Fr(I.confirmButton)||(I.confirmButton.focus(),0)),Se=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|xn--p1ai)$/)){const I=new Date,k=localStorage.getItem("swal-initiation");k?(I.getTime()-Date.parse(k))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const G=document.createElement("audio");G.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",G.loop=!0,document.body.appendChild(G),setTimeout(()=>{G.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${I}`)}Object.assign(Bn.prototype,Ao),Object.assign(Bn,Go),Object.keys(Ao).forEach(I=>{Bn[I]=function(){if(Ei)return Ei[I](...arguments)}}),Bn.DismissReason=Jn,Bn.version="11.7.3";const ot=Bn;return ot.default=ot,ot}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),typeof document<"u"&&function(ct,we){var W=ct.createElement("style");if(ct.getElementsByTagName("head")[0].appendChild(W),W.styleSheet)W.styleSheet.disabled||(W.styleSheet.cssText=we);else try{W.innerHTML=we}catch{W.innerText=we}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;top:0;right:0;bottom:0;left:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:rgba(0,0,0,0) !important}.swal2-container.swal2-top-start,.swal2-container.swal2-center-start,.swal2-container.swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}.swal2-container.swal2-top,.swal2-container.swal2-center,.swal2-container.swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}.swal2-container.swal2-top-end,.swal2-container.swal2-center-end,.swal2-container.swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-start>.swal2-popup,.swal2-container.swal2-center-left>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-start>.swal2-popup,.swal2-container.swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-row>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none !important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:none}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:none}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:serif;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:rgba(0,0,0,0);color:#f27474}.swal2-close:focus{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-input,.swal2-file,.swal2-textarea,.swal2-select,.swal2-radio,.swal2-checkbox{margin:1em 2em 3px}.swal2-input,.swal2-file,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}.swal2-input.swal2-inputerror,.swal2-file.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}.swal2-input:focus,.swal2-file:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-input::placeholder,.swal2-file::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 3px;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}.swal2-radio,.swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-radio label,.swal2-checkbox label{margin:0 .6em;font-size:1.125em}.swal2-radio input,.swal2-checkbox input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{top:0;right:auto;bottom:auto;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{top:0;right:0;bottom:auto;left:auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{top:0;right:auto;bottom:auto;left:0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{top:50%;right:auto;bottom:auto;left:0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{top:50%;right:auto;bottom:auto;left:50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{top:50%;right:0;bottom:auto;left:auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{top:auto;right:auto;bottom:0;left:0}body.swal2-toast-shown .swal2-container.swal2-bottom{top:auto;right:auto;bottom:0;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{top:auto;right:0;bottom:0;left:auto}')},655:(Yn,ct,we)=>{"use strict";function Ct(at,rt,Mt,At){return new(Mt||(Mt=Promise))(function(qt,Rn){function fr(yn){try{bn(At.next(yn))}catch(Qt){Rn(Qt)}}function mr(yn){try{bn(At.throw(yn))}catch(Qt){Rn(Qt)}}function bn(yn){yn.done?qt(yn.value):function Wt(qt){return qt instanceof Mt?qt:new Mt(function(Rn){Rn(qt)})}(yn.value).then(fr,mr)}bn((At=At.apply(at,rt||[])).next())})}function Ye(at){return this instanceof Ye?(this.v=at,this):new Ye(at)}function Ne(at,rt,Mt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Wt,At=Mt.apply(at,rt||[]),qt=[];return Wt={},Rn("next"),Rn("throw"),Rn("return"),Wt[Symbol.asyncIterator]=function(){return this},Wt;function Rn(wr){At[wr]&&(Wt[wr]=function(ir){return new Promise(function(Xr,Tn){qt.push([wr,ir,Xr,Tn])>1||fr(wr,ir)})})}function fr(wr,ir){try{!function mr(wr){wr.value instanceof Ye?Promise.resolve(wr.value.v).then(bn,yn):Qt(qt[0][2],wr)}(At[wr](ir))}catch(Xr){Qt(qt[0][3],Xr)}}function bn(wr){fr("next",wr)}function yn(wr){fr("throw",wr)}function Qt(wr,ir){wr(ir),qt.shift(),qt.length&&fr(qt[0][0],qt[0][1])}}function sn(at){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Mt,rt=at[Symbol.asyncIterator];return rt?rt.call(at):(at=function jt(at){var rt="function"==typeof Symbol&&Symbol.iterator,Mt=rt&&at[rt],At=0;if(Mt)return Mt.call(at);if(at&&"number"==typeof at.length)return{next:function(){return at&&At>=at.length&&(at=void 0),{value:at&&at[At++],done:!at}}};throw new TypeError(rt?"Object is not iterable.":"Symbol.iterator is not defined.")}(at),Mt={},At("next"),At("throw"),At("return"),Mt[Symbol.asyncIterator]=function(){return this},Mt);function At(qt){Mt[qt]=at[qt]&&function(Rn){return new Promise(function(fr,mr){!function Wt(qt,Rn,fr,mr){Promise.resolve(mr).then(function(bn){qt({value:bn,done:fr})},Rn)}(fr,mr,(Rn=at[qt](Rn)).done,Rn.value)})}}}we.d(ct,{FC:()=>Ne,KL:()=>sn,mG:()=>Ct,qq:()=>Ye})},7340:(Yn,ct,we)=>{"use strict";we.d(ct,{LC:()=>ee,X$:()=>u,ZE:()=>Pn,ZN:()=>st,_7:()=>Kt,_j:()=>W,eR:()=>yt,jt:()=>Ie,k1:()=>Or,l3:()=>Ve,oB:()=>wt,oQ:()=>Ct,vP:()=>St});class W{}class ee{}const Ve="*";function u(Ye,Ne){return{type:7,name:Ye,definitions:Ne,options:{}}}function Ie(Ye,Ne=null){return{type:4,styles:Ne,timings:Ye}}function St(Ye,Ne=null){return{type:2,steps:Ye,options:Ne}}function wt(Ye){return{type:6,styles:Ye,offset:null}}function yt(Ye,Ne,pt=null){return{type:1,expr:Ye,animation:Ne,options:pt}}function Ct(Ye,Ne=null){return{type:8,animation:Ye,options:Ne}}function Kt(Ye,Ne=null){return{type:10,animation:Ye,options:Ne}}function Gn(Ye){Promise.resolve().then(Ye)}class st{constructor(Ne=0,pt=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=Ne+pt}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Ne=>Ne()),this._onDoneFns=[])}onStart(Ne){this._originalOnStartFns.push(Ne),this._onStartFns.push(Ne)}onDone(Ne){this._originalOnDoneFns.push(Ne),this._onDoneFns.push(Ne)}onDestroy(Ne){this._onDestroyFns.push(Ne)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Gn(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(Ne=>Ne()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(Ne=>Ne()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(Ne){this._position=this.totalTime?Ne*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(Ne){const pt="start"==Ne?this._onStartFns:this._onDoneFns;pt.forEach(sn=>sn()),pt.length=0}}class Pn{constructor(Ne){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=Ne;let pt=0,sn=0,_n=0;const nn=this.players.length;0==nn?Gn(()=>this._onFinish()):this.players.forEach(Yt=>{Yt.onDone(()=>{++pt==nn&&this._onFinish()}),Yt.onDestroy(()=>{++sn==nn&&this._onDestroy()}),Yt.onStart(()=>{++_n==nn&&this._onStart()})}),this.totalTime=this.players.reduce((Yt,Bt)=>Math.max(Yt,Bt.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Ne=>Ne()),this._onDoneFns=[])}init(){this.players.forEach(Ne=>Ne.init())}onStart(Ne){this._onStartFns.push(Ne)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(Ne=>Ne()),this._onStartFns=[])}onDone(Ne){this._onDoneFns.push(Ne)}onDestroy(Ne){this._onDestroyFns.push(Ne)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(Ne=>Ne.play())}pause(){this.players.forEach(Ne=>Ne.pause())}restart(){this.players.forEach(Ne=>Ne.restart())}finish(){this._onFinish(),this.players.forEach(Ne=>Ne.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(Ne=>Ne.destroy()),this._onDestroyFns.forEach(Ne=>Ne()),this._onDestroyFns=[])}reset(){this.players.forEach(Ne=>Ne.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(Ne){const pt=Ne*this.totalTime;this.players.forEach(sn=>{const _n=sn.totalTime?Math.min(1,pt/sn.totalTime):1;sn.setPosition(_n)})}getPosition(){const Ne=this.players.reduce((pt,sn)=>null===pt||sn.totalTime>pt.totalTime?sn:pt,null);return null!=Ne?Ne.getPosition():0}beforeDestroy(){this.players.forEach(Ne=>{Ne.beforeDestroy&&Ne.beforeDestroy()})}triggerCallback(Ne){const pt="start"==Ne?this._onStartFns:this._onDoneFns;pt.forEach(sn=>sn()),pt.length=0}}const Or="!"},6895:(Yn,ct,we)=>{"use strict";we.d(ct,{Do:()=>Pn,EM:()=>Na,HT:()=>u,JF:()=>gr,K0:()=>Xt,Mx:()=>zi,NF:()=>aa,O5:()=>oo,PC:()=>Ki,S$:()=>jt,V_:()=>xt,Ye:()=>Or,b0:()=>st,bD:()=>lo,ez:()=>Us,mk:()=>Ks,q:()=>Ve,sg:()=>Zn,tP:()=>si,w_:()=>Ie});var W=we(1571);let ee=null;function Ve(){return ee}function u(F){ee||(ee=F)}class Ie{}const Xt=new W.OlP("DocumentToken");let St=(()=>{class F{historyGo(N){throw new Error("Not implemented")}}return F.\u0275fac=function(N){return new(N||F)},F.\u0275prov=W.Yz7({token:F,factory:function(){return function wt(){return(0,W.LFG)(nt)}()},providedIn:"platform"}),F})();const xt=new W.OlP("Location Initialized");let nt=(()=>{class F extends St{constructor(N){super(),this._doc=N,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ve().getBaseHref(this._doc)}onPopState(N){const ae=Ve().getGlobalEventTarget(this._doc,"window");return ae.addEventListener("popstate",N,!1),()=>ae.removeEventListener("popstate",N)}onHashChange(N){const ae=Ve().getGlobalEventTarget(this._doc,"window");return ae.addEventListener("hashchange",N,!1),()=>ae.removeEventListener("hashchange",N)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(N){this._location.pathname=N}pushState(N,ae,Se){yt()?this._history.pushState(N,ae,Se):this._location.hash=Se}replaceState(N,ae,Se){yt()?this._history.replaceState(N,ae,Se):this._location.hash=Se}forward(){this._history.forward()}back(){this._history.back()}historyGo(N=0){this._history.go(N)}getState(){return this._history.state}}return F.\u0275fac=function(N){return new(N||F)(W.LFG(Xt))},F.\u0275prov=W.Yz7({token:F,factory:function(){return function Ct(){return new nt((0,W.LFG)(Xt))}()},providedIn:"platform"}),F})();function yt(){return!!window.history.pushState}function jn(F,X){if(0==F.length)return X;if(0==X.length)return F;let N=0;return F.endsWith("/")&&N++,X.startsWith("/")&&N++,2==N?F+X.substring(1):1==N?F+X:F+"/"+X}function Kt(F){const X=F.match(/#|\?|$/),N=X&&X.index||F.length;return F.slice(0,N-("/"===F[N-1]?1:0))+F.slice(N)}function ln(F){return F&&"?"!==F[0]?"?"+F:F}let jt=(()=>{class F{historyGo(N){throw new Error("Not implemented")}}return F.\u0275fac=function(N){return new(N||F)},F.\u0275prov=W.Yz7({token:F,factory:function(){return(0,W.f3M)(st)},providedIn:"root"}),F})();const Gn=new W.OlP("appBaseHref");let st=(()=>{class F extends jt{constructor(N,ae){super(),this._platformLocation=N,this._removeListenerFns=[],this._baseHref=ae??this._platformLocation.getBaseHrefFromDOM()??(0,W.f3M)(Xt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(N){this._removeListenerFns.push(this._platformLocation.onPopState(N),this._platformLocation.onHashChange(N))}getBaseHref(){return this._baseHref}prepareExternalUrl(N){return jn(this._baseHref,N)}path(N=!1){const ae=this._platformLocation.pathname+ln(this._platformLocation.search),Se=this._platformLocation.hash;return Se&&N?`${ae}${Se}`:ae}pushState(N,ae,Se,ot){const I=this.prepareExternalUrl(Se+ln(ot));this._platformLocation.pushState(N,ae,I)}replaceState(N,ae,Se,ot){const I=this.prepareExternalUrl(Se+ln(ot));this._platformLocation.replaceState(N,ae,I)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(N=0){this._platformLocation.historyGo?.(N)}}return F.\u0275fac=function(N){return new(N||F)(W.LFG(St),W.LFG(Gn,8))},F.\u0275prov=W.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})(),Pn=(()=>{class F extends jt{constructor(N,ae){super(),this._platformLocation=N,this._baseHref="",this._removeListenerFns=[],null!=ae&&(this._baseHref=ae)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(N){this._removeListenerFns.push(this._platformLocation.onPopState(N),this._platformLocation.onHashChange(N))}getBaseHref(){return this._baseHref}path(N=!1){let ae=this._platformLocation.hash;return null==ae&&(ae="#"),ae.length>0?ae.substring(1):ae}prepareExternalUrl(N){const ae=jn(this._baseHref,N);return ae.length>0?"#"+ae:ae}pushState(N,ae,Se,ot){let I=this.prepareExternalUrl(Se+ln(ot));0==I.length&&(I=this._platformLocation.pathname),this._platformLocation.pushState(N,ae,I)}replaceState(N,ae,Se,ot){let I=this.prepareExternalUrl(Se+ln(ot));0==I.length&&(I=this._platformLocation.pathname),this._platformLocation.replaceState(N,ae,I)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(N=0){this._platformLocation.historyGo?.(N)}}return F.\u0275fac=function(N){return new(N||F)(W.LFG(St),W.LFG(Gn,8))},F.\u0275prov=W.Yz7({token:F,factory:F.\u0275fac}),F})(),Or=(()=>{class F{constructor(N){this._subject=new W.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=N;const ae=this._locationStrategy.getBaseHref();this._basePath=function sn(F){if(new RegExp("^(https?:)?//").test(F)){const[,N]=F.split(/\/\/[^\/]+/);return N}return F}(Kt(pt(ae))),this._locationStrategy.onPopState(Se=>{this._subject.emit({url:this.path(!0),pop:!0,state:Se.state,type:Se.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(N=!1){return this.normalize(this._locationStrategy.path(N))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(N,ae=""){return this.path()==this.normalize(N+ln(ae))}normalize(N){return F.stripTrailingSlash(function Ne(F,X){if(!F||!X.startsWith(F))return X;const N=X.substring(F.length);return""===N||["/",";","?","#"].includes(N[0])?N:X}(this._basePath,pt(N)))}prepareExternalUrl(N){return N&&"/"!==N[0]&&(N="/"+N),this._locationStrategy.prepareExternalUrl(N)}go(N,ae="",Se=null){this._locationStrategy.pushState(Se,"",N,ae),this._notifyUrlChangeListeners(this.prepareExternalUrl(N+ln(ae)),Se)}replaceState(N,ae="",Se=null){this._locationStrategy.replaceState(Se,"",N,ae),this._notifyUrlChangeListeners(this.prepareExternalUrl(N+ln(ae)),Se)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(N=0){this._locationStrategy.historyGo?.(N)}onUrlChange(N){return this._urlChangeListeners.push(N),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(ae=>{this._notifyUrlChangeListeners(ae.url,ae.state)})),()=>{const ae=this._urlChangeListeners.indexOf(N);this._urlChangeListeners.splice(ae,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(N="",ae){this._urlChangeListeners.forEach(Se=>Se(N,ae))}subscribe(N,ae,Se){return this._subject.subscribe({next:N,error:ae,complete:Se})}}return F.normalizeQueryParams=ln,F.joinWithSlash=jn,F.stripTrailingSlash=Kt,F.\u0275fac=function(N){return new(N||F)(W.LFG(jt))},F.\u0275prov=W.Yz7({token:F,factory:function(){return function Ye(){return new Or((0,W.LFG)(jt))}()},providedIn:"root"}),F})();function pt(F){return F.replace(/\/index.html$/,"")}function zi(F,X){X=encodeURIComponent(X);for(const N of F.split(";")){const ae=N.indexOf("="),[Se,ot]=-1==ae?[N,""]:[N.slice(0,ae),N.slice(ae+1)];if(Se.trim()===X)return decodeURIComponent(ot)}return null}const oi=/\s+/,Gr=[];let Ks=(()=>{class F{constructor(N,ae,Se,ot){this._iterableDiffers=N,this._keyValueDiffers=ae,this._ngEl=Se,this._renderer=ot,this.initialClasses=Gr,this.stateMap=new Map}set klass(N){this.initialClasses=null!=N?N.trim().split(oi):Gr}set ngClass(N){this.rawClass="string"==typeof N?N.trim().split(oi):N}ngDoCheck(){for(const ae of this.initialClasses)this._updateState(ae,!0);const N=this.rawClass;if(Array.isArray(N)||N instanceof Set)for(const ae of N)this._updateState(ae,!0);else if(null!=N)for(const ae of Object.keys(N))this._updateState(ae,Boolean(N[ae]));this._applyStateDiff()}_updateState(N,ae){const Se=this.stateMap.get(N);void 0!==Se?(Se.enabled!==ae&&(Se.changed=!0,Se.enabled=ae),Se.touched=!0):this.stateMap.set(N,{enabled:ae,changed:!0,touched:!0})}_applyStateDiff(){for(const N of this.stateMap){const ae=N[0],Se=N[1];Se.changed?(this._toggleClass(ae,Se.enabled),Se.changed=!1):Se.touched||(Se.enabled&&this._toggleClass(ae,!1),this.stateMap.delete(ae)),Se.touched=!1}}_toggleClass(N,ae){(N=N.trim()).length>0&&N.split(oi).forEach(Se=>{ae?this._renderer.addClass(this._ngEl.nativeElement,Se):this._renderer.removeClass(this._ngEl.nativeElement,Se)})}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.ZZ4),W.Y36(W.aQg),W.Y36(W.SBq),W.Y36(W.Qsj))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),F})();class Lt{constructor(X,N,ae,Se){this.$implicit=X,this.ngForOf=N,this.index=ae,this.count=Se}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Zn=(()=>{class F{set ngForOf(N){this._ngForOf=N,this._ngForOfDirty=!0}set ngForTrackBy(N){this._trackByFn=N}get ngForTrackBy(){return this._trackByFn}constructor(N,ae,Se){this._viewContainer=N,this._template=ae,this._differs=Se,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(N){N&&(this._template=N)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const N=this._ngForOf;!this._differ&&N&&(this._differ=this._differs.find(N).create(this.ngForTrackBy))}if(this._differ){const N=this._differ.diff(this._ngForOf);N&&this._applyChanges(N)}}_applyChanges(N){const ae=this._viewContainer;N.forEachOperation((Se,ot,I)=>{if(null==Se.previousIndex)ae.createEmbeddedView(this._template,new Lt(Se.item,this._ngForOf,-1,-1),null===I?void 0:I);else if(null==I)ae.remove(null===ot?void 0:ot);else if(null!==ot){const k=ae.get(ot);ae.move(k,I),Nr(k,Se)}});for(let Se=0,ot=ae.length;Se<ot;Se++){const k=ae.get(Se).context;k.index=Se,k.count=ot,k.ngForOf=this._ngForOf}N.forEachIdentityChange(Se=>{Nr(ae.get(Se.currentIndex),Se)})}static ngTemplateContextGuard(N,ae){return!0}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.s_b),W.Y36(W.Rgc),W.Y36(W.ZZ4))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),F})();function Nr(F,X){F.context.$implicit=X.item}let oo=(()=>{class F{constructor(N,ae){this._viewContainer=N,this._context=new Yr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=ae}set ngIf(N){this._context.$implicit=this._context.ngIf=N,this._updateView()}set ngIfThen(N){Co("ngIfThen",N),this._thenTemplateRef=N,this._thenViewRef=null,this._updateView()}set ngIfElse(N){Co("ngIfElse",N),this._elseTemplateRef=N,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(N,ae){return!0}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.s_b),W.Y36(W.Rgc))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),F})();class Yr{constructor(){this.$implicit=null,this.ngIf=null}}function Co(F,X){if(X&&!X.createEmbeddedView)throw new Error(`${F} must be a TemplateRef, but received '${(0,W.AaK)(X)}'.`)}let Ki=(()=>{class F{constructor(N,ae,Se){this._ngEl=N,this._differs=ae,this._renderer=Se,this._ngStyle=null,this._differ=null}set ngStyle(N){this._ngStyle=N,!this._differ&&N&&(this._differ=this._differs.find(N).create())}ngDoCheck(){if(this._differ){const N=this._differ.diff(this._ngStyle);N&&this._applyChanges(N)}}_setStyle(N,ae){const[Se,ot]=N.split("."),I=-1===Se.indexOf("-")?void 0:W.JOm.DashCase;null!=ae?this._renderer.setStyle(this._ngEl.nativeElement,Se,ot?`${ae}${ot}`:ae,I):this._renderer.removeStyle(this._ngEl.nativeElement,Se,I)}_applyChanges(N){N.forEachRemovedItem(ae=>this._setStyle(ae.key,null)),N.forEachAddedItem(ae=>this._setStyle(ae.key,ae.currentValue)),N.forEachChangedItem(ae=>this._setStyle(ae.key,ae.currentValue))}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.SBq),W.Y36(W.aQg),W.Y36(W.Qsj))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),F})(),si=(()=>{class F{constructor(N){this._viewContainerRef=N,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(N){if(N.ngTemplateOutlet||N.ngTemplateOutletInjector){const ae=this._viewContainerRef;if(this._viewRef&&ae.remove(ae.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:Se,ngTemplateOutletContext:ot,ngTemplateOutletInjector:I}=this;this._viewRef=ae.createEmbeddedView(Se,ot,I?{injector:I}:void 0)}else this._viewRef=null}else this._viewRef&&N.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.s_b))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[W.TTD]}),F})(),Us=(()=>{class F{}return F.\u0275fac=function(N){return new(N||F)},F.\u0275mod=W.oAB({type:F}),F.\u0275inj=W.cJS({}),F})();const lo="browser";function aa(F){return F===lo}let Na=(()=>{class F{}return F.\u0275prov=(0,W.Yz7)({token:F,providedIn:"root",factory:()=>new ca((0,W.LFG)(Xt),window)}),F})();class ca{constructor(X,N){this.document=X,this.window=N,this.offset=()=>[0,0]}setOffset(X){this.offset=Array.isArray(X)?()=>X:X}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(X){this.supportsScrolling()&&this.window.scrollTo(X[0],X[1])}scrollToAnchor(X){if(!this.supportsScrolling())return;const N=function wa(F,X){const N=F.getElementById(X)||F.getElementsByName(X)[0];if(N)return N;if("function"==typeof F.createTreeWalker&&F.body&&(F.body.createShadowRoot||F.body.attachShadow)){const ae=F.createTreeWalker(F.body,NodeFilter.SHOW_ELEMENT);let Se=ae.currentNode;for(;Se;){const ot=Se.shadowRoot;if(ot){const I=ot.getElementById(X)||ot.querySelector(`[name="${X}"]`);if(I)return I}Se=ae.nextNode()}}return null}(this.document,X);N&&(this.scrollToElement(N),N.focus())}setHistoryScrollRestoration(X){if(this.supportScrollRestoration()){const N=this.window.history;N&&N.scrollRestoration&&(N.scrollRestoration=X)}}scrollToElement(X){const N=X.getBoundingClientRect(),ae=N.left+this.window.pageXOffset,Se=N.top+this.window.pageYOffset,ot=this.offset();this.window.scrollTo(ae-ot[0],Se-ot[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const X=po(this.window.history)||po(Object.getPrototypeOf(this.window.history));return!(!X||!X.writable&&!X.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function po(F){return Object.getOwnPropertyDescriptor(F,"scrollRestoration")}class gr{}},529:(Yn,ct,we)=>{"use strict";we.d(ct,{JF:()=>Vi,PG:()=>wt,WM:()=>nt,eN:()=>rt});var W=we(6895),ee=we(1571),Ve=we(9646),u=we(9751),Ie=we(4351),Xt=we(9300),St=we(4004);class wt{}class xt{}class nt{constructor(Fe){this.normalizedNames=new Map,this.lazyUpdate=null,Fe?this.lazyInit="string"==typeof Fe?()=>{this.headers=new Map,Fe.split("\n").forEach(Le=>{const $t=Le.indexOf(":");if($t>0){const Rt=Le.slice(0,$t),On=Rt.toLowerCase(),he=Le.slice($t+1).trim();this.maybeSetNormalizedName(Rt,On),this.headers.has(On)?this.headers.get(On).push(he):this.headers.set(On,[he])}})}:()=>{this.headers=new Map,Object.keys(Fe).forEach(Le=>{let $t=Fe[Le];const Rt=Le.toLowerCase();"string"==typeof $t&&($t=[$t]),$t.length>0&&(this.headers.set(Rt,$t),this.maybeSetNormalizedName(Le,Rt))})}:this.headers=new Map}has(Fe){return this.init(),this.headers.has(Fe.toLowerCase())}get(Fe){this.init();const Le=this.headers.get(Fe.toLowerCase());return Le&&Le.length>0?Le[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Fe){return this.init(),this.headers.get(Fe.toLowerCase())||null}append(Fe,Le){return this.clone({name:Fe,value:Le,op:"a"})}set(Fe,Le){return this.clone({name:Fe,value:Le,op:"s"})}delete(Fe,Le){return this.clone({name:Fe,value:Le,op:"d"})}maybeSetNormalizedName(Fe,Le){this.normalizedNames.has(Le)||this.normalizedNames.set(Le,Fe)}init(){this.lazyInit&&(this.lazyInit instanceof nt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Fe=>this.applyUpdate(Fe)),this.lazyUpdate=null))}copyFrom(Fe){Fe.init(),Array.from(Fe.headers.keys()).forEach(Le=>{this.headers.set(Le,Fe.headers.get(Le)),this.normalizedNames.set(Le,Fe.normalizedNames.get(Le))})}clone(Fe){const Le=new nt;return Le.lazyInit=this.lazyInit&&this.lazyInit instanceof nt?this.lazyInit:this,Le.lazyUpdate=(this.lazyUpdate||[]).concat([Fe]),Le}applyUpdate(Fe){const Le=Fe.name.toLowerCase();switch(Fe.op){case"a":case"s":let $t=Fe.value;if("string"==typeof $t&&($t=[$t]),0===$t.length)return;this.maybeSetNormalizedName(Fe.name,Le);const Rt=("a"===Fe.op?this.headers.get(Le):void 0)||[];Rt.push(...$t),this.headers.set(Le,Rt);break;case"d":const On=Fe.value;if(On){let he=this.headers.get(Le);if(!he)return;he=he.filter(H=>-1===On.indexOf(H)),0===he.length?(this.headers.delete(Le),this.normalizedNames.delete(Le)):this.headers.set(Le,he)}else this.headers.delete(Le),this.normalizedNames.delete(Le)}}forEach(Fe){this.init(),Array.from(this.normalizedNames.keys()).forEach(Le=>Fe(this.normalizedNames.get(Le),this.headers.get(Le)))}}class Ct{encodeKey(Fe){return jt(Fe)}encodeValue(Fe){return jt(Fe)}decodeKey(Fe){return decodeURIComponent(Fe)}decodeValue(Fe){return decodeURIComponent(Fe)}}const Kt=/%(\d[a-f0-9])/gi,ln={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function jt(_t){return encodeURIComponent(_t).replace(Kt,(Fe,Le)=>ln[Le]??Fe)}function Gn(_t){return`${_t}`}class st{constructor(Fe={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Fe.encoder||new Ct,Fe.fromString){if(Fe.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function jn(_t,Fe){const Le=new Map;return _t.length>0&&_t.replace(/^\?/,"").split("&").forEach(Rt=>{const On=Rt.indexOf("="),[he,H]=-1==On?[Fe.decodeKey(Rt),""]:[Fe.decodeKey(Rt.slice(0,On)),Fe.decodeValue(Rt.slice(On+1))],K=Le.get(he)||[];K.push(H),Le.set(he,K)}),Le}(Fe.fromString,this.encoder)}else Fe.fromObject?(this.map=new Map,Object.keys(Fe.fromObject).forEach(Le=>{const $t=Fe.fromObject[Le],Rt=Array.isArray($t)?$t.map(Gn):[Gn($t)];this.map.set(Le,Rt)})):this.map=null}has(Fe){return this.init(),this.map.has(Fe)}get(Fe){this.init();const Le=this.map.get(Fe);return Le?Le[0]:null}getAll(Fe){return this.init(),this.map.get(Fe)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Fe,Le){return this.clone({param:Fe,value:Le,op:"a"})}appendAll(Fe){const Le=[];return Object.keys(Fe).forEach($t=>{const Rt=Fe[$t];Array.isArray(Rt)?Rt.forEach(On=>{Le.push({param:$t,value:On,op:"a"})}):Le.push({param:$t,value:Rt,op:"a"})}),this.clone(Le)}set(Fe,Le){return this.clone({param:Fe,value:Le,op:"s"})}delete(Fe,Le){return this.clone({param:Fe,value:Le,op:"d"})}toString(){return this.init(),this.keys().map(Fe=>{const Le=this.encoder.encodeKey(Fe);return this.map.get(Fe).map($t=>Le+"="+this.encoder.encodeValue($t)).join("&")}).filter(Fe=>""!==Fe).join("&")}clone(Fe){const Le=new st({encoder:this.encoder});return Le.cloneFrom=this.cloneFrom||this,Le.updates=(this.updates||[]).concat(Fe),Le}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Fe=>this.map.set(Fe,this.cloneFrom.map.get(Fe))),this.updates.forEach(Fe=>{switch(Fe.op){case"a":case"s":const Le=("a"===Fe.op?this.map.get(Fe.param):void 0)||[];Le.push(Gn(Fe.value)),this.map.set(Fe.param,Le);break;case"d":if(void 0===Fe.value){this.map.delete(Fe.param);break}{let $t=this.map.get(Fe.param)||[];const Rt=$t.indexOf(Gn(Fe.value));-1!==Rt&&$t.splice(Rt,1),$t.length>0?this.map.set(Fe.param,$t):this.map.delete(Fe.param)}}}),this.cloneFrom=this.updates=null)}}class Or{constructor(){this.map=new Map}set(Fe,Le){return this.map.set(Fe,Le),this}get(Fe){return this.map.has(Fe)||this.map.set(Fe,Fe.defaultValue()),this.map.get(Fe)}delete(Fe){return this.map.delete(Fe),this}has(Fe){return this.map.has(Fe)}keys(){return this.map.keys()}}function Ne(_t){return typeof ArrayBuffer<"u"&&_t instanceof ArrayBuffer}function pt(_t){return typeof Blob<"u"&&_t instanceof Blob}function sn(_t){return typeof FormData<"u"&&_t instanceof FormData}class nn{constructor(Fe,Le,$t,Rt){let On;if(this.url=Le,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Fe.toUpperCase(),function Ye(_t){switch(_t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Rt?(this.body=void 0!==$t?$t:null,On=Rt):On=$t,On&&(this.reportProgress=!!On.reportProgress,this.withCredentials=!!On.withCredentials,On.responseType&&(this.responseType=On.responseType),On.headers&&(this.headers=On.headers),On.context&&(this.context=On.context),On.params&&(this.params=On.params)),this.headers||(this.headers=new nt),this.context||(this.context=new Or),this.params){const he=this.params.toString();if(0===he.length)this.urlWithParams=Le;else{const H=Le.indexOf("?");this.urlWithParams=Le+(-1===H?"?":H<Le.length-1?"&":"")+he}}else this.params=new st,this.urlWithParams=Le}serializeBody(){return null===this.body?null:Ne(this.body)||pt(this.body)||sn(this.body)||function _n(_t){return typeof URLSearchParams<"u"&&_t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof st?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||sn(this.body)?null:pt(this.body)?this.body.type||null:Ne(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof st?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Fe={}){const Le=Fe.method||this.method,$t=Fe.url||this.url,Rt=Fe.responseType||this.responseType,On=void 0!==Fe.body?Fe.body:this.body,he=void 0!==Fe.withCredentials?Fe.withCredentials:this.withCredentials,H=void 0!==Fe.reportProgress?Fe.reportProgress:this.reportProgress;let K=Fe.headers||this.headers,fe=Fe.params||this.params;const Ee=Fe.context??this.context;return void 0!==Fe.setHeaders&&(K=Object.keys(Fe.setHeaders).reduce((se,ie)=>se.set(ie,Fe.setHeaders[ie]),K)),Fe.setParams&&(fe=Object.keys(Fe.setParams).reduce((se,ie)=>se.set(ie,Fe.setParams[ie]),fe)),new nn(Le,$t,On,{params:fe,headers:K,context:Ee,reportProgress:H,responseType:Rt,withCredentials:he})}}var Yt=(()=>((Yt=Yt||{})[Yt.Sent=0]="Sent",Yt[Yt.UploadProgress=1]="UploadProgress",Yt[Yt.ResponseHeader=2]="ResponseHeader",Yt[Yt.DownloadProgress=3]="DownloadProgress",Yt[Yt.Response=4]="Response",Yt[Yt.User=5]="User",Yt))();class Bt{constructor(Fe,Le=200,$t="OK"){this.headers=Fe.headers||new nt,this.status=void 0!==Fe.status?Fe.status:Le,this.statusText=Fe.statusText||$t,this.url=Fe.url||null,this.ok=this.status>=200&&this.status<300}}class un extends Bt{constructor(Fe={}){super(Fe),this.type=Yt.ResponseHeader}clone(Fe={}){return new un({headers:Fe.headers||this.headers,status:void 0!==Fe.status?Fe.status:this.status,statusText:Fe.statusText||this.statusText,url:Fe.url||this.url||void 0})}}class rr extends Bt{constructor(Fe={}){super(Fe),this.type=Yt.Response,this.body=void 0!==Fe.body?Fe.body:null}clone(Fe={}){return new rr({body:void 0!==Fe.body?Fe.body:this.body,headers:Fe.headers||this.headers,status:void 0!==Fe.status?Fe.status:this.status,statusText:Fe.statusText||this.statusText,url:Fe.url||this.url||void 0})}}class Vt extends Bt{constructor(Fe){super(Fe,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Fe.url||"(unknown url)"}`:`Http failure response for ${Fe.url||"(unknown url)"}: ${Fe.status} ${Fe.statusText}`,this.error=Fe.error||null}}function at(_t,Fe){return{body:Fe,headers:_t.headers,context:_t.context,observe:_t.observe,params:_t.params,reportProgress:_t.reportProgress,responseType:_t.responseType,withCredentials:_t.withCredentials}}let rt=(()=>{class _t{constructor(Le){this.handler=Le}request(Le,$t,Rt={}){let On;if(Le instanceof nn)On=Le;else{let K,fe;K=Rt.headers instanceof nt?Rt.headers:new nt(Rt.headers),Rt.params&&(fe=Rt.params instanceof st?Rt.params:new st({fromObject:Rt.params})),On=new nn(Le,$t,void 0!==Rt.body?Rt.body:null,{headers:K,context:Rt.context,params:fe,reportProgress:Rt.reportProgress,responseType:Rt.responseType||"json",withCredentials:Rt.withCredentials})}const he=(0,Ve.of)(On).pipe((0,Ie.b)(K=>this.handler.handle(K)));if(Le instanceof nn||"events"===Rt.observe)return he;const H=he.pipe((0,Xt.h)(K=>K instanceof rr));switch(Rt.observe||"body"){case"body":switch(On.responseType){case"arraybuffer":return H.pipe((0,St.U)(K=>{if(null!==K.body&&!(K.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return K.body}));case"blob":return H.pipe((0,St.U)(K=>{if(null!==K.body&&!(K.body instanceof Blob))throw new Error("Response is not a Blob.");return K.body}));case"text":return H.pipe((0,St.U)(K=>{if(null!==K.body&&"string"!=typeof K.body)throw new Error("Response is not a string.");return K.body}));default:return H.pipe((0,St.U)(K=>K.body))}case"response":return H;default:throw new Error(`Unreachable: unhandled observe type ${Rt.observe}}`)}}delete(Le,$t={}){return this.request("DELETE",Le,$t)}get(Le,$t={}){return this.request("GET",Le,$t)}head(Le,$t={}){return this.request("HEAD",Le,$t)}jsonp(Le,$t){return this.request("JSONP",Le,{params:(new st).append($t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Le,$t={}){return this.request("OPTIONS",Le,$t)}patch(Le,$t,Rt={}){return this.request("PATCH",Le,at(Rt,$t))}post(Le,$t,Rt={}){return this.request("POST",Le,at(Rt,$t))}put(Le,$t,Rt={}){return this.request("PUT",Le,at(Rt,$t))}}return _t.\u0275fac=function(Le){return new(Le||_t)(ee.LFG(wt))},_t.\u0275prov=ee.Yz7({token:_t,factory:_t.\u0275fac}),_t})();function Mt(_t,Fe){return Fe(_t)}function At(_t,Fe){return(Le,$t)=>Fe.intercept(Le,{handle:Rt=>_t(Rt,$t)})}const qt=new ee.OlP("HTTP_INTERCEPTORS"),Rn=new ee.OlP("HTTP_INTERCEPTOR_FNS");function fr(){let _t=null;return(Fe,Le)=>(null===_t&&(_t=((0,ee.f3M)(qt,{optional:!0})??[]).reduceRight(At,Mt)),_t(Fe,Le))}let mr=(()=>{class _t extends wt{constructor(Le,$t){super(),this.backend=Le,this.injector=$t,this.chain=null}handle(Le){if(null===this.chain){const $t=Array.from(new Set(this.injector.get(Rn)));this.chain=$t.reduceRight((Rt,On)=>function Wt(_t,Fe,Le){return($t,Rt)=>Le.runInContext(()=>Fe($t,On=>_t(On,Rt)))}(Rt,On,this.injector),Mt)}return this.chain(Le,$t=>this.backend.handle($t))}}return _t.\u0275fac=function(Le){return new(Le||_t)(ee.LFG(xt),ee.LFG(ee.lqb))},_t.\u0275prov=ee.Yz7({token:_t,factory:_t.\u0275fac}),_t})();const qi=/^\)\]\}',?\n/;let sr=(()=>{class _t{constructor(Le){this.xhrFactory=Le}handle(Le){if("JSONP"===Le.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new u.y($t=>{const Rt=this.xhrFactory.build();if(Rt.open(Le.method,Le.urlWithParams),Le.withCredentials&&(Rt.withCredentials=!0),Le.headers.forEach((q,re)=>Rt.setRequestHeader(q,re.join(","))),Le.headers.has("Accept")||Rt.setRequestHeader("Accept","application/json, text/plain, */*"),!Le.headers.has("Content-Type")){const q=Le.detectContentTypeHeader();null!==q&&Rt.setRequestHeader("Content-Type",q)}if(Le.responseType){const q=Le.responseType.toLowerCase();Rt.responseType="json"!==q?q:"text"}const On=Le.serializeBody();let he=null;const H=()=>{if(null!==he)return he;const q=Rt.statusText||"OK",re=new nt(Rt.getAllResponseHeaders()),pe=function vn(_t){return"responseURL"in _t&&_t.responseURL?_t.responseURL:/^X-Request-URL:/m.test(_t.getAllResponseHeaders())?_t.getResponseHeader("X-Request-URL"):null}(Rt)||Le.url;return he=new un({headers:re,status:Rt.status,statusText:q,url:pe}),he},K=()=>{let{headers:q,status:re,statusText:pe,url:Ue}=H(),ft=null;204!==re&&(ft=typeof Rt.response>"u"?Rt.responseText:Rt.response),0===re&&(re=ft?200:0);let dt=re>=200&&re<300;if("json"===Le.responseType&&"string"==typeof ft){const en=ft;ft=ft.replace(qi,"");try{ft=""!==ft?JSON.parse(ft):null}catch(hn){ft=en,dt&&(dt=!1,ft={error:hn,text:ft})}}dt?($t.next(new rr({body:ft,headers:q,status:re,statusText:pe,url:Ue||void 0})),$t.complete()):$t.error(new Vt({error:ft,headers:q,status:re,statusText:pe,url:Ue||void 0}))},fe=q=>{const{url:re}=H(),pe=new Vt({error:q,status:Rt.status||0,statusText:Rt.statusText||"Unknown Error",url:re||void 0});$t.error(pe)};let Ee=!1;const se=q=>{Ee||($t.next(H()),Ee=!0);let re={type:Yt.DownloadProgress,loaded:q.loaded};q.lengthComputable&&(re.total=q.total),"text"===Le.responseType&&Rt.responseText&&(re.partialText=Rt.responseText),$t.next(re)},ie=q=>{let re={type:Yt.UploadProgress,loaded:q.loaded};q.lengthComputable&&(re.total=q.total),$t.next(re)};return Rt.addEventListener("load",K),Rt.addEventListener("error",fe),Rt.addEventListener("timeout",fe),Rt.addEventListener("abort",fe),Le.reportProgress&&(Rt.addEventListener("progress",se),null!==On&&Rt.upload&&Rt.upload.addEventListener("progress",ie)),Rt.send(On),$t.next({type:Yt.Sent}),()=>{Rt.removeEventListener("error",fe),Rt.removeEventListener("abort",fe),Rt.removeEventListener("load",K),Rt.removeEventListener("timeout",fe),Le.reportProgress&&(Rt.removeEventListener("progress",se),null!==On&&Rt.upload&&Rt.upload.removeEventListener("progress",ie)),Rt.readyState!==Rt.DONE&&Rt.abort()}})}}return _t.\u0275fac=function(Le){return new(Le||_t)(ee.LFG(W.JF))},_t.\u0275prov=ee.Yz7({token:_t,factory:_t.\u0275fac}),_t})();const vi=new ee.OlP("XSRF_ENABLED"),Fr=new ee.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Ii=new ee.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class In{}let to=(()=>{class _t{constructor(Le,$t,Rt){this.doc=Le,this.platform=$t,this.cookieName=Rt,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Le=this.doc.cookie||"";return Le!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,W.Mx)(Le,this.cookieName),this.lastCookieString=Le),this.lastToken}}return _t.\u0275fac=function(Le){return new(Le||_t)(ee.LFG(W.K0),ee.LFG(ee.Lbi),ee.LFG(Fr))},_t.\u0275prov=ee.Yz7({token:_t,factory:_t.\u0275fac}),_t})();function zr(_t,Fe){const Le=_t.url.toLowerCase();if(!(0,ee.f3M)(vi)||"GET"===_t.method||"HEAD"===_t.method||Le.startsWith("http://")||Le.startsWith("https://"))return Fe(_t);const $t=(0,ee.f3M)(In).getToken(),Rt=(0,ee.f3M)(Ii);return null!=$t&&!_t.headers.has(Rt)&&(_t=_t.clone({headers:_t.headers.set(Rt,$t)})),Fe(_t)}var gt=(()=>((gt=gt||{})[gt.Interceptors=0]="Interceptors",gt[gt.LegacyInterceptors=1]="LegacyInterceptors",gt[gt.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",gt[gt.NoXsrfProtection=3]="NoXsrfProtection",gt[gt.JsonpSupport=4]="JsonpSupport",gt[gt.RequestsMadeViaParent=5]="RequestsMadeViaParent",gt))();function xi(_t,Fe){return{\u0275kind:_t,\u0275providers:Fe}}function yr(..._t){const Fe=[rt,sr,mr,{provide:wt,useExisting:mr},{provide:xt,useExisting:sr},{provide:Rn,useValue:zr,multi:!0},{provide:vi,useValue:!0},{provide:In,useClass:to}];for(const Le of _t)Fe.push(...Le.\u0275providers);return(0,ee.MR2)(Fe)}const no=new ee.OlP("LEGACY_INTERCEPTOR_FN");let Vi=(()=>{class _t{}return _t.\u0275fac=function(Le){return new(Le||_t)},_t.\u0275mod=ee.oAB({type:_t}),_t.\u0275inj=ee.cJS({providers:[yr(xi(gt.LegacyInterceptors,[{provide:no,useFactory:fr},{provide:Rn,useExisting:no,multi:!0}]))]}),_t})()},1571:(Yn,ct,we)=>{"use strict";we.d(ct,{QbO:()=>Nw,tb:()=>T0,AFp:()=>f0,ip1:()=>d0,CZH:()=>kg,hGG:()=>Tb,z2F:()=>Og,sBO:()=>lb,Sil:()=>Gw,_Vd:()=>zs,EJc:()=>Vw,Xts:()=>yd,SBq:()=>Lh,lqb:()=>gu,qLn:()=>Fh,vpe:()=>tu,XFs:()=>In,OlP:()=>di,zs3:()=>Wl,ZZ4:()=>Oy,aQg:()=>Fy,soG:()=>Lg,YKP:()=>mv,h0i:()=>sf,PXZ:()=>rb,R0b:()=>Ql,FiY:()=>te,Lbi:()=>Bw,g9A:()=>m0,Qsj:()=>Wu,FYo:()=>zm,JOm:()=>qs,tp0:()=>ye,Rgc:()=>Jp,dDg:()=>Qw,eoX:()=>b0,GfV:()=>Zc,s_b:()=>Ag,ifc:()=>q,MMx:()=>cy,Lck:()=>Bx,eFA:()=>C0,Gpc:()=>ln,f3M:()=>Rt,$WT:()=>oi,MR2:()=>Cm,_c5:()=>Eb,c2e:()=>Uw,zSh:()=>Ph,wAp:()=>dr,vHH:()=>Ye,lri:()=>x0,rWj:()=>w0,D6c:()=>Db,cg1:()=>Mc,kL8:()=>rf,dqk:()=>yr,Z0I:()=>ri,eJc:()=>vy,CqO:()=>Ka,QGY:()=>Cp,F4k:()=>Sp,RDi:()=>Hg,AaK:()=>Ct,qOj:()=>hp,TTD:()=>us,_Bn:()=>pv,jDz:()=>_v,xp6:()=>Um,uIk:()=>_p,Tol:()=>B,ekj:()=>D,Suo:()=>Vv,Xpm:()=>or,lG2:()=>ht,Yz7:()=>Tn,cJS:()=>Dn,oAB:()=>kr,Yjl:()=>io,Y36:()=>vc,_UZ:()=>Qh,GkF:()=>Tp,qZA:()=>Kd,TgZ:()=>Xd,EpF:()=>Dp,n5z:()=>ic,LFG:()=>Le,$8M:()=>qo,$Z:()=>Zm,NdJ:()=>ul,CRH:()=>$v,oxw:()=>Ip,Hsn:()=>vg,F$t:()=>Yd,Q6J:()=>ah,s9C:()=>Jd,DdM:()=>Tv,VKq:()=>Dv,WLB:()=>Cv,l5B:()=>Sv,qbA:()=>Mv,HTZ:()=>Iv,iGM:()=>Uv,MAs:()=>wp,KtG:()=>el,CHM:()=>ta,P3R:()=>ys,Akn:()=>P,YNc:()=>_g,W1O:()=>qv,_uU:()=>lt,Oqu:()=>tn,hij:()=>Un,Gf:()=>jv});var W=we(7579),ee=we(727),Ve=we(9751),u=we(6451),Ie=we(8421),Xt=we(930),St=we(4482);function xt(i,o,...l){if(!0===o)return void i();if(!1===o)return;const m=new Xt.Hp({next:()=>{m.unsubscribe(),i()}});return(0,Ie.Xf)(o(...l)).subscribe(m)}function nt(i){for(let o in i)if(i[o]===nt)return o;throw Error("Could not find renamed property on target object.")}function yt(i,o){for(const l in o)o.hasOwnProperty(l)&&!i.hasOwnProperty(l)&&(i[l]=o[l])}function Ct(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(Ct).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const l=o.indexOf("\n");return-1===l?o:o.substring(0,l)}function jn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const Kt=nt({__forward_ref__:nt});function ln(i){return i.__forward_ref__=ln,i.toString=function(){return Ct(this())},i}function jt(i){return Gn(i)?i():i}function Gn(i){return"function"==typeof i&&i.hasOwnProperty(Kt)&&i.__forward_ref__===ln}function st(i){return i&&!!i.\u0275providers}const Or="https://g.co/ng/security#xss";class Ye extends Error{constructor(o,l){super(Ne(o,l)),this.code=o}}function Ne(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}function pt(i){return"string"==typeof i?i:null==i?"":String(i)}function Bt(i,o){throw new Ye(-201,!1)}function yn(i,o){null==i&&function Qt(i,o,l,m){throw new Error(`ASSERTION ERROR: ${i}`+(null==m?"":` [Expected=> ${l} ${m} ${o} <=Actual]`))}(o,i,null,"!=")}function Tn(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function Dn(i){return{providers:i.providers||[],imports:i.imports||[]}}function ei(i){return qi(i,Kr)||qi(i,Bo)}function ri(i){return null!==ei(i)}function qi(i,o){return i.hasOwnProperty(o)?i[o]:null}function vi(i){return i&&(i.hasOwnProperty(Fr)||i.hasOwnProperty(Ii))?i[Fr]:null}const Kr=nt({\u0275prov:nt}),Fr=nt({\u0275inj:nt}),Bo=nt({ngInjectableDef:nt}),Ii=nt({ngInjectorDef:nt});var In=(()=>((In=In||{})[In.Default=0]="Default",In[In.Host=1]="Host",In[In.Self=2]="Self",In[In.SkipSelf=4]="SkipSelf",In[In.Optional=8]="Optional",In))();let to;function xn(i){const o=to;return to=i,o}function gt(i,o,l){const m=ei(i);return m&&"root"==m.providedIn?void 0===m.value?m.value=m.factory():m.value:l&In.Optional?null:void 0!==o?o:void Bt(Ct(i))}const yr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Pi={},Ar="__NG_DI_FLAG__",ho="ngTempTokenPath",vr="ngTokenPath",ro=/\n/gm,Vi="\u0275",ii="__source";let Hn;function _t(i){const o=Hn;return Hn=i,o}function Fe(i,o=In.Default){if(void 0===Hn)throw new Ye(-203,!1);return null===Hn?gt(i,void 0,o):Hn.get(i,o&In.Optional?null:void 0,o)}function Le(i,o=In.Default){return(function zr(){return to}()||Fe)(jt(i),o)}function Rt(i,o=In.Default){return Le(i,On(o))}function On(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function he(i){const o=[];for(let l=0;l<i.length;l++){const m=jt(i[l]);if(Array.isArray(m)){if(0===m.length)throw new Ye(900,!1);let v,b=In.Default;for(let S=0;S<m.length;S++){const L=m[S],z=K(L);"number"==typeof z?-1===z?v=L.token:b|=z:v=L}o.push(Le(v,b))}else o.push(Le(m))}return o}function H(i,o){return i[Ar]=o,i.prototype[Ar]=o,i}function K(i){return i[Ar]}function se(i){return{toString:i}.toString()}var ie=(()=>((ie=ie||{})[ie.OnPush=0]="OnPush",ie[ie.Default=1]="Default",ie))(),q=(()=>{return(i=q||(q={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",q;var i})();const re={},pe=[],Ue=nt({\u0275cmp:nt}),ft=nt({\u0275dir:nt}),dt=nt({\u0275pipe:nt}),en=nt({\u0275mod:nt}),hn=nt({\u0275fac:nt}),dn=nt({__NG_ELEMENT_ID__:nt});let an=0;function or(i){return se(()=>{const o=Ks(i),l={...o,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===ie.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&i.dependencies||null,getStandaloneInjector:null,data:i.data||{},encapsulation:i.encapsulation||q.Emulated,id:"c"+an++,styles:i.styles||pe,_:null,schemas:i.schemas||null,tView:null};as(l);const m=i.dependencies;return l.directiveDefs=Zt(m,!1),l.pipeDefs=Zt(m,!0),l})}function Sn(i){return Wn(i)||_i(i)}function Cr(i){return null!==i}function kr(i){return se(()=>({type:i.type,bootstrap:i.bootstrap||pe,declarations:i.declarations||pe,imports:i.imports||pe,exports:i.exports||pe,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function yo(i,o){if(null==i)return re;const l={};for(const m in i)if(i.hasOwnProperty(m)){let v=i[m],b=v;Array.isArray(v)&&(b=v[1],v=v[0]),l[v]=m,o&&(o[v]=b)}return l}function ht(i){return se(()=>{const o=Ks(i);return as(o),o})}function io(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function Wn(i){return i[Ue]||null}function _i(i){return i[ft]||null}function zi(i){return i[dt]||null}function oi(i){const o=Wn(i)||_i(i)||zi(i);return null!==o&&o.standalone}function Gr(i,o){const l=i[en]||null;if(!l&&!0===o)throw new Error(`Type ${Ct(i)} does not have '\u0275mod' property.`);return l}function Ks(i){const o={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:o,exportAs:i.exportAs||null,standalone:!0===i.standalone,selectors:i.selectors||pe,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:yo(i.inputs,o),outputs:yo(i.outputs)}}function as(i){i.features?.forEach(o=>o(i))}function Zt(i,o){if(!i)return null;const l=o?zi:Sn;return()=>("function"==typeof i?i():i).map(m=>l(m)).filter(Cr)}const Fn=0,Lt=1,Zn=2,Nr=3,$n=4,oo=5,Yr=6,Co=7,Jn=8,br=9,Es=10,Ln=11,ls=12,wi=13,Ys=14,Ki=15,si=16,so=17,ui=18,Bi=19,Ri=20,Hr=21,jr=22,Yi=1,ao=2,Ns=7,Js=8,ti=9,Ni=10;function ki(i){return Array.isArray(i)&&"object"==typeof i[Yi]}function Vr(i){return Array.isArray(i)&&!0===i[Yi]}function Ts(i){return 0!=(4&i.flags)}function Ko(i){return i.componentOffset>-1}function So(i){return 1==(1&i.flags)}function Ji(i){return!!i.template}function Yo(i){return 0!=(256&i[Zn])}function po(i,o){return i.hasOwnProperty(hn)?i[hn]:null}class wa{constructor(o,l,m){this.previousValue=o,this.currentValue=l,this.firstChange=m}isFirstChange(){return this.firstChange}}function us(){return gr}function gr(i){return i.type.prototype.ngOnChanges&&(i.setInput=Jo),ba}function ba(){const i=Qo(this),o=i?.current;if(o){const l=i.previous;if(l===re)i.previous=o;else for(let m in o)l[m]=o[m];i.current=null,this.ngOnChanges(o)}}function Jo(i,o,l,m){const v=this.declaredInputs[l],b=Qo(i)||function Zi(i,o){return i[hs]=o}(i,{previous:re,current:null}),S=b.current||(b.current={}),L=b.previous,z=L[v];S[v]=new wa(z&&z.currentValue,o,L===re),i[m]=o}us.ngInherit=!0;const hs="__ngSimpleChanges__";function Qo(i){return i[hs]||null}const Qi=function(i,o,l){};function hi(i){for(;Array.isArray(i);)i=i[Fn];return i}function Ms(i,o){return hi(o[i])}function Qn(i,o){return hi(o[i.index])}function Ua(i,o){return i.data[o]}function Wr(i,o){const l=o[i];return ki(l)?l:l[Fn]}function es(i){return 64==(64&i[Zn])}function Is(i,o){return null==o?null:i[o]}function Gs(i){i[ui]=0}function wo(i,o){i[oo]+=o;let l=i,m=i[Nr];for(;null!==m&&(1===o&&1===l[oo]||-1===o&&0===l[oo]);)m[oo]+=o,l=m,m=m[Nr]}const tr={lFrame:hr(null),bindingsEnabled:!0};function Po(){return tr.bindingsEnabled}function Ft(){return tr.lFrame.lView}function ar(){return tr.lFrame.tView}function ta(i){return tr.lFrame.contextLView=i,i[Jn]}function el(i){return tr.lFrame.contextLView=null,i}function $i(){let i=dl();for(;null!==i&&64===i.type;)i=i.parent;return i}function dl(){return tr.lFrame.currentTNode}function bo(i,o){const l=tr.lFrame;l.currentTNode=i,l.isParent=o}function Vo(){return tr.lFrame.isParent}function $o(){tr.lFrame.isParent=!1}function Gi(){const i=tr.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function Go(){return tr.lFrame.bindingIndex++}function Q(i){const o=tr.lFrame,l=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,l}function j(i,o){const l=tr.lFrame;l.bindingIndex=l.bindingRootIndex=i,ge(o)}function ge(i){tr.lFrame.currentDirectiveIndex=i}function ze(){return tr.lFrame.currentQueryIndex}function Qe(i){tr.lFrame.currentQueryIndex=i}function Et(i){const o=i[Lt];return 2===o.type?o.declTNode:1===o.type?i[Yr]:null}function mn(i,o,l){if(l&In.SkipSelf){let v=o,b=i;for(;!(v=v.parent,null!==v||l&In.Host||(v=Et(b),null===v||(b=b[Ki],10&v.type))););if(null===v)return!1;o=v,i=b}const m=tr.lFrame=ur();return m.currentTNode=o,m.lView=i,!0}function gn(i){const o=ur(),l=i[Lt];tr.lFrame=o,o.currentTNode=l.firstChild,o.lView=i,o.tView=l,o.contextLView=i,o.bindingIndex=l.bindingStartIndex,o.inI18n=!1}function ur(){const i=tr.lFrame,o=null===i?null:i.child;return null===o?hr(i):o}function hr(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function Vn(){const i=tr.lFrame;return tr.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const Xn=Vn;function pr(){const i=Vn();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Pr(){return tr.lFrame.selectedIndex}function qr(i){tr.lFrame.selectedIndex=i}function Sr(){const i=tr.lFrame;return Ua(i.tView,i.selectedIndex)}function N(i,o){for(let l=o.directiveStart,m=o.directiveEnd;l<m;l++){const b=i.data[l].type.prototype,{ngAfterContentInit:S,ngAfterContentChecked:L,ngAfterViewInit:z,ngAfterViewChecked:Z,ngOnDestroy:le}=b;S&&(i.contentHooks||(i.contentHooks=[])).push(-l,S),L&&((i.contentHooks||(i.contentHooks=[])).push(l,L),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(l,L)),z&&(i.viewHooks||(i.viewHooks=[])).push(-l,z),Z&&((i.viewHooks||(i.viewHooks=[])).push(l,Z),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(l,Z)),null!=le&&(i.destroyHooks||(i.destroyHooks=[])).push(l,le)}}function ae(i,o,l){I(i,o,3,l)}function Se(i,o,l,m){(3&i[Zn])===l&&I(i,o,l,m)}function ot(i,o){let l=i[Zn];(3&l)===o&&(l&=2047,l+=1,i[Zn]=l)}function I(i,o,l,m){const b=m??-1,S=o.length-1;let L=0;for(let z=void 0!==m?65535&i[ui]:0;z<S;z++)if("number"==typeof o[z+1]){if(L=o[z],null!=m&&L>=m)break}else o[z]<0&&(i[ui]+=65536),(L<b||-1==b)&&(k(i,l,o,z),i[ui]=(4294901760&i[ui])+z+2),z++}function k(i,o,l,m){const v=l[m]<0,b=l[m+1],L=i[v?-l[m]:l[m]];if(v){if(i[Zn]>>11<i[ui]>>16&&(3&i[Zn])===o){i[Zn]+=2048,Qi(4,L,b);try{b.call(L)}finally{Qi(5,L,b)}}}else{Qi(4,L,b);try{b.call(L)}finally{Qi(5,L,b)}}}const G=-1;class _e{constructor(o,l,m){this.factory=o,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=m}}function Hi(i,o,l){let m=0;for(;m<l.length;){const v=l[m];if("number"==typeof v){if(0!==v)break;m++;const b=l[m++],S=l[m++],L=l[m++];i.setAttribute(o,S,L,b)}else{const b=v,S=l[++m];Hs(b)?i.setProperty(o,b,S):i.setAttribute(o,b,S),m++}}return m}function Ui(i){return 3===i||4===i||6===i}function Hs(i){return 64===i.charCodeAt(0)}function Wo(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let l=-1;for(let m=0;m<o.length;m++){const v=o[m];"number"==typeof v?l=v:0===l||ec(i,l,v,null,-1===l||2===l?o[++m]:null)}}return i}function ec(i,o,l,m,v){let b=0,S=i.length;if(-1===o)S=-1;else for(;b<i.length;){const L=i[b++];if("number"==typeof L){if(L===o){S=-1;break}if(L>o){S=b-1;break}}}for(;b<i.length;){const L=i[b];if("number"==typeof L)break;if(L===l){if(null===m)return void(null!==v&&(i[b+1]=v));if(m===i[b+1])return void(i[b+2]=v)}b++,null!==m&&b++,null!==v&&b++}-1!==S&&(i.splice(S,0,o),b=S+1),i.splice(b++,0,l),null!==m&&i.splice(b++,0,m),null!==v&&i.splice(b++,0,v)}function Ca(i){return i!==G}function Sa(i){return 32767&i}function eo(i,o){let l=function tc(i){return i>>16}(i),m=o;for(;l>0;)m=m[Ki],l--;return m}let ja=!0;function pl(i){const o=ja;return ja=i,o}const Ll=255,Pc=5;let Rc=0;const fa={};function Fl(i,o){const l=nc(i,o);if(-1!==l)return l;const m=o[Lt];m.firstCreatePass&&(i.injectorIndex=o.length,ml(m.data,i),ml(o,null),ml(m.blueprint,null));const v=kc(i,o),b=i.injectorIndex;if(Ca(v)){const S=Sa(v),L=eo(v,o),z=L[Lt].data;for(let Z=0;Z<8;Z++)o[b+Z]=L[S+Z]|z[S+Z]}return o[b+8]=v,b}function ml(i,o){i.push(0,0,0,0,0,0,0,0,o)}function nc(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function kc(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let l=0,m=null,v=o;for(;null!==v;){if(m=yl(v),null===m)return G;if(l++,v=v[Ki],-1!==m.injectorIndex)return m.injectorIndex|l<<16}return G}function gl(i,o,l){!function Ol(i,o,l){let m;"string"==typeof l?m=l.charCodeAt(0)||0:l.hasOwnProperty(dn)&&(m=l[dn]),null==m&&(m=l[dn]=Rc++);const v=m&Ll;o.data[i+(v>>Pc)]|=1<<v}(i,o,l)}function _l(i,o,l){if(l&In.Optional||void 0!==i)return i;Bt()}function rc(i,o,l,m){if(l&In.Optional&&void 0===m&&(m=null),!(l&(In.Self|In.Host))){const v=i[br],b=xn(void 0);try{return v?v.get(o,m,l&In.Optional):gt(o,m,l&In.Optional)}finally{xn(b)}}return _l(m,0,l)}function zl(i,o,l,m=In.Default,v){if(null!==i){if(1024&o[Zn]){const S=function Rs(i,o,l,m,v){let b=i,S=o;for(;null!==b&&null!==S&&1024&S[Zn]&&!(256&S[Zn]);){const L=ts(b,S,l,m|In.Self,fa);if(L!==fa)return L;let z=b.parent;if(!z){const Z=S[Hr];if(Z){const le=Z.get(l,fa,m);if(le!==fa)return le}z=yl(S),S=S[Ki]}b=z}return v}(i,o,l,m,fa);if(S!==fa)return S}const b=ts(i,o,l,m,fa);if(b!==fa)return b}return rc(o,l,m,v)}function ts(i,o,l,m,v){const b=function Lc(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(dn)?i[dn]:void 0;return"number"==typeof o?o>=0?o&Ll:dh:o}(l);if("function"==typeof b){if(!mn(o,i,m))return m&In.Host?_l(v,0,m):rc(o,l,m,v);try{const S=b(m);if(null!=S||m&In.Optional)return S;Bt()}finally{Xn()}}else if("number"==typeof b){let S=null,L=nc(i,o),z=G,Z=m&In.Host?o[si][Yr]:null;for((-1===L||m&In.SkipSelf)&&(z=-1===L?kc(i,o):o[L+8],z!==G&&hh(m,!1)?(S=o[Lt],L=Sa(z),o=eo(z,o)):L=-1);-1!==L;){const le=o[Lt];if(Lo(b,L,le.data)){const Te=Ru(L,o,l,S,m,Z);if(Te!==fa)return Te}z=o[L+8],z!==G&&hh(m,o[Lt].data[L+8]===Z)&&Lo(b,L,o)?(S=le,L=Sa(z),o=eo(z,o)):L=-1}}return v}function Ru(i,o,l,m,v,b){const S=o[Lt],L=S.data[i+8],le=Va(L,S,l,null==m?Ko(L)&&ja:m!=S&&0!=(3&L.type),v&In.Host&&b===L);return null!==le?tl(o,S,le,L):fa}function Va(i,o,l,m,v){const b=i.providerIndexes,S=o.data,L=1048575&b,z=i.directiveStart,le=b>>20,je=v?L+le:i.directiveEnd;for(let et=m?L:L+le;et<je;et++){const Pt=S[et];if(et<z&&l===Pt||et>=z&&Pt.type===l)return et}if(v){const et=S[z];if(et&&Ji(et)&&et.type===l)return z}return null}function tl(i,o,l,m){let v=i[l];const b=o.data;if(function $e(i){return i instanceof _e}(v)){const S=v;S.resolving&&function _n(i,o){const l=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new Ye(-200,`Circular dependency in DI detected for ${i}${l}`)}(function sn(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():pt(i)}(b[l]));const L=pl(S.canSeeViewProviders);S.resolving=!0;const z=S.injectImpl?xn(S.injectImpl):null;mn(i,m,In.Default);try{v=i[l]=S.factory(void 0,b,i,m),o.firstCreatePass&&l>=m.directiveStart&&function X(i,o,l){const{ngOnChanges:m,ngOnInit:v,ngDoCheck:b}=o.type.prototype;if(m){const S=gr(o);(l.preOrderHooks||(l.preOrderHooks=[])).push(i,S),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(i,S)}v&&(l.preOrderHooks||(l.preOrderHooks=[])).push(0-i,v),b&&((l.preOrderHooks||(l.preOrderHooks=[])).push(i,b),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(i,b))}(l,b[l],o)}finally{null!==z&&xn(z),pl(L),S.resolving=!1,Xn()}}return v}function Lo(i,o,l){return!!(l[o+(i>>Pc)]&1<<i)}function hh(i,o){return!(i&In.Self||i&In.Host&&o)}class Bl{constructor(o,l){this._tNode=o,this._lView=l}get(o,l,m){return zl(this._tNode,this._lView,o,On(m),l)}}function dh(){return new Bl($i(),Ft())}function ic(i){return se(()=>{const o=i.prototype.constructor,l=o[hn]||na(o),m=Object.prototype;let v=Object.getPrototypeOf(i.prototype).constructor;for(;v&&v!==m;){const b=v[hn]||na(v);if(b&&b!==l)return b;v=Object.getPrototypeOf(v)}return b=>new b})}function na(i){return Gn(i)?()=>{const o=na(jt(i));return o&&o()}:po(i)}function yl(i){const o=i[Lt],l=o.type;return 2===l?o.declTNode:1===l?i[Yr]:null}function qo(i){return function nu(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const l=i.attrs;if(l){const m=l.length;let v=0;for(;v<m;){const b=l[v];if(Ui(b))break;if(0===b)v+=2;else if("number"==typeof b)for(v++;v<m&&"string"==typeof l[v];)v++;else{if(b===o)return l[v+1];v+=2}}}return null}($i(),i)}const fn="__parameters__";function $a(i,o,l){return se(()=>{const m=function vl(i){return function(...l){if(i){const m=i(...l);for(const v in m)this[v]=m[v]}}}(o);function v(...b){if(this instanceof v)return m.apply(this,b),this;const S=new v(...b);return L.annotation=S,L;function L(z,Z,le){const Te=z.hasOwnProperty(fn)?z[fn]:Object.defineProperty(z,fn,{value:[]})[fn];for(;Te.length<=le;)Te.push(null);return(Te[le]=Te[le]||[]).push(S),z}}return l&&(v.prototype=Object.create(l.prototype)),v.prototype.ngMetadataName=i,v.annotationCls=v,v})}class di{constructor(o,l){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof l?this.__NG_ELEMENT_ID__=l:void 0!==l&&(this.\u0275prov=Tn({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function il(i,o){i.forEach(l=>Array.isArray(l)?il(l,o):o(l))}function au(i,o,l){o>=i.length?i.push(l):i.splice(o,0,l)}function lc(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}function ol(i,o){const l=[];for(let m=0;m<i;m++)l.push(o);return l}function a(i,o,l){let m=d(i,o);return m>=0?i[1|m]=l:(m=~m,function r(i,o,l,m){let v=i.length;if(v==o)i.push(l,m);else if(1===v)i.push(m,i[0]),i[0]=l;else{for(v--,i.push(i[v-1],i[v]);v>o;)i[v]=i[v-2],v--;i[o]=l,i[o+1]=m}}(i,m,o,l)),m}function f(i,o){const l=d(i,o);if(l>=0)return i[1|l]}function d(i,o){return function x(i,o,l){let m=0,v=i.length>>l;for(;v!==m;){const b=m+(v-m>>1),S=i[b<<l];if(o===S)return b<<l;S>o?v=b:m=b+1}return~(v<<l)}(i,o,1)}const te=H($a("Optional"),8),ye=H($a("SkipSelf"),4);var qs=(()=>((qs=qs||{})[qs.Important=1]="Important",qs[qs.DashCase=2]="DashCase",qs))();const al=new Map;let zc=0;const ld="__ngContext__";function Zs(i,o){ki(o)?(i[ld]=o[Ri],function cf(i){al.set(i[Ri],i)}(o)):i[ld]=o}let fh;function zu(i,o){return fh(i,o)}function Bc(i){const o=i[Nr];return Vr(o)?o[Nr]:o}function ff(i){return hm(i[wi])}function pf(i){return hm(i[$n])}function hm(i){for(;null!==i&&!Vr(i);)i=i[$n];return i}function Nc(i,o,l,m,v){if(null!=m){let b,S=!1;Vr(m)?b=m:ki(m)&&(S=!0,m=m[Fn]);const L=hi(m);0===i&&null!==l?null==v?mh(o,l,L):Ia(o,l,L,v||null,!0):1===i&&null!==l?Ia(o,l,L,v||null,!0):2===i?function dd(i,o,l){const m=Aa(i,o);m&&function fm(i,o,l,m){i.removeChild(o,l,m)}(i,m,o,l)}(o,L,S):3===i&&o.destroyNode(L),null!=b&&function mm(i,o,l,m,v){const b=l[Ns];b!==hi(l)&&Nc(o,i,m,b,v);for(let L=Ni;L<l.length;L++){const z=l[L];Vl(z[Lt],z,i,o,m,b)}}(o,i,b,l,v)}}function Ga(i,o,l){return i.createElement(o,l)}function dm(i,o){const l=i[ti],m=l.indexOf(o),v=o[Nr];512&o[Zn]&&(o[Zn]&=-513,wo(v,-1)),l.splice(m,1)}function hd(i,o){if(i.length<=Ni)return;const l=Ni+o,m=i[l];if(m){const v=m[so];null!==v&&v!==i&&dm(v,m),o>0&&(i[l-1][$n]=m[$n]);const b=lc(i,Ni+o);!function Uc(i,o){Vl(i,o,o[Ln],2,null,null),o[Fn]=null,o[Yr]=null}(m[Lt],m);const S=b[Bi];null!==S&&S.detachView(b[Lt]),m[Nr]=null,m[$n]=null,m[Zn]&=-65}return m}function ph(i,o){if(!(128&o[Zn])){const l=o[Ln];l.destroyNode&&Vl(i,o,l,3,null,null),function Ng(i){let o=i[wi];if(!o)return Ha(i[Lt],i);for(;o;){let l=null;if(ki(o))l=o[wi];else{const m=o[Ni];m&&(l=m)}if(!l){for(;o&&!o[$n]&&o!==i;)ki(o)&&Ha(o[Lt],o),o=o[Nr];null===o&&(o=i),ki(o)&&Ha(o[Lt],o),l=o&&o[$n]}o=l}}(o)}}function Ha(i,o){if(!(128&o[Zn])){o[Zn]&=-65,o[Zn]|=128,function $g(i,o){let l;if(null!=i&&null!=(l=i.destroyHooks))for(let m=0;m<l.length;m+=2){const v=o[l[m]];if(!(v instanceof _e)){const b=l[m+1];if(Array.isArray(b))for(let S=0;S<b.length;S+=2){const L=v[b[S]],z=b[S+1];Qi(4,L,z);try{z.call(L)}finally{Qi(5,L,z)}}else{Qi(4,v,b);try{b.call(v)}finally{Qi(5,v,b)}}}}}(i,o),function Vg(i,o){const l=i.cleanup,m=o[Co];let v=-1;if(null!==l)for(let b=0;b<l.length-1;b+=2)if("string"==typeof l[b]){const S=l[b+3];S>=0?m[v=S]():m[v=-S].unsubscribe(),b+=2}else{const S=m[v=l[b+1]];l[b].call(S)}if(null!==m){for(let b=v+1;b<m.length;b++)(0,m[b])();o[Co]=null}}(i,o),1===o[Lt].type&&o[Ln].destroy();const l=o[so];if(null!==l&&Vr(o[Nr])){l!==o[Nr]&&dm(l,o);const m=o[Bi];null!==m&&m.detachView(i)}!function tm(i){al.delete(i[Ri])}(o)}}function mo(i,o,l){return function er(i,o,l){let m=o;for(;null!==m&&40&m.type;)m=(o=m).parent;if(null===m)return l[Fn];{const{componentOffset:v}=m;if(v>-1){const{encapsulation:b}=i.data[m.directiveStart+v];if(b===q.None||b===q.Emulated)return null}return Qn(m,l)}}(i,o.parent,l)}function Ia(i,o,l,m,v){i.insertBefore(o,l,m,v)}function mh(i,o,l){i.appendChild(o,l)}function ga(i,o,l,m,v){null!==m?Ia(i,o,l,m,v):mh(i,o,l)}function Aa(i,o){return i.parentNode(o)}function Vc(i,o,l){return $c(i,o,l)}let gh,gf,Eh,$c=function Bu(i,o,l){return 40&i.type?Qn(i,l):null};function yh(i,o,l,m){const v=mo(i,m,o),b=o[Ln],L=Vc(m.parent||o[Yr],m,o);if(null!=v)if(Array.isArray(l))for(let z=0;z<l.length;z++)ga(b,v,l[z],L,!1);else ga(b,v,l,L,!1);void 0!==gh&&gh(b,m,o,l,v)}function vh(i,o){if(null!==o){const l=o.type;if(3&l)return Qn(o,i);if(4&l)return xh(-1,i[o.index]);if(8&l){const m=o.child;if(null!==m)return vh(i,m);{const v=i[o.index];return Vr(v)?xh(-1,v):hi(v)}}if(32&l)return zu(o,i)()||hi(i[o.index]);{const m=pm(i,o);return null!==m?Array.isArray(m)?m[0]:vh(Bc(i[si]),m):vh(i,o.next)}}return null}function pm(i,o){return null!==o?i[si][Yr].projection[o.projection]:null}function xh(i,o){const l=Ni+i+1;if(l<o.length){const m=o[l],v=m[Lt].firstChild;if(null!==v)return vh(m,v)}return o[Ns]}function du(i,o,l,m,v,b,S){for(;null!=l;){const L=m[l.index],z=l.type;if(S&&0===o&&(L&&Zs(hi(L),m),l.flags|=2),32!=(32&l.flags))if(8&z)du(i,o,l.child,m,v,b,!1),Nc(o,i,v,L,b);else if(32&z){const Z=zu(l,m);let le;for(;le=Z();)Nc(o,i,v,le,b);Nc(o,i,v,L,b)}else 16&z?fd(i,o,m,l,v,b):Nc(o,i,v,L,b);l=S?l.projectionNext:l.next}}function Vl(i,o,l,m,v,b){du(l,m,i.firstChild,o,v,b,!1)}function fd(i,o,l,m,v,b){const S=l[si],z=S[Yr].projection[m.projection];if(Array.isArray(z))for(let Z=0;Z<z.length;Z++)Nc(o,i,v,z[Z],b);else du(i,o,z,S[Nr],v,b,!0)}function Pa(i,o,l){""===l?i.removeAttribute(o,"class"):i.setAttribute(o,"class",l)}function Nu(i,o,l){const{mergedAttrs:m,classes:v,styles:b}=l;null!==m&&Hi(i,o,m),null!==v&&Pa(i,o,v),null!==b&&function bh(i,o,l){i.setAttribute(o,"style",l)}(i,o,b)}function Hg(i){gf=i}function xf(i){return function fc(){if(void 0===Eh&&(Eh=null,yr.trustedTypes))try{Eh=yr.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return Eh}()?.createScriptURL(i)||i}class wf{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Or})`}}function $l(i){return i instanceof wf?i.changingThisBreaksApplicationSecurity:i}function fu(i,o){const l=function bf(i){return i instanceof wf&&i.getTypeName()||null}(i);if(null!=l&&l!==o){if("ResourceURL"===l&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${l} (see ${Or})`)}return l===o}const Xg=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var Zo=(()=>((Zo=Zo||{})[Zo.NONE=0]="NONE",Zo[Zo.HTML=1]="HTML",Zo[Zo.STYLE=2]="STYLE",Zo[Zo.SCRIPT=3]="SCRIPT",Zo[Zo.URL=4]="URL",Zo[Zo.RESOURCE_URL=5]="RESOURCE_URL",Zo))();function Cl(i){const o=mu();return o?o.sanitize(Zo.URL,i)||"":fu(i,"URL")?$l(i):function Dh(i){return(i=String(i)).match(Xg)?i:"unsafe:"+i}(pt(i))}function Sl(i){const o=mu();if(o)return xf(o.sanitize(Zo.RESOURCE_URL,i)||"");if(fu(i,"ResourceURL"))return xf($l(i));throw new Ye(904,!1)}function ys(i,o,l){return function Tm(i,o){return"src"===o&&("embed"===i||"frame"===i||"iframe"===i||"media"===i||"script"===i)||"href"===o&&("base"===i||"link"===i)?Sl:Cl}(o,l)(i)}function mu(){const i=Ft();return i&&i[ls]}const yd=new di("ENVIRONMENT_INITIALIZER"),vd=new di("INJECTOR",-1),Dm=new di("INJECTOR_DEF_TYPES");class xd{get(o,l=Pi){if(l===Pi){const m=new Error(`NullInjectorError: No provider for ${Ct(o)}!`);throw m.name="NullInjectorError",m}return l}}function Cm(i){return{\u0275providers:i}}function Qg(...i){return{\u0275providers:Gl(0,i),\u0275fromNgModule:!0}}function Gl(i,...o){const l=[],m=new Set;let v;return il(o,b=>{const S=b;$u(S,l,[],m)&&(v||(v=[]),v.push(S))}),void 0!==v&&Wc(v,l),l}function Wc(i,o){for(let l=0;l<i.length;l++){const{providers:v}=i[l];Ah(v,b=>{o.push(b)})}}function $u(i,o,l,m){if(!(i=jt(i)))return!1;let v=null,b=vi(i);const S=!b&&Wn(i);if(b||S){if(S&&!S.standalone)return!1;v=i}else{const z=i.ngModule;if(b=vi(z),!b)return!1;v=z}const L=m.has(v);if(S){if(L)return!1;if(m.add(v),S.dependencies){const z="function"==typeof S.dependencies?S.dependencies():S.dependencies;for(const Z of z)$u(Z,o,l,m)}}else{if(!b)return!1;{if(null!=b.imports&&!L){let Z;m.add(v);try{il(b.imports,le=>{$u(le,o,l,m)&&(Z||(Z=[]),Z.push(le))})}finally{}void 0!==Z&&Wc(Z,o)}if(!L){const Z=po(v)||(()=>new v);o.push({provide:v,useFactory:Z,deps:pe},{provide:Dm,useValue:v,multi:!0},{provide:yd,useValue:()=>Le(v),multi:!0})}const z=b.providers;null==z||L||Ah(z,le=>{o.push(le)})}}return v!==i&&void 0!==i.providers}function Ah(i,o){for(let l of i)st(l)&&(l=l.\u0275providers),Array.isArray(l)?Ah(l,o):o(l)}const Sm=nt({provide:String,useValue:nt});function Pf(i){return null!==i&&"object"==typeof i&&Sm in i}function mc(i){return"function"==typeof i}const Ph=new di("Set Injector scope."),Rh={},Im={};let gc;function kh(){return void 0===gc&&(gc=new xd),gc}class gu{}class _u extends gu{get destroyed(){return this._destroyed}constructor(o,l,m,v){super(),this.parent=l,this.source=m,this.scopes=v,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,kf(o,S=>this.processProvider(S)),this.records.set(vd,Hu(void 0,this)),v.has("environment")&&this.records.set(gu,Hu(void 0,this));const b=this.records.get(Ph);null!=b&&"string"==typeof b.value&&this.scopes.add(b.value),this.injectorDefTypes=new Set(this.get(Dm.multi,pe,In.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const l=_t(this),m=xn(void 0);try{return o()}finally{_t(l),xn(m)}}get(o,l=Pi,m=In.Default){this.assertNotDestroyed(),m=On(m);const v=_t(this),b=xn(void 0);try{if(!(m&In.SkipSelf)){let L=this.records.get(o);if(void 0===L){const z=function Lm(i){return"function"==typeof i||"object"==typeof i&&i instanceof di}(o)&&ei(o);L=z&&this.injectableDefInScope(z)?Hu(Gu(o),Rh):null,this.records.set(o,L)}if(null!=L)return this.hydrate(o,L)}return(m&In.Self?kh():this.parent).get(o,l=m&In.Optional&&l===Pi?null:l)}catch(S){if("NullInjectorError"===S.name){if((S[ho]=S[ho]||[]).unshift(Ct(o)),v)throw S;return function fe(i,o,l,m){const v=i[ho];throw o[ii]&&v.unshift(o[ii]),i.message=function Ee(i,o,l,m=null){i=i&&"\n"===i.charAt(0)&&i.charAt(1)==Vi?i.slice(2):i;let v=Ct(o);if(Array.isArray(o))v=o.map(Ct).join(" -> ");else if("object"==typeof o){let b=[];for(let S in o)if(o.hasOwnProperty(S)){let L=o[S];b.push(S+":"+("string"==typeof L?JSON.stringify(L):Ct(L)))}v=`{${b.join(", ")}}`}return`${l}${m?"("+m+")":""}[${v}]: ${i.replace(ro,"\n  ")}`}("\n"+i.message,v,l,m),i[vr]=v,i[ho]=null,i}(S,o,"R3InjectorError",this.source)}throw S}finally{xn(b),_t(v)}}resolveInjectorInitializers(){const o=_t(this),l=xn(void 0);try{const m=this.get(yd.multi,pe,In.Self);for(const v of m)v()}finally{_t(o),xn(l)}}toString(){const o=[],l=this.records;for(const m of l.keys())o.push(Ct(m));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ye(205,!1)}processProvider(o){let l=mc(o=jt(o))?o:jt(o&&o.provide);const m=function Pm(i){return Pf(i)?Hu(void 0,i.useValue):Hu(Rm(i),Rh)}(o);if(mc(o)||!0!==o.multi)this.records.get(l);else{let v=this.records.get(l);v||(v=Hu(void 0,Rh,!0),v.factory=()=>he(v.multi),this.records.set(l,v)),l=o,v.multi.push(o)}this.records.set(l,m)}hydrate(o,l){return l.value===Rh&&(l.value=Im,l.value=l.factory()),"object"==typeof l.value&&l.value&&function t_(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}injectableDefInScope(o){if(!o.providedIn)return!1;const l=jt(o.providedIn);return"string"==typeof l?"any"===l||this.scopes.has(l):this.injectorDefTypes.has(l)}}function Gu(i){const o=ei(i),l=null!==o?o.factory:po(i);if(null!==l)return l;if(i instanceof di)throw new Ye(204,!1);if(i instanceof Function)return function Am(i){const o=i.length;if(o>0)throw ol(o,"?"),new Ye(204,!1);const l=function vn(i){const o=i&&(i[Kr]||i[Bo]);return o?(function sr(i){if(i.hasOwnProperty("name"))return i.name;(""+i).match(/^function\s*([^\s(]+)/)}(i),o):null}(i);return null!==l?()=>l.factory(i):()=>new i}(i);throw new Ye(204,!1)}function Rm(i,o,l){let m;if(mc(i)){const v=jt(i);return po(v)||Gu(v)}if(Pf(i))m=()=>jt(i.useValue);else if(function Mm(i){return!(!i||!i.useFactory)}(i))m=()=>i.useFactory(...he(i.deps||[]));else if(function Rf(i){return!(!i||!i.useExisting)}(i))m=()=>Le(jt(i.useExisting));else{const v=jt(i&&(i.useClass||i.provide));if(!function km(i){return!!i.deps}(i))return po(v)||Gu(v);m=()=>new v(...he(i.deps))}return m}function Hu(i,o,l=!1){return{factory:i,value:o,multi:l?[]:void 0}}function kf(i,o){for(const l of i)Array.isArray(l)?kf(l,o):l&&st(l)?kf(l.\u0275providers,o):o(l)}class n_{}class Lf{}class _c{resolveComponentFactory(o){throw function Om(i){const o=Error(`No component factory found for ${Ct(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let zs=(()=>{class i{}return i.NULL=new _c,i})();function r_(){return qc($i(),Ft())}function qc(i,o){return new Lh(Qn(i,o))}let Lh=(()=>{class i{constructor(l){this.nativeElement=l}}return i.__NG_ELEMENT_ID__=r_,i})();function i_(i){return i instanceof Lh?i.nativeElement:i}class zm{}let Wu=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function wd(){const i=Ft(),l=Wr($i().index,i);return(ki(l)?l:i)[Ln]}(),i})(),Bm=(()=>{class i{}return i.\u0275prov=Tn({token:i,providedIn:"root",factory:()=>null}),i})();class Zc{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const Oh=new Zc("15.2.5"),Ff={},zf="ngOriginalError";function Bf(i){return i[zf]}class Fh{constructor(){this._console=console}handleError(o){const l=this._findOriginalError(o);this._console.error("ERROR",o),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(o){let l=o&&Bf(o);for(;l&&Bf(l);)l=Bf(l);return l||null}}function Hl(i){return i instanceof Function?i():i}function Cd(i,o,l){let m=i.length;for(;;){const v=i.indexOf(o,l);if(-1===v)return v;if(0===v||i.charCodeAt(v-1)<=32){const b=o.length;if(v+b===m||i.charCodeAt(v+b)<=32)return v}l=v+1}}const Sd="ng-template";function h_(i,o,l){let m=0,v=!0;for(;m<i.length;){let b=i[m++];if("string"==typeof b&&v){const S=i[m++];if(l&&"class"===b&&-1!==Cd(S.toLowerCase(),o,0))return!0}else{if(1===b){for(;m<i.length&&"string"==typeof(b=i[m++]);)if(b.toLowerCase()===o)return!0;return!1}"number"==typeof b&&(v=!1)}}return!1}function jf(i){return 4===i.type&&i.value!==Sd}function zh(i,o,l){return o===(4!==i.type||l?i.value:Sd)}function d_(i,o,l){let m=4;const v=i.attrs||[],b=function Id(i){for(let o=0;o<i.length;o++)if(Ui(i[o]))return o;return i.length}(v);let S=!1;for(let L=0;L<o.length;L++){const z=o[L];if("number"!=typeof z){if(!S)if(4&m){if(m=2|1&m,""!==z&&!zh(i,z,l)||""===z&&1===o.length){if(Za(m))return!1;S=!0}}else{const Z=8&m?z:o[++L];if(8&m&&null!==i.attrs){if(!h_(i.attrs,Z,l)){if(Za(m))return!1;S=!0}continue}const Te=f_(8&m?"class":z,v,jf(i),l);if(-1===Te){if(Za(m))return!1;S=!0;continue}if(""!==Z){let je;je=Te>b?"":v[Te+1].toLowerCase();const et=8&m?je:null;if(et&&-1!==Cd(et,Z,0)||2&m&&Z!==je){if(Za(m))return!1;S=!0}}}}else{if(!S&&!Za(m)&&!Za(z))return!1;if(S&&Za(z))continue;S=!1,m=z|1&m}}return Za(m)||S}function Za(i){return 0==(1&i)}function f_(i,o,l,m){if(null===o)return-1;let v=0;if(m||!l){let b=!1;for(;v<o.length;){const S=o[v];if(S===i)return v;if(3===S||6===S)b=!0;else{if(1===S||2===S){let L=o[++v];for(;"string"==typeof L;)L=o[++v];continue}if(4===S)break;if(0===S){v+=4;continue}}v+=b?1:2}return-1}return function p_(i,o){let l=i.indexOf(4);if(l>-1)for(l++;l<i.length;){const m=i[l];if("number"==typeof m)return-1;if(m===o)return l;l++}return-1}(o,i)}function Md(i,o,l=!1){for(let m=0;m<o.length;m++)if(d_(i,o[m],l))return!0;return!1}function m_(i,o){e:for(let l=0;l<o.length;l++){const m=o[l];if(i.length===m.length){for(let v=0;v<i.length;v++)if(i[v]!==m[v])continue e;return!0}}return!1}function Nm(i,o){return i?":not("+o.trim()+")":o}function g_(i){let o=i[0],l=1,m=2,v="",b=!1;for(;l<i.length;){let S=i[l];if("string"==typeof S)if(2&m){const L=i[++l];v+="["+S+(L.length>0?'="'+L+'"':"")+"]"}else 8&m?v+="."+S:4&m&&(v+=" "+S);else""!==v&&!Za(S)&&(o+=Nm(b,v),v=""),m=S,b=b||!Za(m);l++}return""!==v&&(o+=Nm(b,v)),o}const Er={};function Um(i){$f(ar(),Ft(),Pr()+i,!1)}function $f(i,o,l,m){if(!m)if(3==(3&o[Zn])){const b=i.preOrderCheckHooks;null!==b&&ae(o,b,l)}else{const b=i.preOrderHooks;null!==b&&Se(o,b,0,l)}qr(l)}function Ad(i,o=null,l=null,m){const v=Bh(i,o,l,m);return v.resolveInjectorInitializers(),v}function Bh(i,o=null,l=null,m,v=new Set){const b=[l||pe,Qg(i)];return m=m||("object"==typeof i?void 0:Ct(i)),new _u(b,o||kh(),m||null,v)}let Wl=(()=>{class i{static create(l,m){if(Array.isArray(l))return Ad({name:""},m,l,"");{const v=l.name??"";return Ad({name:v},l.parent,l.providers,v)}}}return i.THROW_IF_NOT_FOUND=Pi,i.NULL=new xd,i.\u0275prov=Tn({token:i,providedIn:"any",factory:()=>Le(vd)}),i.__NG_ELEMENT_ID__=-1,i})();function vc(i,o=In.Default){const l=Ft();return null===l?Le(i,o):zl($i(),l,jt(i),o)}function Zm(){throw new Error("invalid")}function Jf(i,o){const l=i.contentQueries;if(null!==l)for(let m=0;m<l.length;m+=2){const b=l[m+1];if(-1!==b){const S=i.data[b];Qe(l[m]),S.contentQueries(2,o[b],b)}}}function Ld(i,o,l,m,v,b,S,L,z,Z,le){const Te=o.blueprint.slice();return Te[Fn]=v,Te[Zn]=76|m,(null!==le||i&&1024&i[Zn])&&(Te[Zn]|=1024),Gs(Te),Te[Nr]=Te[Ki]=i,Te[Jn]=l,Te[Es]=S||i&&i[Es],Te[Ln]=L||i&&i[Ln],Te[ls]=z||i&&i[ls]||null,Te[br]=Z||i&&i[br]||null,Te[Yr]=b,Te[Ri]=function em(){return zc++}(),Te[Hr]=le,Te[si]=2==o.type?i[si]:Te,Te}function Ku(i,o,l,m,v){let b=i.data[o];if(null===b)b=function Qf(i,o,l,m,v){const b=dl(),S=Vo(),z=i.data[o]=function R_(i,o,l,m,v,b){return{type:l,index:m,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:v,attrs:b,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,S?b:b&&b.parent,l,o,m,v);return null===i.firstChild&&(i.firstChild=z),null!==b&&(S?null==b.child&&null!==z.parent&&(b.child=z):null===b.next&&(b.next=z,z.prev=b)),z}(i,o,l,m,v),function M(){return tr.lFrame.inI18n}()&&(b.flags|=32);else if(64&b.type){b.type=l,b.value=m,b.attrs=v;const S=function Ps(){const i=tr.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();b.injectorIndex=null===S?-1:S.injectorIndex}return bo(b,!0),b}function jh(i,o,l,m){if(0===l)return-1;const v=o.length;for(let b=0;b<l;b++)o.push(m),i.blueprint.push(m),i.data.push(null);return v}function Od(i,o,l){gn(o);try{const m=i.viewQuery;null!==m&&Vd(1,m,l);const v=i.template;null!==v&&vs(i,o,v,1,l),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Jf(i,o),i.staticViewQueries&&Vd(2,i.viewQuery,l);const b=i.components;null!==b&&function A_(i,o){for(let l=0;l<o.length;l++)ap(i,o[l])}(o,b)}catch(m){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),m}finally{o[Zn]&=-5,pr()}}function Fd(i,o,l,m){const v=o[Zn];if(128!=(128&v)){gn(o);try{Gs(o),function fl(i){return tr.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==l&&vs(i,o,l,2,m);const S=3==(3&v);if(S){const Z=i.preOrderCheckHooks;null!==Z&&ae(o,Z,null)}else{const Z=i.preOrderHooks;null!==Z&&Se(o,Z,0,null),ot(o,0)}if(function Xa(i){for(let o=ff(i);null!==o;o=pf(o)){if(!o[ao])continue;const l=o[ti];for(let m=0;m<l.length;m++){const v=l[m];512&v[Zn]||wo(v[Nr],1),v[Zn]|=512}}}(o),function ng(i){for(let o=ff(i);null!==o;o=pf(o))for(let l=Ni;l<o.length;l++){const m=o[l],v=m[Lt];es(m)&&Fd(v,m,v.template,m[Jn])}}(o),null!==i.contentQueries&&Jf(i,o),S){const Z=i.contentCheckHooks;null!==Z&&ae(o,Z)}else{const Z=i.contentHooks;null!==Z&&Se(o,Z,1),ot(o,1)}!function Xm(i,o){const l=i.hostBindingOpCodes;if(null!==l)try{for(let m=0;m<l.length;m++){const v=l[m];if(v<0)qr(~v);else{const b=v,S=l[++m],L=l[++m];j(S,b),L(2,o[b])}}}finally{qr(-1)}}(i,o);const L=i.components;null!==L&&function Km(i,o){for(let l=0;l<o.length;l++)Gh(i,o[l])}(o,L);const z=i.viewQuery;if(null!==z&&Vd(2,z,m),S){const Z=i.viewCheckHooks;null!==Z&&ae(o,Z)}else{const Z=i.viewHooks;null!==Z&&Se(o,Z,2),ot(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[Zn]&=-41,512&o[Zn]&&(o[Zn]&=-513,wo(o[Nr],-1))}finally{pr()}}}function vs(i,o,l,m,v){const b=Pr(),S=2&m;try{qr(-1),S&&o.length>jr&&$f(i,o,jr,!1),Qi(S?2:0,v),l(m,v)}finally{qr(b),Qi(S?3:1,v)}}function ll(i,o,l){if(Ts(o)){const v=o.directiveEnd;for(let b=o.directiveStart;b<v;b++){const S=i.data[b];S.contentQueries&&S.contentQueries(1,l[b],b)}}}function Vh(i,o,l){Po()&&(function O_(i,o,l,m){const v=l.directiveStart,b=l.directiveEnd;Ko(l)&&function tg(i,o,l){const m=Qn(o,i),v=wu(l),b=i[Es],S=Ud(i,Ld(i,v,null,l.onPush?32:16,m,o,b,b.createRenderer(m,l),null,null,null));i[o.index]=S}(o,l,i.data[v+l.componentOffset]),i.firstCreatePass||Fl(l,o),Zs(m,o);const S=l.initialInputs;for(let L=v;L<b;L++){const z=i.data[L],Z=tl(o,i,L,l);Zs(Z,o),null!==S&&U_(0,L-v,Z,z,0,S),Ji(z)&&(Wr(l.index,o)[Jn]=tl(o,i,L,l))}}(i,o,l,Qn(l,o)),64==(64&l.flags)&&eg(i,o,l))}function Yu(i,o,l=Qn){const m=o.localNames;if(null!==m){let v=o.index+1;for(let b=0;b<m.length;b+=2){const S=m[b+1],L=-1===S?l(o,i):i[S];i[v++]=L}}}function wu(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=ep(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function ep(i,o,l,m,v,b,S,L,z,Z){const le=jr+m,Te=le+v,je=function P_(i,o){const l=[];for(let m=0;m<o;m++)l.push(m<i?null:Er);return l}(le,Te),et="function"==typeof Z?Z():Z;return je[Lt]={type:i,blueprint:je,template:l,queries:null,viewQuery:L,declTNode:o,data:je.slice().fill(null,le),bindingStartIndex:le,expandoStartIndex:Te,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof b?b():b,pipeRegistry:"function"==typeof S?S():S,firstChild:null,schemas:z,consts:et,incompleteFirstPass:!1}}function Ym(i,o,l,m){const v=$d(o);null===l?v.push(m):(v.push(l),i.firstCreatePass&&lp(i).push(m,v.length-1))}function Ju(i,o,l,m){for(let v in i)if(i.hasOwnProperty(v)){l=null===l?{}:l;const b=i[v];null===m?tp(l,o,v,b):m.hasOwnProperty(v)&&tp(l,o,m[v],b)}return l}function tp(i,o,l,m){i.hasOwnProperty(l)?i[l].push(o,m):i[l]=[o,m]}function ya(i,o,l,m,v,b,S,L){const z=Qn(o,l);let le,Z=o.inputs;!L&&null!=Z&&(le=Z[m])?(Il(i,l,le,m,v),Ko(o)&&np(l,o.index)):3&o.type&&(m=function Si(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(m),v=null!=S?S(v,o.value||"",m):v,b.setProperty(z,m,v))}function np(i,o){const l=Wr(o,i);16&l[Zn]||(l[Zn]|=32)}function Kc(i,o,l,m){if(Po()){const v=null===m?null:{"":-1},b=function z_(i,o){const l=i.directiveRegistry;let m=null,v=null;if(l)for(let b=0;b<l.length;b++){const S=l[b];if(Md(o,S.selectors,!1))if(m||(m=[]),Ji(S))if(null!==S.findHostDirectiveDefs){const L=[];v=v||new Map,S.findHostDirectiveDefs(S,L,v),m.unshift(...L,S),ip(i,o,L.length)}else m.unshift(S),ip(i,o,0);else v=v||new Map,S.findHostDirectiveDefs?.(S,m,v),m.push(S)}return null===m?null:[m,v]}(i,l);let S,L;null===b?S=L=null:[S,L]=b,null!==S&&rp(i,o,l,S,v,L),v&&function B_(i,o,l){if(o){const m=i.localNames=[];for(let v=0;v<o.length;v+=2){const b=l[o[v+1]];if(null==b)throw new Ye(-301,!1);m.push(o[v],b)}}}(l,m,v)}l.mergedAttrs=Wo(l.mergedAttrs,l.attrs)}function rp(i,o,l,m,v,b){for(let Z=0;Z<m.length;Z++)gl(Fl(l,o),i,m[Z].type);!function zd(i,o,l){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+l,i.providerIndexes=o}(l,i.data.length,m.length);for(let Z=0;Z<m.length;Z++){const le=m[Z];le.providersResolver&&le.providersResolver(le)}let S=!1,L=!1,z=jh(i,o,m.length,null);for(let Z=0;Z<m.length;Z++){const le=m[Z];l.mergedAttrs=Wo(l.mergedAttrs,le.hostAttrs),Qu(i,l,o,z,le),N_(z,le,v),null!==le.contentQueries&&(l.flags|=4),(null!==le.hostBindings||null!==le.hostAttrs||0!==le.hostVars)&&(l.flags|=64);const Te=le.type.prototype;!S&&(Te.ngOnChanges||Te.ngOnInit||Te.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(l.index),S=!0),!L&&(Te.ngOnChanges||Te.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(l.index),L=!0),z++}!function Jm(i,o,l){const v=o.directiveEnd,b=i.data,S=o.attrs,L=[];let z=null,Z=null;for(let le=o.directiveStart;le<v;le++){const Te=b[le],je=l?l.get(Te):null,Pt=je?je.outputs:null;z=Ju(Te.inputs,le,z,je?je.inputs:null),Z=Ju(Te.outputs,le,Z,Pt);const on=null===z||null===S||jf(o)?null:sp(z,le,S);L.push(on)}null!==z&&(z.hasOwnProperty("class")&&(o.flags|=8),z.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=L,o.inputs=z,o.outputs=Z}(i,l,b)}function eg(i,o,l){const m=l.directiveStart,v=l.directiveEnd,b=l.index,S=function ne(){return tr.lFrame.currentDirectiveIndex}();try{qr(b);for(let L=m;L<v;L++){const z=i.data[L],Z=o[L];ge(L),(null!==z.hostBindings||0!==z.hostVars||null!==z.hostAttrs)&&F_(z,Z)}}finally{qr(-1),ge(S)}}function F_(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function ip(i,o,l){o.componentOffset=l,(i.components||(i.components=[])).push(o.index)}function N_(i,o,l){if(l){if(o.exportAs)for(let m=0;m<o.exportAs.length;m++)l[o.exportAs[m]]=i;Ji(o)&&(l[""]=i)}}function Qu(i,o,l,m,v){i.data[m]=v;const b=v.factory||(v.factory=po(v.type)),S=new _e(b,Ji(v),vc);i.blueprint[m]=S,l[m]=S,function k_(i,o,l,m,v){const b=v.hostBindings;if(b){let S=i.hostBindingOpCodes;null===S&&(S=i.hostBindingOpCodes=[]);const L=~o.index;(function L_(i){let o=i.length;for(;o>0;){const l=i[--o];if("number"==typeof l&&l<0)return l}return 0})(S)!=L&&S.push(L),S.push(l,m,b)}}(i,o,m,jh(i,l,v.hostVars,Er),v)}function ql(i,o,l,m,v,b){const S=Qn(i,o);!function op(i,o,l,m,v,b,S){if(null==b)i.removeAttribute(o,v,l);else{const L=null==S?pt(b):S(b,m||"",v);i.setAttribute(o,v,L,l)}}(o[Ln],S,b,i.value,l,m,v)}function U_(i,o,l,m,v,b){const S=b[o];if(null!==S){const L=m.setInput;for(let z=0;z<S.length;){const Z=S[z++],le=S[z++],Te=S[z++];null!==L?m.setInput(l,Te,Z,le):l[le]=Te}}}function sp(i,o,l){let m=null,v=0;for(;v<l.length;){const b=l[v];if(0!==b)if(5!==b){if("number"==typeof b)break;if(i.hasOwnProperty(b)){null===m&&(m=[]);const S=i[b];for(let L=0;L<S.length;L+=2)if(S[L]===o){m.push(b,S[L+1],l[v+1]);break}}v+=2}else v+=2;else v+=4}return m}function Bd(i,o,l,m){return[i,!0,!1,o,null,0,m,l,null,null]}function Gh(i,o){const l=Wr(o,i);if(es(l)){const m=l[Lt];48&l[Zn]?Fd(m,l,m.template,l[Jn]):l[oo]>0&&Yc(l)}}function Yc(i){for(let m=ff(i);null!==m;m=pf(m))for(let v=Ni;v<m.length;v++){const b=m[v];if(es(b))if(512&b[Zn]){const S=b[Lt];Fd(S,b,S.template,b[Jn])}else b[oo]>0&&Yc(b)}const l=i[Lt].components;if(null!==l)for(let m=0;m<l.length;m++){const v=Wr(l[m],i);es(v)&&v[oo]>0&&Yc(v)}}function ap(i,o){const l=Wr(o,i),m=l[Lt];(function Nd(i,o){for(let l=o.length;l<i.blueprint.length;l++)o.push(i.blueprint[l])})(m,l),Od(m,l,l[Jn])}function Ud(i,o){return i[wi]?i[Ys][$n]=o:i[wi]=o,i[Ys]=o,o}function jd(i){for(;i;){i[Zn]|=32;const o=Bc(i);if(Yo(i)&&!o)return i;i=o}return null}function Hh(i,o,l,m=!0){const v=o[Es];v.begin&&v.begin();try{Fd(i,o,i.template,l)}catch(S){throw m&&cp(o,S),S}finally{v.end&&v.end()}}function Vd(i,o,l){Qe(0),o(i,l)}function $d(i){return i[Co]||(i[Co]=[])}function lp(i){return i.cleanup||(i.cleanup=[])}function cp(i,o){const l=i[br],m=l?l.get(Fh,null):null;m&&m.handleError(o)}function Il(i,o,l,m,v){for(let b=0;b<l.length;){const S=l[b++],L=l[b++],z=o[S],Z=i.data[S];null!==Z.setInput?Z.setInput(z,v,m,L):z[L]=v}}function Wh(i,o,l){let m=l?i.styles:null,v=l?i.classes:null,b=0;if(null!==o)for(let S=0;S<o.length;S++){const L=o[S];"number"==typeof L?b=L:1==b?v=jn(v,L):2==b&&(m=jn(m,L+": "+o[++S]+";"))}l?i.styles=m:i.stylesWithoutHost=m,l?i.classes=v:i.classesWithoutHost=v}function qh(i,o,l,m,v=!1){for(;null!==l;){const b=o[l.index];if(null!==b&&m.push(hi(b)),Vr(b))for(let L=Ni;L<b.length;L++){const z=b[L],Z=z[Lt].firstChild;null!==Z&&qh(z[Lt],z,Z,m)}const S=l.type;if(8&S)qh(i,o,l.child,m);else if(32&S){const L=zu(l,o);let z;for(;z=L();)m.push(z)}else if(16&S){const L=pm(o,l);if(Array.isArray(L))m.push(...L);else{const z=Bc(o[si]);qh(z[Lt],z,L,m,!0)}}l=v?l.projectionNext:l.next}return m}class eh{get rootNodes(){const o=this._lView,l=o[Lt];return qh(l,o,l.firstChild,[])}constructor(o,l){this._lView=o,this._cdRefInjectingView=l,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Jn]}set context(o){this._lView[Jn]=o}get destroyed(){return 128==(128&this._lView[Zn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Nr];if(Vr(o)){const l=o[Js],m=l?l.indexOf(this):-1;m>-1&&(hd(o,m),lc(l,m))}this._attachedToViewContainer=!1}ph(this._lView[Lt],this._lView)}onDestroy(o){Ym(this._lView[Lt],this._lView,null,o)}markForCheck(){jd(this._cdRefInjectingView||this._lView)}detach(){this._lView[Zn]&=-65}reattach(){this._lView[Zn]|=64}detectChanges(){Hh(this._lView[Lt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ye(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function hu(i,o){Vl(i,o,o[Ln],2,null,null)}(this._lView[Lt],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Ye(902,!1);this._appRef=o}}class V_ extends eh{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Hh(o[Lt],o,o[Jn],!1)}checkNoChanges(){}get context(){return null}}class ig extends zs{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const l=Wn(o);return new th(l,this.ngModule)}}function up(i){const o=[];for(let l in i)i.hasOwnProperty(l)&&o.push({propName:i[l],templateName:l});return o}class Zh{constructor(o,l){this.injector=o,this.parentInjector=l}get(o,l,m){m=On(m);const v=this.injector.get(o,Ff,m);return v!==Ff||l===Ff?v:this.parentInjector.get(o,l,m)}}class th extends Lf{get inputs(){return up(this.componentDef.inputs)}get outputs(){return up(this.componentDef.outputs)}constructor(o,l){super(),this.componentDef=o,this.ngModule=l,this.componentType=o.type,this.selector=function __(i){return i.map(g_).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!l}create(o,l,m,v){let b=(v=v||this.ngModule)instanceof gu?v:v?.injector;b&&null!==this.componentDef.getStandaloneInjector&&(b=this.componentDef.getStandaloneInjector(b)||b);const S=b?new Zh(o,b):o,L=S.get(zm,null);if(null===L)throw new Ye(407,!1);const z=S.get(Bm,null),Z=L.createRenderer(null,this.componentDef),le=this.componentDef.selectors[0][0]||"div",Te=m?function $h(i,o,l){return i.selectRootElement(o,l===q.ShadowDom)}(Z,m,this.componentDef.encapsulation):Ga(Z,le,function og(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(le)),je=this.componentDef.onPush?288:272,et=ep(0,null,null,1,0,null,null,null,null,null),Pt=Ld(null,et,null,je,null,null,L,Z,z,S,null);let on,En;gn(Pt);try{const zn=this.componentDef;let cr,Jt=null;zn.findHostDirectiveDefs?(cr=[],Jt=new Map,zn.findHostDirectiveDefs(zn,cr,Jt),cr.push(zn)):cr=[zn];const Lr=function nh(i,o){const l=i[Lt],m=jr;return i[m]=o,Ku(l,m,2,"#host",null)}(Pt,Te),zo=function lg(i,o,l,m,v,b,S,L){const z=v[Lt];!function Gd(i,o,l,m){for(const v of i)o.mergedAttrs=Wo(o.mergedAttrs,v.hostAttrs);null!==o.mergedAttrs&&(Wh(o,o.mergedAttrs,!0),null!==l&&Nu(m,l,o))}(m,i,o,S);const Z=b.createRenderer(o,l),le=Ld(v,wu(l),null,l.onPush?32:16,v[i.index],i,b,Z,L||null,null,null);return z.firstCreatePass&&ip(z,i,m.length-1),Ud(v,le),v[i.index]=le}(Lr,Te,zn,cr,Pt,L,Z);En=Ua(et,jr),Te&&function Hd(i,o,l,m){if(m)Hi(i,l,["ng-version",Oh.full]);else{const{attrs:v,classes:b}=function y_(i){const o=[],l=[];let m=1,v=2;for(;m<i.length;){let b=i[m];if("string"==typeof b)2===v?""!==b&&o.push(b,i[++m]):8===v&&l.push(b);else{if(!Za(v))break;v=b}m++}return{attrs:o,classes:l}}(o.selectors[0]);v&&Hi(i,l,v),b&&b.length>0&&Pa(i,l,b.join(" "))}}(Z,zn,Te,m),void 0!==l&&function Wd(i,o,l){const m=i.projection=[];for(let v=0;v<o.length;v++){const b=l[v];m.push(null!=b?Array.from(b):null)}}(En,this.ngContentSelectors,l),on=function cg(i,o,l,m,v,b){const S=$i(),L=v[Lt],z=Qn(S,v);rp(L,v,S,l,null,m);for(let le=0;le<l.length;le++)Zs(tl(v,L,S.directiveStart+le,S),v);eg(L,v,S),z&&Zs(z,v);const Z=tl(v,L,S.directiveStart+S.componentOffset,S);if(i[Jn]=v[Jn]=Z,null!==b)for(const le of b)le(Z,o);return ll(L,S,i),Z}(zo,zn,cr,Jt,Pt,[$_]),Od(et,Pt,null)}finally{pr()}return new sg(this.componentType,on,qc(En,Pt),Pt,En)}}class sg extends n_{constructor(o,l,m,v,b){super(),this.location=m,this._rootLView=v,this._tNode=b,this.instance=l,this.hostView=this.changeDetectorRef=new V_(v),this.componentType=o}setInput(o,l){const m=this._tNode.inputs;let v;if(null!==m&&(v=m[o])){const b=this._rootLView;Il(b[Lt],b,v,o,l),np(b,this._tNode.index)}}get injector(){return new Bl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function $_(){const i=$i();N(Ft()[Lt],i)}function hp(i){let o=function ug(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),l=!0;const m=[i];for(;o;){let v;if(Ji(i))v=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Ye(903,!1);v=o.\u0275dir}if(v){if(l){m.push(v);const S=i;S.inputs=dp(i.inputs),S.declaredInputs=dp(i.declaredInputs),S.outputs=dp(i.outputs);const L=v.hostBindings;L&&H_(i,L);const z=v.viewQuery,Z=v.contentQueries;if(z&&rh(i,z),Z&&fp(i,Z),yt(i.inputs,v.inputs),yt(i.declaredInputs,v.declaredInputs),yt(i.outputs,v.outputs),Ji(v)&&v.data.animation){const le=i.data;le.animation=(le.animation||[]).concat(v.data.animation)}}const b=v.features;if(b)for(let S=0;S<b.length;S++){const L=b[S];L&&L.ngInherit&&L(i),L===hp&&(l=!1)}}o=Object.getPrototypeOf(o)}!function G_(i){let o=0,l=null;for(let m=i.length-1;m>=0;m--){const v=i[m];v.hostVars=o+=v.hostVars,v.hostAttrs=Wo(v.hostAttrs,l=Wo(l,v.hostAttrs))}}(m)}function dp(i){return i===re?{}:i===pe?[]:i}function rh(i,o){const l=i.viewQuery;i.viewQuery=l?(m,v)=>{o(m,v),l(m,v)}:o}function fp(i,o){const l=i.contentQueries;i.contentQueries=l?(m,v,b)=>{o(m,v,b),l(m,v,b)}:o}function H_(i,o){const l=i.hostBindings;i.hostBindings=l?(m,v)=>{o(m,v),l(m,v)}:o}function Xh(i){return!!Xl(i)&&(Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i)}function Xl(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function ka(i,o,l){return i[o]=l}function wc(i,o){return i[o]}function ns(i,o,l){return!Object.is(i[o],l)&&(i[o]=l,!0)}function Al(i,o,l,m){const v=ns(i,o,l);return ns(i,o+1,m)||v}function cl(i,o,l,m,v,b){const S=Al(i,o,l,m);return Al(i,o+2,v,b)||S}function _p(i,o,l,m){const v=Ft();return ns(v,Go(),o)&&(ar(),ql(Sr(),v,i,o,l,m)),_p}function bc(i,o,l,m){return ns(i,Go(),l)?o+pt(l)+m:Er}function _g(i,o,l,m,v,b,S,L){const z=Ft(),Z=ar(),le=i+jr,Te=Z.firstCreatePass?function Jc(i,o,l,m,v,b,S,L,z){const Z=o.consts,le=Ku(o,i,4,S||null,Is(Z,L));Kc(o,l,le,Is(Z,z)),N(o,le);const Te=le.tView=ep(2,le,m,v,b,o.directiveRegistry,o.pipeRegistry,null,o.schemas,Z);return null!==o.queries&&(o.queries.template(o,le),Te.queries=o.queries.embeddedTView(le)),le}(le,Z,z,o,l,m,v,b,S):Z.data[le];bo(Te,!1);const je=z[Ln].createComment("");yh(Z,z,je,Te),Zs(je,z),Ud(z,z[le]=Bd(je,z,je,Te)),So(Te)&&Vh(Z,z,Te),null!=S&&Yu(z,Te,L)}function wp(i){return function jo(i,o){return i[o]}(function ds(){return tr.lFrame.contextLView}(),jr+i)}function ah(i,o,l){const m=Ft();return ns(m,Go(),o)&&ya(ar(),Sr(),m,i,o,m[Ln],l,!1),ah}function bp(i,o,l,m,v){const S=v?"class":"style";Il(i,l,o.inputs[S],S,m)}function Xd(i,o,l,m){const v=Ft(),b=ar(),S=jr+i,L=v[Ln],z=b.firstCreatePass?function K_(i,o,l,m,v,b){const S=o.consts,z=Ku(o,i,2,m,Is(S,v));return Kc(o,l,z,Is(S,b)),null!==z.attrs&&Wh(z,z.attrs,!1),null!==z.mergedAttrs&&Wh(z,z.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,z),z}(S,b,v,o,l,m):b.data[S],Z=v[S]=Ga(L,o,function F(){return tr.lFrame.currentNamespace}()),le=So(z);return bo(z,!0),Nu(L,Z,z),32!=(32&z.flags)&&yh(b,v,Z,z),0===function ea(){return tr.lFrame.elementDepthCount}()&&Zs(Z,v),function bi(){tr.lFrame.elementDepthCount++}(),le&&(Vh(b,v,z),ll(b,z,v)),null!==m&&Yu(v,z),Xd}function Kd(){let i=$i();Vo()?$o():(i=i.parent,bo(i,!1));const o=i;!function Ea(){tr.lFrame.elementDepthCount--}();const l=ar();return l.firstCreatePass&&(N(l,i),Ts(i)&&l.queries.elementEnd(i)),null!=o.classesWithoutHost&&function mt(i){return 0!=(8&i.flags)}(o)&&bp(l,o,Ft(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function ai(i){return 0!=(16&i.flags)}(o)&&bp(l,o,Ft(),o.stylesWithoutHost,!1),Kd}function Qh(i,o,l,m){return Xd(i,o,l,m),Kd(),Qh}function Mu(i,o,l){const m=Ft(),v=ar(),b=i+jr,S=v.firstCreatePass?function Y_(i,o,l,m,v){const b=o.consts,S=Is(b,m),L=Ku(o,i,8,"ng-container",S);return null!==S&&Wh(L,S,!0),Kc(o,l,L,Is(b,v)),null!==o.queries&&o.queries.elementStart(o,L),L}(b,v,m,o,l):v.data[b];bo(S,!0);const L=m[b]=m[Ln].createComment("");return yh(v,m,L,S),Zs(L,m),So(S)&&(Vh(v,m,S),ll(v,S,m)),null!=l&&Yu(m,S),Mu}function Ep(){let i=$i();const o=ar();return Vo()?$o():(i=i.parent,bo(i,!1)),o.firstCreatePass&&(N(o,i),Ts(i)&&o.queries.elementEnd(i)),Ep}function Tp(i,o,l){return Mu(i,o,l),Ep(),Tp}function Dp(){return Ft()}function Cp(i){return!!i&&"function"==typeof i.then}function Sp(i){return!!i&&"function"==typeof i.subscribe}const Ka=Sp;function ul(i,o,l,m){const v=Ft(),b=ar(),S=$i();return function Tc(i,o,l,m,v,b,S){const L=So(m),Z=i.firstCreatePass&&lp(i),le=o[Jn],Te=$d(o);let je=!0;if(3&m.type||S){const on=Qn(m,o),En=S?S(on):on,zn=Te.length,cr=S?Lr=>S(hi(Lr[m.index])):m.index;let Jt=null;if(!S&&L&&(Jt=function Kl(i,o,l,m){const v=i.cleanup;if(null!=v)for(let b=0;b<v.length-1;b+=2){const S=v[b];if(S===l&&v[b+1]===m){const L=o[Co],z=v[b+2];return L.length>z?L[z]:null}"string"==typeof S&&(b+=2)}return null}(i,o,v,m.index)),null!==Jt)(Jt.__ngLastListenerFn__||Jt).__ngNextListenerFn__=b,Jt.__ngLastListenerFn__=b,je=!1;else{b=Mp(m,o,le,b,!1);const Lr=l.listen(En,v,b);Te.push(b,Lr),Z&&Z.push(v,cr,zn,zn+1)}}else b=Mp(m,o,le,b,!1);const et=m.outputs;let Pt;if(je&&null!==et&&(Pt=et[v])){const on=Pt.length;if(on)for(let En=0;En<on;En+=2){const zo=o[Pt[En]][Pt[En+1]].subscribe(b),bs=Te.length;Te.push(b,zo),Z&&Z.push(v,m.index,bs,-(bs+1))}}}(b,v,v[Ln],S,i,o,m),ul}function ed(i,o,l,m){try{return Qi(6,o,l),!1!==l(m)}catch(v){return cp(i,v),!1}finally{Qi(7,o,l)}}function Mp(i,o,l,m,v){return function b(S){if(S===Function)return m;jd(i.componentOffset>-1?Wr(i.index,o):o);let z=ed(o,l,m,S),Z=b.__ngNextListenerFn__;for(;Z;)z=ed(o,l,Z,S)&&z,Z=Z.__ngNextListenerFn__;return v&&!1===z&&(S.preventDefault(),S.returnValue=!1),z}}function Ip(i=1){return function Br(i){return(tr.lFrame.contextLView=function Jr(i,o){for(;i>0;)o=o[Ki],i--;return o}(i,tr.lFrame.contextLView))[Jn]}(i)}function yg(i,o){let l=null;const m=function Vf(i){const o=i.attrs;if(null!=o){const l=o.indexOf(5);if(!(1&l))return o[l+1]}return null}(i);for(let v=0;v<o.length;v++){const b=o[v];if("*"!==b){if(null===m?Md(i,b,!0):m_(m,b))return v}else l=v}return l}function Yd(i){const o=Ft()[si][Yr];if(!o.projection){const m=o.projection=ol(i?i.length:1,null),v=m.slice();let b=o.child;for(;null!==b;){const S=i?yg(b,i):0;null!==S&&(v[S]?v[S].projectionNext=b:m[S]=b,v[S]=b),b=b.next}}}function vg(i,o=0,l){const m=Ft(),v=ar(),b=Ku(v,jr+i,16,null,l||null);null===b.projection&&(b.projection=o),$o(),32!=(32&b.flags)&&function dc(i,o,l){fd(o[Ln],0,o,l,mo(i,l,o),Vc(l.parent||o[Yr],l,o))}(v,m,b)}function Jd(i,o,l){return Qd(i,"",o,"",l),Jd}function Qd(i,o,l,m,v){const b=Ft(),S=bc(b,o,l,m);return S!==Er&&ya(ar(),Sr(),b,i,S,b[Ln],v,!1),Qd}function ef(i,o){return i<<17|o<<2}function Ya(i){return i>>17&32767}function hl(i){return 2|i}function Cc(i){return(131068&i)>>2}function nd(i,o){return-131069&i|o<<2}function Sc(i){return 1|i}function Bp(i,o,l,m,v){const b=i[l+1],S=null===o;let L=m?Ya(b):Cc(b),z=!1;for(;0!==L&&(!1===z||S);){const le=i[L+1];xg(i[L],o)&&(z=!0,i[L+1]=m?Sc(le):hl(le)),L=m?Ya(le):Cc(le)}z&&(i[l+1]=m?hl(b):Sc(b))}function xg(i,o){return null===i||null==o||(Array.isArray(i)?i[1]:i)===o||!(!Array.isArray(i)||"string"!=typeof o)&&d(i,o)>=0}const xs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Np(i){return i.substring(xs.key,xs.keyEnd)}function wg(i){return i.substring(xs.value,xs.valueEnd)}function nf(i,o){const l=xs.textEnd;return l===o?-1:(o=xs.keyEnd=function n(i,o,l){for(;o<l&&i.charCodeAt(o)>32;)o++;return o}(i,xs.key=o,l),e(i,o,l))}function Up(i,o){const l=xs.textEnd;let m=xs.key=e(i,o,l);return l===m?-1:(m=xs.keyEnd=function s(i,o,l){let m;for(;o<l&&(45===(m=i.charCodeAt(o))||95===m||(-33&m)>=65&&(-33&m)<=90||m>=48&&m<=57);)o++;return o}(i,m,l),m=h(i,m,l),m=xs.value=e(i,m,l),m=xs.valueEnd=function g(i,o,l){let m=-1,v=-1,b=-1,S=o,L=S;for(;S<l;){const z=i.charCodeAt(S++);if(59===z)return L;34===z||39===z?L=S=_(i,z,S,l):o===S-4&&85===b&&82===v&&76===m&&40===z?L=S=_(i,41,S,l):z>32&&(L=S),b=v,v=m,m=-33&z}return L}(i,m,l),h(i,m,l))}function t(i){xs.key=0,xs.keyEnd=0,xs.value=0,xs.valueEnd=0,xs.textEnd=i.length}function e(i,o,l){for(;o<l&&i.charCodeAt(o)<=32;)o++;return o}function h(i,o,l,m){return(o=e(i,o,l))<l&&o++,o}function _(i,o,l,m){let v=-1,b=l;for(;b<m;){const S=i.charCodeAt(b++);if(S==o&&92!==v)return b;v=92==S&&92===v?0:S}throw new Error}function D(i,o){return function $(i,o,l,m){const v=Ft(),b=ar(),S=Q(2);b.firstUpdatePass&&xe(b,i,S,m),o!==Er&&ns(v,S,o)&&it(b,b.data[Pr()],v,v[Ln],i,v[S+1]=function Ot(i,o){return null==i||""===i||("string"==typeof o?i+=o:"object"==typeof i&&(i=Ct($l(i)))),i}(o,l),m,S)}(i,o,null,!0),D}function P(i){J(vt,O,i,!1)}function O(i,o){for(let l=function bg(i){return t(i),Up(i,e(i,0,xs.textEnd))}(o);l>=0;l=Up(o,l))vt(i,Np(o),wg(o))}function B(i){J(a,V,i,!0)}function V(i,o){for(let l=function ey(i){return t(i),nf(i,e(i,0,xs.textEnd))}(o);l>=0;l=nf(o,l))a(i,Np(o),!0)}function J(i,o,l,m){const v=ar(),b=Q(2);v.firstUpdatePass&&xe(v,null,b,m);const S=Ft();if(l!==Er&&ns(S,b,l)){const L=v.data[Pr()];if(Ut(L,m)&&!ue(v,b)){let z=m?L.classesWithoutHost:L.stylesWithoutHost;null!==z&&(l=jn(z,l||"")),bp(v,L,S,l,m)}else!function Nt(i,o,l,m,v,b,S,L){v===Er&&(v=pe);let z=0,Z=0,le=0<v.length?v[0]:null,Te=0<b.length?b[0]:null;for(;null!==le||null!==Te;){const je=z<v.length?v[z+1]:void 0,et=Z<b.length?b[Z+1]:void 0;let on,Pt=null;le===Te?(z+=2,Z+=2,je!==et&&(Pt=Te,on=et)):null===Te||null!==le&&le<Te?(z+=2,Pt=le):(Z+=2,Pt=Te,on=et),null!==Pt&&it(i,o,l,m,Pt,on,S,L),le=z<v.length?v[z]:null,Te=Z<b.length?b[Z]:null}}(v,L,S,S[Ln],S[b+1],S[b+1]=function qe(i,o,l){if(null==l||""===l)return pe;const m=[],v=$l(l);if(Array.isArray(v))for(let b=0;b<v.length;b++)i(m,v[b],!0);else if("object"==typeof v)for(const b in v)v.hasOwnProperty(b)&&i(m,b,v[b]);else"string"==typeof v&&o(m,v);return m}(i,o,l),m,b)}}function ue(i,o){return o>=i.expandoStartIndex}function xe(i,o,l,m){const v=i.data;if(null===v[l+1]){const b=v[Pr()],S=ue(i,l);Ut(b,m)&&null===o&&!S&&(o=!1),o=function Me(i,o,l,m){const v=function Oe(i){const o=tr.lFrame.currentDirectiveIndex;return-1===o?null:i[o]}(i);let b=m?o.residualClasses:o.residualStyles;if(null===v)0===(m?o.classBindings:o.styleBindings)&&(l=Xe(l=Pe(null,i,o,l,m),o.attrs,m),b=null);else{const S=o.directiveStylingLast;if(-1===S||i[S]!==v)if(l=Pe(v,i,o,l,m),null===b){let z=function ve(i,o,l){const m=l?o.classBindings:o.styleBindings;if(0!==Cc(m))return i[Ya(m)]}(i,o,m);void 0!==z&&Array.isArray(z)&&(z=Pe(null,i,o,z[1],m),z=Xe(z,o.attrs,m),function Ce(i,o,l,m){i[Ya(l?o.classBindings:o.styleBindings)]=m}(i,o,m,z))}else b=function ke(i,o,l){let m;const v=o.directiveEnd;for(let b=1+o.directiveStylingLast;b<v;b++)m=Xe(m,i[b].hostAttrs,l);return Xe(m,o.attrs,l)}(i,o,m)}return void 0!==b&&(m?o.residualClasses=b:o.residualStyles=b),l}(v,b,o,m),function rd(i,o,l,m,v,b){let S=b?o.classBindings:o.styleBindings,L=Ya(S),z=Cc(S);i[m]=l;let le,Z=!1;if(Array.isArray(l)?(le=l[1],(null===le||d(l,le)>0)&&(Z=!0)):le=l,v)if(0!==z){const je=Ya(i[L+1]);i[m+1]=ef(je,L),0!==je&&(i[je+1]=nd(i[je+1],m)),i[L+1]=function zp(i,o){return 131071&i|o<<17}(i[L+1],m)}else i[m+1]=ef(L,0),0!==L&&(i[L+1]=nd(i[L+1],m)),L=m;else i[m+1]=ef(z,0),0===L?L=m:i[z+1]=nd(i[z+1],m),z=m;Z&&(i[m+1]=hl(i[m+1])),Bp(i,le,m,!0),Bp(i,le,m,!1),function tf(i,o,l,m,v){const b=v?i.residualClasses:i.residualStyles;null!=b&&"string"==typeof o&&d(b,o)>=0&&(l[m+1]=Sc(l[m+1]))}(o,le,i,m,b),S=ef(L,z),b?o.classBindings=S:o.styleBindings=S}(v,b,o,l,S,m)}}function Pe(i,o,l,m,v){let b=null;const S=l.directiveEnd;let L=l.directiveStylingLast;for(-1===L?L=l.directiveStart:L++;L<S&&(b=o[L],m=Xe(m,b.hostAttrs,v),b!==i);)L++;return null!==i&&(l.directiveStylingLast=L),m}function Xe(i,o,l){const m=l?1:2;let v=-1;if(null!==o)for(let b=0;b<o.length;b++){const S=o[b];"number"==typeof S?v=S:v===m&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),a(i,S,!!l||o[++b]))}return void 0===i?null:i}function vt(i,o,l){a(i,o,$l(l))}function it(i,o,l,m,v,b,S,L){if(!(3&o.type))return;const z=i.data,Z=z[L+1],le=function Rl(i){return 1==(1&i)}(Z)?bt(z,o,l,v,Cc(Z),S):void 0;Tt(le)||(Tt(b)||function Fp(i){return 2==(2&i)}(Z)&&(b=bt(z,null,l,v,L,S)),function wh(i,o,l,m,v){if(o)v?i.addClass(l,m):i.removeClass(l,m);else{let b=-1===m.indexOf("-")?void 0:qs.DashCase;null==v?i.removeStyle(l,m,b):("string"==typeof v&&v.endsWith("!important")&&(v=v.slice(0,-10),b|=qs.Important),i.setStyle(l,m,v,b))}}(m,S,Ms(Pr(),l),v,b))}function bt(i,o,l,m,v,b){const S=null===o;let L;for(;v>0;){const z=i[v],Z=Array.isArray(z),le=Z?z[1]:z,Te=null===le;let je=l[v+1];je===Er&&(je=Te?pe:void 0);let et=Te?f(je,m):le===m?je:void 0;if(Z&&!Tt(et)&&(et=f(z,m)),Tt(et)&&(L=et,S))return L;const Pt=i[v+1];v=S?Ya(Pt):Cc(Pt)}if(null!==o){let z=b?o.residualClasses:o.residualStyles;null!=z&&(L=f(z,m))}return L}function Tt(i){return void 0!==i}function Ut(i,o){return 0!=(i.flags&(o?8:16))}function lt(i,o=""){const l=Ft(),m=ar(),v=i+jr,b=m.firstCreatePass?Ku(m,v,1,o,null):m.data[v],S=l[v]=function cu(i,o){return i.createText(o)}(l[Ln],o);yh(m,l,S,b),bo(b,!1)}function tn(i){return Un("",i,""),tn}function Un(i,o,l){const m=Ft(),v=bc(m,i,o,l);return v!==Er&&function Zl(i,o,l){const m=Ms(o,i);!function uu(i,o,l){i.setValue(o,l)}(i[Ln],m,l)}(m,Pr(),v),Un}const Qc=void 0;var Gp=["en",[["a","p"],["AM","PM"],Qc],[["AM","PM"],Qc,Qc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Qc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Qc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Qc,"{1} 'at' {0}",Qc],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function $p(i){const l=Math.floor(Math.abs(i)),m=i.toString().replace(/^[^.]*\.?/,"").length;return 1===l&&0===m?1:5}];let va={};function Mc(i){const o=function La(i){return i.toLowerCase().replace(/_/g,"-")}(i);let l=Ic(o);if(l)return l;const m=o.split("-")[0];if(l=Ic(m),l)return l;if("en"===m)return Gp;throw new Ye(701,!1)}function rf(i){return Mc(i)[dr.PluralCase]}function Ic(i){return i in va||(va[i]=yr.ng&&yr.ng.common&&yr.ng.common.locales&&yr.ng.common.locales[i]),va[i]}var dr=(()=>((dr=dr||{})[dr.LocaleId=0]="LocaleId",dr[dr.DayPeriodsFormat=1]="DayPeriodsFormat",dr[dr.DayPeriodsStandalone=2]="DayPeriodsStandalone",dr[dr.DaysFormat=3]="DaysFormat",dr[dr.DaysStandalone=4]="DaysStandalone",dr[dr.MonthsFormat=5]="MonthsFormat",dr[dr.MonthsStandalone=6]="MonthsStandalone",dr[dr.Eras=7]="Eras",dr[dr.FirstDayOfWeek=8]="FirstDayOfWeek",dr[dr.WeekendRange=9]="WeekendRange",dr[dr.DateFormat=10]="DateFormat",dr[dr.TimeFormat=11]="TimeFormat",dr[dr.DateTimeFormat=12]="DateTimeFormat",dr[dr.NumberSymbols=13]="NumberSymbols",dr[dr.NumberFormats=14]="NumberFormats",dr[dr.CurrencyCode=15]="CurrencyCode",dr[dr.CurrencySymbol=16]="CurrencySymbol",dr[dr.CurrencyName=17]="CurrencyName",dr[dr.Currencies=18]="Currencies",dr[dr.Directionality=19]="Directionality",dr[dr.PluralCase=20]="PluralCase",dr[dr.ExtraData=21]="ExtraData",dr))();const eu="en-US";let Vy=eu;function iy(i,o,l,m,v){if(i=jt(i),Array.isArray(i))for(let b=0;b<i.length;b++)iy(i[b],o,l,m,v);else{const b=ar(),S=Ft();let L=mc(i)?i:jt(i.provide),z=Rm(i);const Z=$i(),le=1048575&Z.providerIndexes,Te=Z.directiveStart,je=Z.providerIndexes>>20;if(mc(i)||!i.multi){const et=new _e(z,v,vc),Pt=sy(L,o,v?le:le+je,Te);-1===Pt?(gl(Fl(Z,S),b,L),oy(b,i,o.length),o.push(L),Z.directiveStart++,Z.directiveEnd++,v&&(Z.providerIndexes+=1048576),l.push(et),S.push(et)):(l[Pt]=et,S[Pt]=et)}else{const et=sy(L,o,le+je,Te),Pt=sy(L,o,le,le+je),En=Pt>=0&&l[Pt];if(v&&!En||!v&&!(et>=0&&l[et])){gl(Fl(Z,S),b,L);const zn=function zx(i,o,l,m,v){const b=new _e(i,l,vc);return b.multi=[],b.index=o,b.componentProviders=0,fv(b,v,m&&!l),b}(v?Fx:Ox,l.length,v,m,z);!v&&En&&(l[Pt].providerFactory=zn),oy(b,i,o.length,0),o.push(L),Z.directiveStart++,Z.directiveEnd++,v&&(Z.providerIndexes+=1048576),l.push(zn),S.push(zn)}else oy(b,i,et>-1?et:Pt,fv(l[v?Pt:et],z,!v&&m));!v&&m&&En&&l[Pt].componentProviders++}}}function oy(i,o,l,m){const v=mc(o),b=function e_(i){return!!i.useClass}(o);if(v||b){const z=(b?jt(o.useClass):o).prototype.ngOnDestroy;if(z){const Z=i.destroyHooks||(i.destroyHooks=[]);if(!v&&o.multi){const le=Z.indexOf(l);-1===le?Z.push(l,[m,z]):Z[le+1].push(m,z)}else Z.push(l,z)}}}function fv(i,o,l){return l&&i.componentProviders++,i.multi.push(o)-1}function sy(i,o,l,m){for(let v=l;v<m;v++)if(o[v]===i)return v;return-1}function Ox(i,o,l,m){return ay(this.multi,[])}function Fx(i,o,l,m){const v=this.multi;let b;if(this.providerFactory){const S=this.providerFactory.componentProviders,L=tl(l,l[Lt],this.providerFactory.index,m);b=L.slice(0,S),ay(v,b);for(let z=S;z<L.length;z++)b.push(L[z])}else b=[],ay(v,b);return b}function ay(i,o){for(let l=0;l<i.length;l++)o.push((0,i[l])());return o}function pv(i,o=[]){return l=>{l.providersResolver=(m,v)=>function Lx(i,o,l){const m=ar();if(m.firstCreatePass){const v=Ji(i);iy(l,m.data,m.blueprint,v,!0),iy(o,m.data,m.blueprint,v,!1)}}(m,v?v(i):i,o)}}class sf{}class mv{}function Bx(i,o){return new gv(i,o??null)}class gv extends sf{constructor(o,l){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ig(this);const m=Gr(o);this._bootstrapComponents=Hl(m.bootstrap),this._r3Injector=Bh(o,l,[{provide:sf,useValue:this},{provide:zs,useValue:this.componentFactoryResolver}],Ct(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class ly extends mv{constructor(o){super(),this.moduleType=o}create(o){return new gv(this.moduleType,o)}}class Nx extends sf{constructor(o,l,m){super(),this.componentFactoryResolver=new ig(this),this.instance=null;const v=new _u([...o,{provide:sf,useValue:this},{provide:zs,useValue:this.componentFactoryResolver}],l||kh(),m,new Set(["environment"]));this.injector=v,v.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function cy(i,o,l=null){return new Nx(i,o,l).injector}let Ux=(()=>{class i{constructor(l){this._injector=l,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(l){if(!l.standalone)return null;if(!this.cachedInjectors.has(l.id)){const m=Gl(0,l.type),v=m.length>0?cy([m],this._injector,`Standalone[${l.type.name}]`):null;this.cachedInjectors.set(l.id,v)}return this.cachedInjectors.get(l.id)}ngOnDestroy(){try{for(const l of this.cachedInjectors.values())null!==l&&l.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=Tn({token:i,providedIn:"environment",factory:()=>new i(Le(gu))}),i})();function _v(i){i.getStandaloneInjector=o=>o.get(Ux).getOrCreateStandaloneInjector(i)}function Tv(i,o,l){const m=Gi()+i,v=Ft();return v[m]===Er?ka(v,m,l?o.call(l):o()):wc(v,m)}function Dv(i,o,l,m){return function Av(i,o,l,m,v,b){const S=o+l;return ns(i,S,v)?ka(i,S+1,b?m.call(b,v):m(v)):Kp(i,S+1)}(Ft(),Gi(),i,o,l,m)}function Cv(i,o,l,m,v){return function Pv(i,o,l,m,v,b,S){const L=o+l;return Al(i,L,v,b)?ka(i,L+2,S?m.call(S,v,b):m(v,b)):Kp(i,L+2)}(Ft(),Gi(),i,o,l,m,v)}function Sv(i,o,l,m,v,b,S){return function kv(i,o,l,m,v,b,S,L,z){const Z=o+l;return cl(i,Z,v,b,S,L)?ka(i,Z+4,z?m.call(z,v,b,S,L):m(v,b,S,L)):Kp(i,Z+4)}(Ft(),Gi(),i,o,l,m,v,b,S)}function Mv(i,o,l,m,v,b,S,L){const z=Gi()+i,Z=Ft(),le=cl(Z,z,l,m,v,b);return ns(Z,z+4,S)||le?ka(Z,z+5,L?o.call(L,l,m,v,b,S):o(l,m,v,b,S)):wc(Z,z+5)}function Iv(i,o,l,m,v,b,S,L,z){const Z=Gi()+i,le=Ft(),Te=cl(le,Z,l,m,v,b);return Al(le,Z+4,S,L)||Te?ka(le,Z+6,z?o.call(z,l,m,v,b,S,L):o(l,m,v,b,S,L)):wc(le,Z+6)}function Kp(i,o){const l=i[o];return l===Er?void 0:l}function hy(i){return o=>{setTimeout(i,void 0,o)}}const tu=class sw extends W.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,l,m){let v=o,b=l||(()=>null),S=m;if(o&&"object"==typeof o){const z=o;v=z.next?.bind(z),b=z.error?.bind(z),S=z.complete?.bind(z)}this.__isAsync&&(b=hy(b),v&&(v=hy(v)),S&&(S=hy(S)));const L=super.subscribe({next:v,error:b,complete:S});return o instanceof ee.w0&&o.add(L),L}};function aw(){return this._results[Symbol.iterator]()}class dy{get changes(){return this._changes||(this._changes=new tu)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const l=dy.prototype;l[Symbol.iterator]||(l[Symbol.iterator]=aw)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,l){return this._results.reduce(o,l)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,l){const m=this;m.dirty=!1;const v=function Ws(i){return i.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function su(i,o,l){if(i.length!==o.length)return!1;for(let m=0;m<i.length;m++){let v=i[m],b=o[m];if(l&&(v=l(v),b=l(b)),b!==v)return!1}return!0}(m._results,v,l))&&(m._results=v,m.length=v.length,m.last=v[this.length-1],m.first=v[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Jp=(()=>{class i{}return i.__NG_ELEMENT_ID__=uw,i})();const lw=Jp,cw=class extends lw{constructor(o,l,m){super(),this._declarationLView=o,this._declarationTContainer=l,this.elementRef=m}createEmbeddedView(o,l){const m=this._declarationTContainer.tView,v=Ld(this._declarationLView,m,o,16,null,m.declTNode,null,null,null,null,l||null);v[so]=this._declarationLView[this._declarationTContainer.index];const S=this._declarationLView[Bi];return null!==S&&(v[Bi]=S.createEmbeddedView(m)),Od(m,v,o),new eh(v)}};function uw(){return Ig($i(),Ft())}function Ig(i,o){return 4&i.type?new cw(o,i,qc(i,o)):null}let Ag=(()=>{class i{}return i.__NG_ELEMENT_ID__=hw,i})();function hw(){return zv($i(),Ft())}const dw=Ag,Ov=class extends dw{constructor(o,l,m){super(),this._lContainer=o,this._hostTNode=l,this._hostLView=m}get element(){return qc(this._hostTNode,this._hostLView)}get injector(){return new Bl(this._hostTNode,this._hostLView)}get parentInjector(){const o=kc(this._hostTNode,this._hostLView);if(Ca(o)){const l=eo(o,this._hostLView),m=Sa(o);return new Bl(l[Lt].data[m+8],l)}return new Bl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const l=Fv(this._lContainer);return null!==l&&l[o]||null}get length(){return this._lContainer.length-Ni}createEmbeddedView(o,l,m){let v,b;"number"==typeof m?v=m:null!=m&&(v=m.index,b=m.injector);const S=o.createEmbeddedView(l||{},b);return this.insert(S,v),S}createComponent(o,l,m,v,b){const S=o&&!function Ul(i){return"function"==typeof i}(o);let L;if(S)L=l;else{const Te=l||{};L=Te.index,m=Te.injector,v=Te.projectableNodes,b=Te.environmentInjector||Te.ngModuleRef}const z=S?o:new th(Wn(o)),Z=m||this.parentInjector;if(!b&&null==z.ngModule){const je=(S?Z:this.parentInjector).get(gu,null);je&&(b=je)}const le=z.create(Z,v,void 0,b);return this.insert(le.hostView,L),le}insert(o,l){const m=o._lView,v=m[Lt];if(function Qa(i){return Vr(i[Nr])}(m)){const le=this.indexOf(o);if(-1!==le)this.detach(le);else{const Te=m[Nr],je=new Ov(Te,Te[Yr],Te[Nr]);je.detach(je.indexOf(o))}}const b=this._adjustIndex(l),S=this._lContainer;!function Ug(i,o,l,m){const v=Ni+m,b=l.length;m>0&&(l[v-1][$n]=o),m<b-Ni?(o[$n]=l[v],au(l,Ni+m,o)):(l.push(o),o[$n]=null),o[Nr]=l;const S=o[so];null!==S&&l!==S&&function jg(i,o){const l=i[ti];o[si]!==o[Nr][Nr][si]&&(i[ao]=!0),null===l?i[ti]=[o]:l.push(o)}(S,o);const L=o[Bi];null!==L&&L.insertView(i),o[Zn]|=64}(v,m,S,b);const L=xh(b,S),z=m[Ln],Z=Aa(z,S[Ns]);return null!==Z&&function jc(i,o,l,m,v,b){m[Fn]=v,m[Yr]=o,Vl(i,m,l,1,v,b)}(v,S[Yr],z,m,Z,L),o.attachToViewContainerRef(),au(fy(S),b,o),o}move(o,l){return this.insert(o,l)}indexOf(o){const l=Fv(this._lContainer);return null!==l?l.indexOf(o):-1}remove(o){const l=this._adjustIndex(o,-1),m=hd(this._lContainer,l);m&&(lc(fy(this._lContainer),l),ph(m[Lt],m))}detach(o){const l=this._adjustIndex(o,-1),m=hd(this._lContainer,l);return m&&null!=lc(fy(this._lContainer),l)?new eh(m):null}_adjustIndex(o,l=0){return o??this.length+l}};function Fv(i){return i[Js]}function fy(i){return i[Js]||(i[Js]=[])}function zv(i,o){let l;const m=o[i.index];if(Vr(m))l=m;else{let v;if(8&i.type)v=hi(m);else{const b=o[Ln];v=b.createComment("");const S=Qn(i,o);Ia(b,Aa(b,S),v,function mf(i,o){return i.nextSibling(o)}(b,S),!1)}o[i.index]=l=Bd(m,o,v,i),Ud(o,l)}return new Ov(l,i,o)}class py{constructor(o){this.queryList=o,this.matches=null}clone(){return new py(this.queryList)}setDirty(){this.queryList.setDirty()}}class my{constructor(o=[]){this.queries=o}createEmbeddedView(o){const l=o.queries;if(null!==l){const m=null!==o.contentQueries?o.contentQueries[0]:l.length,v=[];for(let b=0;b<m;b++){const S=l.getByIndex(b);v.push(this.queries[S.indexInDeclarationView].clone())}return new my(v)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let l=0;l<this.queries.length;l++)null!==Wv(o,l).matches&&this.queries[l].setDirty()}}class Bv{constructor(o,l,m=null){this.predicate=o,this.flags=l,this.read=m}}class gy{constructor(o=[]){this.queries=o}elementStart(o,l){for(let m=0;m<this.queries.length;m++)this.queries[m].elementStart(o,l)}elementEnd(o){for(let l=0;l<this.queries.length;l++)this.queries[l].elementEnd(o)}embeddedTView(o){let l=null;for(let m=0;m<this.length;m++){const v=null!==l?l.length:0,b=this.getByIndex(m).embeddedTView(o,v);b&&(b.indexInDeclarationView=m,null!==l?l.push(b):l=[b])}return null!==l?new gy(l):null}template(o,l){for(let m=0;m<this.queries.length;m++)this.queries[m].template(o,l)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class _y{constructor(o,l=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=l}elementStart(o,l){this.isApplyingToNode(l)&&this.matchTNode(o,l)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,l){this.elementStart(o,l)}embeddedTView(o,l){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,l),new _y(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const l=this._declarationNodeIndex;let m=o.parent;for(;null!==m&&8&m.type&&m.index!==l;)m=m.parent;return l===(null!==m?m.index:-1)}return this._appliesToNextNode}matchTNode(o,l){const m=this.metadata.predicate;if(Array.isArray(m))for(let v=0;v<m.length;v++){const b=m[v];this.matchTNodeWithReadOption(o,l,fw(l,b)),this.matchTNodeWithReadOption(o,l,Va(l,o,b,!1,!1))}else m===Jp?4&l.type&&this.matchTNodeWithReadOption(o,l,-1):this.matchTNodeWithReadOption(o,l,Va(l,o,m,!1,!1))}matchTNodeWithReadOption(o,l,m){if(null!==m){const v=this.metadata.read;if(null!==v)if(v===Lh||v===Ag||v===Jp&&4&l.type)this.addMatch(l.index,-2);else{const b=Va(l,o,v,!1,!1);null!==b&&this.addMatch(l.index,b)}else this.addMatch(l.index,m)}}addMatch(o,l){null===this.matches?this.matches=[o,l]:this.matches.push(o,l)}}function fw(i,o){const l=i.localNames;if(null!==l)for(let m=0;m<l.length;m+=2)if(l[m]===o)return l[m+1];return null}function mw(i,o,l,m){return-1===l?function pw(i,o){return 11&i.type?qc(i,o):4&i.type?Ig(i,o):null}(o,i):-2===l?function gw(i,o,l){return l===Lh?qc(o,i):l===Jp?Ig(o,i):l===Ag?zv(o,i):void 0}(i,o,m):tl(i,i[Lt],l,o)}function Nv(i,o,l,m){const v=o[Bi].queries[m];if(null===v.matches){const b=i.data,S=l.matches,L=[];for(let z=0;z<S.length;z+=2){const Z=S[z];L.push(Z<0?null:mw(o,b[Z],S[z+1],l.metadata.read))}v.matches=L}return v.matches}function yy(i,o,l,m){const v=i.queries.getByIndex(l),b=v.matches;if(null!==b){const S=Nv(i,o,v,l);for(let L=0;L<b.length;L+=2){const z=b[L];if(z>0)m.push(S[L/2]);else{const Z=b[L+1],le=o[-z];for(let Te=Ni;Te<le.length;Te++){const je=le[Te];je[so]===je[Nr]&&yy(je[Lt],je,Z,m)}if(null!==le[ti]){const Te=le[ti];for(let je=0;je<Te.length;je++){const et=Te[je];yy(et[Lt],et,Z,m)}}}}}return m}function Uv(i){const o=Ft(),l=ar(),m=ze();Qe(m+1);const v=Wv(l,m);if(i.dirty&&function ha(i){return 4==(4&i[Zn])}(o)===(2==(2&v.metadata.flags))){if(null===v.matches)i.reset([]);else{const b=v.crossesNgTemplate?yy(l,o,m,[]):Nv(l,o,v,m);i.reset(b,i_),i.notifyOnChanges()}return!0}return!1}function jv(i,o,l){const m=ar();m.firstCreatePass&&(Hv(m,new Bv(i,o,l),-1),2==(2&o)&&(m.staticViewQueries=!0)),Gv(m,Ft(),o)}function Vv(i,o,l,m){const v=ar();if(v.firstCreatePass){const b=$i();Hv(v,new Bv(o,l,m),b.index),function yw(i,o){const l=i.contentQueries||(i.contentQueries=[]);o!==(l.length?l[l.length-1]:-1)&&l.push(i.queries.length-1,o)}(v,i),2==(2&l)&&(v.staticContentQueries=!0)}Gv(v,Ft(),l)}function $v(){return function _w(i,o){return i[Bi].queries[o].queryList}(Ft(),ze())}function Gv(i,o,l){const m=new dy(4==(4&l));Ym(i,o,m,m.destroy),null===o[Bi]&&(o[Bi]=new my),o[Bi].queries.push(new py(m))}function Hv(i,o,l){null===i.queries&&(i.queries=new gy),i.queries.track(new _y(o,l))}function Wv(i,o){return i.queries.getByIndex(o)}function qv(i,o){return Ig(i,o)}function vy(i){return!!Gr(i)}function Rg(...i){}const d0=new di("Application Initializer");let kg=(()=>{class i{constructor(l){this.appInits=l,this.resolve=Rg,this.reject=Rg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((m,v)=>{this.resolve=m,this.reject=v})}runInitializers(){if(this.initialized)return;const l=[],m=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let v=0;v<this.appInits.length;v++){const b=this.appInits[v]();if(Cp(b))l.push(b);else if(Ka(b)){const S=new Promise((L,z)=>{b.subscribe({complete:L,error:z})});l.push(S)}}Promise.all(l).then(()=>{m()}).catch(v=>{this.reject(v)}),0===l.length&&m(),this.initialized=!0}}return i.\u0275fac=function(l){return new(l||i)(Le(d0,8))},i.\u0275prov=Tn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const f0=new di("AppId",{providedIn:"root",factory:function p0(){return`${Ty()}${Ty()}${Ty()}`}});function Ty(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const m0=new di("Platform Initializer"),Bw=new di("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Nw=new di("AnimationModuleType");let Uw=(()=>{class i{log(l){console.log(l)}warn(l){console.warn(l)}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=Tn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Lg=new di("LocaleId",{providedIn:"root",factory:()=>Rt(Lg,In.Optional|In.SkipSelf)||function jw(){return typeof $localize<"u"&&$localize.locale||eu}()}),Vw=new di("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class $w{constructor(o,l){this.ngModuleFactory=o,this.componentFactories=l}}let Gw=(()=>{class i{compileModuleSync(l){return new ly(l)}compileModuleAsync(l){return Promise.resolve(this.compileModuleSync(l))}compileModuleAndAllComponentsSync(l){const m=this.compileModuleSync(l),b=Hl(Gr(l).declarations).reduce((S,L)=>{const z=Wn(L);return z&&S.push(new th(z)),S},[]);return new $w(m,b)}compileModuleAndAllComponentsAsync(l){return Promise.resolve(this.compileModuleAndAllComponentsSync(l))}clearCache(){}clearCacheFor(l){}getModuleId(l){}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=Tn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const qw=(()=>Promise.resolve(0))();function Dy(i){typeof Zone>"u"?qw.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Ql{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:m=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tu(!1),this.onMicrotaskEmpty=new tu(!1),this.onStable=new tu(!1),this.onError=new tu(!1),typeof Zone>"u")throw new Ye(908,!1);Zone.assertZonePatched();const v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!m&&l,v.shouldCoalesceRunChangeDetection=m,v.lastRequestAnimationFrameId=-1,v.nativeRequestAnimationFrame=function Zw(){let i=yr.requestAnimationFrame,o=yr.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const l=i[Zone.__symbol__("OriginalDelegate")];l&&(i=l);const m=o[Zone.__symbol__("OriginalDelegate")];m&&(o=m)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Yw(i){const o=()=>{!function Kw(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(yr,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,Sy(i),i.isCheckStableRunning=!0,Cy(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),Sy(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,m,v,b,S,L)=>{try{return y0(i),l.invokeTask(v,b,S,L)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===b.type||i.shouldCoalesceRunChangeDetection)&&o(),v0(i)}},onInvoke:(l,m,v,b,S,L,z)=>{try{return y0(i),l.invoke(v,b,S,L,z)}finally{i.shouldCoalesceRunChangeDetection&&o(),v0(i)}},onHasTask:(l,m,v,b)=>{l.hasTask(v,b),m===v&&("microTask"==b.change?(i._hasPendingMicrotasks=b.microTask,Sy(i),Cy(i)):"macroTask"==b.change&&(i.hasPendingMacrotasks=b.macroTask))},onHandleError:(l,m,v,b)=>(l.handleError(v,b),i.runOutsideAngular(()=>i.onError.emit(b)),!1)})}(v)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ql.isInAngularZone())throw new Ye(909,!1)}static assertNotInAngularZone(){if(Ql.isInAngularZone())throw new Ye(909,!1)}run(o,l,m){return this._inner.run(o,l,m)}runTask(o,l,m,v){const b=this._inner,S=b.scheduleEventTask("NgZoneEvent: "+v,o,Xw,Rg,Rg);try{return b.runTask(S,l,m)}finally{b.cancelTask(S)}}runGuarded(o,l,m){return this._inner.runGuarded(o,l,m)}runOutsideAngular(o){return this._outer.run(o)}}const Xw={};function Cy(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Sy(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function y0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function v0(i){i._nesting--,Cy(i)}class Jw{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tu,this.onMicrotaskEmpty=new tu,this.onStable=new tu,this.onError=new tu}run(o,l,m){return o.apply(l,m)}runGuarded(o,l,m){return o.apply(l,m)}runOutsideAngular(o){return o()}runTask(o,l,m,v){return o.apply(l,m)}}const x0=new di(""),w0=new di("");let My,Qw=(()=>{class i{constructor(l,m,v){this._ngZone=l,this.registry=m,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,My||(function eb(i){My=i}(v),v.addToWindow(m)),this._watchAngularEvents(),l.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ql.assertNotInAngularZone(),Dy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Dy(()=>{for(;0!==this._callbacks.length;){let l=this._callbacks.pop();clearTimeout(l.timeoutId),l.doneCb(this._didWork)}this._didWork=!1});else{let l=this.getPendingTasks();this._callbacks=this._callbacks.filter(m=>!m.updateCb||!m.updateCb(l)||(clearTimeout(m.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(l=>({source:l.source,creationLocation:l.creationLocation,data:l.data})):[]}addCallback(l,m,v){let b=-1;m&&m>0&&(b=setTimeout(()=>{this._callbacks=this._callbacks.filter(S=>S.timeoutId!==b),l(this._didWork,this.getPendingTasks())},m)),this._callbacks.push({doneCb:l,timeoutId:b,updateCb:v})}whenStable(l,m,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(l,m,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(l){this.registry.registerApplication(l,this)}unregisterApplication(l){this.registry.unregisterApplication(l)}findProviders(l,m,v){return[]}}return i.\u0275fac=function(l){return new(l||i)(Le(Ql),Le(b0),Le(w0))},i.\u0275prov=Tn({token:i,factory:i.\u0275fac}),i})(),b0=(()=>{class i{constructor(){this._applications=new Map}registerApplication(l,m){this._applications.set(l,m)}unregisterApplication(l){this._applications.delete(l)}unregisterAllApplications(){this._applications.clear()}getTestability(l){return this._applications.get(l)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(l,m=!0){return My?.findTestabilityInTree(this,l,m)??null}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=Tn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Au=!1;let uh=null;const E0=new di("AllowMultipleToken"),Iy=new di("PlatformDestroyListeners"),T0=new di("appBootstrapListener");class rb{constructor(o,l){this.name=o,this.token=l}}function C0(i,o,l=[]){const m=`Platform: ${o}`,v=new di(m);return(b=[])=>{let S=Ay();if(!S||S.injector.get(E0,!1)){const L=[...l,...b,{provide:v,useValue:!0}];i?i(L):function ib(i){if(uh&&!uh.get(E0,!1))throw new Ye(400,!1);uh=i;const o=i.get(M0);(function D0(i){const o=i.get(m0,null);o&&o.forEach(l=>l())})(i)}(function S0(i=[],o){return Wl.create({name:o,providers:[{provide:Ph,useValue:"platform"},{provide:Iy,useValue:new Set([()=>uh=null])},...i]})}(L,m))}return function sb(i){const o=Ay();if(!o)throw new Ye(401,!1);return o}()}}function Ay(){return uh?.get(M0)??null}let M0=(()=>{class i{constructor(l){this._injector=l,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(l,m){const v=function A0(i,o){let l;return l="noop"===i?new Jw:("zone.js"===i?void 0:i)||new Ql(o),l}(m?.ngZone,function I0(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(m)),b=[{provide:Ql,useValue:v}];return v.run(()=>{const S=Wl.create({providers:b,parent:this.injector,name:l.moduleType.name}),L=l.create(S),z=L.injector.get(Fh,null);if(!z)throw new Ye(402,!1);return v.runOutsideAngular(()=>{const Z=v.onError.subscribe({next:le=>{z.handleError(le)}});L.onDestroy(()=>{Fg(this._modules,L),Z.unsubscribe()})}),function P0(i,o,l){try{const m=l();return Cp(m)?m.catch(v=>{throw o.runOutsideAngular(()=>i.handleError(v)),v}):m}catch(m){throw o.runOutsideAngular(()=>i.handleError(m)),m}}(z,v,()=>{const Z=L.injector.get(kg);return Z.runInitializers(),Z.donePromise.then(()=>(function $y(i){yn(i,"Expected localeId to be defined"),"string"==typeof i&&(Vy=i.toLowerCase().replace(/_/g,"-"))}(L.injector.get(Lg,eu)||eu),this._moduleDoBootstrap(L),L))})})}bootstrapModule(l,m=[]){const v=R0({},m);return function tb(i,o,l){const m=new ly(l);return Promise.resolve(m)}(0,0,l).then(b=>this.bootstrapModuleFactory(b,v))}_moduleDoBootstrap(l){const m=l.injector.get(Og);if(l._bootstrapComponents.length>0)l._bootstrapComponents.forEach(v=>m.bootstrap(v));else{if(!l.instance.ngDoBootstrap)throw new Ye(-403,!1);l.instance.ngDoBootstrap(m)}this._modules.push(l)}onDestroy(l){this._destroyListeners.push(l)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ye(404,!1);this._modules.slice().forEach(m=>m.destroy()),this._destroyListeners.forEach(m=>m());const l=this._injector.get(Iy,null);l&&(l.forEach(m=>m()),l.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(l){return new(l||i)(Le(Wl))},i.\u0275prov=Tn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function R0(i,o){return Array.isArray(o)?o.reduce(R0,i):{...i,...o}}let Og=(()=>{class i{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(l,m,v){this._zone=l,this._injector=m,this._exceptionHandler=v,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const b=new Ve.y(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),S=new Ve.y(L=>{let z;this._zone.runOutsideAngular(()=>{z=this._zone.onStable.subscribe(()=>{Ql.assertNotInAngularZone(),Dy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const Z=this._zone.onUnstable.subscribe(()=>{Ql.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{z.unsubscribe(),Z.unsubscribe()}});this.isStable=(0,u.T)(b,S.pipe(function wt(i={}){const{connector:o=(()=>new W.x),resetOnError:l=!0,resetOnComplete:m=!0,resetOnRefCountZero:v=!0}=i;return b=>{let S,L,z,Z=0,le=!1,Te=!1;const je=()=>{L?.unsubscribe(),L=void 0},et=()=>{je(),S=z=void 0,le=Te=!1},Pt=()=>{const on=S;et(),on?.unsubscribe()};return(0,St.e)((on,En)=>{Z++,!Te&&!le&&je();const zn=z=z??o();En.add(()=>{Z--,0===Z&&!Te&&!le&&(L=xt(Pt,v))}),zn.subscribe(En),!S&&Z>0&&(S=new Xt.Hp({next:cr=>zn.next(cr),error:cr=>{Te=!0,je(),L=xt(et,l,cr),zn.error(cr)},complete:()=>{le=!0,je(),L=xt(et,m),zn.complete()}}),(0,Ie.Xf)(on).subscribe(S))})(b)}}()))}bootstrap(l,m){const v=l instanceof Lf;if(!this._injector.get(kg).done){!v&&oi(l);throw new Ye(405,Au)}let S;S=v?l:this._injector.get(zs).resolveComponentFactory(l),this.componentTypes.push(S.componentType);const L=function nb(i){return i.isBoundToModule}(S)?void 0:this._injector.get(sf),Z=S.create(Wl.NULL,[],m||S.selector,L),le=Z.location.nativeElement,Te=Z.injector.get(x0,null);return Te?.registerApplication(le),Z.onDestroy(()=>{this.detachView(Z.hostView),Fg(this.components,Z),Te?.unregisterApplication(le)}),this._loadComponent(Z),Z}tick(){if(this._runningTick)throw new Ye(101,!1);try{this._runningTick=!0;for(let l of this._views)l.detectChanges()}catch(l){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(l))}finally{this._runningTick=!1}}attachView(l){const m=l;this._views.push(m),m.attachToAppRef(this)}detachView(l){const m=l;Fg(this._views,m),m.detachFromAppRef()}_loadComponent(l){this.attachView(l.hostView),this.tick(),this.components.push(l);const m=this._injector.get(T0,[]);m.push(...this._bootstrapListeners),m.forEach(v=>v(l))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(l=>l()),this._views.slice().forEach(l=>l.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(l){return this._destroyListeners.push(l),()=>Fg(this._destroyListeners,l)}destroy(){if(this._destroyed)throw new Ye(406,!1);const l=this._injector;l.destroy&&!l.destroyed&&l.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(l){return new(l||i)(Le(Ql),Le(gu),Le(Fh))},i.\u0275prov=Tn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Fg(i,o){const l=i.indexOf(o);l>-1&&i.splice(l,1)}let lb=(()=>{class i{}return i.__NG_ELEMENT_ID__=cb,i})();function cb(i){return function ub(i,o,l){if(Ko(i)&&!l){const m=Wr(i.index,o);return new eh(m,m)}return 47&i.type?new eh(o[si],o):null}($i(),Ft(),16==(16&i))}class z0{constructor(){}supports(o){return Xh(o)}create(o){return new gb(o)}}const mb=(i,o)=>o;class gb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||mb}forEachItem(o){let l;for(l=this._itHead;null!==l;l=l._next)o(l)}forEachOperation(o){let l=this._itHead,m=this._removalsHead,v=0,b=null;for(;l||m;){const S=!m||l&&l.currentIndex<N0(m,v,b)?l:m,L=N0(S,v,b),z=S.currentIndex;if(S===m)v--,m=m._nextRemoved;else if(l=l._next,null==S.previousIndex)v++;else{b||(b=[]);const Z=L-v,le=z-v;if(Z!=le){for(let je=0;je<Z;je++){const et=je<b.length?b[je]:b[je]=0,Pt=et+je;le<=Pt&&Pt<Z&&(b[je]=et+1)}b[S.previousIndex]=le-Z}}L!==z&&o(S,L,z)}}forEachPreviousItem(o){let l;for(l=this._previousItHead;null!==l;l=l._nextPrevious)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachMovedItem(o){let l;for(l=this._movesHead;null!==l;l=l._nextMoved)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}forEachIdentityChange(o){let l;for(l=this._identityChangesHead;null!==l;l=l._nextIdentityChange)o(l)}diff(o){if(null==o&&(o=[]),!Xh(o))throw new Ye(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let v,b,S,l=this._itHead,m=!1;if(Array.isArray(o)){this.length=o.length;for(let L=0;L<this.length;L++)b=o[L],S=this._trackByFn(L,b),null!==l&&Object.is(l.trackById,S)?(m&&(l=this._verifyReinsertion(l,b,S,L)),Object.is(l.item,b)||this._addIdentityChange(l,b)):(l=this._mismatch(l,b,S,L),m=!0),l=l._next}else v=0,function Z_(i,o){if(Array.isArray(i))for(let l=0;l<i.length;l++)o(i[l]);else{const l=i[Symbol.iterator]();let m;for(;!(m=l.next()).done;)o(m.value)}}(o,L=>{S=this._trackByFn(v,L),null!==l&&Object.is(l.trackById,S)?(m&&(l=this._verifyReinsertion(l,L,S,v)),Object.is(l.item,L)||this._addIdentityChange(l,L)):(l=this._mismatch(l,L,S,v),m=!0),l=l._next,v++}),this.length=v;return this._truncate(l),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,l,m,v){let b;return null===o?b=this._itTail:(b=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(m,null))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._reinsertAfter(o,b,v)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(m,v))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._moveAfter(o,b,v)):o=this._addAfter(new _b(l,m),b,v),o}_verifyReinsertion(o,l,m,v){let b=null===this._unlinkedRecords?null:this._unlinkedRecords.get(m,null);return null!==b?o=this._reinsertAfter(b,o._prev,v):o.currentIndex!=v&&(o.currentIndex=v,this._addToMoves(o,v)),o}_truncate(o){for(;null!==o;){const l=o._next;this._addToRemovals(this._unlink(o)),o=l}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,l,m){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const v=o._prevRemoved,b=o._nextRemoved;return null===v?this._removalsHead=b:v._nextRemoved=b,null===b?this._removalsTail=v:b._prevRemoved=v,this._insertAfter(o,l,m),this._addToMoves(o,m),o}_moveAfter(o,l,m){return this._unlink(o),this._insertAfter(o,l,m),this._addToMoves(o,m),o}_addAfter(o,l,m){return this._insertAfter(o,l,m),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,l,m){const v=null===l?this._itHead:l._next;return o._next=v,o._prev=l,null===v?this._itTail=o:v._prev=o,null===l?this._itHead=o:l._next=o,null===this._linkedRecords&&(this._linkedRecords=new B0),this._linkedRecords.put(o),o.currentIndex=m,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const l=o._prev,m=o._next;return null===l?this._itHead=m:l._next=m,null===m?this._itTail=l:m._prev=l,o}_addToMoves(o,l){return o.previousIndex===l||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new B0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,l){return o.item=l,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class _b{constructor(o,l){this.item=o,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class yb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,l){let m;for(m=this._head;null!==m;m=m._nextDup)if((null===l||l<=m.currentIndex)&&Object.is(m.trackById,o))return m;return null}remove(o){const l=o._prevDup,m=o._nextDup;return null===l?this._head=m:l._nextDup=m,null===m?this._tail=l:m._prevDup=l,null===this._head}}class B0{constructor(){this.map=new Map}put(o){const l=o.trackById;let m=this.map.get(l);m||(m=new yb,this.map.set(l,m)),m.add(o)}get(o,l){const v=this.map.get(o);return v?v.get(o,l):null}remove(o){const l=o.trackById;return this.map.get(l).remove(o)&&this.map.delete(l),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function N0(i,o,l){const m=i.previousIndex;if(null===m)return m;let v=0;return l&&m<l.length&&(v=l[m]),m+o+v}class U0{constructor(){}supports(o){return o instanceof Map||Xl(o)}create(){return new vb}}class vb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let l;for(l=this._mapHead;null!==l;l=l._next)o(l)}forEachPreviousItem(o){let l;for(l=this._previousMapHead;null!==l;l=l._nextPrevious)o(l)}forEachChangedItem(o){let l;for(l=this._changesHead;null!==l;l=l._nextChanged)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}diff(o){if(o){if(!(o instanceof Map||Xl(o)))throw new Ye(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(o,(m,v)=>{if(l&&l.key===v)this._maybeAddToChanges(l,m),this._appendAfter=l,l=l._next;else{const b=this._getOrCreateRecordForKey(v,m);l=this._insertBeforeOrAppend(l,b)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let m=l;null!==m;m=m._nextRemoved)m===this._mapHead&&(this._mapHead=null),this._records.delete(m.key),m._nextRemoved=m._next,m.previousValue=m.currentValue,m.currentValue=null,m._prev=null,m._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,l){if(o){const m=o._prev;return l._next=o,l._prev=m,o._prev=l,m&&(m._next=l),o===this._mapHead&&(this._mapHead=l),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(o,l){if(this._records.has(o)){const v=this._records.get(o);this._maybeAddToChanges(v,l);const b=v._prev,S=v._next;return b&&(b._next=S),S&&(S._prev=b),v._next=null,v._prev=null,v}const m=new xb(o);return this._records.set(o,m),m.currentValue=l,this._addToAdditions(m),m}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,l){Object.is(l,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=l,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,l){o instanceof Map?o.forEach(l):Object.keys(o).forEach(m=>l(o[m],m))}}class xb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function j0(){return new Oy([new z0])}let Oy=(()=>{class i{constructor(l){this.factories=l}static create(l,m){if(null!=m){const v=m.factories.slice();l=l.concat(v)}return new i(l)}static extend(l){return{provide:i,useFactory:m=>i.create(l,m||j0()),deps:[[i,new ye,new te]]}}find(l){const m=this.factories.find(v=>v.supports(l));if(null!=m)return m;throw new Ye(901,!1)}}return i.\u0275prov=Tn({token:i,providedIn:"root",factory:j0}),i})();function V0(){return new Fy([new U0])}let Fy=(()=>{class i{constructor(l){this.factories=l}static create(l,m){if(m){const v=m.factories.slice();l=l.concat(v)}return new i(l)}static extend(l){return{provide:i,useFactory:m=>i.create(l,m||V0()),deps:[[i,new ye,new te]]}}find(l){const m=this.factories.find(v=>v.supports(l));if(m)return m;throw new Ye(901,!1)}}return i.\u0275prov=Tn({token:i,providedIn:"root",factory:V0}),i})();const Eb=C0(null,"core",[]);let Tb=(()=>{class i{constructor(l){}}return i.\u0275fac=function(l){return new(l||i)(Le(Og))},i.\u0275mod=kr({type:i}),i.\u0275inj=Dn({}),i})();function Db(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},1481:(Yn,ct,we)=>{"use strict";we.d(ct,{Dx:()=>zr,b2:()=>Fr,q6:()=>vn,se:()=>Vt});var W=we(6895),ee=we(1571);class Ve extends W.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u extends Ve{static makeCurrent(){(0,W.HT)(new u)}onAndCancel(ie,q,re){return ie.addEventListener(q,re,!1),()=>{ie.removeEventListener(q,re,!1)}}dispatchEvent(ie,q){ie.dispatchEvent(q)}remove(ie){ie.parentNode&&ie.parentNode.removeChild(ie)}createElement(ie,q){return(q=q||this.getDefaultDocument()).createElement(ie)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ie){return ie.nodeType===Node.ELEMENT_NODE}isShadowRoot(ie){return ie instanceof DocumentFragment}getGlobalEventTarget(ie,q){return"window"===q?window:"document"===q?ie:"body"===q?ie.body:null}getBaseHref(ie){const q=function Xt(){return Ie=Ie||document.querySelector("base"),Ie?Ie.getAttribute("href"):null}();return null==q?null:function wt(se){St=St||document.createElement("a"),St.setAttribute("href",se);const ie=St.pathname;return"/"===ie.charAt(0)?ie:`/${ie}`}(q)}resetBaseElement(){Ie=null}getUserAgent(){return window.navigator.userAgent}getCookie(ie){return(0,W.Mx)(document.cookie,ie)}}let St,Ie=null;const xt=new ee.OlP("TRANSITION_ID"),yt=[{provide:ee.ip1,useFactory:function nt(se,ie,q){return()=>{q.get(ee.CZH).donePromise.then(()=>{const re=(0,W.q)(),pe=ie.querySelectorAll(`style[ng-transition="${se}"]`);for(let Ue=0;Ue<pe.length;Ue++)re.remove(pe[Ue])})}},deps:[xt,W.K0,ee.zs3],multi:!0}];let jn=(()=>{class se{build(){return new XMLHttpRequest}}return se.\u0275fac=function(q){return new(q||se)},se.\u0275prov=ee.Yz7({token:se,factory:se.\u0275fac}),se})();const Kt=new ee.OlP("EventManagerPlugins");let ln=(()=>{class se{constructor(q,re){this._zone=re,this._eventNameToPlugin=new Map,q.forEach(pe=>{pe.manager=this}),this._plugins=q.slice().reverse()}addEventListener(q,re,pe){return this._findPluginFor(re).addEventListener(q,re,pe)}addGlobalEventListener(q,re,pe){return this._findPluginFor(re).addGlobalEventListener(q,re,pe)}getZone(){return this._zone}_findPluginFor(q){const re=this._eventNameToPlugin.get(q);if(re)return re;const pe=this._plugins;for(let Ue=0;Ue<pe.length;Ue++){const ft=pe[Ue];if(ft.supports(q))return this._eventNameToPlugin.set(q,ft),ft}throw new Error(`No event manager plugin found for event ${q}`)}}return se.\u0275fac=function(q){return new(q||se)(ee.LFG(Kt),ee.LFG(ee.R0b))},se.\u0275prov=ee.Yz7({token:se,factory:se.\u0275fac}),se})();class jt{constructor(ie){this._doc=ie}addGlobalEventListener(ie,q,re){const pe=(0,W.q)().getGlobalEventTarget(this._doc,ie);if(!pe)throw new Error(`Unsupported event target ${pe} for event ${q}`);return this.addEventListener(pe,q,re)}}let Gn=(()=>{class se{constructor(){this.usageCount=new Map}addStyles(q){for(const re of q)1===this.changeUsageCount(re,1)&&this.onStyleAdded(re)}removeStyles(q){for(const re of q)0===this.changeUsageCount(re,-1)&&this.onStyleRemoved(re)}onStyleRemoved(q){}onStyleAdded(q){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(q,re){const pe=this.usageCount;let Ue=pe.get(q)??0;return Ue+=re,Ue>0?pe.set(q,Ue):pe.delete(q),Ue}ngOnDestroy(){for(const q of this.getAllStyles())this.onStyleRemoved(q);this.usageCount.clear()}}return se.\u0275fac=function(q){return new(q||se)},se.\u0275prov=ee.Yz7({token:se,factory:se.\u0275fac}),se})(),st=(()=>{class se extends Gn{constructor(q){super(),this.doc=q,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(q){for(const re of this.hostNodes)this.addStyleToHost(re,q)}onStyleRemoved(q){const re=this.styleRef;re.get(q)?.forEach(Ue=>Ue.remove()),re.delete(q)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(q){this.hostNodes.add(q);for(const re of this.getAllStyles())this.addStyleToHost(q,re)}removeHost(q){this.hostNodes.delete(q)}addStyleToHost(q,re){const pe=this.doc.createElement("style");pe.textContent=re,q.appendChild(pe);const Ue=this.styleRef.get(re);Ue?Ue.push(pe):this.styleRef.set(re,[pe])}resetHostNodes(){const q=this.hostNodes;q.clear(),q.add(this.doc.head)}}return se.\u0275fac=function(q){return new(q||se)(ee.LFG(W.K0))},se.\u0275prov=ee.Yz7({token:se,factory:se.\u0275fac}),se})();const Pn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Or=/%COMP%/g,nn=new ee.OlP("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function un(se,ie){return ie.flat(100).map(q=>q.replace(Or,se))}function rr(se){return ie=>{if("__ngUnwrap__"===ie)return se;!1===se(ie)&&(ie.preventDefault(),ie.returnValue=!1)}}let Vt=(()=>{class se{constructor(q,re,pe,Ue){this.eventManager=q,this.sharedStylesHost=re,this.appId=pe,this.removeStylesOnCompDestory=Ue,this.rendererByCompId=new Map,this.defaultRenderer=new at(q)}createRenderer(q,re){if(!q||!re)return this.defaultRenderer;const pe=this.getOrCreateRenderer(q,re);return pe instanceof Rn?pe.applyToHost(q):pe instanceof qt&&pe.applyStyles(),pe}getOrCreateRenderer(q,re){const pe=this.rendererByCompId;let Ue=pe.get(re.id);if(!Ue){const ft=this.eventManager,dt=this.sharedStylesHost,en=this.removeStylesOnCompDestory;switch(re.encapsulation){case ee.ifc.Emulated:Ue=new Rn(ft,dt,re,this.appId,en);break;case ee.ifc.ShadowDom:return new Wt(ft,dt,q,re);default:Ue=new qt(ft,dt,re,en)}Ue.onDestroy=()=>pe.delete(re.id),pe.set(re.id,Ue)}return Ue}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return se.\u0275fac=function(q){return new(q||se)(ee.LFG(ln),ee.LFG(st),ee.LFG(ee.AFp),ee.LFG(nn))},se.\u0275prov=ee.Yz7({token:se,factory:se.\u0275fac}),se})();class at{constructor(ie){this.eventManager=ie,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ie,q){return q?document.createElementNS(Pn[q]||q,ie):document.createElement(ie)}createComment(ie){return document.createComment(ie)}createText(ie){return document.createTextNode(ie)}appendChild(ie,q){(At(ie)?ie.content:ie).appendChild(q)}insertBefore(ie,q,re){ie&&(At(ie)?ie.content:ie).insertBefore(q,re)}removeChild(ie,q){ie&&ie.removeChild(q)}selectRootElement(ie,q){let re="string"==typeof ie?document.querySelector(ie):ie;if(!re)throw new Error(`The selector "${ie}" did not match any elements`);return q||(re.textContent=""),re}parentNode(ie){return ie.parentNode}nextSibling(ie){return ie.nextSibling}setAttribute(ie,q,re,pe){if(pe){q=pe+":"+q;const Ue=Pn[pe];Ue?ie.setAttributeNS(Ue,q,re):ie.setAttribute(q,re)}else ie.setAttribute(q,re)}removeAttribute(ie,q,re){if(re){const pe=Pn[re];pe?ie.removeAttributeNS(pe,q):ie.removeAttribute(`${re}:${q}`)}else ie.removeAttribute(q)}addClass(ie,q){ie.classList.add(q)}removeClass(ie,q){ie.classList.remove(q)}setStyle(ie,q,re,pe){pe&(ee.JOm.DashCase|ee.JOm.Important)?ie.style.setProperty(q,re,pe&ee.JOm.Important?"important":""):ie.style[q]=re}removeStyle(ie,q,re){re&ee.JOm.DashCase?ie.style.removeProperty(q):ie.style[q]=""}setProperty(ie,q,re){ie[q]=re}setValue(ie,q){ie.nodeValue=q}listen(ie,q,re){return"string"==typeof ie?this.eventManager.addGlobalEventListener(ie,q,rr(re)):this.eventManager.addEventListener(ie,q,rr(re))}}function At(se){return"TEMPLATE"===se.tagName&&void 0!==se.content}class Wt extends at{constructor(ie,q,re,pe){super(ie),this.sharedStylesHost=q,this.hostEl=re,this.shadowRoot=re.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Ue=un(pe.id,pe.styles);for(const ft of Ue){const dt=document.createElement("style");dt.textContent=ft,this.shadowRoot.appendChild(dt)}}nodeOrShadowRoot(ie){return ie===this.hostEl?this.shadowRoot:ie}appendChild(ie,q){return super.appendChild(this.nodeOrShadowRoot(ie),q)}insertBefore(ie,q,re){return super.insertBefore(this.nodeOrShadowRoot(ie),q,re)}removeChild(ie,q){return super.removeChild(this.nodeOrShadowRoot(ie),q)}parentNode(ie){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ie)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class qt extends at{constructor(ie,q,re,pe,Ue=re.id){super(ie),this.sharedStylesHost=q,this.removeStylesOnCompDestory=pe,this.rendererUsageCount=0,this.styles=un(Ue,re.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class Rn extends qt{constructor(ie,q,re,pe,Ue){const ft=pe+"-"+re.id;super(ie,q,re,Ue,ft),this.contentAttr=function Yt(se){return"_ngcontent-%COMP%".replace(Or,se)}(ft),this.hostAttr=function Bt(se){return"_nghost-%COMP%".replace(Or,se)}(ft)}applyToHost(ie){this.applyStyles(),this.setAttribute(ie,this.hostAttr,"")}createElement(ie,q){const re=super.createElement(ie,q);return super.setAttribute(re,this.contentAttr,""),re}}let fr=(()=>{class se extends jt{constructor(q){super(q)}supports(q){return!0}addEventListener(q,re,pe){return q.addEventListener(re,pe,!1),()=>this.removeEventListener(q,re,pe)}removeEventListener(q,re,pe){return q.removeEventListener(re,pe)}}return se.\u0275fac=function(q){return new(q||se)(ee.LFG(W.K0))},se.\u0275prov=ee.Yz7({token:se,factory:se.\u0275fac}),se})();const mr=["alt","control","meta","shift"],bn={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},yn={alt:se=>se.altKey,control:se=>se.ctrlKey,meta:se=>se.metaKey,shift:se=>se.shiftKey};let Qt=(()=>{class se extends jt{constructor(q){super(q)}supports(q){return null!=se.parseEventName(q)}addEventListener(q,re,pe){const Ue=se.parseEventName(re),ft=se.eventCallback(Ue.fullKey,pe,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,W.q)().onAndCancel(q,Ue.domEventName,ft))}static parseEventName(q){const re=q.toLowerCase().split("."),pe=re.shift();if(0===re.length||"keydown"!==pe&&"keyup"!==pe)return null;const Ue=se._normalizeKey(re.pop());let ft="",dt=re.indexOf("code");if(dt>-1&&(re.splice(dt,1),ft="code."),mr.forEach(hn=>{const dn=re.indexOf(hn);dn>-1&&(re.splice(dn,1),ft+=hn+".")}),ft+=Ue,0!=re.length||0===Ue.length)return null;const en={};return en.domEventName=pe,en.fullKey=ft,en}static matchEventFullKeyCode(q,re){let pe=bn[q.key]||q.key,Ue="";return re.indexOf("code.")>-1&&(pe=q.code,Ue="code."),!(null==pe||!pe)&&(pe=pe.toLowerCase()," "===pe?pe="space":"."===pe&&(pe="dot"),mr.forEach(ft=>{ft!==pe&&(0,yn[ft])(q)&&(Ue+=ft+".")}),Ue+=pe,Ue===re)}static eventCallback(q,re,pe){return Ue=>{se.matchEventFullKeyCode(Ue,q)&&pe.runGuarded(()=>re(Ue))}}static _normalizeKey(q){return"esc"===q?"escape":q}}return se.\u0275fac=function(q){return new(q||se)(ee.LFG(W.K0))},se.\u0275prov=ee.Yz7({token:se,factory:se.\u0275fac}),se})();const vn=(0,ee.eFA)(ee._c5,"browser",[{provide:ee.Lbi,useValue:W.bD},{provide:ee.g9A,useValue:function Dn(){u.makeCurrent()},multi:!0},{provide:W.K0,useFactory:function ri(){return(0,ee.RDi)(document),document},deps:[]}]),sr=new ee.OlP(""),vi=[{provide:ee.rWj,useClass:class Ct{addToWindow(ie){ee.dqk.getAngularTestability=(re,pe=!0)=>{const Ue=ie.findTestabilityInTree(re,pe);if(null==Ue)throw new Error("Could not find testability for element.");return Ue},ee.dqk.getAllAngularTestabilities=()=>ie.getAllTestabilities(),ee.dqk.getAllAngularRootElements=()=>ie.getAllRootElements(),ee.dqk.frameworkStabilizers||(ee.dqk.frameworkStabilizers=[]),ee.dqk.frameworkStabilizers.push(re=>{const pe=ee.dqk.getAllAngularTestabilities();let Ue=pe.length,ft=!1;const dt=function(en){ft=ft||en,Ue--,0==Ue&&re(ft)};pe.forEach(function(en){en.whenStable(dt)})})}findTestabilityInTree(ie,q,re){return null==q?null:ie.getTestability(q)??(re?(0,W.q)().isShadowRoot(q)?this.findTestabilityInTree(ie,q.host,!0):this.findTestabilityInTree(ie,q.parentElement,!0):null)}},deps:[]},{provide:ee.lri,useClass:ee.dDg,deps:[ee.R0b,ee.eoX,ee.rWj]},{provide:ee.dDg,useClass:ee.dDg,deps:[ee.R0b,ee.eoX,ee.rWj]}],Kr=[{provide:ee.zSh,useValue:"root"},{provide:ee.qLn,useFactory:function ei(){return new ee.qLn},deps:[]},{provide:Kt,useClass:fr,multi:!0,deps:[W.K0,ee.R0b,ee.Lbi]},{provide:Kt,useClass:Qt,multi:!0,deps:[W.K0]},{provide:Vt,useClass:Vt,deps:[ln,st,ee.AFp,nn]},{provide:ee.FYo,useExisting:Vt},{provide:Gn,useExisting:st},{provide:st,useClass:st,deps:[W.K0]},{provide:ln,useClass:ln,deps:[Kt,ee.R0b]},{provide:W.JF,useClass:jn,deps:[]},[]];let Fr=(()=>{class se{constructor(q){}static withServerTransition(q){return{ngModule:se,providers:[{provide:ee.AFp,useValue:q.appId},{provide:xt,useExisting:ee.AFp},yt]}}}return se.\u0275fac=function(q){return new(q||se)(ee.LFG(sr,12))},se.\u0275mod=ee.oAB({type:se}),se.\u0275inj=ee.cJS({providers:[...Kr,...vi],imports:[W.ez,ee.hGG]}),se})(),zr=(()=>{class se{constructor(q){this._doc=q}getTitle(){return this._doc.title}setTitle(q){this._doc.title=q||""}}return se.\u0275fac=function(q){return new(q||se)(ee.LFG(W.K0))},se.\u0275prov=ee.Yz7({token:se,factory:function(q){let re=null;return re=q?new q:function to(){return new zr((0,ee.LFG)(W.K0))}(),re},providedIn:"root"}),se})();typeof window<"u"&&window},8750:(Yn,ct,we)=>{"use strict";we.d(ct,{F0:()=>ts,rH:()=>Va,Bz:()=>Ws,lC:()=>Qo});var W=we(1571),ee=we(2076),Ve=we(9646),u=we(7579);class Ie extends u.x{constructor(f){super(),this._value=f}get value(){return this.getValue()}_subscribe(f){const d=super._subscribe(f);return!d.closed&&f.next(this._value),d}getValue(){const{hasError:f,thrownError:d,_value:y}=this;if(f)throw d;return this._throwIfClosed(),y}next(f){super.next(this._value=f)}}const St=(0,we(3888).d)(a=>function(){a(this),this.name="EmptyError",this.message="no elements in sequence"});var wt=we(9751),xt=we(4742),nt=we(4671),yt=we(3268),Ct=we(3269),jn=we(1810),Kt=we(5403),ln=we(9672);function jt(...a){const f=(0,Ct.yG)(a),d=(0,Ct.jO)(a),{args:y,keys:x}=(0,xt.D)(a);if(0===y.length)return(0,ee.D)([],f);const E=new wt.y(function Gn(a,f,d=nt.y){return y=>{st(f,()=>{const{length:x}=a,E=new Array(x);let C=x,R=x;for(let U=0;U<x;U++)st(f,()=>{const Y=(0,ee.D)(a[U],f);let oe=!1;Y.subscribe((0,Kt.x)(y,ce=>{E[U]=ce,oe||(oe=!0,R--),R||y.next(d(E.slice()))},()=>{--C||y.complete()}))},y)},y)}}(y,f,x?C=>(0,jn.n)(x,C):nt.y));return d?E.pipe((0,yt.Z)(d)):E}function st(a,f,d){a?(0,ln.f)(d,a,f):f()}var Pn=we(7272),Or=we(8421);function Ye(a){return new wt.y(f=>{(0,Or.Xf)(a()).subscribe(f)})}var Ne=we(9635),pt=we(576);function sn(a,f){const d=(0,pt.m)(a)?a:()=>a,y=x=>x.error(d());return new wt.y(f?x=>f.schedule(y,0,x):y)}var _n=we(515),nn=we(727),Yt=we(4482);function Bt(){return(0,Yt.e)((a,f)=>{let d=null;a._refCount++;const y=(0,Kt.x)(f,void 0,void 0,void 0,()=>{if(!a||a._refCount<=0||0<--a._refCount)return void(d=null);const x=a._connection,E=d;d=null,x&&(!E||x===E)&&x.unsubscribe(),f.unsubscribe()});a.subscribe(y),y.closed||(d=a.connect())})}class un extends wt.y{constructor(f,d){super(),this.source=f,this.subjectFactory=d,this._subject=null,this._refCount=0,this._connection=null,(0,Yt.A)(f)&&(this.lift=f.lift)}_subscribe(f){return this.getSubject().subscribe(f)}getSubject(){const f=this._subject;return(!f||f.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:f}=this;this._subject=this._connection=null,f?.unsubscribe()}connect(){let f=this._connection;if(!f){f=this._connection=new nn.w0;const d=this.getSubject();f.add(this.source.subscribe((0,Kt.x)(d,void 0,()=>{this._teardown(),d.complete()},y=>{this._teardown(),d.error(y)},()=>this._teardown()))),f.closed&&(this._connection=null,f=nn.w0.EMPTY)}return f}refCount(){return Bt()(this)}}var rr=we(6895),Vt=we(4004),at=we(3900),rt=we(5698),Mt=we(8675),At=we(9300),Wt=we(5577);function qt(a){return(0,Yt.e)((f,d)=>{let y=!1;f.subscribe((0,Kt.x)(d,x=>{y=!0,d.next(x)},()=>{y||d.next(a),d.complete()}))})}function Rn(a=fr){return(0,Yt.e)((f,d)=>{let y=!1;f.subscribe((0,Kt.x)(d,x=>{y=!0,d.next(x)},()=>y?d.complete():d.error(a())))})}function fr(){return new St}function mr(a,f){const d=arguments.length>=2;return y=>y.pipe(a?(0,At.h)((x,E)=>a(x,E,y)):nt.y,(0,rt.q)(1),d?qt(f):Rn(()=>new St))}var bn=we(4351),yn=we(8505),Qt=we(262);function ir(a,f){return(0,Yt.e)(function wr(a,f,d,y,x){return(E,C)=>{let R=d,U=f,Y=0;E.subscribe((0,Kt.x)(C,oe=>{const ce=Y++;U=R?a(U,oe,ce):(R=!0,oe),y&&C.next(U)},x&&(()=>{R&&C.next(U),C.complete()})))}}(a,f,arguments.length>=2,!0))}function Xr(a){return a<=0?()=>_n.E:(0,Yt.e)((f,d)=>{let y=[];f.subscribe((0,Kt.x)(d,x=>{y.push(x),a<y.length&&y.shift()},()=>{for(const x of y)d.next(x);d.complete()},void 0,()=>{y=null}))})}function Tn(a,f){const d=arguments.length>=2;return y=>y.pipe(a?(0,At.h)((x,E)=>a(x,E,y)):nt.y,Xr(1),d?qt(f):Rn(()=>new St))}function ei(a){return(0,Yt.e)((f,d)=>{try{f.subscribe(d)}finally{d.add(a)}})}var ri=we(8189),qi=we(1481);const vn="primary",sr=Symbol("RouteTitle");class vi{constructor(f){this.params=f||{}}has(f){return Object.prototype.hasOwnProperty.call(this.params,f)}get(f){if(this.has(f)){const d=this.params[f];return Array.isArray(d)?d[0]:d}return null}getAll(f){if(this.has(f)){const d=this.params[f];return Array.isArray(d)?d:[d]}return[]}get keys(){return Object.keys(this.params)}}function Kr(a){return new vi(a)}function Fr(a,f,d){const y=d.path.split("/");if(y.length>a.length||"full"===d.pathMatch&&(f.hasChildren()||y.length<a.length))return null;const x={};for(let E=0;E<y.length;E++){const C=y[E],R=a[E];if(C.startsWith(":"))x[C.substring(1)]=R;else if(C!==R.path)return null}return{consumed:a.slice(0,y.length),posParams:x}}function Ii(a,f){const d=a?Object.keys(a):void 0,y=f?Object.keys(f):void 0;if(!d||!y||d.length!=y.length)return!1;let x;for(let E=0;E<d.length;E++)if(x=d[E],!In(a[x],f[x]))return!1;return!0}function In(a,f){if(Array.isArray(a)&&Array.isArray(f)){if(a.length!==f.length)return!1;const d=[...a].sort(),y=[...f].sort();return d.every((x,E)=>y[E]===x)}return a===f}function to(a){return Array.prototype.concat.apply([],a)}function zr(a){return a.length>0?a[a.length-1]:null}function gt(a,f){for(const d in a)a.hasOwnProperty(d)&&f(a[d],d)}function xi(a){return(0,W.CqO)(a)?a:(0,W.QGY)(a)?(0,ee.D)(Promise.resolve(a)):(0,Ve.of)(a)}const yr=!1,Ai={exact:function Ar(a,f,d){if(!Le(a.segments,f.segments)||!Vi(a.segments,f.segments,d)||a.numberOfChildren!==f.numberOfChildren)return!1;for(const y in f.children)if(!a.children[y]||!Ar(a.children[y],f.children[y],d))return!1;return!0},subset:vr},no={exact:function Pi(a,f){return Ii(a,f)},subset:function ho(a,f){return Object.keys(f).length<=Object.keys(a).length&&Object.keys(f).every(d=>In(a[d],f[d]))},ignored:()=>!0};function Fi(a,f,d){return Ai[d.paths](a.root,f.root,d.matrixParams)&&no[d.queryParams](a.queryParams,f.queryParams)&&!("exact"===d.fragment&&a.fragment!==f.fragment)}function vr(a,f,d){return ro(a,f,f.segments,d)}function ro(a,f,d,y){if(a.segments.length>d.length){const x=a.segments.slice(0,d.length);return!(!Le(x,d)||f.hasChildren()||!Vi(x,d,y))}if(a.segments.length===d.length){if(!Le(a.segments,d)||!Vi(a.segments,d,y))return!1;for(const x in f.children)if(!a.children[x]||!vr(a.children[x],f.children[x],y))return!1;return!0}{const x=d.slice(0,a.segments.length),E=d.slice(a.segments.length);return!!(Le(a.segments,x)&&Vi(a.segments,x,y)&&a.children[vn])&&ro(a.children[vn],f,E,y)}}function Vi(a,f,d){return f.every((y,x)=>no[d](a[x].parameters,y.parameters))}class ii{constructor(f=new Hn([],{}),d={},y=null){this.root=f,this.queryParams=d,this.fragment=y}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Kr(this.queryParams)),this._queryParamMap}toString(){return he.serialize(this)}}class Hn{constructor(f,d){this.segments=f,this.children=d,this.parent=null,gt(d,(y,x)=>y.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return H(this)}}class _t{constructor(f,d){this.path=f,this.parameters=d}get parameterMap(){return this._parameterMap||(this._parameterMap=Kr(this.parameters)),this._parameterMap}toString(){return pe(this)}}function Le(a,f){return a.length===f.length&&a.every((d,y)=>d.path===f[y].path)}let Rt=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return new On},providedIn:"root"}),a})();class On{parse(f){const d=new xr(f);return new ii(d.parseRootSegment(),d.parseQueryParams(),d.parseFragment())}serialize(f){const d=`/${K(f.root,!0)}`,y=function ft(a){const f=Object.keys(a).map(d=>{const y=a[d];return Array.isArray(y)?y.map(x=>`${Ee(d)}=${Ee(x)}`).join("&"):`${Ee(d)}=${Ee(y)}`}).filter(d=>!!d);return f.length?`?${f.join("&")}`:""}(f.queryParams);return`${d}${y}${"string"==typeof f.fragment?`#${function se(a){return encodeURI(a)}(f.fragment)}`:""}`}}const he=new On;function H(a){return a.segments.map(f=>pe(f)).join("/")}function K(a,f){if(!a.hasChildren())return H(a);if(f){const d=a.children[vn]?K(a.children[vn],!1):"",y=[];return gt(a.children,(x,E)=>{E!==vn&&y.push(`${E}:${K(x,!1)}`)}),y.length>0?`${d}(${y.join("//")})`:d}{const d=function $t(a,f){let d=[];return gt(a.children,(y,x)=>{x===vn&&(d=d.concat(f(y,x)))}),gt(a.children,(y,x)=>{x!==vn&&(d=d.concat(f(y,x)))}),d}(a,(y,x)=>x===vn?[K(a.children[vn],!1)]:[`${x}:${K(y,!1)}`]);return 1===Object.keys(a.children).length&&null!=a.children[vn]?`${H(a)}/${d[0]}`:`${H(a)}/(${d.join("//")})`}}function fe(a){return encodeURIComponent(a).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ee(a){return fe(a).replace(/%3B/gi,";")}function ie(a){return fe(a).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function q(a){return decodeURIComponent(a)}function re(a){return q(a.replace(/\+/g,"%20"))}function pe(a){return`${ie(a.path)}${function Ue(a){return Object.keys(a).map(f=>`;${ie(f)}=${ie(a[f])}`).join("")}(a.parameters)}`}const dt=/^[^\/()?;=#]+/;function en(a){const f=a.match(dt);return f?f[0]:""}const hn=/^[^=?&#]+/,an=/^[^&#]+/;class xr{constructor(f){this.url=f,this.remaining=f}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Hn([],{}):new Hn([],this.parseChildren())}parseQueryParams(){const f={};if(this.consumeOptional("?"))do{this.parseQueryParam(f)}while(this.consumeOptional("&"));return f}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const f=[];for(this.peekStartsWith("(")||f.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),f.push(this.parseSegment());let d={};this.peekStartsWith("/(")&&(this.capture("/"),d=this.parseParens(!0));let y={};return this.peekStartsWith("(")&&(y=this.parseParens(!1)),(f.length>0||Object.keys(d).length>0)&&(y[vn]=new Hn(f,d)),y}parseSegment(){const f=en(this.remaining);if(""===f&&this.peekStartsWith(";"))throw new W.vHH(4009,yr);return this.capture(f),new _t(q(f),this.parseMatrixParams())}parseMatrixParams(){const f={};for(;this.consumeOptional(";");)this.parseParam(f);return f}parseParam(f){const d=en(this.remaining);if(!d)return;this.capture(d);let y="";if(this.consumeOptional("=")){const x=en(this.remaining);x&&(y=x,this.capture(y))}f[q(d)]=q(y)}parseQueryParam(f){const d=function dn(a){const f=a.match(hn);return f?f[0]:""}(this.remaining);if(!d)return;this.capture(d);let y="";if(this.consumeOptional("=")){const C=function or(a){const f=a.match(an);return f?f[0]:""}(this.remaining);C&&(y=C,this.capture(y))}const x=re(d),E=re(y);if(f.hasOwnProperty(x)){let C=f[x];Array.isArray(C)||(C=[C],f[x]=C),C.push(E)}else f[x]=E}parseParens(f){const d={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const y=en(this.remaining),x=this.remaining[y.length];if("/"!==x&&")"!==x&&";"!==x)throw new W.vHH(4010,yr);let E;y.indexOf(":")>-1?(E=y.slice(0,y.indexOf(":")),this.capture(E),this.capture(":")):f&&(E=vn);const C=this.parseChildren();d[E]=1===Object.keys(C).length?C[vn]:new Hn([],C),this.consumeOptional("//")}return d}peekStartsWith(f){return this.remaining.startsWith(f)}consumeOptional(f){return!!this.peekStartsWith(f)&&(this.remaining=this.remaining.substring(f.length),!0)}capture(f){if(!this.consumeOptional(f))throw new W.vHH(4011,yr)}}function Sn(a){return a.segments.length>0?new Hn([],{[vn]:a}):a}function Cr(a){const f={};for(const y of Object.keys(a.children)){const E=Cr(a.children[y]);(E.segments.length>0||E.hasChildren())&&(f[y]=E)}return function kr(a){if(1===a.numberOfChildren&&a.children[vn]){const f=a.children[vn];return new Hn(a.segments.concat(f.segments),f.children)}return a}(new Hn(a.segments,f))}function fo(a){return a instanceof ii}const yo=!1;function _i(a,f,d,y,x){if(0===d.length)return Gr(f.root,f.root,f.root,y,x);const E=function Zt(a){if("string"==typeof a[0]&&1===a.length&&"/"===a[0])return new as(!0,0,a);let f=0,d=!1;const y=a.reduce((x,E,C)=>{if("object"==typeof E&&null!=E){if(E.outlets){const R={};return gt(E.outlets,(U,Y)=>{R[Y]="string"==typeof U?U.split("/"):U}),[...x,{outlets:R}]}if(E.segmentPath)return[...x,E.segmentPath]}return"string"!=typeof E?[...x,E]:0===C?(E.split("/").forEach((R,U)=>{0==U&&"."===R||(0==U&&""===R?d=!0:".."===R?f++:""!=R&&x.push(R))}),x):[...x,E]},[]);return new as(d,f,y)}(d);return E.toRoot()?Gr(f.root,f.root,new Hn([],{}),y,x):function C(U){const Y=function Zn(a,f,d,y){if(a.isAbsolute)return new Fn(f.root,!0,0);if(-1===y)return new Fn(d,d===f.root,0);return function Nr(a,f,d){let y=a,x=f,E=d;for(;E>x;){if(E-=x,y=y.parent,!y)throw new W.vHH(4005,yo&&"Invalid number of '../'");x=y.segments.length}return new Fn(y,!1,x-E)}(d,y+(zi(a.commands[0])?0:1),a.numberOfDoubleDots)}(E,f,a.snapshot?._urlSegment,U),oe=Y.processChildren?Yr(Y.segmentGroup,Y.index,E.commands):oo(Y.segmentGroup,Y.index,E.commands);return Gr(f.root,Y.segmentGroup,oe,y,x)}(a.snapshot?._lastPathIndex)}function zi(a){return"object"==typeof a&&null!=a&&!a.outlets&&!a.segmentPath}function oi(a){return"object"==typeof a&&null!=a&&a.outlets}function Gr(a,f,d,y,x){let C,E={};y&&gt(y,(U,Y)=>{E[Y]=Array.isArray(U)?U.map(oe=>`${oe}`):`${U}`}),C=a===f?d:Ks(a,f,d);const R=Sn(Cr(C));return new ii(R,E,x)}function Ks(a,f,d){const y={};return gt(a.children,(x,E)=>{y[E]=x===f?d:Ks(x,f,d)}),new Hn(a.segments,y)}class as{constructor(f,d,y){if(this.isAbsolute=f,this.numberOfDoubleDots=d,this.commands=y,f&&y.length>0&&zi(y[0]))throw new W.vHH(4003,yo&&"Root segment cannot have matrix parameters");const x=y.find(oi);if(x&&x!==zr(y))throw new W.vHH(4004,yo&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Fn{constructor(f,d,y){this.segmentGroup=f,this.processChildren=d,this.index=y}}function oo(a,f,d){if(a||(a=new Hn([],{})),0===a.segments.length&&a.hasChildren())return Yr(a,f,d);const y=function Co(a,f,d){let y=0,x=f;const E={match:!1,pathIndex:0,commandIndex:0};for(;x<a.segments.length;){if(y>=d.length)return E;const C=a.segments[x],R=d[y];if(oi(R))break;const U=`${R}`,Y=y<d.length-1?d[y+1]:null;if(x>0&&void 0===U)break;if(U&&Y&&"object"==typeof Y&&void 0===Y.outlets){if(!Ln(U,Y,C))return E;y+=2}else{if(!Ln(U,{},C))return E;y++}x++}return{match:!0,pathIndex:x,commandIndex:y}}(a,f,d),x=d.slice(y.commandIndex);if(y.match&&y.pathIndex<a.segments.length){const E=new Hn(a.segments.slice(0,y.pathIndex),{});return E.children[vn]=new Hn(a.segments.slice(y.pathIndex),a.children),Yr(E,0,x)}return y.match&&0===x.length?new Hn(a.segments,{}):y.match&&!a.hasChildren()?Jn(a,f,d):y.match?Yr(a,0,x):Jn(a,f,d)}function Yr(a,f,d){if(0===d.length)return new Hn(a.segments,{});{const y=function $n(a){return oi(a[0])?a[0].outlets:{[vn]:a}}(d),x={};return!y[vn]&&a.children[vn]&&1===a.numberOfChildren&&0===a.children[vn].segments.length?Yr(a.children[vn],f,d):(gt(y,(E,C)=>{"string"==typeof E&&(E=[E]),null!==E&&(x[C]=oo(a.children[C],f,E))}),gt(a.children,(E,C)=>{void 0===y[C]&&(x[C]=E)}),new Hn(a.segments,x))}}function Jn(a,f,d){const y=a.segments.slice(0,f);let x=0;for(;x<d.length;){const E=d[x];if(oi(E)){const U=br(E.outlets);return new Hn(y,U)}if(0===x&&zi(d[0])){y.push(new _t(a.segments[f].path,Es(d[0]))),x++;continue}const C=oi(E)?E.outlets[vn]:`${E}`,R=x<d.length-1?d[x+1]:null;C&&R&&zi(R)?(y.push(new _t(C,Es(R))),x+=2):(y.push(new _t(C,{})),x++)}return new Hn(y,{})}function br(a){const f={};return gt(a,(d,y)=>{"string"==typeof d&&(d=[d]),null!==d&&(f[y]=Jn(new Hn([],{}),0,d))}),f}function Es(a){const f={};return gt(a,(d,y)=>f[y]=`${d}`),f}function Ln(a,f,d){return a==d.path&&Ii(f,d.parameters)}const ls="imperative";class wi{constructor(f,d){this.id=f,this.url=d}}class Ys extends wi{constructor(f,d,y="imperative",x=null){super(f,d),this.type=0,this.navigationTrigger=y,this.restoredState=x}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ki extends wi{constructor(f,d,y){super(f,d),this.urlAfterRedirects=y,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class si extends wi{constructor(f,d,y,x){super(f,d),this.reason=y,this.code=x,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class so extends wi{constructor(f,d,y,x){super(f,d),this.reason=y,this.code=x,this.type=16}}class ui extends wi{constructor(f,d,y,x){super(f,d),this.error=y,this.target=x,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Bi extends wi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ri extends wi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hr extends wi{constructor(f,d,y,x,E){super(f,d),this.urlAfterRedirects=y,this.state=x,this.shouldActivate=E,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class jr extends wi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ia extends wi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Yi{constructor(f){this.route=f,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ao{constructor(f){this.route=f,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Ns{constructor(f){this.snapshot=f,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Js{constructor(f){this.snapshot=f,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ti{constructor(f){this.snapshot=f,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ni{constructor(f){this.snapshot=f,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xa{constructor(f,d,y){this.routerEvent=f,this.position=d,this.anchor=y,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let Ts=(()=>{class a{createUrlTree(d,y,x,E,C,R){return _i(d||y.root,x,E,C,R)}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac}),a})(),So=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(f){return Ts.\u0275fac(f)},providedIn:"root"}),a})();class Ji{constructor(f){this._root=f}get root(){return this._root.value}parent(f){const d=this.pathFromRoot(f);return d.length>1?d[d.length-2]:null}children(f){const d=Yo(f,this._root);return d?d.children.map(y=>y.value):[]}firstChild(f){const d=Yo(f,this._root);return d&&d.children.length>0?d.children[0].value:null}siblings(f){const d=Fa(f,this._root);return d.length<2?[]:d[d.length-2].children.map(x=>x.value).filter(x=>x!==f)}pathFromRoot(f){return Fa(f,this._root).map(d=>d.value)}}function Yo(a,f){if(a===f.value)return f;for(const d of f.children){const y=Yo(a,d);if(y)return y}return null}function Fa(a,f){if(a===f.value)return[f];for(const d of f.children){const y=Fa(a,d);if(y.length)return y.unshift(f),y}return[]}class No{constructor(f,d){this.value=f,this.children=d}toString(){return`TreeNode(${this.value})`}}function Mo(a){const f={};return a&&a.children.forEach(d=>f[d.value.outlet]=d),f}class za extends Ji{constructor(f,d){super(f),this.snapshot=d,Ba(this,f)}toString(){return this.snapshot.toString()}}function Ds(a,f){const d=function cs(a,f){const C=new lo([],{},{},"",{},vn,f,null,a.root,-1,{});return new sa("",new No(C,[]))}(a,f),y=new Ie([new _t("",{})]),x=new Ie({}),E=new Ie({}),C=new Ie({}),R=new Ie(""),U=new Uo(y,x,C,R,E,vn,f,d.root);return U.snapshot=d.root,new za(new No(U,[]),d)}class Uo{constructor(f,d,y,x,E,C,R,U){this.url=f,this.params=d,this.queryParams=y,this.fragment=x,this.data=E,this.outlet=C,this.component=R,this.title=this.data?.pipe((0,Vt.U)(Y=>Y[sr]))??(0,Ve.of)(void 0),this._futureSnapshot=U}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Vt.U)(f=>Kr(f)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Vt.U)(f=>Kr(f)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function oa(a,f="emptyOnly"){const d=a.pathFromRoot;let y=0;if("always"!==f)for(y=d.length-1;y>=1;){const x=d[y],E=d[y-1];if(x.routeConfig&&""===x.routeConfig.path)y--;else{if(E.component)break;y--}}return function Us(a){return a.reduce((f,d)=>({params:{...f.params,...d.params},data:{...f.data,...d.data},resolve:{...d.data,...f.resolve,...d.routeConfig?.data,...d._resolvedData}}),{params:{},data:{},resolve:{}})}(d.slice(y))}class lo{get title(){return this.data?.[sr]}constructor(f,d,y,x,E,C,R,U,Y,oe,ce){this.url=f,this.params=d,this.queryParams=y,this.fragment=x,this.data=E,this.outlet=C,this.component=R,this.routeConfig=U,this._urlSegment=Y,this._lastPathIndex=oe,this._resolve=ce}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Kr(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Kr(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(y=>y.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class sa extends Ji{constructor(f,d){super(d),this.url=f,Ba(this,d)}toString(){return Cs(this._root)}}function Ba(a,f){f.value._routerState=a,f.children.forEach(d=>Ba(a,d))}function Cs(a){const f=a.children.length>0?` { ${a.children.map(Cs).join(", ")} } `:"";return`${a.value}${f}`}function aa(a){if(a.snapshot){const f=a.snapshot,d=a._futureSnapshot;a.snapshot=d,Ii(f.queryParams,d.queryParams)||a.queryParams.next(d.queryParams),f.fragment!==d.fragment&&a.fragment.next(d.fragment),Ii(f.params,d.params)||a.params.next(d.params),function Bo(a,f){if(a.length!==f.length)return!1;for(let d=0;d<a.length;++d)if(!Ii(a[d],f[d]))return!1;return!0}(f.url,d.url)||a.url.next(d.url),Ii(f.data,d.data)||a.data.next(d.data)}else a.snapshot=a._futureSnapshot,a.data.next(a._futureSnapshot.data)}function vo(a,f){const d=Ii(a.params,f.params)&&function Fe(a,f){return Le(a,f)&&a.every((d,y)=>Ii(d.parameters,f[y].parameters))}(a.url,f.url);return d&&!(!a.parent!=!f.parent)&&(!a.parent||vo(a.parent,f.parent))}function Io(a,f,d){if(d&&a.shouldReuseRoute(f.value,d.value.snapshot)){const y=d.value;y._futureSnapshot=f.value;const x=function js(a,f,d){return f.children.map(y=>{for(const x of d.children)if(a.shouldReuseRoute(y.value,x.value.snapshot))return Io(a,y,x);return Io(a,y)})}(a,f,d);return new No(y,x)}{if(a.shouldAttach(f.value)){const E=a.retrieve(f.value);if(null!==E){const C=E.route;return C.value._futureSnapshot=f.value,C.children=f.children.map(R=>Io(a,R)),C}}const y=function Na(a){return new Uo(new Ie(a.url),new Ie(a.params),new Ie(a.queryParams),new Ie(a.fragment),new Ie(a.data),a.outlet,a.component,a)}(f.value),x=f.children.map(E=>Io(a,E));return new No(y,x)}}const ca="ngNavigationCancelingError";function po(a,f){const{redirectTo:d,navigationBehaviorOptions:y}=fo(f)?{redirectTo:f,navigationBehaviorOptions:void 0}:f,x=wa(!1,0,f);return x.url=d,x.navigationBehaviorOptions=y,x}function wa(a,f,d){const y=new Error("NavigationCancelingError: "+(a||""));return y[ca]=!0,y.cancellationCode=f,d&&(y.url=d),y}function us(a){return gr(a)&&fo(a.url)}function gr(a){return a&&a[ca]}class ba{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Jo,this.attachRef=null}}let Jo=(()=>{class a{constructor(){this.contexts=new Map}onChildOutletCreated(d,y){const x=this.getOrCreateContext(d);x.outlet=y,this.contexts.set(d,x)}onChildOutletDestroyed(d){const y=this.getContext(d);y&&(y.outlet=null,y.attachRef=null)}onOutletDeactivated(){const d=this.contexts;return this.contexts=new Map,d}onOutletReAttached(d){this.contexts=d}getOrCreateContext(d){let y=this.getContext(d);return y||(y=new ba,this.contexts.set(d,y)),y}getContext(d){return this.contexts.get(d)||null}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const hs=!1;let Qo=(()=>{class a{constructor(){this.activated=null,this._activatedRoute=null,this.name=vn,this.activateEvents=new W.vpe,this.deactivateEvents=new W.vpe,this.attachEvents=new W.vpe,this.detachEvents=new W.vpe,this.parentContexts=(0,W.f3M)(Jo),this.location=(0,W.f3M)(W.s_b),this.changeDetector=(0,W.f3M)(W.sBO),this.environmentInjector=(0,W.f3M)(W.lqb)}ngOnChanges(d){if(d.name){const{firstChange:y,previousValue:x}=d.name;if(y)return;this.isTrackedInParentContexts(x)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(x)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(d){return this.parentContexts.getContext(d)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const d=this.parentContexts.getContext(this.name);d?.route&&(d.attachRef?this.attach(d.attachRef,d.route):this.activateWith(d.route,d.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new W.vHH(4012,hs);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new W.vHH(4012,hs);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new W.vHH(4012,hs);this.location.detach();const d=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(d.instance),d}attach(d,y){this.activated=d,this._activatedRoute=y,this.location.insert(d.hostView),this.attachEvents.emit(d.instance)}deactivate(){if(this.activated){const d=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(d)}}activateWith(d,y){if(this.isActivated)throw new W.vHH(4013,hs);this._activatedRoute=d;const x=this.location,C=d.snapshot.component,R=this.parentContexts.getOrCreateContext(this.name).children,U=new Zi(d,R,x.injector);if(y&&function Ao(a){return!!a.resolveComponentFactory}(y)){const Y=y.resolveComponentFactory(C);this.activated=x.createComponent(Y,x.length,U)}else this.activated=x.createComponent(C,{index:x.length,injector:U,environmentInjector:y??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275dir=W.lG2({type:a,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[W.TTD]}),a})();class Zi{constructor(f,d,y){this.route=f,this.childContexts=d,this.parent=y}get(f,d){return f===Uo?this.route:f===Jo?this.childContexts:this.parent.get(f,d)}}let xo=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275cmp=W.Xpm({type:a,selectors:[["ng-component"]],standalone:!0,features:[W.jDz],decls:1,vars:0,template:function(d,y){1&d&&W._UZ(0,"router-outlet")},dependencies:[Qo],encapsulation:2}),a})();function Qi(a,f){return a.providers&&!a._injector&&(a._injector=(0,W.MMx)(a.providers,f,`Route: ${a.path}`)),a._injector??f}function jo(a){const f=a.children&&a.children.map(jo),d=f?{...a,children:f}:{...a};return!d.component&&!d.loadComponent&&(f||d.loadChildren)&&d.outlet&&d.outlet!==vn&&(d.component=xo),d}function Wr(a){return a.outlet||vn}function ha(a,f){const d=a.filter(y=>Wr(y)===f);return d.push(...a.filter(y=>Wr(y)!==f)),d}function es(a){if(!a)return null;if(a.routeConfig?._injector)return a.routeConfig._injector;for(let f=a.parent;f;f=f.parent){const d=f.routeConfig;if(d?._loadedInjector)return d._loadedInjector;if(d?._injector)return d._injector}return null}class Is{constructor(f,d,y,x){this.routeReuseStrategy=f,this.futureState=d,this.currState=y,this.forwardEvent=x}activate(f){const d=this.futureState._root,y=this.currState?this.currState._root:null;this.deactivateChildRoutes(d,y,f),aa(this.futureState.root),this.activateChildRoutes(d,y,f)}deactivateChildRoutes(f,d,y){const x=Mo(d);f.children.forEach(E=>{const C=E.value.outlet;this.deactivateRoutes(E,x[C],y),delete x[C]}),gt(x,(E,C)=>{this.deactivateRouteAndItsChildren(E,y)})}deactivateRoutes(f,d,y){const x=f.value,E=d?d.value:null;if(x===E)if(x.component){const C=y.getContext(x.outlet);C&&this.deactivateChildRoutes(f,d,C.children)}else this.deactivateChildRoutes(f,d,y);else E&&this.deactivateRouteAndItsChildren(d,y)}deactivateRouteAndItsChildren(f,d){f.value.component&&this.routeReuseStrategy.shouldDetach(f.value.snapshot)?this.detachAndStoreRouteSubtree(f,d):this.deactivateRouteAndOutlet(f,d)}detachAndStoreRouteSubtree(f,d){const y=d.getContext(f.value.outlet),x=y&&f.value.component?y.children:d,E=Mo(f);for(const C of Object.keys(E))this.deactivateRouteAndItsChildren(E[C],x);if(y&&y.outlet){const C=y.outlet.detach(),R=y.children.onOutletDeactivated();this.routeReuseStrategy.store(f.value.snapshot,{componentRef:C,route:f,contexts:R})}}deactivateRouteAndOutlet(f,d){const y=d.getContext(f.value.outlet),x=y&&f.value.component?y.children:d,E=Mo(f);for(const C of Object.keys(E))this.deactivateRouteAndItsChildren(E[C],x);y&&(y.outlet&&(y.outlet.deactivate(),y.children.onOutletDeactivated()),y.attachRef=null,y.resolver=null,y.route=null)}activateChildRoutes(f,d,y){const x=Mo(d);f.children.forEach(E=>{this.activateRoutes(E,x[E.value.outlet],y),this.forwardEvent(new Ni(E.value.snapshot))}),f.children.length&&this.forwardEvent(new Js(f.value.snapshot))}activateRoutes(f,d,y){const x=f.value,E=d?d.value:null;if(aa(x),x===E)if(x.component){const C=y.getOrCreateContext(x.outlet);this.activateChildRoutes(f,d,C.children)}else this.activateChildRoutes(f,d,y);else if(x.component){const C=y.getOrCreateContext(x.outlet);if(this.routeReuseStrategy.shouldAttach(x.snapshot)){const R=this.routeReuseStrategy.retrieve(x.snapshot);this.routeReuseStrategy.store(x.snapshot,null),C.children.onOutletReAttached(R.contexts),C.attachRef=R.componentRef,C.route=R.route.value,C.outlet&&C.outlet.attach(R.componentRef,R.route.value),aa(R.route.value),this.activateChildRoutes(f,null,C.children)}else{const R=es(x.snapshot),U=R?.get(W._Vd)??null;C.attachRef=null,C.route=x,C.resolver=U,C.injector=R,C.outlet&&C.outlet.activateWith(x,C.injector),this.activateChildRoutes(f,null,C.children)}}else this.activateChildRoutes(f,null,y)}}class Gs{constructor(f){this.path=f,this.route=this.path[this.path.length-1]}}class wo{constructor(f,d){this.component=f,this.route=d}}function tr(a,f,d){const y=a._root;return ea(y,f?f._root:null,d,[y.value])}function As(a,f){const d=Symbol(),y=f.get(a,d);return y===d?"function"!=typeof a||(0,W.Z0I)(a)?f.get(a):a:y}function ea(a,f,d,y,x={canDeactivateChecks:[],canActivateChecks:[]}){const E=Mo(f);return a.children.forEach(C=>{(function bi(a,f,d,y,x={canDeactivateChecks:[],canActivateChecks:[]}){const E=a.value,C=f?f.value:null,R=d?d.getContext(a.value.outlet):null;if(C&&E.routeConfig===C.routeConfig){const U=function Ea(a,f,d){if("function"==typeof d)return d(a,f);switch(d){case"pathParamsChange":return!Le(a.url,f.url);case"pathParamsOrQueryParamsChange":return!Le(a.url,f.url)||!Ii(a.queryParams,f.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!vo(a,f)||!Ii(a.queryParams,f.queryParams);default:return!vo(a,f)}}(C,E,E.routeConfig.runGuardsAndResolvers);U?x.canActivateChecks.push(new Gs(y)):(E.data=C.data,E._resolvedData=C._resolvedData),ea(a,f,E.component?R?R.children:null:d,y,x),U&&R&&R.outlet&&R.outlet.isActivated&&x.canDeactivateChecks.push(new wo(R.outlet.component,C))}else C&&Po(f,R,x),x.canActivateChecks.push(new Gs(y)),ea(a,null,E.component?R?R.children:null:d,y,x)})(C,E[C.value.outlet],d,y.concat([C.value]),x),delete E[C.value.outlet]}),gt(E,(C,R)=>Po(C,d.getContext(R),x)),x}function Po(a,f,d){const y=Mo(a),x=a.value;gt(y,(E,C)=>{Po(E,x.component?f?f.children.getContext(C):null:f,d)}),d.canDeactivateChecks.push(new wo(x.component&&f&&f.outlet&&f.outlet.isActivated?f.outlet.component:null,x))}function da(a){return"function"==typeof a}function bo(a){return a instanceof St||"EmptyError"===a?.name}const Vo=Symbol("INITIAL_VALUE");function $o(){return(0,at.w)(a=>jt(a.map(f=>f.pipe((0,rt.q)(1),(0,Mt.O)(Vo)))).pipe((0,Vt.U)(f=>{for(const d of f)if(!0!==d){if(d===Vo)return Vo;if(!1===d||d instanceof ii)return d}return!0}),(0,At.h)(f=>f!==Vo),(0,rt.q)(1)))}function A(a){return(0,Ne.z)((0,yn.b)(f=>{if(fo(f))throw po(0,f)}),(0,Vt.U)(f=>!0===f))}const ne={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ge(a,f,d,y,x){const E=Oe(a,f,d);return E.matched?function j(a,f,d,y){const x=f.canMatch;if(!x||0===x.length)return(0,Ve.of)(!0);const E=x.map(C=>{const R=As(C,a);return xi(function $i(a){return a&&da(a.canMatch)}(R)?R.canMatch(f,d):a.runInContext(()=>R(f,d)))});return(0,Ve.of)(E).pipe($o(),A())}(y=Qi(f,y),f,d).pipe((0,Vt.U)(C=>!0===C?E:{...ne})):(0,Ve.of)(E)}function Oe(a,f,d){if(""===f.path)return"full"===f.pathMatch&&(a.hasChildren()||d.length>0)?{...ne}:{matched:!0,consumedSegments:[],remainingSegments:d,parameters:{},positionalParamSegments:{}};const x=(f.matcher||Fr)(d,a,f);if(!x)return{...ne};const E={};gt(x.posParams,(R,U)=>{E[U]=R.path});const C=x.consumed.length>0?{...E,...x.consumed[x.consumed.length-1].parameters}:E;return{matched:!0,consumedSegments:x.consumed,remainingSegments:d.slice(x.consumed.length),parameters:C,positionalParamSegments:x.posParams??{}}}function ze(a,f,d,y){if(d.length>0&&function mn(a,f,d){return d.some(y=>ur(a,f,y)&&Wr(y)!==vn)}(a,d,y)){const E=new Hn(f,function Et(a,f,d,y){const x={};x[vn]=y,y._sourceSegment=a,y._segmentIndexShift=f.length;for(const E of d)if(""===E.path&&Wr(E)!==vn){const C=new Hn([],{});C._sourceSegment=a,C._segmentIndexShift=f.length,x[Wr(E)]=C}return x}(a,f,y,new Hn(d,a.children)));return E._sourceSegment=a,E._segmentIndexShift=f.length,{segmentGroup:E,slicedSegments:[]}}if(0===d.length&&function gn(a,f,d){return d.some(y=>ur(a,f,y))}(a,d,y)){const E=new Hn(a.segments,function Qe(a,f,d,y,x){const E={};for(const C of y)if(ur(a,d,C)&&!x[Wr(C)]){const R=new Hn([],{});R._sourceSegment=a,R._segmentIndexShift=f.length,E[Wr(C)]=R}return{...x,...E}}(a,f,d,y,a.children));return E._sourceSegment=a,E._segmentIndexShift=f.length,{segmentGroup:E,slicedSegments:d}}const x=new Hn(a.segments,a.children);return x._sourceSegment=a,x._segmentIndexShift=f.length,{segmentGroup:x,slicedSegments:d}}function ur(a,f,d){return(!(a.hasChildren()||f.length>0)||"full"!==d.pathMatch)&&""===d.path}function hr(a,f,d,y){return!!(Wr(a)===y||y!==vn&&ur(f,d,a))&&("**"===a.path||Oe(f,a,d).matched)}function Vn(a,f,d){return 0===f.length&&!a.children[d]}const Xn=!1;class pr{constructor(f){this.segmentGroup=f||null}}class Br{constructor(f){this.urlTree=f}}function Jr(a){return sn(new pr(a))}function Pr(a){return sn(new Br(a))}class Bn{constructor(f,d,y,x,E){this.injector=f,this.configLoader=d,this.urlSerializer=y,this.urlTree=x,this.config=E,this.allowRedirects=!0}apply(){const f=ze(this.urlTree.root,[],[],this.config).segmentGroup,d=new Hn(f.segments,f.children);return this.expandSegmentGroup(this.injector,this.config,d,vn).pipe((0,Vt.U)(E=>this.createUrlTree(Cr(E),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,Qt.K)(E=>{if(E instanceof Br)return this.allowRedirects=!1,this.match(E.urlTree);throw E instanceof pr?this.noMatchError(E):E}))}match(f){return this.expandSegmentGroup(this.injector,this.config,f.root,vn).pipe((0,Vt.U)(x=>this.createUrlTree(Cr(x),f.queryParams,f.fragment))).pipe((0,Qt.K)(x=>{throw x instanceof pr?this.noMatchError(x):x}))}noMatchError(f){return new W.vHH(4002,Xn)}createUrlTree(f,d,y){const x=Sn(f);return new ii(x,d,y)}expandSegmentGroup(f,d,y,x){return 0===y.segments.length&&y.hasChildren()?this.expandChildren(f,d,y).pipe((0,Vt.U)(E=>new Hn([],E))):this.expandSegment(f,y,d,y.segments,x,!0)}expandChildren(f,d,y){const x=[];for(const E of Object.keys(y.children))"primary"===E?x.unshift(E):x.push(E);return(0,ee.D)(x).pipe((0,bn.b)(E=>{const C=y.children[E],R=ha(d,E);return this.expandSegmentGroup(f,R,C,E).pipe((0,Vt.U)(U=>({segment:U,outlet:E})))}),ir((E,C)=>(E[C.outlet]=C.segment,E),{}),Tn())}expandSegment(f,d,y,x,E,C){return(0,ee.D)(y).pipe((0,bn.b)(R=>this.expandSegmentAgainstRoute(f,d,y,R,x,E,C).pipe((0,Qt.K)(Y=>{if(Y instanceof pr)return(0,Ve.of)(null);throw Y}))),mr(R=>!!R),(0,Qt.K)((R,U)=>{if(bo(R))return Vn(d,x,E)?(0,Ve.of)(new Hn([],{})):Jr(d);throw R}))}expandSegmentAgainstRoute(f,d,y,x,E,C,R){return hr(x,d,E,C)?void 0===x.redirectTo?this.matchSegmentAgainstRoute(f,d,x,E,C):R&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C):Jr(d):Jr(d)}expandSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C){return"**"===x.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(f,y,x,C):this.expandRegularSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C)}expandWildCardWithParamsAgainstRouteUsingRedirect(f,d,y,x){const E=this.applyRedirectCommands([],y.redirectTo,{});return y.redirectTo.startsWith("/")?Pr(E):this.lineralizeSegments(y,E).pipe((0,Wt.z)(C=>{const R=new Hn(C,{});return this.expandSegment(f,R,d,C,x,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C){const{matched:R,consumedSegments:U,remainingSegments:Y,positionalParamSegments:oe}=Oe(d,x,E);if(!R)return Jr(d);const ce=this.applyRedirectCommands(U,x.redirectTo,oe);return x.redirectTo.startsWith("/")?Pr(ce):this.lineralizeSegments(x,ce).pipe((0,Wt.z)(de=>this.expandSegment(f,d,y,de.concat(Y),C,!1)))}matchSegmentAgainstRoute(f,d,y,x,E){return"**"===y.path?(f=Qi(y,f),y.loadChildren?(y._loadedRoutes?(0,Ve.of)({routes:y._loadedRoutes,injector:y._loadedInjector}):this.configLoader.loadChildren(f,y)).pipe((0,Vt.U)(R=>(y._loadedRoutes=R.routes,y._loadedInjector=R.injector,new Hn(x,{})))):(0,Ve.of)(new Hn(x,{}))):ge(d,y,x,f).pipe((0,at.w)(({matched:C,consumedSegments:R,remainingSegments:U})=>C?this.getChildConfig(f=y._injector??f,y,x).pipe((0,Wt.z)(oe=>{const ce=oe.injector??f,de=oe.routes,{segmentGroup:me,slicedSegments:te}=ze(d,R,U,de),be=new Hn(me.segments,me.children);if(0===te.length&&be.hasChildren())return this.expandChildren(ce,de,be).pipe((0,Vt.U)(Ae=>new Hn(R,Ae)));if(0===de.length&&0===te.length)return(0,Ve.of)(new Hn(R,{}));const ye=Wr(y)===E;return this.expandSegment(ce,be,de,te,ye?vn:E,!0).pipe((0,Vt.U)(Re=>new Hn(R.concat(Re.segments),Re.children)))})):Jr(d)))}getChildConfig(f,d,y){return d.children?(0,Ve.of)({routes:d.children,injector:f}):d.loadChildren?void 0!==d._loadedRoutes?(0,Ve.of)({routes:d._loadedRoutes,injector:d._loadedInjector}):function M(a,f,d,y){const x=f.canLoad;if(void 0===x||0===x.length)return(0,Ve.of)(!0);const E=x.map(C=>{const R=As(C,a);return xi(function Ft(a){return a&&da(a.canLoad)}(R)?R.canLoad(f,d):a.runInContext(()=>R(f,d)))});return(0,Ve.of)(E).pipe($o(),A())}(f,d,y).pipe((0,Wt.z)(x=>x?this.configLoader.loadChildren(f,d).pipe((0,yn.b)(E=>{d._loadedRoutes=E.routes,d._loadedInjector=E.injector})):function Sr(a){return sn(wa(Xn,3))}())):(0,Ve.of)({routes:[],injector:f})}lineralizeSegments(f,d){let y=[],x=d.root;for(;;){if(y=y.concat(x.segments),0===x.numberOfChildren)return(0,Ve.of)(y);if(x.numberOfChildren>1||!x.children[vn])return f.redirectTo,sn(new W.vHH(4e3,Xn));x=x.children[vn]}}applyRedirectCommands(f,d,y){return this.applyRedirectCreateUrlTree(d,this.urlSerializer.parse(d),f,y)}applyRedirectCreateUrlTree(f,d,y,x){const E=this.createSegmentGroup(f,d.root,y,x);return new ii(E,this.createQueryParams(d.queryParams,this.urlTree.queryParams),d.fragment)}createQueryParams(f,d){const y={};return gt(f,(x,E)=>{if("string"==typeof x&&x.startsWith(":")){const R=x.substring(1);y[E]=d[R]}else y[E]=x}),y}createSegmentGroup(f,d,y,x){const E=this.createSegments(f,d.segments,y,x);let C={};return gt(d.children,(R,U)=>{C[U]=this.createSegmentGroup(f,R,y,x)}),new Hn(E,C)}createSegments(f,d,y,x){return d.map(E=>E.path.startsWith(":")?this.findPosParam(f,E,x):this.findOrReturn(E,y))}findPosParam(f,d,y){const x=y[d.path.substring(1)];if(!x)throw new W.vHH(4001,Xn);return x}findOrReturn(f,d){let y=0;for(const x of d){if(x.path===f.path)return d.splice(y),x;y++}return f}}class F{}class ae{constructor(f,d,y,x,E,C,R){this.injector=f,this.rootComponentType=d,this.config=y,this.urlTree=x,this.url=E,this.paramsInheritanceStrategy=C,this.urlSerializer=R}recognize(){const f=ze(this.urlTree.root,[],[],this.config.filter(d=>void 0===d.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,f,vn).pipe((0,Vt.U)(d=>{if(null===d)return null;const y=new lo([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},vn,this.rootComponentType,null,this.urlTree.root,-1,{}),x=new No(y,d),E=new sa(this.url,x);return this.inheritParamsAndData(E._root),E}))}inheritParamsAndData(f){const d=f.value,y=oa(d,this.paramsInheritanceStrategy);d.params=Object.freeze(y.params),d.data=Object.freeze(y.data),f.children.forEach(x=>this.inheritParamsAndData(x))}processSegmentGroup(f,d,y,x){return 0===y.segments.length&&y.hasChildren()?this.processChildren(f,d,y):this.processSegment(f,d,y,y.segments,x)}processChildren(f,d,y){return(0,ee.D)(Object.keys(y.children)).pipe((0,bn.b)(x=>{const E=y.children[x],C=ha(d,x);return this.processSegmentGroup(f,C,E,x)}),ir((x,E)=>x&&E?(x.push(...E),x):null),function ni(a,f=!1){return(0,Yt.e)((d,y)=>{let x=0;d.subscribe((0,Kt.x)(y,E=>{const C=a(E,x++);(C||f)&&y.next(E),!C&&y.complete()}))})}(x=>null!==x),qt(null),Tn(),(0,Vt.U)(x=>{if(null===x)return null;const E=k(x);return function Se(a){a.sort((f,d)=>f.value.outlet===vn?-1:d.value.outlet===vn?1:f.value.outlet.localeCompare(d.value.outlet))}(E),E}))}processSegment(f,d,y,x,E){return(0,ee.D)(d).pipe((0,bn.b)(C=>this.processSegmentAgainstRoute(C._injector??f,C,y,x,E)),mr(C=>!!C),(0,Qt.K)(C=>{if(bo(C))return Vn(y,x,E)?(0,Ve.of)([]):(0,Ve.of)(null);throw C}))}processSegmentAgainstRoute(f,d,y,x,E){if(d.redirectTo||!hr(d,y,x,E))return(0,Ve.of)(null);let C;if("**"===d.path){const R=x.length>0?zr(x).parameters:{},U=$e(y)+x.length,Y=new lo(x,R,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,An(d),Wr(d),d.component??d._loadedComponent??null,d,_e(y),U,nr(d));C=(0,Ve.of)({snapshot:Y,consumedSegments:[],remainingSegments:[]})}else C=ge(y,d,x,f).pipe((0,Vt.U)(({matched:R,consumedSegments:U,remainingSegments:Y,parameters:oe})=>{if(!R)return null;const ce=$e(y)+U.length;return{snapshot:new lo(U,oe,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,An(d),Wr(d),d.component??d._loadedComponent??null,d,_e(y),ce,nr(d)),consumedSegments:U,remainingSegments:Y}}));return C.pipe((0,at.w)(R=>{if(null===R)return(0,Ve.of)(null);const{snapshot:U,consumedSegments:Y,remainingSegments:oe}=R;f=d._injector??f;const ce=d._loadedInjector??f,de=function ot(a){return a.children?a.children:a.loadChildren?a._loadedRoutes:[]}(d),{segmentGroup:me,slicedSegments:te}=ze(y,Y,oe,de.filter(ye=>void 0===ye.redirectTo));if(0===te.length&&me.hasChildren())return this.processChildren(ce,de,me).pipe((0,Vt.U)(ye=>null===ye?null:[new No(U,ye)]));if(0===de.length&&0===te.length)return(0,Ve.of)([new No(U,[])]);const be=Wr(d)===E;return this.processSegment(ce,de,me,te,be?vn:E).pipe((0,Vt.U)(ye=>null===ye?null:[new No(U,ye)]))}))}}function I(a){const f=a.value.routeConfig;return f&&""===f.path&&void 0===f.redirectTo}function k(a){const f=[],d=new Set;for(const y of a){if(!I(y)){f.push(y);continue}const x=f.find(E=>y.value.routeConfig===E.value.routeConfig);void 0!==x?(x.children.push(...y.children),d.add(x)):f.push(y)}for(const y of d){const x=k(y.children);f.push(new No(y.value,x))}return f.filter(y=>!d.has(y))}function _e(a){let f=a;for(;f._sourceSegment;)f=f._sourceSegment;return f}function $e(a){let f=a,d=f._segmentIndexShift??0;for(;f._sourceSegment;)f=f._sourceSegment,d+=f._segmentIndexShift??0;return d-1}function An(a){return a.data||{}}function nr(a){return a.resolve||{}}function Hs(a){return"string"==typeof a.title||null===a.title}function Wo(a){return(0,at.w)(f=>{const d=a(f);return d?(0,ee.D)(d).pipe((0,Vt.U)(()=>f)):(0,Ve.of)(f)})}const Ca=new W.OlP("ROUTES");let Sa=(()=>{class a{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,W.f3M)(W.Sil)}loadComponent(d){if(this.componentLoaders.get(d))return this.componentLoaders.get(d);if(d._loadedComponent)return(0,Ve.of)(d._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(d);const y=xi(d.loadComponent()).pipe((0,Vt.U)(eo),(0,yn.b)(E=>{this.onLoadEndListener&&this.onLoadEndListener(d),d._loadedComponent=E}),ei(()=>{this.componentLoaders.delete(d)})),x=new un(y,()=>new u.x).pipe(Bt());return this.componentLoaders.set(d,x),x}loadChildren(d,y){if(this.childrenLoaders.get(y))return this.childrenLoaders.get(y);if(y._loadedRoutes)return(0,Ve.of)({routes:y._loadedRoutes,injector:y._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(y);const E=this.loadModuleFactoryOrRoutes(y.loadChildren).pipe((0,Vt.U)(R=>{this.onLoadEndListener&&this.onLoadEndListener(y);let U,Y,oe=!1;Array.isArray(R)?Y=R:(U=R.create(d).injector,Y=to(U.get(Ca,[],W.XFs.Self|W.XFs.Optional)));return{routes:Y.map(jo),injector:U}}),ei(()=>{this.childrenLoaders.delete(y)})),C=new un(E,()=>new u.x).pipe(Bt());return this.childrenLoaders.set(y,C),C}loadModuleFactoryOrRoutes(d){return xi(d()).pipe((0,Vt.U)(eo),(0,Wt.z)(y=>y instanceof W.YKP||Array.isArray(y)?(0,Ve.of)(y):(0,ee.D)(this.compiler.compileModuleAsync(y))))}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function eo(a){return function tc(a){return a&&"object"==typeof a&&"default"in a}(a)?a.default:a}let pl=(()=>{class a{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new u.x,this.configLoader=(0,W.f3M)(Sa),this.environmentInjector=(0,W.f3M)(W.lqb),this.urlSerializer=(0,W.f3M)(Rt),this.rootContexts=(0,W.f3M)(Jo),this.navigationId=0,this.afterPreactivation=()=>(0,Ve.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=x=>this.events.next(new ao(x)),this.configLoader.onLoadStartListener=x=>this.events.next(new Yi(x))}complete(){this.transitions?.complete()}handleNavigationRequest(d){const y=++this.navigationId;this.transitions?.next({...this.transitions.value,...d,id:y})}setupNavigations(d){return this.transitions=new Ie({id:0,targetPageId:0,currentUrlTree:d.currentUrlTree,currentRawUrl:d.currentUrlTree,extractedUrl:d.urlHandlingStrategy.extract(d.currentUrlTree),urlAfterRedirects:d.urlHandlingStrategy.extract(d.currentUrlTree),rawUrl:d.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:ls,restoredState:null,currentSnapshot:d.routerState.snapshot,targetSnapshot:null,currentRouterState:d.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,At.h)(y=>0!==y.id),(0,Vt.U)(y=>({...y,extractedUrl:d.urlHandlingStrategy.extract(y.rawUrl)})),(0,at.w)(y=>{let x=!1,E=!1;return(0,Ve.of)(y).pipe((0,yn.b)(C=>{this.currentNavigation={id:C.id,initialUrl:C.rawUrl,extractedUrl:C.extractedUrl,trigger:C.source,extras:C.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,at.w)(C=>{const R=d.browserUrlTree.toString(),U=!d.navigated||C.extractedUrl.toString()!==R||R!==d.currentUrlTree.toString();if(!U&&"reload"!==(C.extras.onSameUrlNavigation??d.onSameUrlNavigation)){const oe="";return this.events.next(new so(C.id,d.serializeUrl(y.rawUrl),oe,0)),d.rawUrlTree=C.rawUrl,C.resolve(null),_n.E}if(d.urlHandlingStrategy.shouldProcessUrl(C.rawUrl))return Pu(C.source)&&(d.browserUrlTree=C.extractedUrl),(0,Ve.of)(C).pipe((0,at.w)(oe=>{const ce=this.transitions?.getValue();return this.events.next(new Ys(oe.id,this.urlSerializer.serialize(oe.extractedUrl),oe.source,oe.restoredState)),ce!==this.transitions?.getValue()?_n.E:Promise.resolve(oe)}),function Ho(a,f,d,y){return(0,at.w)(x=>function Ei(a,f,d,y,x){return new Bn(a,f,d,y,x).apply()}(a,f,d,x.extractedUrl,y).pipe((0,Vt.U)(E=>({...x,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,d.config),(0,yn.b)(oe=>{this.currentNavigation={...this.currentNavigation,finalUrl:oe.urlAfterRedirects},y.urlAfterRedirects=oe.urlAfterRedirects}),function mt(a,f,d,y,x){return(0,Wt.z)(E=>function N(a,f,d,y,x,E,C="emptyOnly"){return new ae(a,f,d,y,x,C,E).recognize().pipe((0,at.w)(R=>null===R?function X(a){return new wt.y(f=>f.error(a))}(new F):(0,Ve.of)(R)))}(a,f,d,E.urlAfterRedirects,y.serialize(E.urlAfterRedirects),y,x).pipe((0,Vt.U)(C=>({...E,targetSnapshot:C}))))}(this.environmentInjector,this.rootComponentType,d.config,this.urlSerializer,d.paramsInheritanceStrategy),(0,yn.b)(oe=>{if(y.targetSnapshot=oe.targetSnapshot,"eager"===d.urlUpdateStrategy){if(!oe.extras.skipLocationChange){const de=d.urlHandlingStrategy.merge(oe.urlAfterRedirects,oe.rawUrl);d.setBrowserUrl(de,oe)}d.browserUrlTree=oe.urlAfterRedirects}const ce=new Bi(oe.id,this.urlSerializer.serialize(oe.extractedUrl),this.urlSerializer.serialize(oe.urlAfterRedirects),oe.targetSnapshot);this.events.next(ce)}));if(U&&d.urlHandlingStrategy.shouldProcessUrl(d.rawUrlTree)){const{id:oe,extractedUrl:ce,source:de,restoredState:me,extras:te}=C,be=new Ys(oe,this.urlSerializer.serialize(ce),de,me);this.events.next(be);const ye=Ds(ce,this.rootComponentType).snapshot;return y={...C,targetSnapshot:ye,urlAfterRedirects:ce,extras:{...te,skipLocationChange:!1,replaceUrl:!1}},(0,Ve.of)(y)}{const oe="";return this.events.next(new so(C.id,d.serializeUrl(y.extractedUrl),oe,1)),d.rawUrlTree=C.rawUrl,C.resolve(null),_n.E}}),(0,yn.b)(C=>{const R=new Ri(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(R)}),(0,Vt.U)(C=>y={...C,guards:tr(C.targetSnapshot,C.currentSnapshot,this.rootContexts)}),function ds(a,f){return(0,Wt.z)(d=>{const{targetSnapshot:y,currentSnapshot:x,guards:{canActivateChecks:E,canDeactivateChecks:C}}=d;return 0===C.length&&0===E.length?(0,Ve.of)({...d,guardsResult:!0}):function kl(a,f,d,y){return(0,ee.D)(a).pipe((0,Wt.z)(x=>function Q(a,f,d,y,x){const E=f&&f.routeConfig?f.routeConfig.canDeactivate:null;if(!E||0===E.length)return(0,Ve.of)(!0);const C=E.map(R=>{const U=es(f)??x,Y=As(R,U);return xi(function el(a){return a&&da(a.canDeactivate)}(Y)?Y.canDeactivate(a,f,d,y):U.runInContext(()=>Y(a,f,d,y))).pipe(mr())});return(0,Ve.of)(C).pipe($o())}(x.component,x.route,d,f,y)),mr(x=>!0!==x,!0))}(C,y,x,a).pipe((0,Wt.z)(R=>R&&function Ta(a){return"boolean"==typeof a}(R)?function Da(a,f,d,y){return(0,ee.D)(f).pipe((0,bn.b)(x=>(0,Pn.z)(function Ro(a,f){return null!==a&&f&&f(new Ns(a)),(0,Ve.of)(!0)}(x.route.parent,y),function Gi(a,f){return null!==a&&f&&f(new ti(a)),(0,Ve.of)(!0)}(x.route,y),function Go(a,f,d){const y=f[f.length-1],E=f.slice(0,f.length-1).reverse().map(C=>function Qs(a){const f=a.routeConfig?a.routeConfig.canActivateChild:null;return f&&0!==f.length?{node:a,guards:f}:null}(C)).filter(C=>null!==C).map(C=>Ye(()=>{const R=C.guards.map(U=>{const Y=es(C.node)??d,oe=As(U,Y);return xi(function ta(a){return a&&da(a.canActivateChild)}(oe)?oe.canActivateChild(y,a):Y.runInContext(()=>oe(y,a))).pipe(mr())});return(0,Ve.of)(R).pipe($o())}));return(0,Ve.of)(E).pipe($o())}(a,x.path,d),function fl(a,f,d){const y=f.routeConfig?f.routeConfig.canActivate:null;if(!y||0===y.length)return(0,Ve.of)(!0);const x=y.map(E=>Ye(()=>{const C=es(f)??d,R=As(E,C);return xi(function ar(a){return a&&da(a.canActivate)}(R)?R.canActivate(f,a):C.runInContext(()=>R(f,a))).pipe(mr())}));return(0,Ve.of)(x).pipe($o())}(a,x.route,d))),mr(x=>!0!==x,!0))}(y,E,a,f):(0,Ve.of)(R)),(0,Vt.U)(R=>({...d,guardsResult:R})))})}(this.environmentInjector,C=>this.events.next(C)),(0,yn.b)(C=>{if(y.guardsResult=C.guardsResult,fo(C.guardsResult))throw po(0,C.guardsResult);const R=new Hr(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot,!!C.guardsResult);this.events.next(R)}),(0,At.h)(C=>!!C.guardsResult||(d.restoreHistory(C),this.cancelNavigationTransition(C,"",3),!1)),Wo(C=>{if(C.guards.canActivateChecks.length)return(0,Ve.of)(C).pipe((0,yn.b)(R=>{const U=new jr(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects),R.targetSnapshot);this.events.next(U)}),(0,at.w)(R=>{let U=!1;return(0,Ve.of)(R).pipe(function ai(a,f){return(0,Wt.z)(d=>{const{targetSnapshot:y,guards:{canActivateChecks:x}}=d;if(!x.length)return(0,Ve.of)(d);let E=0;return(0,ee.D)(x).pipe((0,bn.b)(C=>function ko(a,f,d,y){const x=a.routeConfig,E=a._resolve;return void 0!==x?.title&&!Hs(x)&&(E[sr]=x.title),function Ti(a,f,d,y){const x=function Hi(a){return[...Object.keys(a),...Object.getOwnPropertySymbols(a)]}(a);if(0===x.length)return(0,Ve.of)({});const E={};return(0,ee.D)(x).pipe((0,Wt.z)(C=>function Ui(a,f,d,y){const x=es(f)??y,E=As(a,x);return xi(E.resolve?E.resolve(f,d):x.runInContext(()=>E(f,d)))}(a[C],f,d,y).pipe(mr(),(0,yn.b)(R=>{E[C]=R}))),Xr(1),function Dn(a){return(0,Vt.U)(()=>a)}(E),(0,Qt.K)(C=>bo(C)?_n.E:sn(C)))}(E,a,f,y).pipe((0,Vt.U)(C=>(a._resolvedData=C,a.data=oa(a,d).resolve,x&&Hs(x)&&(a.data[sr]=x.title),null)))}(C.route,y,a,f)),(0,yn.b)(()=>E++),Xr(1),(0,Wt.z)(C=>E===x.length?(0,Ve.of)(d):_n.E))})}(d.paramsInheritanceStrategy,this.environmentInjector),(0,yn.b)({next:()=>U=!0,complete:()=>{U||(d.restoreHistory(R),this.cancelNavigationTransition(R,"",2))}}))}),(0,yn.b)(R=>{const U=new ia(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects),R.targetSnapshot);this.events.next(U)}))}),Wo(C=>{const R=U=>{const Y=[];U.routeConfig?.loadComponent&&!U.routeConfig._loadedComponent&&Y.push(this.configLoader.loadComponent(U.routeConfig).pipe((0,yn.b)(oe=>{U.component=oe}),(0,Vt.U)(()=>{})));for(const oe of U.children)Y.push(...R(oe));return Y};return jt(R(C.targetSnapshot.root)).pipe(qt(),(0,rt.q)(1))}),Wo(()=>this.afterPreactivation()),(0,Vt.U)(C=>{const R=function la(a,f,d){const y=Io(a,f._root,d?d._root:void 0);return new za(y,f)}(d.routeReuseStrategy,C.targetSnapshot,C.currentRouterState);return y={...C,targetRouterState:R}}),(0,yn.b)(C=>{d.currentUrlTree=C.urlAfterRedirects,d.rawUrlTree=d.urlHandlingStrategy.merge(C.urlAfterRedirects,C.rawUrl),d.routerState=C.targetRouterState,"deferred"===d.urlUpdateStrategy&&(C.extras.skipLocationChange||d.setBrowserUrl(d.rawUrlTree,C),d.browserUrlTree=C.urlAfterRedirects)}),((a,f,d)=>(0,Vt.U)(y=>(new Is(f,y.targetRouterState,y.currentRouterState,d).activate(a),y)))(this.rootContexts,d.routeReuseStrategy,C=>this.events.next(C)),(0,yn.b)({next:C=>{x=!0,this.lastSuccessfulNavigation=this.currentNavigation,d.navigated=!0,this.events.next(new Ki(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(d.currentUrlTree))),d.titleStrategy?.updateTitle(C.targetRouterState.snapshot),C.resolve(!0)},complete:()=>{x=!0}}),ei(()=>{x||E||this.cancelNavigationTransition(y,"",1),this.currentNavigation?.id===y.id&&(this.currentNavigation=null)}),(0,Qt.K)(C=>{if(E=!0,gr(C)){us(C)||(d.navigated=!0,d.restoreHistory(y,!0));const R=new si(y.id,this.urlSerializer.serialize(y.extractedUrl),C.message,C.cancellationCode);if(this.events.next(R),us(C)){const U=d.urlHandlingStrategy.merge(C.url,d.rawUrlTree),Y={skipLocationChange:y.extras.skipLocationChange,replaceUrl:"eager"===d.urlUpdateStrategy||Pu(y.source)};d.scheduleNavigation(U,ls,null,Y,{resolve:y.resolve,reject:y.reject,promise:y.promise})}else y.resolve(!1)}else{d.restoreHistory(y,!0);const R=new ui(y.id,this.urlSerializer.serialize(y.extractedUrl),C,y.targetSnapshot??void 0);this.events.next(R);try{y.resolve(d.errorHandler(C))}catch(U){y.reject(U)}}return _n.E}))}))}cancelNavigationTransition(d,y,x){const E=new si(d.id,this.urlSerializer.serialize(d.extractedUrl),y,x);this.events.next(E),d.resolve(!1)}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function Pu(a){return a!==ls}let Ll=(()=>{class a{buildTitle(d){let y,x=d.root;for(;void 0!==x;)y=this.getResolvedTitleForRoute(x)??y,x=x.children.find(E=>E.outlet===vn);return y}getResolvedTitleForRoute(d){return d.data[sr]}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return(0,W.f3M)(Pc)},providedIn:"root"}),a})(),Pc=(()=>{class a extends Ll{constructor(d){super(),this.title=d}updateTitle(d){const y=this.buildTitle(d);void 0!==y&&this.title.setTitle(y)}}return a.\u0275fac=function(d){return new(d||a)(W.LFG(qi.Dx))},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Rc=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return(0,W.f3M)(Ol)},providedIn:"root"}),a})();class fa{shouldDetach(f){return!1}store(f,d){}shouldAttach(f){return!1}retrieve(f){return null}shouldReuseRoute(f,d){return f.routeConfig===d.routeConfig}}let Ol=(()=>{class a extends fa{}return a.\u0275fac=function(){let f;return function(y){return(f||(f=W.n5z(a)))(y||a)}}(),a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const ml=new W.OlP("",{providedIn:"root",factory:()=>({})});let nc=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return(0,W.f3M)(kc)},providedIn:"root"}),a})(),kc=(()=>{class a{shouldProcessUrl(d){return!0}extract(d){return d}merge(d,y){return d}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function nu(a){throw a}function _l(a,f,d){return f.parse("/")}const rc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zl={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ts=(()=>{class a{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,W.f3M)(W.c2e),this.isNgZoneEnabled=!1,this.options=(0,W.f3M)(ml,{optional:!0})||{},this.errorHandler=this.options.errorHandler||nu,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||_l,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,W.f3M)(nc),this.routeReuseStrategy=(0,W.f3M)(Rc),this.urlCreationStrategy=(0,W.f3M)(So),this.titleStrategy=(0,W.f3M)(Ll),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=to((0,W.f3M)(Ca,{optional:!0})??[]),this.navigationTransitions=(0,W.f3M)(pl),this.urlSerializer=(0,W.f3M)(Rt),this.location=(0,W.f3M)(rr.Ye),this.isNgZoneEnabled=(0,W.f3M)(W.R0b)instanceof W.R0b&&W.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new ii,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Ds(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(d=>{this.lastSuccessfulId=d.id,this.currentPageId=d.targetPageId},d=>{this.console.warn(`Unhandled Navigation Error: ${d}`)})}resetRootComponentType(d){this.routerState.root.component=d,this.navigationTransitions.rootComponentType=d}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const d=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),ls,d)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(d=>{const y="popstate"===d.type?"popstate":"hashchange";"popstate"===y&&setTimeout(()=>{this.navigateToSyncWithBrowser(d.url,y,d.state)},0)}))}navigateToSyncWithBrowser(d,y,x){const E={replaceUrl:!0},C=x?.navigationId?x:null;if(x){const U={...x};delete U.navigationId,delete U.\u0275routerPageId,0!==Object.keys(U).length&&(E.state=U)}const R=this.parseUrl(d);this.scheduleNavigation(R,y,C,E)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(d){this.config=d.map(jo),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(d,y={}){const{relativeTo:x,queryParams:E,fragment:C,queryParamsHandling:R,preserveFragment:U}=y,Y=U?this.currentUrlTree.fragment:C;let oe=null;switch(R){case"merge":oe={...this.currentUrlTree.queryParams,...E};break;case"preserve":oe=this.currentUrlTree.queryParams;break;default:oe=E||null}return null!==oe&&(oe=this.removeEmptyProps(oe)),this.urlCreationStrategy.createUrlTree(x,this.routerState,this.currentUrlTree,d,oe,Y??null)}navigateByUrl(d,y={skipLocationChange:!1}){const x=fo(d)?d:this.parseUrl(d),E=this.urlHandlingStrategy.merge(x,this.rawUrlTree);return this.scheduleNavigation(E,ls,null,y)}navigate(d,y={skipLocationChange:!1}){return function Ru(a){for(let f=0;f<a.length;f++){const d=a[f];if(null==d)throw new W.vHH(4008,false)}}(d),this.navigateByUrl(this.createUrlTree(d,y),y)}serializeUrl(d){return this.urlSerializer.serialize(d)}parseUrl(d){let y;try{y=this.urlSerializer.parse(d)}catch(x){y=this.malformedUriErrorHandler(x,this.urlSerializer,d)}return y}isActive(d,y){let x;if(x=!0===y?{...rc}:!1===y?{...zl}:y,fo(d))return Fi(this.currentUrlTree,d,x);const E=this.parseUrl(d);return Fi(this.currentUrlTree,E,x)}removeEmptyProps(d){return Object.keys(d).reduce((y,x)=>{const E=d[x];return null!=E&&(y[x]=E),y},{})}scheduleNavigation(d,y,x,E,C){if(this.disposed)return Promise.resolve(!1);let R,U,Y,oe;return C?(R=C.resolve,U=C.reject,Y=C.promise):Y=new Promise((ce,de)=>{R=ce,U=de}),oe="computed"===this.canceledNavigationResolution?x&&x.\u0275routerPageId?x.\u0275routerPageId:E.replaceUrl||E.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:oe,source:y,restoredState:x,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:d,extras:E,resolve:R,reject:U,promise:Y,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Y.catch(ce=>Promise.reject(ce))}setBrowserUrl(d,y){const x=this.urlSerializer.serialize(d),E={...y.extras.state,...this.generateNgRouterState(y.id,y.targetPageId)};this.location.isCurrentPathEqualTo(x)||y.extras.replaceUrl?this.location.replaceState(x,"",E):this.location.go(x,"",E)}restoreHistory(d,y=!1){if("computed"===this.canceledNavigationResolution){const x=this.currentPageId-d.targetPageId;"popstate"!==d.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===x?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===x&&(this.resetState(d),this.browserUrlTree=d.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(x)}else"replace"===this.canceledNavigationResolution&&(y&&this.resetState(d),this.resetUrlToCurrentUrlTree())}resetState(d){this.routerState=d.currentRouterState,this.currentUrlTree=d.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,d.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(d,y){return"computed"===this.canceledNavigationResolution?{navigationId:d,\u0275routerPageId:y}:{navigationId:d}}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Va=(()=>{class a{constructor(d,y,x,E,C,R){this.router=d,this.route=y,this.tabIndexAttribute=x,this.renderer=E,this.el=C,this.locationStrategy=R,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new u.x;const U=C.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===U||"area"===U,this.isAnchorElement?this.subscription=d.events.subscribe(Y=>{Y instanceof Ki&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(d){this._preserveFragment=(0,W.D6c)(d)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(d){this._skipLocationChange=(0,W.D6c)(d)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(d){this._replaceUrl=(0,W.D6c)(d)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(d){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",d)}ngOnChanges(d){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(d){null!=d?(this.commands=Array.isArray(d)?d:[d],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(d,y,x,E,C){return!!(null===this.urlTree||this.isAnchorElement&&(0!==d||y||x||E||C||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const d=null===this.href?null:(0,W.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",d)}applyAttributeValue(d,y){const x=this.renderer,E=this.el.nativeElement;null!==y?x.setAttribute(E,d,y):x.removeAttribute(E,d)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return a.\u0275fac=function(d){return new(d||a)(W.Y36(ts),W.Y36(Uo),W.$8M("tabindex"),W.Y36(W.Qsj),W.Y36(W.SBq),W.Y36(rr.S$))},a.\u0275dir=W.lG2({type:a,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(d,y){1&d&&W.NdJ("click",function(E){return y.onClick(E.button,E.ctrlKey,E.shiftKey,E.altKey,E.metaKey)}),2&d&&W.uIk("target",y.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[W.TTD]}),a})();class Lo{}let dh=(()=>{class a{constructor(d,y,x,E,C){this.router=d,this.injector=x,this.preloadingStrategy=E,this.loader=C}setUpPreloading(){this.subscription=this.router.events.pipe((0,At.h)(d=>d instanceof Ki),(0,bn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(d,y){const x=[];for(const E of y){E.providers&&!E._injector&&(E._injector=(0,W.MMx)(E.providers,d,`Route: ${E.path}`));const C=E._injector??d,R=E._loadedInjector??C;(E.loadChildren&&!E._loadedRoutes&&void 0===E.canLoad||E.loadComponent&&!E._loadedComponent)&&x.push(this.preloadConfig(C,E)),(E.children||E._loadedRoutes)&&x.push(this.processRoutes(R,E.children??E._loadedRoutes))}return(0,ee.D)(x).pipe((0,ri.J)())}preloadConfig(d,y){return this.preloadingStrategy.preload(y,()=>{let x;x=y.loadChildren&&void 0===y.canLoad?this.loader.loadChildren(d,y):(0,Ve.of)(null);const E=x.pipe((0,Wt.z)(C=>null===C?(0,Ve.of)(void 0):(y._loadedRoutes=C.routes,y._loadedInjector=C.injector,this.processRoutes(C.injector??d,C.routes))));if(y.loadComponent&&!y._loadedComponent){const C=this.loader.loadComponent(y);return(0,ee.D)([E,C]).pipe((0,ri.J)())}return E})}}return a.\u0275fac=function(d){return new(d||a)(W.LFG(ts),W.LFG(W.Sil),W.LFG(W.lqb),W.LFG(Lo),W.LFG(Sa))},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const ic=new W.OlP("");let na=(()=>{class a{constructor(d,y,x,E,C={}){this.urlSerializer=d,this.transitions=y,this.viewportScroller=x,this.zone=E,this.options=C,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},C.scrollPositionRestoration=C.scrollPositionRestoration||"disabled",C.anchorScrolling=C.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(d=>{d instanceof Ys?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=d.navigationTrigger,this.restoredId=d.restoredState?d.restoredState.navigationId:0):d instanceof Ki&&(this.lastId=d.id,this.scheduleScrollEvent(d,this.urlSerializer.parse(d.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(d=>{d instanceof xa&&(d.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(d.position):d.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(d.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(d,y){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new xa(d,"popstate"===this.lastSource?this.store[this.restoredId]:null,y))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return a.\u0275fac=function(d){W.$Z()},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac}),a})();var Rs=(()=>((Rs=Rs||{})[Rs.COMPLETE=0]="COMPLETE",Rs[Rs.FAILED=1]="FAILED",Rs[Rs.REDIRECTING=2]="REDIRECTING",Rs))();const qo=!1;function ks(a,f){return{\u0275kind:a,\u0275providers:f}}const rl=new W.OlP("",{providedIn:"root",factory:()=>!1});function iu(){const a=(0,W.f3M)(W.zs3);return f=>{const d=a.get(W.z2F);if(f!==d.components[0])return;const y=a.get(ts),x=a.get(di);1===a.get(ou)&&y.initialNavigation(),a.get(Fc,null,W.XFs.Optional)?.setUpPreloading(),a.get(ic,null,W.XFs.Optional)?.init(),y.resetRootComponentType(d.componentTypes[0]),x.closed||(x.next(),x.unsubscribe())}}const di=new W.OlP(qo?"bootstrap done indicator":"",{factory:()=>new u.x}),ou=new W.OlP(qo?"initial navigation":"",{providedIn:"root",factory:()=>1});function Oc(){let a=[];return a=qo?[{provide:W.Xts,multi:!0,useFactory:()=>{const f=(0,W.f3M)(ts);return()=>f.events.subscribe(d=>{console.group?.(`Router Event: ${d.constructor.name}`),console.log(function ki(a){if(!("type"in a))return`Unknown Router Event: ${a.constructor.name}`;switch(a.type){case 14:return`ActivationEnd(path: '${a.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${a.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${a.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${a.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state}, shouldActivate: ${a.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 2:return`NavigationCancel(id: ${a.id}, url: '${a.url}')`;case 16:return`NavigationSkipped(id: ${a.id}, url: '${a.url}')`;case 1:return`NavigationEnd(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${a.id}, url: '${a.url}', error: ${a.error})`;case 0:return`NavigationStart(id: ${a.id}, url: '${a.url}')`;case 6:return`ResolveEnd(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 5:return`ResolveStart(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 10:return`RouteConfigLoadEnd(path: ${a.route.path})`;case 9:return`RouteConfigLoadStart(path: ${a.route.path})`;case 4:return`RoutesRecognized(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 15:return`Scroll(anchor: '${a.anchor}', position: '${a.position?`${a.position[0]}, ${a.position[1]}`:null}')`}}(d)),console.log(d),console.groupEnd?.()})}}]:[],ks(1,a)}const Fc=new W.OlP(qo?"router preloader":"");function oc(a){return ks(0,[{provide:Fc,useExisting:dh},{provide:Lo,useExisting:a}])}const Nl=!1,ac=new W.OlP(Nl?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),Ul=[rr.Ye,{provide:Rt,useClass:On},ts,Jo,{provide:Uo,useFactory:function fn(a){return a.routerState.root},deps:[ts]},Sa,Nl?{provide:rl,useValue:!0}:[]];function su(){return new W.PXZ("Router",ts)}let Ws=(()=>{class a{constructor(d){}static forRoot(d,y){return{ngModule:a,providers:[Ul,Nl&&y?.enableTracing?Oc().\u0275providers:[],{provide:Ca,multi:!0,useValue:d},{provide:ac,useFactory:ol,deps:[[ts,new W.FiY,new W.tp0]]},{provide:ml,useValue:y||{}},y?.useHash?{provide:rr.S$,useClass:rr.Do}:{provide:rr.S$,useClass:rr.b0},{provide:ic,useFactory:()=>{const a=(0,W.f3M)(rr.EM),f=(0,W.f3M)(W.R0b),d=(0,W.f3M)(ml),y=(0,W.f3M)(pl),x=(0,W.f3M)(Rt);return d.scrollOffset&&a.setOffset(d.scrollOffset),new na(x,y,a,f,d)}},y?.preloadingStrategy?oc(y.preloadingStrategy).\u0275providers:[],{provide:W.PXZ,multi:!0,useFactory:su},y?.initialNavigation?cc(y):[],[{provide:p,useFactory:iu},{provide:W.tb,multi:!0,useExisting:p}]]}}static forChild(d){return{ngModule:a,providers:[{provide:Ca,multi:!0,useValue:d}]}}}return a.\u0275fac=function(d){return new(d||a)(W.LFG(ac,8))},a.\u0275mod=W.oAB({type:a}),a.\u0275inj=W.cJS({imports:[xo]}),a})();function ol(a){if(Nl&&a)throw new W.vHH(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function cc(a){return["disabled"===a.initialNavigation?ks(3,[{provide:W.ip1,multi:!0,useFactory:()=>{const f=(0,W.f3M)(ts);return()=>{f.setUpLocationChangeListener()}}},{provide:ou,useValue:2}]).\u0275providers:[],"enabledBlocking"===a.initialNavigation?ks(2,[{provide:ou,useValue:0},{provide:W.ip1,multi:!0,deps:[W.zs3],useFactory:f=>{const d=f.get(rr.V_,Promise.resolve());return()=>d.then(()=>new Promise(y=>{const x=f.get(ts),E=f.get(di);(function yl(a,f){a.events.pipe((0,At.h)(d=>d instanceof Ki||d instanceof si||d instanceof ui||d instanceof so),(0,Vt.U)(d=>d instanceof Ki||d instanceof so?Rs.COMPLETE:d instanceof si&&(0===d.code||1===d.code)?Rs.REDIRECTING:Rs.FAILED),(0,At.h)(d=>d!==Rs.REDIRECTING),(0,rt.q)(1)).subscribe(()=>{f()})})(x,()=>{y(!0)}),f.get(pl).afterPreactivation=()=>(y(!0),E.closed?(0,Ve.of)(void 0):E),x.initialNavigation()}))}}]).\u0275providers:[]]}const p=new W.OlP(Nl?"Router Initializer":"")}},Yn=>{Yn(Yn.s=4066)}]);